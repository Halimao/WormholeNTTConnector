const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DuXi1xNY-DWC___-m.js","assets/index-BGLdF6jF.js","assets/index-CUtl-BF5.css"])))=>i.map(i=>d[i]);
import{aC as Q,aM as Do,aA as ge,_ as gw,bl as qo,aL as vw}from"./index-BGLdF6jF.js";import{s as jo,x as Tl,r as Dl,H as yw,c as ql,q as Os}from"./evm-A_PshNGs-BP88HHT7.js";import{L as Cs,O as As,U as Ts,T as Lt,v as Qt,G as Ye,y as ur,N as mw,j as Ar,P as jl,Q as _e,$ as Ds,X as Be,V as $o,M as ko,p as de,b as ie,H as ww,h as bw,R as Su,u as _w,f as Iw,n as qs,a as js,k as Ou,z as Nu,_ as Ew,D as Pw,m as Sw,w as Ow,c as Nw,d as Ru,e as Rw,x as xw,F as Cw,E as Aw,i as Tw,g as vs}from"./index.es-CEy-pF4C-DURb_lgF.js";import{a3 as j,a4 as Dw,a6 as $l,a5 as kl,a7 as qw}from"./index-CNWcuxPc-C5KIuBWR.js";const jw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ur},Symbol.toStringTag,{value:"Module"})),$w=":";function kw(o){const[e,r]=o.split($w);return{namespace:e,reference:r}}function Uw(o,e=[]){const r=[];return Object.keys(o).forEach(s=>{if(e.length&&!e.includes(s))return;const a=o[s];r.push(...a.accounts)}),r}function Ul(o,e){return o.includes(":")?[o]:e.chains||[]}const zl="base10",At="base16",wo="base64pad",Uo="utf8",Ml=0,lr=1,zw=0,xu=1,bo=12,zo=32;function Mw(){const o=Tl.generateKeyPair();return{privateKey:ie(o.secretKey,At),publicKey:ie(o.publicKey,At)}}function _o(){const o=Dl.randomBytes(zo);return ie(o,At)}function Lw(o,e){const r=Tl.sharedKey(de(o,At),de(e,At),!0),s=new yw(jo.SHA256,r).expand(zo);return ie(s,At)}function Kw(o){const e=jo.hash(de(o,At));return ie(e,At)}function Tr(o){const e=jo.hash(de(o,Uo));return ie(e,At)}function Hw(o){return de(`${o}`,zl)}function wn(o){return Number(ie(o,zl))}function Vw(o){const e=Hw(typeof o.type<"u"?o.type:Ml);if(wn(e)===lr&&typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof o.senderPublicKey<"u"?de(o.senderPublicKey,At):void 0,s=typeof o.iv<"u"?de(o.iv,At):Dl.randomBytes(bo),a=new ql.ChaCha20Poly1305(de(o.symKey,At)).seal(s,de(o.message,Uo));return Ww({type:e,sealed:a,iv:s,senderPublicKey:r})}function Fw(o){const e=new ql.ChaCha20Poly1305(de(o.symKey,At)),{sealed:r,iv:s}=Ns(o.encoded),a=e.open(s,r);if(a===null)throw new Error("Failed to decrypt");return ie(a,Uo)}function Ww(o){if(wn(o.type)===lr){if(typeof o.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ie(Ou([o.type,o.senderPublicKey,o.iv,o.sealed]),wo)}return ie(Ou([o.type,o.iv,o.sealed]),wo)}function Ns(o){const e=de(o,wo),r=e.slice(zw,xu),s=xu;if(wn(r)===lr){const g=s+zo,b=g+bo,d=e.slice(s,g),_=e.slice(g,b),I=e.slice(b);return{type:r,sealed:I,iv:_,senderPublicKey:d}}const a=s+bo,u=e.slice(s,a),h=e.slice(a);return{type:r,sealed:h,iv:u}}function Bw(o,e){const r=Ns(o);return Ll({type:wn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ie(r.senderPublicKey,At):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ll(o){const e=(o==null?void 0:o.type)||Ml;if(e===lr){if(typeof(o==null?void 0:o.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(o==null?void 0:o.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:o==null?void 0:o.senderPublicKey,receiverPublicKey:o==null?void 0:o.receiverPublicKey}}function Cu(o){return o.type===lr&&typeof o.senderPublicKey=="string"&&typeof o.receiverPublicKey=="string"}var Gw=Object.defineProperty,Au=Object.getOwnPropertySymbols,Qw=Object.prototype.hasOwnProperty,Jw=Object.prototype.propertyIsEnumerable,Tu=(o,e,r)=>e in o?Gw(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,Du=(o,e)=>{for(var r in e||(e={}))Qw.call(e,r)&&Tu(o,r,e[r]);if(Au)for(var r of Au(e))Jw.call(e,r)&&Tu(o,r,e[r]);return o};const Yw="ReactNative",Gt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Zw="js";function Mo(){return typeof Q.process<"u"&&typeof Q.process.versions<"u"&&typeof Q.process.versions.node<"u"}function qr(){return!kl()&&!!$l()&&navigator.product===Yw}function jr(){return!Mo()&&!!$l()&&!!kl()}function bn(){return qr()?Gt.reactNative:Mo()?Gt.node:jr()?Gt.browser:Gt.unknown}function Xw(){var o;try{return qr()&&typeof Q.global<"u"&&typeof(Q.global==null?void 0:Q.global.Application)<"u"?(o=Q.global.Application)==null?void 0:o.applicationId:void 0}catch{return}}function tb(o,e){let r=Os.parse(o);return r=Du(Du({},r),e),o=Os.stringify(r),o}function eb(){return Dw()||{name:"",description:"",url:"",icons:[""]}}function rb(){if(bn()===Gt.reactNative&&typeof Q.global<"u"&&typeof(Q.global==null?void 0:Q.global.Platform)<"u"){const{OS:r,Version:s}=Q.global.Platform;return[r,s].join("-")}const o=Tw();if(o===null)return"unknown";const e=o.os?o.os.replace(" ","").toLowerCase():"unknown";return o.type==="browser"?[e,o.name,o.version].join("-"):[e,o.version].join("-")}function nb(){var o;const e=bn();return e===Gt.browser?[e,((o=qw())==null?void 0:o.host)||"unknown"].join(":"):e}function sb(o,e,r){const s=rb(),a=nb();return[[o,e].join("-"),[Zw,r].join("-"),s,a].join("/")}function ib({protocol:o,version:e,relayUrl:r,sdkVersion:s,auth:a,projectId:u,useOnCloseEvent:h,bundleId:g}){const b=r.split("?"),d=sb(o,e,s),_={auth:a,ua:d,projectId:u,useOnCloseEvent:h,origin:g||void 0},I=tb(b[1]||"",_);return b[0]+"?"+I}function cr(o,e){return o.filter(r=>e.includes(r)).length===o.length}function Kl(o){return Object.fromEntries(o.entries())}function Hl(o){return new Map(Object.entries(o))}function xr(o=j.FIVE_MINUTES,e){const r=j.toMiliseconds(o||j.FIVE_MINUTES);let s,a,u;return{resolve:h=>{u&&s&&(clearTimeout(u),s(h))},reject:h=>{u&&a&&(clearTimeout(u),a(h))},done:()=>new Promise((h,g)=>{u=setTimeout(()=>{g(new Error(e))},r),s=h,a=g})}}function yn(o,e,r){return new Promise(async(s,a)=>{const u=setTimeout(()=>a(new Error(r)),e);try{const h=await o;s(h)}catch(h){a(h)}clearTimeout(u)})}function Vl(o,e){if(typeof e=="string"&&e.startsWith(`${o}:`))return e;if(o.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(o.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${o}`)}function ob(o){return Vl("topic",o)}function ab(o){return Vl("id",o)}function Fl(o){const[e,r]=o.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")s.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return s}function fe(o,e){return j.fromMiliseconds(Date.now()+j.toMiliseconds(o))}function Ge(o){return Date.now()>=j.toMiliseconds(o)}function dt(o,e){return`${o}${e?`:${e}`:""}`}function oo(o=[],e=[]){return[...new Set([...o,...e])]}async function cb({id:o,topic:e,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const u=`${a}/wc?requestId=${o}&sessionTopic=${e}`,h=bn();h===Gt.browser?u.startsWith("https://")?window.open(u,"_blank","noreferrer noopener"):window.open(u,"_self","noreferrer noopener"):h===Gt.reactNative&&typeof(Q.global==null?void 0:Q.global.Linking)<"u"&&await Q.global.Linking.openURL(u)}catch(s){console.error(s)}}async function ub(o,e){try{return await o.getItem(e)||(jr()?localStorage.getItem(e):void 0)}catch(r){console.error(r)}}const lb="irn";function Io(o){return(o==null?void 0:o.relay)||{protocol:lb}}function Is(o){const e=Ow[o];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${o}`);return e}var hb=Object.defineProperty,qu=Object.getOwnPropertySymbols,pb=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,ju=(o,e,r)=>e in o?hb(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,db=(o,e)=>{for(var r in e||(e={}))pb.call(e,r)&&ju(o,r,e[r]);if(qu)for(var r of qu(e))fb.call(e,r)&&ju(o,r,e[r]);return o};function gb(o,e="-"){const r={},s="relay"+e;return Object.keys(o).forEach(a=>{if(a.startsWith(s)){const u=a.replace(s,""),h=o[a];r[u]=h}}),r}function $u(o){o=o.includes("wc://")?o.replace("wc://",""):o,o=o.includes("wc:")?o.replace("wc:",""):o;const e=o.indexOf(":"),r=o.indexOf("?")!==-1?o.indexOf("?"):void 0,s=o.substring(0,e),a=o.substring(e+1,r).split("@"),u=typeof r<"u"?o.substring(r):"",h=Os.parse(u);return{protocol:s,topic:vb(a[0]),version:parseInt(a[1],10),symKey:h.symKey,relay:gb(h)}}function vb(o){return o.startsWith("//")?o.substring(2):o}function yb(o,e="-"){const r="relay",s={};return Object.keys(o).forEach(a=>{const u=r+e+a;o[a]&&(s[u]=o[a])}),s}function mb(o){return`${o.protocol}:${o.topic}@${o.version}?`+Os.stringify(db({symKey:o.symKey},yb(o.relay)))}function $r(o){const e=[];return o.forEach(r=>{const[s,a]=r.split(":");e.push(`${s}:${a}`)}),e}function wb(o){const e=[];return Object.values(o).forEach(r=>{e.push(...$r(r.accounts))}),e}function bb(o,e){const r=[];return Object.values(o).forEach(s=>{$r(s.accounts).includes(e)&&r.push(...s.methods)}),r}function _b(o,e){const r=[];return Object.values(o).forEach(s=>{$r(s.accounts).includes(e)&&r.push(...s.events)}),r}function Ib(o,e){const r=Es(o,e);if(r)throw new Error(r.message);const s={};for(const[a,u]of Object.entries(o))s[a]={methods:u.methods,events:u.events,chains:u.accounts.map(h=>`${h.split(":")[0]}:${h.split(":")[1]}`)};return s}function Lo(o){return o.includes(":")}function dn(o){return Lo(o)?o.split(":")[0]:o}const Eb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Pb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function C(o,e){const{message:r,code:s}=Pb[o];return{message:e?`${r} ${e}`:r,code:s}}function lt(o,e){const{message:r,code:s}=Eb[o];return{message:e?`${r} ${e}`:r,code:s}}function Ie(o,e){return!!Array.isArray(o)}function Dr(o){return Object.getPrototypeOf(o)===Object.prototype&&Object.keys(o).length}function Mt(o){return typeof o>"u"}function bt(o,e){return e&&Mt(o)?!0:typeof o=="string"&&!!o.trim().length}function Ko(o,e){return typeof o=="number"&&!isNaN(o)}function Sb(o,e){const{requiredNamespaces:r}=e,s=Object.keys(o.namespaces),a=Object.keys(r);let u=!0;return cr(a,s)?(s.forEach(h=>{const{accounts:g,methods:b,events:d}=o.namespaces[h],_=$r(g),I=r[h];(!cr(Ul(h,I),_)||!cr(I.methods,b)||!cr(I.events,d))&&(u=!1)}),u):!1}function Rs(o){return bt(o,!1)&&o.includes(":")?o.split(":").length===2:!1}function Ob(o){if(bt(o,!1)&&o.includes(":")){const e=o.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Rs(r)}}return!1}function Nb(o){if(bt(o,!1))try{return typeof new URL(o)<"u"}catch{return!1}return!1}function Rb(o){var e;return(e=o==null?void 0:o.proposer)==null?void 0:e.publicKey}function xb(o){return o==null?void 0:o.topic}function Cb(o,e){let r=null;return bt(o==null?void 0:o.publicKey,!1)||(r=C("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function ku(o){let e=!0;return Ie(o)?o.length&&(e=o.every(r=>bt(r,!1))):e=!1,e}function Ab(o,e,r){let s=null;return Ie(e)&&e.length?e.forEach(a=>{s||Rs(a)||(s=lt("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Rs(o)||(s=lt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function Tb(o,e,r){let s=null;return Object.entries(o).forEach(([a,u])=>{if(s)return;const h=Ab(a,Ul(a,u),`${e} ${r}`);h&&(s=h)}),s}function Db(o,e){let r=null;return Ie(o)?o.forEach(s=>{r||Ob(s)||(r=lt("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=lt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function qb(o,e){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=Db(s==null?void 0:s.accounts,`${e} namespace`);a&&(r=a)}),r}function jb(o,e){let r=null;return ku(o==null?void 0:o.methods)?ku(o==null?void 0:o.events)||(r=lt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=lt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Wl(o,e){let r=null;return Object.values(o).forEach(s=>{if(r)return;const a=jb(s,`${e}, namespace`);a&&(r=a)}),r}function $b(o,e,r){let s=null;if(o&&Dr(o)){const a=Wl(o,e);a&&(s=a);const u=Tb(o,e,r);u&&(s=u)}else s=C("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return s}function Es(o,e){let r=null;if(o&&Dr(o)){const s=Wl(o,e);s&&(r=s);const a=qb(o,e);a&&(r=a)}else r=C("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Bl(o){return bt(o.protocol,!0)}function kb(o,e){let r=!1;return o?o&&Ie(o)&&o.length&&o.forEach(s=>{r=Bl(s)}):r=!0,r}function Ub(o){return typeof o=="number"}function zt(o){return typeof o<"u"&&typeof o!==null}function zb(o){return!(!o||typeof o!="object"||!o.code||!Ko(o.code)||!o.message||!bt(o.message,!1))}function Mb(o){return!(Mt(o)||!bt(o.method,!1))}function Lb(o){return!(Mt(o)||Mt(o.result)&&Mt(o.error)||!Ko(o.id)||!bt(o.jsonrpc,!1))}function Kb(o){return!(Mt(o)||!bt(o.name,!1))}function Uu(o,e){return!(!Rs(e)||!wb(o).includes(e))}function Hb(o,e,r){return bt(r,!1)?bb(o,e).includes(r):!1}function Vb(o,e,r){return bt(r,!1)?_b(o,e).includes(r):!1}function zu(o,e,r){let s=null;const a=Fb(o),u=Wb(e),h=Object.keys(a),g=Object.keys(u),b=Mu(Object.keys(o)),d=Mu(Object.keys(e)),_=b.filter(I=>!d.includes(I));return _.length&&(s=C("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${_.toString()}
      Received: ${Object.keys(e).toString()}`)),cr(h,g)||(s=C("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${h.toString()}
      Approved: ${g.toString()}`)),Object.keys(e).forEach(I=>{if(!I.includes(":")||s)return;const P=$r(e[I].accounts);P.includes(I)||(s=C("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${I}
        Required: ${I}
        Approved: ${P.toString()}`))}),h.forEach(I=>{s||(cr(a[I].methods,u[I].methods)?cr(a[I].events,u[I].events)||(s=C("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${I}`)):s=C("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${I}`))}),s}function Fb(o){const e={};return Object.keys(o).forEach(r=>{var s;r.includes(":")?e[r]=o[r]:(s=o[r].chains)==null||s.forEach(a=>{e[a]={methods:o[r].methods,events:o[r].events}})}),e}function Mu(o){return[...new Set(o.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Wb(o){const e={};return Object.keys(o).forEach(r=>{if(r.includes(":"))e[r]=o[r];else{const s=$r(o[r].accounts);s==null||s.forEach(a=>{e[a]={accounts:o[r].accounts.filter(u=>u.includes(`${a}:`)),methods:o[r].methods,events:o[r].events}})}}),e}function Bb(o,e){return Ko(o)&&o<=e.max&&o>=e.min}function Lu(){const o=bn();return new Promise(e=>{switch(o){case Gt.browser:e(Gb());break;case Gt.reactNative:e(Qb());break;case Gt.node:e(Jb());break;default:e(!0)}})}function Gb(){return jr()&&(navigator==null?void 0:navigator.onLine)}async function Qb(){if(qr()&&typeof Q.global<"u"&&Q.global!=null&&Q.global.NetInfo){const o=await(Q.global==null?void 0:Q.global.NetInfo.fetch());return o==null?void 0:o.isConnected}return!0}function Jb(){return!0}function Yb(o){switch(bn()){case Gt.browser:Zb(o);break;case Gt.reactNative:Xb(o);break}}function Zb(o){!qr()&&jr()&&(window.addEventListener("online",()=>o(!0)),window.addEventListener("offline",()=>o(!1)))}function Xb(o){var e;qr()&&typeof Q.global<"u"&&Q.global!=null&&Q.global.NetInfo&&((e=Q.global)==null||e.NetInfo.addEventListener(r=>o(r==null?void 0:r.isConnected)))}const ao={};let ys=class{static get(o){return ao[o]}static set(o,e){ao[o]=e}static delete(o){delete ao[o]}};function t_(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function wt(o,...e){try{return t_(o(...e))}catch(r){return Promise.reject(r)}}function e_(o){const e=typeof o;return o===null||e!=="object"&&e!=="function"}function r_(o){const e=Object.getPrototypeOf(o);return!e||e.isPrototypeOf(Object)}function Ps(o){if(e_(o))return String(o);if(r_(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return Ps(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Eo="base64:";function n_(o){return typeof o=="string"?o:Eo+o_(o)}function s_(o){return typeof o!="string"||!o.startsWith(Eo)?o:i_(o.slice(Eo.length))}function i_(o){return globalThis.Buffer?Q.Buffer.from(o,"base64"):Uint8Array.from(globalThis.atob(o),e=>e.codePointAt(0))}function o_(o){return globalThis.Buffer?Q.Buffer.from(o).toString("base64"):globalThis.btoa(String.fromCodePoint(...o))}function Ut(o){var e;return o&&((e=o.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function a_(...o){return Ut(o.join(":"))}function ms(o){return o=Ut(o),o?o+":":""}function c_(o,e){if(e===void 0)return!0;let r=0,s=o.indexOf(":");for(;s>-1;)r++,s=o.indexOf(":",s+1);return r<=e}function u_(o,e){return e?o.startsWith(e)&&o[o.length-1]!=="$":o[o.length-1]!=="$"}const l_="memory",h_=()=>{const o=new Map;return{name:l_,getInstance:()=>o,hasItem(e){return o.has(e)},getItem(e){return o.get(e)??null},getItemRaw(e){return o.get(e)??null},setItem(e,r){o.set(e,r)},setItemRaw(e,r){o.set(e,r)},removeItem(e){o.delete(e)},getKeys(){return[...o.keys()]},clear(){o.clear()},dispose(){o.clear()}}};function p_(o={}){const e={mounts:{"":o.driver||h_()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=d=>{for(const _ of e.mountpoints)if(d.startsWith(_))return{base:_,relativeKey:d.slice(_.length),driver:e.mounts[_]};return{base:"",relativeKey:d,driver:e.mounts[""]}},s=(d,_)=>e.mountpoints.filter(I=>I.startsWith(d)||_&&d.startsWith(I)).map(I=>({relativeBase:d.length>I.length?d.slice(I.length):void 0,mountpoint:I,driver:e.mounts[I]})),a=(d,_)=>{if(e.watching){_=Ut(_);for(const I of e.watchListeners)I(d,_)}},u=async()=>{if(!e.watching){e.watching=!0;for(const d in e.mounts)e.unwatch[d]=await Ku(e.mounts[d],a,d)}},h=async()=>{if(e.watching){for(const d in e.unwatch)await e.unwatch[d]();e.unwatch={},e.watching=!1}},g=(d,_,I)=>{const P=new Map,T=x=>{let L=P.get(x.base);return L||(L={driver:x.driver,base:x.base,items:[]},P.set(x.base,L)),L};for(const x of d){const L=typeof x=="string",et=Ut(L?x:x.key),B=L?void 0:x.value,gt=L||!x.options?_:{..._,...x.options},J=r(et);T(J).items.push({key:et,value:B,relativeKey:J.relativeKey,options:gt})}return Promise.all([...P.values()].map(x=>I(x))).then(x=>x.flat())},b={hasItem(d,_={}){d=Ut(d);const{relativeKey:I,driver:P}=r(d);return wt(P.hasItem,I,_)},getItem(d,_={}){d=Ut(d);const{relativeKey:I,driver:P}=r(d);return wt(P.getItem,I,_).then(T=>vs(T))},getItems(d,_={}){return g(d,_,I=>I.driver.getItems?wt(I.driver.getItems,I.items.map(P=>({key:P.relativeKey,options:P.options})),_).then(P=>P.map(T=>({key:a_(I.base,T.key),value:vs(T.value)}))):Promise.all(I.items.map(P=>wt(I.driver.getItem,P.relativeKey,P.options).then(T=>({key:P.key,value:vs(T)})))))},getItemRaw(d,_={}){d=Ut(d);const{relativeKey:I,driver:P}=r(d);return P.getItemRaw?wt(P.getItemRaw,I,_):wt(P.getItem,I,_).then(T=>s_(T))},async setItem(d,_,I={}){if(_===void 0)return b.removeItem(d);d=Ut(d);const{relativeKey:P,driver:T}=r(d);T.setItem&&(await wt(T.setItem,P,Ps(_),I),T.watch||a("update",d))},async setItems(d,_){await g(d,_,async I=>{if(I.driver.setItems)return wt(I.driver.setItems,I.items.map(P=>({key:P.relativeKey,value:Ps(P.value),options:P.options})),_);I.driver.setItem&&await Promise.all(I.items.map(P=>wt(I.driver.setItem,P.relativeKey,Ps(P.value),P.options)))})},async setItemRaw(d,_,I={}){if(_===void 0)return b.removeItem(d,I);d=Ut(d);const{relativeKey:P,driver:T}=r(d);if(T.setItemRaw)await wt(T.setItemRaw,P,_,I);else if(T.setItem)await wt(T.setItem,P,n_(_),I);else return;T.watch||a("update",d)},async removeItem(d,_={}){typeof _=="boolean"&&(_={removeMeta:_}),d=Ut(d);const{relativeKey:I,driver:P}=r(d);P.removeItem&&(await wt(P.removeItem,I,_),(_.removeMeta||_.removeMata)&&await wt(P.removeItem,I+"$",_),P.watch||a("remove",d))},async getMeta(d,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),d=Ut(d);const{relativeKey:I,driver:P}=r(d),T=Object.create(null);if(P.getMeta&&Object.assign(T,await wt(P.getMeta,I,_)),!_.nativeOnly){const x=await wt(P.getItem,I+"$",_).then(L=>vs(L));x&&typeof x=="object"&&(typeof x.atime=="string"&&(x.atime=new Date(x.atime)),typeof x.mtime=="string"&&(x.mtime=new Date(x.mtime)),Object.assign(T,x))}return T},setMeta(d,_,I={}){return this.setItem(d+"$",_,I)},removeMeta(d,_={}){return this.removeItem(d+"$",_)},async getKeys(d,_={}){var I;d=ms(d);const P=s(d,!0);let T=[];const x=[];let L=!0;for(const B of P){(I=B.driver.flags)!=null&&I.maxDepth||(L=!1);const gt=await wt(B.driver.getKeys,B.relativeBase,_);for(const J of gt){const Y=B.mountpoint+Ut(J);T.some(st=>Y.startsWith(st))||x.push(Y)}T=[B.mountpoint,...T.filter(J=>!J.startsWith(B.mountpoint))]}const et=_.maxDepth!==void 0&&!L;return x.filter(B=>(!et||c_(B,_.maxDepth))&&u_(B,d))},async clear(d,_={}){d=ms(d),await Promise.all(s(d,!1).map(async I=>{if(I.driver.clear)return wt(I.driver.clear,I.relativeBase,_);if(I.driver.removeItem){const P=await I.driver.getKeys(I.relativeBase||"",_);return Promise.all(P.map(T=>I.driver.removeItem(T,_)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(d=>Hu(d)))},async watch(d){return await u(),e.watchListeners.push(d),async()=>{e.watchListeners=e.watchListeners.filter(_=>_!==d),e.watchListeners.length===0&&await h()}},async unwatch(){e.watchListeners=[],await h()},mount(d,_){if(d=ms(d),d&&e.mounts[d])throw new Error(`already mounted at ${d}`);return d&&(e.mountpoints.push(d),e.mountpoints.sort((I,P)=>P.length-I.length)),e.mounts[d]=_,e.watching&&Promise.resolve(Ku(_,a,d)).then(I=>{e.unwatch[d]=I}).catch(console.error),b},async unmount(d,_=!0){var I,P;d=ms(d),!(!d||!e.mounts[d])&&(e.watching&&d in e.unwatch&&((P=(I=e.unwatch)[d])==null||P.call(I),delete e.unwatch[d]),_&&await Hu(e.mounts[d]),e.mountpoints=e.mountpoints.filter(T=>T!==d),delete e.mounts[d])},getMount(d=""){d=Ut(d)+":";const _=r(d);return{driver:_.driver,base:_.base}},getMounts(d="",_={}){return d=Ut(d),s(d,_.parents).map(I=>({driver:I.driver,base:I.mountpoint}))},keys:(d,_={})=>b.getKeys(d,_),get:(d,_={})=>b.getItem(d,_),set:(d,_,I={})=>b.setItem(d,_,I),has:(d,_={})=>b.hasItem(d,_),del:(d,_={})=>b.removeItem(d,_),remove:(d,_={})=>b.removeItem(d,_)};return b}function Ku(o,e,r){return o.watch?o.watch((s,a)=>e(s,r+a)):()=>{}}async function Hu(o){typeof o.dispose=="function"&&await wt(o.dispose)}const f_="idb-keyval";var d_=(o={})=>{const e=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>e+a;let s;return o.dbName&&o.storeName&&(s=Nw(o.dbName,o.storeName)),{name:f_,options:o,async hasItem(a){return!(typeof await Ru(r(a),s)>"u")},async getItem(a){return await Ru(r(a),s)??null},setItem(a,u){return Rw(r(a),u,s)},removeItem(a){return xw(r(a),s)},getKeys(){return Cw(s)},clear(){return Aw(s)}}};const g_="WALLET_CONNECT_V2_INDEXED_DB",v_="keyvaluestorage";let y_=class{constructor(){this.indexedDb=p_({driver:d_({dbName:g_,storeName:v_})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(o=>[o.key,o.value])}async getItem(o){const e=await this.indexedDb.getItem(o);if(e!==null)return e}async setItem(o,e){await this.indexedDb.setItem(o,qs(e))}async removeItem(o){await this.indexedDb.removeItem(o)}};var co=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Q.global<"u"?Q.global:typeof self<"u"?self:{},Ss={exports:{}};(function(){let o;function e(){}o=e,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof co<"u"&&co.localStorage?Ss.exports=co.localStorage:typeof window<"u"&&window.localStorage?Ss.exports=window.localStorage:Ss.exports=new e})();function m_(o){var e;return[o[0],js((e=o[1])!=null?e:"")]}class w_{constructor(){this.localStorage=Ss.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(m_)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return js(r)}async setItem(e,r){this.localStorage.setItem(e,qs(r))}async removeItem(e){this.localStorage.removeItem(e)}}const b_="wc_storage_version",Vu=1,__=async(o,e,r)=>{const s=b_,a=await e.getItem(s);if(a&&a>=Vu){r(e);return}const u=await o.getKeys();if(!u.length){r(e);return}const h=[];for(;u.length;){const g=u.shift();if(!g)continue;const b=g.toLowerCase();if(b.includes("wc@")||b.includes("walletconnect")||b.includes("wc_")||b.includes("wallet_connect")){const d=await o.getItem(g);await e.setItem(g,d),h.push(g)}}await e.setItem(s,Vu),r(e),I_(o,h)},I_=async(o,e)=>{e.length&&e.forEach(async r=>{await o.removeItem(r)})};let E_=class{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const o=new w_;this.storage=o;try{const e=new y_;__(o,e,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(o){return await this.initialize(),this.storage.getItem(o)}async setItem(o,e){return await this.initialize(),this.storage.setItem(o,e)}async removeItem(o){return await this.initialize(),this.storage.removeItem(o)}async initialize(){this.initialized||await new Promise(o=>{const e=setInterval(()=>{this.initialized&&(clearInterval(e),o())},20)})}};var kr={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Po=function(o,e){return Po=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},Po(o,e)};function P_(o,e){Po(o,e);function r(){this.constructor=o}o.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var So=function(){return So=Object.assign||function(o){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(o[a]=e[a])}return o},So.apply(this,arguments)};function S_(o,e){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&e.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function O_(o,e,r,s){var a=arguments.length,u=a<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,r):s,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,e,r,s);else for(var g=o.length-1;g>=0;g--)(h=o[g])&&(u=(a<3?h(u):a>3?h(e,r,u):h(e,r))||u);return a>3&&u&&Object.defineProperty(e,r,u),u}function N_(o,e){return function(r,s){e(r,s,o)}}function R_(o,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,e)}function x_(o,e,r,s){function a(u){return u instanceof r?u:new r(function(h){h(u)})}return new(r||(r=Promise))(function(u,h){function g(_){try{d(s.next(_))}catch(I){h(I)}}function b(_){try{d(s.throw(_))}catch(I){h(I)}}function d(_){_.done?u(_.value):a(_.value).then(g,b)}d((s=s.apply(o,e||[])).next())})}function C_(o,e){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,h;return h={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function g(d){return function(_){return b([d,_])}}function b(d){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=d[0]&2?a.return:d[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,d[1])).done)return u;switch(a=0,u&&(d=[d[0]&2,u.value]),d[0]){case 0:case 1:u=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,a=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!u||d[1]>u[0]&&d[1]<u[3])){r.label=d[1];break}if(d[0]===6&&r.label<u[1]){r.label=u[1],u=d;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(d);break}u[2]&&r.ops.pop(),r.trys.pop();continue}d=e.call(o,r)}catch(_){d=[6,_],a=0}finally{s=u=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function A_(o,e,r,s){s===void 0&&(s=r),o[s]=e[r]}function T_(o,e){for(var r in o)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=o[r])}function Oo(o){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&o[e],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Gl(o,e){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],h;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(g){h={error:g}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(h)throw h.error}}return u}function D_(){for(var o=[],e=0;e<arguments.length;e++)o=o.concat(Gl(arguments[e]));return o}function q_(){for(var o=0,e=0,r=arguments.length;e<r;e++)o+=arguments[e].length;for(var s=Array(o),a=0,e=0;e<r;e++)for(var u=arguments[e],h=0,g=u.length;h<g;h++,a++)s[a]=u[h];return s}function mn(o){return this instanceof mn?(this.v=o,this):new mn(o)}function j_(o,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,e||[]),a,u=[];return a={},h("next"),h("throw"),h("return"),a[Symbol.asyncIterator]=function(){return this},a;function h(P){s[P]&&(a[P]=function(T){return new Promise(function(x,L){u.push([P,T,x,L])>1||g(P,T)})})}function g(P,T){try{b(s[P](T))}catch(x){I(u[0][3],x)}}function b(P){P.value instanceof mn?Promise.resolve(P.value.v).then(d,_):I(u[0][2],P)}function d(P){g("next",P)}function _(P){g("throw",P)}function I(P,T){P(T),u.shift(),u.length&&g(u[0][0],u[0][1])}}function $_(o){var e,r;return e={},s("next"),s("throw",function(a){throw a}),s("return"),e[Symbol.iterator]=function(){return this},e;function s(a,u){e[a]=o[a]?function(h){return(r=!r)?{value:mn(o[a](h)),done:a==="return"}:u?u(h):h}:u}}function k_(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=o[Symbol.asyncIterator],r;return e?e.call(o):(o=typeof Oo=="function"?Oo(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(h){return new Promise(function(g,b){h=o[u](h),a(g,b,h.done,h.value)})}}function a(u,h,g,b){Promise.resolve(b).then(function(d){u({value:d,done:g})},h)}}function U_(o,e){return Object.defineProperty?Object.defineProperty(o,"raw",{value:e}):o.raw=e,o}function z_(o){if(o&&o.__esModule)return o;var e={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(e[r]=o[r]);return e.default=o,e}function M_(o){return o&&o.__esModule?o:{default:o}}function L_(o,e){if(!e.has(o))throw new TypeError("attempted to get private field on non-instance");return e.get(o)}function K_(o,e,r){if(!e.has(o))throw new TypeError("attempted to set private field on non-instance");return e.set(o,r),r}const H_=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return So},__asyncDelegator:$_,__asyncGenerator:j_,__asyncValues:k_,__await:mn,__awaiter:x_,__classPrivateFieldGet:L_,__classPrivateFieldSet:K_,__createBinding:A_,__decorate:O_,__exportStar:T_,__extends:P_,__generator:C_,__importDefault:M_,__importStar:z_,__makeTemplateObject:U_,__metadata:R_,__param:N_,__read:Gl,__rest:S_,__spread:D_,__spreadArrays:q_,__values:Oo},Symbol.toStringTag,{value:"Module"})),$s=Do(H_);var an={},Fu={},cn={};const V_=Do(jw);var Wu;function F_(){if(Wu)return cn;Wu=1,Object.defineProperty(cn,"__esModule",{value:!0}),cn.IHeartBeat=void 0;const o=V_;class e extends o.IEvents{constructor(s){super()}}return cn.IHeartBeat=e,cn}var Bu;function Ql(){return Bu||(Bu=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),$s.__exportStar(F_(),o)}(Fu)),Fu}var Gu={},ar={},Qu;function W_(){if(Qu)return ar;Qu=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.HEARTBEAT_EVENTS=ar.HEARTBEAT_INTERVAL=void 0;const o=j;return ar.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,ar.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ar}var Ju;function Jl(){return Ju||(Ju=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),$s.__exportStar(W_(),o)}(Gu)),Gu}var Yu;function B_(){if(Yu)return an;Yu=1,Object.defineProperty(an,"__esModule",{value:!0}),an.HeartBeat=void 0;const o=$s,e=ge,r=j,s=Ql(),a=Jl();class u extends s.IHeartBeat{constructor(g){super(g),this.events=new e.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(g==null?void 0:g.interval)||a.HEARTBEAT_INTERVAL}static init(g){return o.__awaiter(this,void 0,void 0,function*(){const b=new u(g);return yield b.init(),b})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(g,b){this.events.on(g,b)}once(g,b){this.events.once(g,b)}off(g,b){this.events.off(g,b)}removeListener(g,b){this.events.removeListener(g,b)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return an.HeartBeat=u,an}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const e=$s;e.__exportStar(B_(),o),e.__exportStar(Ql(),o),e.__exportStar(Jl(),o)})(kr);class G_ extends ur{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Q_=class extends ur{constructor(o,e){super(),this.core=o,this.logger=e,this.records=new Map}},J_=class{constructor(o,e){this.logger=o,this.core=e}},Y_=class extends ur{constructor(o,e){super(),this.relayer=o,this.logger=e}},Z_=class extends ur{constructor(o){super()}},X_=class{constructor(o,e,r,s){this.core=o,this.logger=e,this.name=r}};class tI extends ur{constructor(e,r){super(),this.relayer=e,this.logger=r}}let eI=class extends ur{constructor(o,e){super(),this.core=o,this.logger=e}},rI=class{constructor(o,e){this.projectId=o,this.logger=e}},nI=class{constructor(o,e){this.projectId=o,this.logger=e}},sI=class{constructor(o){this.opts=o,this.protocol="wc",this.version=2}},iI=class{constructor(o){this.client=o}};class je extends mw{constructor(e){super(e),this.events=new ge.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Ar(e.method,e.params||[],e.id||jl().toString()),r)}async requestStrict(e,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${e.id}`,u=>{_e(u)?a(u.error):s(u.result)});try{await this.connection.send(e,r)}catch(u){a(u)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ds(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const oI=()=>typeof WebSocket<"u"?WebSocket:typeof Q.global<"u"&&typeof Q.global.WebSocket<"u"?Q.global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),aI=()=>typeof WebSocket<"u"||typeof Q.global<"u"&&typeof Q.global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Zu=o=>o.split("?")[0],Xu=10,cI=oI();let uI=class{constructor(o){if(this.url=o,this.events=new ge.EventEmitter,this.registering=!1,!Nu(o))throw new Error(`Provided URL is not compatible with WebSocket connection: ${o}`);this.url=o}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(o,e){this.events.on(o,e)}once(o,e){this.events.once(o,e)}off(o,e){this.events.off(o,e)}removeListener(o,e){this.events.removeListener(o,e)}async open(o=this.url){await this.register(o)}async close(){return new Promise((o,e)=>{if(typeof this.socket>"u"){e(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),o()},this.socket.close()})}async send(o){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(qs(o))}catch(e){this.onError(o.id,e)}}register(o=this.url){if(!Nu(o))throw new Error(`Provided URL is not compatible with WebSocket connection: ${o}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((r,s)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),s(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=o,this.registering=!0,new Promise((e,r)=>{const s=new URLSearchParams(o).get("origin"),a=Ew.isReactNative()?{headers:{origin:s}}:{rejectUnauthorized:!Pw(o)},u=new cI(o,[],a);aI()?u.onerror=h=>{const g=h;r(this.emitError(g.error))}:u.on("error",h=>{r(this.emitError(h))}),u.onopen=()=>{this.onOpen(u),e(u)}})}onOpen(o){o.onmessage=e=>this.onPayload(e),o.onclose=e=>this.onClose(e),this.socket=o,this.registering=!1,this.events.emit("open")}onClose(o){this.socket=void 0,this.registering=!1,this.events.emit("close",o)}onPayload(o){if(typeof o.data>"u")return;const e=typeof o.data=="string"?js(o.data):o.data;this.events.emit("payload",e)}onError(o,e){const r=this.parseError(e),s=r.message||r.toString(),a=$o(o,s);this.events.emit("payload",a)}parseError(o,e=this.url){return Sw(o,Zu(e),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Xu&&this.events.setMaxListeners(Xu)}emitError(o){const e=this.parseError(new Error((o==null?void 0:o.message)||`WebSocket connection failed for host: ${Zu(this.url)}`));return this.events.emit("register_error",e),e}};function lI(o,e){return e=e||{},new Promise(function(r,s){var a=new XMLHttpRequest,u=[],h=[],g={},b=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:b,headers:{keys:function(){return u},entries:function(){return h},get:function(_){return g[_.toLowerCase()]},has:function(_){return _.toLowerCase()in g}}}};for(var d in a.open(e.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,I,P){u.push(I=I.toLowerCase()),h.push([I,P]),g[I]=g[I]?g[I]+","+P:P}),r(b())},a.onerror=s,a.withCredentials=e.credentials=="include",e.headers)a.setRequestHeader(d,e.headers[d]);a.send(e.body||null)})}const hI=Object.freeze(Object.defineProperty({__proto__:null,default:lI},Symbol.toStringTag,{value:"Module"})),tl=Do(hI);var pI=self.fetch||(self.fetch=tl.default||tl);const fI=vw(pI);function dI(o,e){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),h=u.charCodeAt(0);if(r[h]!==255)throw new TypeError(u+" is ambiguous");r[h]=a}var g=o.length,b=o.charAt(0),d=Math.log(g)/Math.log(256),_=Math.log(256)/Math.log(g);function I(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var L=0,et=0,B=0,gt=x.length;B!==gt&&x[B]===0;)B++,L++;for(var J=(gt-B)*_+1>>>0,Y=new Uint8Array(J);B!==gt;){for(var st=x[B],Tt=0,ht=J-1;(st!==0||Tt<et)&&ht!==-1;ht--,Tt++)st+=256*Y[ht]>>>0,Y[ht]=st%g>>>0,st=st/g>>>0;if(st!==0)throw new Error("Non-zero carry");et=Tt,B++}for(var Nt=J-et;Nt!==J&&Y[Nt]===0;)Nt++;for(var ke=b.repeat(L);Nt<J;++Nt)ke+=o.charAt(Y[Nt]);return ke}function P(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var L=0;if(x[L]!==" "){for(var et=0,B=0;x[L]===b;)et++,L++;for(var gt=(x.length-L)*d+1>>>0,J=new Uint8Array(gt);x[L];){var Y=r[x.charCodeAt(L)];if(Y===255)return;for(var st=0,Tt=gt-1;(Y!==0||st<B)&&Tt!==-1;Tt--,st++)Y+=g*J[Tt]>>>0,J[Tt]=Y%256>>>0,Y=Y/256>>>0;if(Y!==0)throw new Error("Non-zero carry");B=st,L++}if(x[L]!==" "){for(var ht=gt-B;ht!==gt&&J[ht]===0;)ht++;for(var Nt=new Uint8Array(et+(gt-ht)),ke=et;ht!==gt;)Nt[ke++]=J[ht++];return Nt}}}function T(x){var L=P(x);if(L)return L;throw new Error(`Non-${e} character`)}return{encode:I,decodeUnsafe:P,decode:T}}var gI=dI,vI=gI;const Yl=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},yI=o=>new TextEncoder().encode(o),mI=o=>new TextDecoder().decode(o);class wI{constructor(e,r,s){this.name=e,this.prefix=r,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class bI{constructor(e,r,s){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Zl(this,e)}}class _I{constructor(e){this.decoders=e}or(e){return Zl(this,e)}decode(e){const r=e[0],s=this.decoders[r];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Zl=(o,e)=>new _I({...o.decoders||{[o.prefix]:o},...e.decoders||{[e.prefix]:e}});class II{constructor(e,r,s,a){this.name=e,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new wI(e,r,s),this.decoder=new bI(e,r,a)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ks=({name:o,prefix:e,encode:r,decode:s})=>new II(o,e,r,s),_n=({prefix:o,name:e,alphabet:r})=>{const{encode:s,decode:a}=vI(r,e);return ks({prefix:o,name:e,encode:s,decode:u=>Yl(a(u))})},EI=(o,e,r,s)=>{const a={};for(let _=0;_<e.length;++_)a[e[_]]=_;let u=o.length;for(;o[u-1]==="=";)--u;const h=new Uint8Array(u*r/8|0);let g=0,b=0,d=0;for(let _=0;_<u;++_){const I=a[o[_]];if(I===void 0)throw new SyntaxError(`Non-${s} character`);b=b<<r|I,g+=r,g>=8&&(g-=8,h[d++]=255&b>>g)}if(g>=r||255&b<<8-g)throw new SyntaxError("Unexpected end of data");return h},PI=(o,e,r)=>{const s=e[e.length-1]==="=",a=(1<<r)-1;let u="",h=0,g=0;for(let b=0;b<o.length;++b)for(g=g<<8|o[b],h+=8;h>r;)h-=r,u+=e[a&g>>h];if(h&&(u+=e[a&g<<r-h]),s)for(;u.length*r&7;)u+="=";return u},Et=({name:o,prefix:e,bitsPerChar:r,alphabet:s})=>ks({prefix:e,name:o,encode(a){return PI(a,s,r)},decode(a){return EI(a,s,r,o)}}),SI=ks({prefix:"\0",name:"identity",encode:o=>mI(o),decode:o=>yI(o)});var OI=Object.freeze({__proto__:null,identity:SI});const NI=Et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var RI=Object.freeze({__proto__:null,base2:NI});const xI=Et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var CI=Object.freeze({__proto__:null,base8:xI});const AI=_n({prefix:"9",name:"base10",alphabet:"0123456789"});var TI=Object.freeze({__proto__:null,base10:AI});const DI=Et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qI=Et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var jI=Object.freeze({__proto__:null,base16:DI,base16upper:qI});const $I=Et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kI=Et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),UI=Et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zI=Et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),MI=Et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),LI=Et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),KI=Et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),HI=Et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),VI=Et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var FI=Object.freeze({__proto__:null,base32:$I,base32upper:kI,base32pad:UI,base32padupper:zI,base32hex:MI,base32hexupper:LI,base32hexpad:KI,base32hexpadupper:HI,base32z:VI});const WI=_n({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),BI=_n({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var GI=Object.freeze({__proto__:null,base36:WI,base36upper:BI});const QI=_n({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),JI=_n({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var YI=Object.freeze({__proto__:null,base58btc:QI,base58flickr:JI});const ZI=Et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),XI=Et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),tE=Et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),eE=Et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var rE=Object.freeze({__proto__:null,base64:ZI,base64pad:XI,base64url:tE,base64urlpad:eE});const Xl=Array.from(""),nE=Xl.reduce((o,e,r)=>(o[r]=e,o),[]),sE=Xl.reduce((o,e,r)=>(o[e.codePointAt(0)]=r,o),[]);function iE(o){return o.reduce((e,r)=>(e+=nE[r],e),"")}function oE(o){const e=[];for(const r of o){const s=sE[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(s)}return new Uint8Array(e)}const aE=ks({prefix:"",name:"base256emoji",encode:iE,decode:oE});var cE=Object.freeze({__proto__:null,base256emoji:aE}),uE=th,el=128,lE=-128,hE=Math.pow(2,31);function th(o,e,r){e=e||[],r=r||0;for(var s=r;o>=hE;)e[r++]=o&255|el,o/=128;for(;o&lE;)e[r++]=o&255|el,o>>>=7;return e[r]=o|0,th.bytes=r-s+1,e}var pE=No,fE=128,rl=127;function No(o,s){var r=0,s=s||0,a=0,u=s,h,g=o.length;do{if(u>=g)throw No.bytes=0,new RangeError("Could not decode varint");h=o[u++],r+=a<28?(h&rl)<<a:(h&rl)*Math.pow(2,a),a+=7}while(h>=fE);return No.bytes=u-s,r}var dE=Math.pow(2,7),gE=Math.pow(2,14),vE=Math.pow(2,21),yE=Math.pow(2,28),mE=Math.pow(2,35),wE=Math.pow(2,42),bE=Math.pow(2,49),_E=Math.pow(2,56),IE=Math.pow(2,63),EE=function(o){return o<dE?1:o<gE?2:o<vE?3:o<yE?4:o<mE?5:o<wE?6:o<bE?7:o<_E?8:o<IE?9:10},PE={encode:uE,decode:pE,encodingLength:EE},eh=PE;const nl=(o,e,r=0)=>(eh.encode(o,e,r),e),sl=o=>eh.encodingLength(o),Ro=(o,e)=>{const r=e.byteLength,s=sl(o),a=s+sl(r),u=new Uint8Array(a+r);return nl(o,u,0),nl(r,u,s),u.set(e,a),new SE(o,r,e,u)};class SE{constructor(e,r,s,a){this.code=e,this.size=r,this.digest=s,this.bytes=a}}const rh=({name:o,code:e,encode:r})=>new OE(o,e,r);class OE{constructor(e,r,s){this.name=e,this.code=r,this.encode=s}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ro(this.code,r):r.then(s=>Ro(this.code,s))}else throw Error("Unknown type, must be binary type")}}const nh=o=>async e=>new Uint8Array(await crypto.subtle.digest(o,e)),NE=rh({name:"sha2-256",code:18,encode:nh("SHA-256")}),RE=rh({name:"sha2-512",code:19,encode:nh("SHA-512")});var xE=Object.freeze({__proto__:null,sha256:NE,sha512:RE});const sh=0,CE="identity",ih=Yl,AE=o=>Ro(sh,ih(o)),TE={code:sh,name:CE,encode:ih,digest:AE};var DE=Object.freeze({__proto__:null,identity:TE});new TextEncoder,new TextDecoder;const il={...OI,...RI,...CI,...TI,...jI,...FI,...GI,...YI,...rE,...cE};({...xE,...DE});function oh(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function qE(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?oh(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function ah(o,e,r,s){return{name:o,prefix:e,encoder:{name:o,prefix:e,encode:r},decoder:{decode:s}}}const ol=ah("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),uo=ah("ascii","a",o=>{let e="a";for(let r=0;r<o.length;r++)e+=String.fromCharCode(o[r]);return e},o=>{o=o.substring(1);const e=qE(o.length);for(let r=0;r<o.length;r++)e[r]=o.charCodeAt(r);return e}),jE={utf8:ol,"utf-8":ol,hex:il.base16,latin1:uo,ascii:uo,binary:uo,...il};function $E(o,e="utf8"){const r=jE[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?oh(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const ch="wc",kE=2,uh="core",Qe=`${ch}@2:${uh}:`,UE={logger:"error"},zE={database:":memory:"},ME="crypto",al="client_ed25519_seed",LE=j.ONE_DAY,KE="keychain",HE="0.3",VE="messages",FE="0.3",WE=j.SIX_HOURS,BE="publisher",lh="irn",GE="error",hh="wss://relay.walletconnect.com",cl="wss://relay.walletconnect.org",QE="relayer",Ot={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},JE="_subscription",De={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},YE=j.ONE_SECOND,ZE="2.11.0",XE=1e4,t0="0.3",e0="WALLETCONNECT_CLIENT_ID",pe={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},r0="subscription",n0="0.3",s0=j.FIVE_SECONDS*1e3,i0="pairing",o0="0.3",un={wc_pairingDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:j.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:j.ONE_DAY,prompt:!1,tag:0},res:{ttl:j.ONE_DAY,prompt:!1,tag:0}}},gn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},be={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},a0="history",c0="0.3",u0="expirer",se={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},l0="0.3",lo="verify-api",Cr="https://verify.walletconnect.com",xo="https://verify.walletconnect.org",h0=[Cr,xo],p0="echo",f0="https://echo.walletconnect.com";class d0{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=KE,this.version=HE,this.initialized=!1,this.storagePrefix=Qe,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=C("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=e,this.logger=Lt(r,this.name)}get context(){return Qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Kl(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Hl(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class g0{constructor(e,r,s){this.core=e,this.logger=r,this.name=ME,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=Su(a);return _w(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=Mw();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),h=Su(u),g=_o();return await Iw(g,a,LE,h)},this.generateSharedKey=(a,u,h)=>{this.isInitialized();const g=this.getPrivateKey(a),b=Lw(g,u);return this.setSymKey(b,h)},this.setSymKey=async(a,u)=>{this.isInitialized();const h=u||Kw(a);return await this.keychain.set(h,a),h},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,h)=>{this.isInitialized();const g=Ll(h),b=qs(u);if(Cu(g)){const P=g.senderPublicKey,T=g.receiverPublicKey;a=await this.generateSharedKey(P,T)}const d=this.getSymKey(a),{type:_,senderPublicKey:I}=g;return Vw({type:_,symKey:d,message:b,senderPublicKey:I})},this.decode=async(a,u,h)=>{this.isInitialized();const g=Bw(u,h);if(Cu(g)){const b=g.receiverPublicKey,d=g.senderPublicKey;a=await this.generateSharedKey(b,d)}try{const b=this.getSymKey(a),d=Fw({symKey:b,encoded:u});return js(d)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const u=Ns(a);return wn(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Ns(a);return u.senderPublicKey?ie(u.senderPublicKey,At):void 0},this.core=e,this.logger=Lt(r,this.name),this.keychain=s||new d0(this.core,this.logger)}get context(){return Qt(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(al)}catch{e=_o(),await this.keychain.set(al,e)}return $E(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class v0 extends J_{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=VE,this.version=FE,this.initialized=!1,this.storagePrefix=Qe,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=Tr(a);let h=this.messages.get(s);return typeof h>"u"&&(h={}),typeof h[u]<"u"||(h[u]=a,this.messages.set(s,h),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),h=Tr(a);return typeof u[h]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Lt(e,this.name),this.core=r}get context(){return Qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Kl(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Hl(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class y0 extends Y_{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ge.EventEmitter,this.name=BE,this.queue=new Map,this.publishTimeout=j.toMiliseconds(j.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const g=(u==null?void 0:u.ttl)||WE,b=Io(u),d=(u==null?void 0:u.prompt)||!1,_=(u==null?void 0:u.tag)||0,I=(u==null?void 0:u.id)||jl().toString(),P={topic:s,message:a,opts:{ttl:g,relay:b,prompt:d,tag:_,id:I}},T=setTimeout(()=>this.queue.set(I,P),this.publishTimeout);try{await await yn(this.rpcPublish(s,a,g,b,d,_,I),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(I),this.relayer.events.emit(Ot.publish,P)}catch(x){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(h=u==null?void 0:u.internal)!=null&&h.throwOnFailedPublish)throw this.removeRequestFromQueue(I),x;return}finally{clearTimeout(T)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=e,this.logger=Lt(r,this.name),this.registerEventListeners()}get context(){return Qt(this.logger)}rpcPublish(e,r,s,a,u,h,g){var b,d,_,I;const P={method:Is(a.protocol).publish,params:{topic:e,message:r,ttl:s,prompt:u,tag:h},id:g};return Mt((b=P.params)==null?void 0:b.prompt)&&((d=P.params)==null||delete d.prompt),Mt((_=P.params)==null?void 0:_.tag)&&((I=P.params)==null||delete I.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:P}),this.relayer.request(P)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:s,opts:a}=e;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(kr.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ot.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ot.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class m0{constructor(){this.map=new Map,this.set=(e,r)=>{const s=this.get(e);this.exists(e,r)||this.map.set(e,[...s,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(e);return}this.map.set(e,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var w0=Object.defineProperty,b0=Object.defineProperties,_0=Object.getOwnPropertyDescriptors,ul=Object.getOwnPropertySymbols,I0=Object.prototype.hasOwnProperty,E0=Object.prototype.propertyIsEnumerable,ll=(o,e,r)=>e in o?w0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,ln=(o,e)=>{for(var r in e||(e={}))I0.call(e,r)&&ll(o,r,e[r]);if(ul)for(var r of ul(e))E0.call(e,r)&&ll(o,r,e[r]);return o},ho=(o,e)=>b0(o,_0(e));class P0 extends tI{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new m0,this.events=new ge.EventEmitter,this.name=r0,this.version=n0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Qe,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=Io(a),h={topic:s,relay:u};this.pending.set(s,h);const g=await this.rpcSubscribe(s,u);return this.onSubscribe(g,h),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),g}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const h=new j.Watch;h.start(this.pendingSubscriptionWatchLabel);const g=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(g),h.stop(this.pendingSubscriptionWatchLabel),a(!0)),h.elapsed(this.pendingSubscriptionWatchLabel)>=s0&&(clearInterval(g),h.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Lt(r,this.name),this.clientId=""}get context(){return Qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let s=!1;try{s=this.getSubscription(e).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const s=this.topicMap.get(e);await Promise.all(s.map(async a=>await this.unsubscribeById(e,a,r)))}async unsubscribeById(e,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}});try{const a=Io(s);await this.rpcUnsubscribe(e,r,a);const u=lt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(e,r){const s={method:Is(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await yn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ot.connection_stalled)}return Tr(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,s={method:Is(r.protocol).batchSubscribe,params:{topics:e.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await yn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ot.connection_stalled)}}rpcUnsubscribe(e,r,s){const a={method:Is(s.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(e,r){this.setSubscription(e,ho(ln({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,ln({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,ln({},r)),this.topicMap.set(r.topic,e),this.events.emit(pe.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:s}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(pe.deleted,ho(ln({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(pe.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(pe.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Ie(r)&&this.onBatchSubscribe(r.map((s,a)=>ho(ln({},e[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(kr.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ot.connect,async()=>{await this.onConnect()}),this.relayer.on(Ot.disconnect,()=>{this.onDisconnect()}),this.events.on(pe.created,async e=>{const r=pe.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(pe.deleted,async e=>{const r=pe.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var S0=Object.defineProperty,hl=Object.getOwnPropertySymbols,O0=Object.prototype.hasOwnProperty,N0=Object.prototype.propertyIsEnumerable,pl=(o,e,r)=>e in o?S0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,R0=(o,e)=>{for(var r in e||(e={}))O0.call(e,r)&&pl(o,r,e[r]);if(hl)for(var r of hl(e))N0.call(e,r)&&pl(o,r,e[r]);return o};class x0 extends Z_{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ge.EventEmitter,this.name=QE,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Ot.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Ot.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(De.payload,this.onPayloadHandler),this.provider.on(De.connect,this.onConnectHandler),this.provider.on(De.disconnect,this.onDisconnectHandler),this.provider.on(De.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Lt(e.logger,this.name):Cs(As({level:e.logger||GE})),this.messages=new v0(this.logger,e.core),this.subscriber=new P0(this,this.logger),this.publisher=new y0(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||hh,this.projectId=e.projectId,this.bundleId=Xw(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${cl}...`),await this.restartTransport(cl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},XE)}get context(){return Qt(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,s){this.isInitialized(),await this.publisher.publish(e,r,s),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"";if(a)return a;let u;const h=g=>{g.topic===e&&(this.subscriber.off(pe.created,h),u())};return await Promise.all([new Promise(g=>{u=g,this.subscriber.on(pe.created,h)}),new Promise(async g=>{a=await this.subscriber.subscribe(e,r),g()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await yn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(pe.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await yn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(De.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Lu())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new je(new uI(ib({sdkVersion:ZE,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:s}=e;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(e){const{topic:r,message:s}=e;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ko(e)){if(!e.method.endsWith(JE))return;const r=e.params,{topic:s,message:a,publishedAt:u}=r.data,h={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(R0({type:"event",event:r.id},h)),this.events.emit(r.id,h),await this.acknowledgePayload(e),await this.onMessageEvent(h)}else Ds(e)&&this.events.emit(Ot.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Ot.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Ts(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(De.payload,this.onPayloadHandler),this.provider.off(De.connect,this.onConnectHandler),this.provider.off(De.disconnect,this.onDisconnectHandler),this.provider.off(De.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Ot.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await Lu();Yb(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Ot.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},j.toMiliseconds(YE)))}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var C0=Object.defineProperty,fl=Object.getOwnPropertySymbols,A0=Object.prototype.hasOwnProperty,T0=Object.prototype.propertyIsEnumerable,dl=(o,e,r)=>e in o?C0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,gl=(o,e)=>{for(var r in e||(e={}))A0.call(e,r)&&dl(o,r,e[r]);if(fl)for(var r of fl(e))T0.call(e,r)&&dl(o,r,e[r]);return o};class Us extends X_{constructor(e,r,s,a=Qe,u=void 0){super(e,r,s,a),this.core=e,this.logger=r,this.name=s,this.map=new Map,this.version=t0,this.cached=[],this.initialized=!1,this.storagePrefix=Qe,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(h=>{this.getKey&&h!==null&&!Mt(h)?this.map.set(this.getKey(h),h):Rb(h)?this.map.set(h.id,h):xb(h)&&this.map.set(h.topic,h)}),this.cached=[],this.initialized=!0)},this.set=async(h,g)=>{this.isInitialized(),this.map.has(h)?await this.update(h,g):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:h,value:g}),this.map.set(h,g),await this.persist())},this.get=h=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:h}),this.getData(h)),this.getAll=h=>(this.isInitialized(),h?this.values.filter(g=>Object.keys(h).every(b=>ww(g[b],h[b]))):this.values),this.update=async(h,g)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:h,update:g});const b=gl(gl({},this.getData(h)),g);this.map.set(h,b),await this.persist()},this.delete=async(h,g)=>{this.isInitialized(),this.map.has(h)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:h,reason:g}),this.map.delete(h),await this.persist())},this.logger=Lt(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return Qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:s}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class D0{constructor(e,r){this.core=e,this.logger=r,this.name=i0,this.version=o0,this.events=new qo,this.initialized=!1,this.storagePrefix=Qe,this.ignoredPayloadTypes=[lr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=_o(),a=await this.core.crypto.setSymKey(s),u=fe(j.FIVE_MINUTES),h={protocol:lh},g={topic:a,expiry:u,relay:h,active:!1},b=mb({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:h});return await this.pairings.set(a,g),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:b}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:h}=$u(s.uri);let g;if(this.pairings.keys.includes(a)&&(g=this.pairings.get(a),g.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const b=fe(j.FIVE_MINUTES),d={topic:a,relay:h,expiry:b,active:!1};return await this.pairings.set(a,d),this.core.expirer.set(a,b),s.activatePairing&&await this.activate({topic:a}),this.events.emit(gn.create,d),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:h})),d},this.activate=async({topic:s})=>{this.isInitialized();const a=fe(j.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:h,resolve:g,reject:b}=xr();this.events.once(dt("pairing_ping",u),({error:d})=>{d?b(d):g()}),await h()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",lt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const h=Ar(a,u),g=await this.core.crypto.encode(s,h),b=un[a].req;return this.core.history.set(s,h),this.core.relayer.publish(s,g,b),h.id},this.sendResult=async(s,a,u)=>{const h=Ts(s,u),g=await this.core.crypto.encode(a,h),b=await this.core.history.get(a,s),d=un[b.request.method].res;await this.core.relayer.publish(a,g,d),await this.core.history.resolve(h)},this.sendError=async(s,a,u)=>{const h=$o(s,u),g=await this.core.crypto.encode(a,h),b=await this.core.history.get(a,s),d=un[b.request.method]?un[b.request.method].res:un.unregistered_method.res;await this.core.relayer.publish(a,g,d),await this.core.history.resolve(h)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,lt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Ge(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,h=(await this.core.history.get(a,u.id)).request.method;switch(h){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(h)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(gn.ping,{id:u,topic:s})}catch(h){await this.sendError(u,s,h),this.logger.error(h)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{Be(a)?this.events.emit(dt("pairing_ping",u),{}):_e(a)&&this.events.emit(dt("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(gn.delete,{id:u,topic:s})}catch(h){await this.sendError(u,s,h),this.logger.error(h)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:h}=a;try{if(this.registeredMethods.includes(h))return;const g=lt("WC_METHOD_UNSUPPORTED",h);await this.sendError(u,s,g),this.logger.error(g)}catch(g){await this.sendError(u,s,g),this.logger.error(g)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(lt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!zt(s)){const{message:h}=C("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(h)}if(!Nb(s.uri)){const{message:h}=C("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(h)}const u=$u(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:h}=C("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(h)}if(!(u!=null&&u.symKey)){const{message:h}=C("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(h)}},this.isValidPing=async s=>{if(!zt(s)){const{message:u}=C("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!zt(s)){const{message:u}=C("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!bt(s,!1)){const{message:a}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Ge(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=C("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=e,this.logger=Lt(r,this.name),this.pairings=new Us(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Qt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ot.message,async e=>{const{topic:r,message:s}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{ko(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Ds(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(se.expired,async e=>{const{topic:r}=Fl(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(gn.expire,{topic:r}))})}}class q0 extends Q_{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ge.EventEmitter,this.name=a0,this.version=c0,this.cached=[],this.initialized=!1,this.storagePrefix=Qe,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const h={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:fe(j.THIRTY_DAYS)};this.records.set(h.id,h),this.events.emit(be.created,h)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=_e(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(be.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(be.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Lt(r,this.name)}get context(){return Qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Ar(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:s}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(be.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(be.created,e=>{const r=be.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(be.updated,e=>{const r=be.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(be.deleted,e=>{const r=be.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(kr.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{j.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class j0 extends eI{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ge.EventEmitter,this.name=u0,this.version=l0,this.cached=[],this.initialized=!1,this.storagePrefix=Qe,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),h={target:u,expiry:a};this.expirations.set(u,h),this.checkExpiry(u,h),this.events.emit(se.created,{target:u,expiration:h})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(se.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Lt(r,this.name)}get context(){return Qt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return ob(e);if(typeof e=="number")return ab(e);const{message:r}=C("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(se.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=C("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:s}=C("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(e,r){const{expiry:s}=r;j.toMiliseconds(s)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(se.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(kr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(se.created,e=>{const r=se.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(se.expired,e=>{const r=se.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(se.deleted,e=>{const r=se.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}}}class $0 extends rI{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=lo,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||qr()||!jr())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=xo;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(h){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(h),u=await this.fetchAttestation(s.attestationId,xo)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(j.ONE_SECOND*2),h=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),h.status===200?await h.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(lo))return u();window.addEventListener("message",a);const h=document.createElement("iframe");h.id=lo,h.src=`${this.verifyUrl}/${this.projectId}`,h.style.display="none",document.body.append(h),this.iframe=h,s=u}),new Promise((u,h)=>setTimeout(()=>{window.removeEventListener("message",a),h("verify iframe load timeout")},j.toMiliseconds(j.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||Cr;return h0.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${Cr}`),a=Cr),a},this.logger=Lt(r,this.name),this.verifyUrl=Cr,this.abortController=new AbortController,this.isDevEnv=Mo()&&Q.process.env.IS_VITEST}get context(){return Qt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),j.toMiliseconds(e))}}class k0 extends nI{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=p0,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:h,enableEncrypted:g=!1}=s,b=`${f0}/${this.projectId}/clients`;await fI(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:h,token:u,always_raw:g})})},this.logger=Lt(r,this.context)}}var U0=Object.defineProperty,vl=Object.getOwnPropertySymbols,z0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,yl=(o,e,r)=>e in o?U0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,ml=(o,e)=>{for(var r in e||(e={}))z0.call(e,r)&&yl(o,r,e[r]);if(vl)for(var r of vl(e))M0.call(e,r)&&yl(o,r,e[r]);return o};class Ho extends G_{constructor(e){super(e),this.protocol=ch,this.version=kE,this.name=uh,this.events=new ge.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||hh,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Cs(As({level:(e==null?void 0:e.logger)||UE.logger}));this.logger=Lt(r,this.name),this.heartbeat=new kr.HeartBeat,this.crypto=new g0(this,this.logger,e==null?void 0:e.keychain),this.history=new q0(this,this.logger),this.expirer=new j0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new E_(ml(ml({},zE),e==null?void 0:e.storageOptions)),this.relayer=new x0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new D0(this,this.logger),this.verify=new $0(this.projectId||"",this.logger),this.echoClient=new k0(this.projectId||"",this.logger)}static async init(e){const r=new Ho(e);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(e0,s),r}get context(){return Qt(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const L0=Ho,ph="wc",fh=2,dh="client",Vo=`${ph}@${fh}:${dh}:`,po={name:dh,logger:"error"},wl="WALLETCONNECT_DEEPLINK_CHOICE",K0="proposal",gh="Proposal expired",H0="session",ws=j.SEVEN_DAYS,V0="engine",hn={wc_sessionPropose:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1104},res:{ttl:j.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1106},res:{ttl:j.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:j.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:j.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:j.ONE_DAY,prompt:!1,tag:1112},res:{ttl:j.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:j.THIRTY_SECONDS,prompt:!1,tag:1115}}},fo={min:j.FIVE_MINUTES,max:j.SEVEN_DAYS},qe={idle:"IDLE",active:"ACTIVE"},F0="request",W0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var B0=Object.defineProperty,G0=Object.defineProperties,Q0=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,J0=Object.prototype.hasOwnProperty,Y0=Object.prototype.propertyIsEnumerable,_l=(o,e,r)=>e in o?B0(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,kt=(o,e)=>{for(var r in e||(e={}))J0.call(e,r)&&_l(o,r,e[r]);if(bl)for(var r of bl(e))Y0.call(e,r)&&_l(o,r,e[r]);return o},pn=(o,e)=>G0(o,Q0(e));class Z0 extends iI{constructor(e){super(e),this.name=V0,this.events=new qo,this.initialized=!1,this.ignoredPayloadTypes=[lr],this.requestQueue={state:qe.idle,queue:[]},this.sessionRequestQueue={state:qe.idle,queue:[]},this.requestQueueDelay=j.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(hn)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=pn(kt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:h,sessionProperties:g,relays:b}=s;let d=a,_,I=!1;if(d&&(I=this.client.core.pairing.pairings.get(d).active),!d||!I){const{topic:J,uri:Y}=await this.client.core.pairing.create();d=J,_=Y}const P=await this.client.core.crypto.generateKeyPair(),T=kt({requiredNamespaces:u,optionalNamespaces:h,relays:b??[{protocol:lh}],proposer:{publicKey:P,metadata:this.client.metadata}},g&&{sessionProperties:g}),{reject:x,resolve:L,done:et}=xr(j.FIVE_MINUTES,gh);if(this.events.once(dt("session_connect"),async({error:J,session:Y})=>{if(J)x(J);else if(Y){Y.self.publicKey=P;const st=pn(kt({},Y),{requiredNamespaces:Y.requiredNamespaces,optionalNamespaces:Y.optionalNamespaces});await this.client.session.set(Y.topic,st),await this.setExpiry(Y.topic,Y.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:Y.peer.metadata}),L(st)}}),!d){const{message:J}=C("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(J)}const B=await this.sendRequest({topic:d,method:"wc_sessionPropose",params:T}),gt=fe(j.FIVE_MINUTES);return await this.setProposal(B,kt({id:B,expiry:gt},T)),{uri:_,approval:et}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:h}=r,g=this.client.proposal.get(s);let{pairingTopic:b,proposer:d,requiredNamespaces:_,optionalNamespaces:I}=g;b=b||"",Dr(_)||(_=Ib(u,"approve()"));const P=await this.client.core.crypto.generateKeyPair(),T=d.publicKey,x=await this.client.core.crypto.generateSharedKey(P,T);b&&s&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:d.metadata}),await this.sendResult({id:s,topic:b,result:{relay:{protocol:a??"irn"},responderPublicKey:P}}),await this.client.proposal.delete(s,lt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const L=kt({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:_,optionalNamespaces:I,pairingTopic:b,controller:{publicKey:P,metadata:this.client.metadata},expiry:fe(ws)},h&&{sessionProperties:h});await this.client.core.relayer.subscribe(x),await this.sendRequest({topic:x,method:"wc_sessionSettle",params:L,throwOnFailedPublish:!0});const et=pn(kt({},L),{topic:x,pairingTopic:b,acknowledged:!1,self:L.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:P});return await this.client.session.set(x,et),await this.setExpiry(x,fe(ws)),{topic:x,acknowledged:()=>new Promise(B=>setTimeout(()=>B(this.client.session.get(x)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,lt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:h,resolve:g,reject:b}=xr();return this.events.once(dt("session_update",u),({error:d})=>{d?b(d):g()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:h}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:h,reject:g}=xr();return this.events.once(dt("session_extend",a),({error:b})=>{b?g(b):h()}),await this.setExpiry(s,fe(ws)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:h}=r,g=bw(),{done:b,resolve:d,reject:_}=xr(h,"Request expired. Please try again.");return this.events.once(dt("session_request",g),({error:I,result:P})=>{I?_(I):d(P)}),await Promise.all([new Promise(async I=>{await this.sendRequest({clientRpcId:g,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:h,throwOnFailedPublish:!0}).catch(P=>_(P)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:g}),I()}),new Promise(async I=>{const P=await ub(this.client.core.storage,wl);cb({id:g,topic:u,wcDeepLink:P}),I()}),b()]).then(I=>I[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;Be(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):_e(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:h,reject:g}=xr();this.events.once(dt("session_ping",a),({error:b})=>{b?g(b):h()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:lt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Sb(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var h,g;return((h=u.peerMetadata)==null?void 0:h.url)&&((g=u.peerMetadata)==null?void 0:g.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,lt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(wl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,lt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,lt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=qe.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=hn.wc_sessionRequest.req.ttl,{id:a,topic:u,params:h,verifyContext:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:h,verifyContext:g}),s&&this.client.core.expirer.set(a,fe(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:h,relayRpcId:g,clientRpcId:b,throwOnFailedPublish:d}=r,_=Ar(a,u,b);if(jr()&&W0.includes(a)){const T=Tr(JSON.stringify(_));this.client.core.verify.register({attestationId:T})}const I=await this.client.core.crypto.encode(s,_),P=hn[a].req;return h&&(P.ttl=h),g&&(P.id=g),this.client.core.history.set(s,_),d?(P.internal=pn(kt({},P.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,I,P)):this.client.core.relayer.publish(s,I,P).catch(T=>this.client.logger.error(T)),_.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:h}=r,g=Ts(s,u),b=await this.client.core.crypto.encode(a,g),d=await this.client.core.history.get(a,s),_=hn[d.request.method].res;h?(_.internal=pn(kt({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,b,_)):this.client.core.relayer.publish(a,b,_).catch(I=>this.client.logger.error(I)),await this.client.core.history.resolve(g)},this.sendError=async(r,s,a)=>{const u=$o(r,a),h=await this.client.core.crypto.encode(s,u),g=await this.client.core.history.get(s,r),b=hn[g.request.method].res;this.client.core.relayer.publish(s,h,b),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Ge(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Ge(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===qe.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=qe.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=qe.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=C("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(kt({},s.params));const h=fe(j.FIVE_MINUTES),g=kt({id:u,pairingTopic:r,expiry:h},a);await this.setProposal(u,g);const b=Tr(JSON.stringify(s)),d=await this.getVerifyContext(b,g.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:g,verifyContext:d})}catch(h){await this.sendError(u,r,h),this.client.logger.error(h)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(Be(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const h=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:h});const g=h.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});const b=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const d=await this.client.core.crypto.generateSharedKey(g,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const _=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else _e(s)&&(await this.client.proposal.delete(a,lt("USER_DISCONNECTED")),this.events.emit(dt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:h,controller:g,expiry:b,namespaces:d,requiredNamespaces:_,optionalNamespaces:I,sessionProperties:P,pairingTopic:T}=s.params,x=kt({topic:r,relay:h,expiry:b,namespaces:d,acknowledged:!0,pairingTopic:T,requiredNamespaces:_,optionalNamespaces:I,controller:g.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},P&&{sessionProperties:P});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(dt("session_connect"),{session:x}),this.cleanupDuplicatePairings(x)}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;Be(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(dt("session_approve",a),{})):_e(s)&&(await this.client.session.delete(r,lt("USER_DISCONNECTED")),this.events.emit(dt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const h=`${r}_session_update`,g=ys.get(h);if(g&&this.isRequestOutOfSync(g,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(kt({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),ys.set(h,u)}catch(h){await this.sendError(u,r,h),this.client.logger.error(h)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;Be(s)?this.events.emit(dt("session_update",a),{}):_e(s)&&this.events.emit(dt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,fe(ws)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;Be(s)?this.events.emit(dt("session_extend",a),{}):_e(s)&&this.events.emit(dt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{Be(s)?this.events.emit(dt("session_ping",a),{}):_e(s)&&this.events.emit(dt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Ot.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(kt({topic:r},u));const h=Tr(JSON.stringify(Ar("wc_sessionRequest",u,a))),g=this.client.session.get(r),b=await this.getVerifyContext(h,g.peer.metadata),d={id:a,topic:r,params:u,verifyContext:b};await this.setPendingSessionRequest(d),this.addSessionRequestToSessionRequestQueue(d),this.processSessionRequestQueue()}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;Be(s)?this.events.emit(dt("session_request",a),{result:s.result}):_e(s)&&this.events.emit(dt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const h=`${r}_session_event_${u.event.name}`,g=ys.get(h);if(g&&this.isRequestOutOfSync(g,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(kt({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),ys.set(h,a)}catch(h){await this.sendError(a,r,h),this.client.logger.error(h)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=qe.idle,this.processSessionRequestQueue()},j.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===qe.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=qe.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Ar("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!zt(r)){const{message:b}=C("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(b)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:h,relays:g}=r;if(Mt(s)||await this.isValidPairingTopic(s),!kb(g)){const{message:b}=C("MISSING_OR_INVALID",`connect() relays: ${g}`);throw new Error(b)}!Mt(a)&&Dr(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!Mt(u)&&Dr(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),Mt(h)||this.validateSessionProps(h,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=$b(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!zt(r))throw new Error(C("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:h}=r;await this.isValidProposalId(s);const g=this.client.proposal.get(s),b=Es(a,"approve()");if(b)throw new Error(b.message);const d=zu(g.requiredNamespaces,a,"approve()");if(d)throw new Error(d.message);if(!bt(u,!0)){const{message:_}=C("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(_)}Mt(h)||this.validateSessionProps(h,"sessionProperties")},this.isValidReject=async r=>{if(!zt(r)){const{message:u}=C("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!zb(a)){const{message:u}=C("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!zt(r)){const{message:d}=C("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(d)}const{relay:s,controller:a,namespaces:u,expiry:h}=r;if(!Bl(s)){const{message:d}=C("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const g=Cb(a,"onSessionSettleRequest()");if(g)throw new Error(g.message);const b=Es(u,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Ge(h)){const{message:d}=C("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async r=>{if(!zt(r)){const{message:b}=C("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(b)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),h=Es(a,"update()");if(h)throw new Error(h.message);const g=zu(u.requiredNamespaces,a,"update()");if(g)throw new Error(g.message)},this.isValidExtend=async r=>{if(!zt(r)){const{message:a}=C("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!zt(r)){const{message:b}=C("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(b)}const{topic:s,request:a,chainId:u,expiry:h}=r;await this.isValidSessionTopic(s);const{namespaces:g}=this.client.session.get(s);if(!Uu(g,u)){const{message:b}=C("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(b)}if(!Mb(a)){const{message:b}=C("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!Hb(g,u,a.method)){const{message:b}=C("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(h&&!Bb(h,fo)){const{message:b}=C("MISSING_OR_INVALID",`request() expiry: ${h}. Expiry must be a number (in seconds) between ${fo.min} and ${fo.max}`);throw new Error(b)}},this.isValidRespond=async r=>{var s;if(!zt(r)){const{message:h}=C("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(h){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),h}if(!Lb(u)){const{message:h}=C("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!zt(r)){const{message:a}=C("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!zt(r)){const{message:g}=C("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(g)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:h}=this.client.session.get(s);if(!Uu(h,u)){const{message:g}=C("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(g)}if(!Kb(a)){const{message:g}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}if(!Vb(h,u,a.name)){const{message:g}=C("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(g)}},this.isValidDisconnect=async r=>{if(!zt(r)){const{message:a}=C("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||Cr,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!bt(a,!1)){const{message:u}=C("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:e}=C("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Ot.message,async e=>{const{topic:r,message:s}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{ko(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Ds(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(se.expired,async e=>{const{topic:r,id:s}=Fl(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,C("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(gn.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!bt(e,!1)){const{message:r}=C("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Ge(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=C("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!bt(e,!1)){const{message:r}=C("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Ge(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=C("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(bt(e,!1)){const{message:r}=C("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=C("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Ub(e)){const{message:r}=C("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=C("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Ge(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=C("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class X0 extends Us{constructor(e,r){super(e,r,K0,Vo),this.core=e,this.logger=r}}class tP extends Us{constructor(e,r){super(e,r,H0,Vo),this.core=e,this.logger=r}}class eP extends Us{constructor(e,r){super(e,r,F0,Vo,s=>s.id),this.core=e,this.logger=r}}let rP=class vh extends sI{constructor(e){super(e),this.protocol=ph,this.version=fh,this.name=po.name,this.events=new ge.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(e==null?void 0:e.name)||po.name,this.metadata=(e==null?void 0:e.metadata)||eb();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Cs(As({level:(e==null?void 0:e.logger)||po.logger}));this.core=(e==null?void 0:e.core)||new L0(e),this.logger=Lt(r,this.name),this.session=new tP(this.core,this.logger),this.proposal=new X0(this.core,this.logger),this.pendingRequest=new eP(this.core,this.logger),this.engine=new Z0(this)}static async init(e){const r=new vh(e);return await r.initialize(),r}get context(){return Qt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Il="error",nP="wss://relay.walletconnect.com",sP="wc",iP="universal_provider",El=`${sP}@2:${iP}:`,oP="https://rpc.walletconnect.com/v1/",$e={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Q.global<"u"?Q.global:typeof self<"u"?self:{},Co={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,e){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",g="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",d=500,_="__lodash_placeholder__",I=1,P=2,T=4,x=1,L=2,et=1,B=2,gt=4,J=8,Y=16,st=32,Tt=64,ht=128,Nt=256,ke=512,wh=30,bh="...",_h=800,Ih=16,Bo=1,Eh=2,Ph=3,In=1/0,pr=9007199254740991,Sh=17976931348623157e292,En=NaN,ve=4294967295,Oh=ve-1,Nh=ve>>>1,Rh=[["ary",ht],["bind",et],["bindKey",B],["curry",J],["curryRight",Y],["flip",ke],["partial",st],["partialRight",Tt],["rearg",Nt]],fr="[object Arguments]",Pn="[object Array]",xh="[object AsyncFunction]",Ur="[object Boolean]",zr="[object Date]",Ch="[object DOMException]",Sn="[object Error]",On="[object Function]",Go="[object GeneratorFunction]",oe="[object Map]",Mr="[object Number]",Ah="[object Null]",Ee="[object Object]",Qo="[object Promise]",Th="[object Proxy]",Lr="[object RegExp]",ae="[object Set]",Kr="[object String]",Nn="[object Symbol]",Dh="[object Undefined]",Hr="[object WeakMap]",qh="[object WeakSet]",Vr="[object ArrayBuffer]",dr="[object DataView]",zs="[object Float32Array]",Ms="[object Float64Array]",Ls="[object Int8Array]",Ks="[object Int16Array]",Hs="[object Int32Array]",Vs="[object Uint8Array]",Fs="[object Uint8ClampedArray]",Ws="[object Uint16Array]",Bs="[object Uint32Array]",jh=/\b__p \+= '';/g,$h=/\b(__p \+=) '' \+/g,kh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Jo=/&(?:amp|lt|gt|quot|#39);/g,Yo=/[&<>"']/g,Uh=RegExp(Jo.source),zh=RegExp(Yo.source),Mh=/<%-([\s\S]+?)%>/g,Lh=/<%([\s\S]+?)%>/g,Zo=/<%=([\s\S]+?)%>/g,Kh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hh=/^\w*$/,Vh=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Gs=/[\\^$.*+?()[\]{}|]/g,Fh=RegExp(Gs.source),Qs=/^\s+/,Wh=/\s/,Bh=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Gh=/\{\n\/\* \[wrapped with (.+)\] \*/,Qh=/,? & /,Jh=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Yh=/[()=,{}\[\]\/\s]/,Zh=/\\(\\)?/g,Xh=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Xo=/\w*$/,tp=/^[-+]0x[0-9a-f]+$/i,ep=/^0b[01]+$/i,rp=/^\[object .+?Constructor\]$/,np=/^0o[0-7]+$/i,sp=/^(?:0|[1-9]\d*)$/,ip=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Rn=/($^)/,op=/['\n\r\u2028\u2029\\]/g,xn="\\ud800-\\udfff",ap="\\u0300-\\u036f",cp="\\ufe20-\\ufe2f",up="\\u20d0-\\u20ff",ta=ap+cp+up,ea="\\u2700-\\u27bf",ra="a-z\\xdf-\\xf6\\xf8-\\xff",lp="\\xac\\xb1\\xd7\\xf7",hp="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",pp="\\u2000-\\u206f",fp=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",na="A-Z\\xc0-\\xd6\\xd8-\\xde",sa="\\ufe0e\\ufe0f",ia=lp+hp+pp+fp,Js="[']",dp="["+xn+"]",oa="["+ia+"]",Cn="["+ta+"]",aa="\\d+",gp="["+ea+"]",ca="["+ra+"]",ua="[^"+xn+ia+aa+ea+ra+na+"]",Ys="\\ud83c[\\udffb-\\udfff]",vp="(?:"+Cn+"|"+Ys+")",la="[^"+xn+"]",Zs="(?:\\ud83c[\\udde6-\\uddff]){2}",Xs="[\\ud800-\\udbff][\\udc00-\\udfff]",gr="["+na+"]",ha="\\u200d",pa="(?:"+ca+"|"+ua+")",yp="(?:"+gr+"|"+ua+")",fa="(?:"+Js+"(?:d|ll|m|re|s|t|ve))?",da="(?:"+Js+"(?:D|LL|M|RE|S|T|VE))?",ga=vp+"?",va="["+sa+"]?",mp="(?:"+ha+"(?:"+[la,Zs,Xs].join("|")+")"+va+ga+")*",wp="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",bp="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ya=va+ga+mp,_p="(?:"+[gp,Zs,Xs].join("|")+")"+ya,Ip="(?:"+[la+Cn+"?",Cn,Zs,Xs,dp].join("|")+")",Ep=RegExp(Js,"g"),Pp=RegExp(Cn,"g"),ti=RegExp(Ys+"(?="+Ys+")|"+Ip+ya,"g"),Sp=RegExp([gr+"?"+ca+"+"+fa+"(?="+[oa,gr,"$"].join("|")+")",yp+"+"+da+"(?="+[oa,gr+pa,"$"].join("|")+")",gr+"?"+pa+"+"+fa,gr+"+"+da,bp,wp,aa,_p].join("|"),"g"),Op=RegExp("["+ha+xn+ta+sa+"]"),Np=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Rp=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],xp=-1,it={};it[zs]=it[Ms]=it[Ls]=it[Ks]=it[Hs]=it[Vs]=it[Fs]=it[Ws]=it[Bs]=!0,it[fr]=it[Pn]=it[Vr]=it[Ur]=it[dr]=it[zr]=it[Sn]=it[On]=it[oe]=it[Mr]=it[Ee]=it[Lr]=it[ae]=it[Kr]=it[Hr]=!1;var nt={};nt[fr]=nt[Pn]=nt[Vr]=nt[dr]=nt[Ur]=nt[zr]=nt[zs]=nt[Ms]=nt[Ls]=nt[Ks]=nt[Hs]=nt[oe]=nt[Mr]=nt[Ee]=nt[Lr]=nt[ae]=nt[Kr]=nt[Nn]=nt[Vs]=nt[Fs]=nt[Ws]=nt[Bs]=!0,nt[Sn]=nt[On]=nt[Hr]=!1;var Cp={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Ap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tp={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Dp={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qp=parseFloat,jp=parseInt,ma=typeof fn=="object"&&fn&&fn.Object===Object&&fn,$p=typeof self=="object"&&self&&self.Object===Object&&self,_t=ma||$p||Function("return this")(),ei=e&&!e.nodeType&&e,Ze=ei&&!0&&o&&!o.nodeType&&o,wa=Ze&&Ze.exports===ei,ri=wa&&ma.process,Jt=function(){try{var m=Ze&&Ze.require&&Ze.require("util").types;return m||ri&&ri.binding&&ri.binding("util")}catch{}}(),ba=Jt&&Jt.isArrayBuffer,_a=Jt&&Jt.isDate,Ia=Jt&&Jt.isMap,Ea=Jt&&Jt.isRegExp,Pa=Jt&&Jt.isSet,Sa=Jt&&Jt.isTypedArray;function Kt(m,S,E){switch(E.length){case 0:return m.call(S);case 1:return m.call(S,E[0]);case 2:return m.call(S,E[0],E[1]);case 3:return m.call(S,E[0],E[1],E[2])}return m.apply(S,E)}function kp(m,S,E,D){for(var z=-1,Z=m==null?0:m.length;++z<Z;){var vt=m[z];S(D,vt,E(vt),m)}return D}function Yt(m,S){for(var E=-1,D=m==null?0:m.length;++E<D&&S(m[E],E,m)!==!1;);return m}function Up(m,S){for(var E=m==null?0:m.length;E--&&S(m[E],E,m)!==!1;);return m}function Oa(m,S){for(var E=-1,D=m==null?0:m.length;++E<D;)if(!S(m[E],E,m))return!1;return!0}function Ue(m,S){for(var E=-1,D=m==null?0:m.length,z=0,Z=[];++E<D;){var vt=m[E];S(vt,E,m)&&(Z[z++]=vt)}return Z}function An(m,S){var E=m==null?0:m.length;return!!E&&vr(m,S,0)>-1}function ni(m,S,E){for(var D=-1,z=m==null?0:m.length;++D<z;)if(E(S,m[D]))return!0;return!1}function ot(m,S){for(var E=-1,D=m==null?0:m.length,z=Array(D);++E<D;)z[E]=S(m[E],E,m);return z}function ze(m,S){for(var E=-1,D=S.length,z=m.length;++E<D;)m[z+E]=S[E];return m}function si(m,S,E,D){var z=-1,Z=m==null?0:m.length;for(D&&Z&&(E=m[++z]);++z<Z;)E=S(E,m[z],z,m);return E}function zp(m,S,E,D){var z=m==null?0:m.length;for(D&&z&&(E=m[--z]);z--;)E=S(E,m[z],z,m);return E}function ii(m,S){for(var E=-1,D=m==null?0:m.length;++E<D;)if(S(m[E],E,m))return!0;return!1}var Mp=oi("length");function Lp(m){return m.split("")}function Kp(m){return m.match(Jh)||[]}function Na(m,S,E){var D;return E(m,function(z,Z,vt){if(S(z,Z,vt))return D=Z,!1}),D}function Tn(m,S,E,D){for(var z=m.length,Z=E+(D?1:-1);D?Z--:++Z<z;)if(S(m[Z],Z,m))return Z;return-1}function vr(m,S,E){return S===S?tf(m,S,E):Tn(m,Ra,E)}function Hp(m,S,E,D){for(var z=E-1,Z=m.length;++z<Z;)if(D(m[z],S))return z;return-1}function Ra(m){return m!==m}function xa(m,S){var E=m==null?0:m.length;return E?ci(m,S)/E:En}function oi(m){return function(S){return S==null?r:S[m]}}function ai(m){return function(S){return m==null?r:m[S]}}function Ca(m,S,E,D,z){return z(m,function(Z,vt,rt){E=D?(D=!1,Z):S(E,Z,vt,rt)}),E}function Vp(m,S){var E=m.length;for(m.sort(S);E--;)m[E]=m[E].value;return m}function ci(m,S){for(var E,D=-1,z=m.length;++D<z;){var Z=S(m[D]);Z!==r&&(E=E===r?Z:E+Z)}return E}function ui(m,S){for(var E=-1,D=Array(m);++E<m;)D[E]=S(E);return D}function Fp(m,S){return ot(S,function(E){return[E,m[E]]})}function Aa(m){return m&&m.slice(0,ja(m)+1).replace(Qs,"")}function Ht(m){return function(S){return m(S)}}function li(m,S){return ot(S,function(E){return m[E]})}function Fr(m,S){return m.has(S)}function Ta(m,S){for(var E=-1,D=m.length;++E<D&&vr(S,m[E],0)>-1;);return E}function Da(m,S){for(var E=m.length;E--&&vr(S,m[E],0)>-1;);return E}function Wp(m,S){for(var E=m.length,D=0;E--;)m[E]===S&&++D;return D}var Bp=ai(Cp),Gp=ai(Ap);function Qp(m){return"\\"+Dp[m]}function Jp(m,S){return m==null?r:m[S]}function yr(m){return Op.test(m)}function Yp(m){return Np.test(m)}function Zp(m){for(var S,E=[];!(S=m.next()).done;)E.push(S.value);return E}function hi(m){var S=-1,E=Array(m.size);return m.forEach(function(D,z){E[++S]=[z,D]}),E}function qa(m,S){return function(E){return m(S(E))}}function Me(m,S){for(var E=-1,D=m.length,z=0,Z=[];++E<D;){var vt=m[E];(vt===S||vt===_)&&(m[E]=_,Z[z++]=E)}return Z}function Dn(m){var S=-1,E=Array(m.size);return m.forEach(function(D){E[++S]=D}),E}function Xp(m){var S=-1,E=Array(m.size);return m.forEach(function(D){E[++S]=[D,D]}),E}function tf(m,S,E){for(var D=E-1,z=m.length;++D<z;)if(m[D]===S)return D;return-1}function ef(m,S,E){for(var D=E+1;D--;)if(m[D]===S)return D;return D}function mr(m){return yr(m)?nf(m):Mp(m)}function ce(m){return yr(m)?sf(m):Lp(m)}function ja(m){for(var S=m.length;S--&&Wh.test(m.charAt(S)););return S}var rf=ai(Tp);function nf(m){for(var S=ti.lastIndex=0;ti.test(m);)++S;return S}function sf(m){return m.match(ti)||[]}function of(m){return m.match(Sp)||[]}var af=function m(S){S=S==null?_t:wr.defaults(_t.Object(),S,wr.pick(_t,Rp));var E=S.Array,D=S.Date,z=S.Error,Z=S.Function,vt=S.Math,rt=S.Object,pi=S.RegExp,cf=S.String,Zt=S.TypeError,qn=E.prototype,uf=Z.prototype,br=rt.prototype,jn=S["__core-js_shared__"],$n=uf.toString,tt=br.hasOwnProperty,lf=0,$a=function(){var t=/[^.]+$/.exec(jn&&jn.keys&&jn.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),kn=br.toString,hf=$n.call(rt),pf=_t._,ff=pi("^"+$n.call(tt).replace(Gs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Un=wa?S.Buffer:r,Le=S.Symbol,zn=S.Uint8Array,ka=Un?Un.allocUnsafe:r,Mn=qa(rt.getPrototypeOf,rt),Ua=rt.create,za=br.propertyIsEnumerable,Ln=qn.splice,Ma=Le?Le.isConcatSpreadable:r,Wr=Le?Le.iterator:r,Xe=Le?Le.toStringTag:r,Kn=function(){try{var t=sr(rt,"defineProperty");return t({},"",{}),t}catch{}}(),df=S.clearTimeout!==_t.clearTimeout&&S.clearTimeout,gf=D&&D.now!==_t.Date.now&&D.now,vf=S.setTimeout!==_t.setTimeout&&S.setTimeout,Hn=vt.ceil,Vn=vt.floor,fi=rt.getOwnPropertySymbols,yf=Un?Un.isBuffer:r,La=S.isFinite,mf=qn.join,wf=qa(rt.keys,rt),yt=vt.max,Pt=vt.min,bf=D.now,_f=S.parseInt,Ka=vt.random,If=qn.reverse,di=sr(S,"DataView"),Br=sr(S,"Map"),gi=sr(S,"Promise"),_r=sr(S,"Set"),Gr=sr(S,"WeakMap"),Qr=sr(rt,"create"),Fn=Gr&&new Gr,Ir={},Ef=ir(di),Pf=ir(Br),Sf=ir(gi),Of=ir(_r),Nf=ir(Gr),Wn=Le?Le.prototype:r,Jr=Wn?Wn.valueOf:r,Ha=Wn?Wn.toString:r;function p(t){if(ut(t)&&!M(t)&&!(t instanceof W)){if(t instanceof Xt)return t;if(tt.call(t,"__wrapped__"))return Vc(t)}return new Xt(t)}var Er=function(){function t(){}return function(n){if(!ct(n))return{};if(Ua)return Ua(n);t.prototype=n;var i=new t;return t.prototype=r,i}}();function Bn(){}function Xt(t,n){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=r}p.templateSettings={escape:Mh,evaluate:Lh,interpolate:Zo,variable:"",imports:{_:p}},p.prototype=Bn.prototype,p.prototype.constructor=p,Xt.prototype=Er(Bn.prototype),Xt.prototype.constructor=Xt;function W(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ve,this.__views__=[]}function Rf(){var t=new W(this.__wrapped__);return t.__actions__=Dt(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Dt(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Dt(this.__views__),t}function xf(){if(this.__filtered__){var t=new W(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Cf(){var t=this.__wrapped__.value(),n=this.__dir__,i=M(t),c=n<0,l=i?t.length:0,f=Kd(0,l,this.__views__),v=f.start,y=f.end,w=y-v,O=c?y:v-1,N=this.__iteratees__,R=N.length,A=0,q=Pt(w,this.__takeCount__);if(!i||!c&&l==w&&q==w)return fc(t,this.__actions__);var k=[];t:for(;w--&&A<q;){O+=n;for(var H=-1,U=t[O];++H<R;){var F=N[H],G=F.iteratee,Wt=F.type,Ct=G(U);if(Wt==Eh)U=Ct;else if(!Ct){if(Wt==Bo)continue t;break t}}k[A++]=U}return k}W.prototype=Er(Bn.prototype),W.prototype.constructor=W;function tr(t){var n=-1,i=t==null?0:t.length;for(this.clear();++n<i;){var c=t[n];this.set(c[0],c[1])}}function Af(){this.__data__=Qr?Qr(null):{},this.size=0}function Tf(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n}function Df(t){var n=this.__data__;if(Qr){var i=n[t];return i===b?r:i}return tt.call(n,t)?n[t]:r}function qf(t){var n=this.__data__;return Qr?n[t]!==r:tt.call(n,t)}function jf(t,n){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Qr&&n===r?b:n,this}tr.prototype.clear=Af,tr.prototype.delete=Tf,tr.prototype.get=Df,tr.prototype.has=qf,tr.prototype.set=jf;function Pe(t){var n=-1,i=t==null?0:t.length;for(this.clear();++n<i;){var c=t[n];this.set(c[0],c[1])}}function $f(){this.__data__=[],this.size=0}function kf(t){var n=this.__data__,i=Gn(n,t);if(i<0)return!1;var c=n.length-1;return i==c?n.pop():Ln.call(n,i,1),--this.size,!0}function Uf(t){var n=this.__data__,i=Gn(n,t);return i<0?r:n[i][1]}function zf(t){return Gn(this.__data__,t)>-1}function Mf(t,n){var i=this.__data__,c=Gn(i,t);return c<0?(++this.size,i.push([t,n])):i[c][1]=n,this}Pe.prototype.clear=$f,Pe.prototype.delete=kf,Pe.prototype.get=Uf,Pe.prototype.has=zf,Pe.prototype.set=Mf;function Se(t){var n=-1,i=t==null?0:t.length;for(this.clear();++n<i;){var c=t[n];this.set(c[0],c[1])}}function Lf(){this.size=0,this.__data__={hash:new tr,map:new(Br||Pe),string:new tr}}function Kf(t){var n=os(this,t).delete(t);return this.size-=n?1:0,n}function Hf(t){return os(this,t).get(t)}function Vf(t){return os(this,t).has(t)}function Ff(t,n){var i=os(this,t),c=i.size;return i.set(t,n),this.size+=i.size==c?0:1,this}Se.prototype.clear=Lf,Se.prototype.delete=Kf,Se.prototype.get=Hf,Se.prototype.has=Vf,Se.prototype.set=Ff;function er(t){var n=-1,i=t==null?0:t.length;for(this.__data__=new Se;++n<i;)this.add(t[n])}function Wf(t){return this.__data__.set(t,b),this}function Bf(t){return this.__data__.has(t)}er.prototype.add=er.prototype.push=Wf,er.prototype.has=Bf;function ue(t){var n=this.__data__=new Pe(t);this.size=n.size}function Gf(){this.__data__=new Pe,this.size=0}function Qf(t){var n=this.__data__,i=n.delete(t);return this.size=n.size,i}function Jf(t){return this.__data__.get(t)}function Yf(t){return this.__data__.has(t)}function Zf(t,n){var i=this.__data__;if(i instanceof Pe){var c=i.__data__;if(!Br||c.length<a-1)return c.push([t,n]),this.size=++i.size,this;i=this.__data__=new Se(c)}return i.set(t,n),this.size=i.size,this}ue.prototype.clear=Gf,ue.prototype.delete=Qf,ue.prototype.get=Jf,ue.prototype.has=Yf,ue.prototype.set=Zf;function Va(t,n){var i=M(t),c=!i&&or(t),l=!i&&!c&&We(t),f=!i&&!c&&!l&&Nr(t),v=i||c||l||f,y=v?ui(t.length,cf):[],w=y.length;for(var O in t)(n||tt.call(t,O))&&!(v&&(O=="length"||l&&(O=="offset"||O=="parent")||f&&(O=="buffer"||O=="byteLength"||O=="byteOffset")||xe(O,w)))&&y.push(O);return y}function Fa(t){var n=t.length;return n?t[Oi(0,n-1)]:r}function Xf(t,n){return as(Dt(t),rr(n,0,t.length))}function td(t){return as(Dt(t))}function vi(t,n,i){(i!==r&&!le(t[n],i)||i===r&&!(n in t))&&Oe(t,n,i)}function Yr(t,n,i){var c=t[n];(!(tt.call(t,n)&&le(c,i))||i===r&&!(n in t))&&Oe(t,n,i)}function Gn(t,n){for(var i=t.length;i--;)if(le(t[i][0],n))return i;return-1}function ed(t,n,i,c){return Ke(t,function(l,f,v){n(c,l,i(l),v)}),c}function Wa(t,n){return t&&me(n,mt(n),t)}function rd(t,n){return t&&me(n,jt(n),t)}function Oe(t,n,i){n=="__proto__"&&Kn?Kn(t,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[n]=i}function yi(t,n){for(var i=-1,c=n.length,l=E(c),f=t==null;++i<c;)l[i]=f?r:Yi(t,n[i]);return l}function rr(t,n,i){return t===t&&(i!==r&&(t=t<=i?t:i),n!==r&&(t=t>=n?t:n)),t}function te(t,n,i,c,l,f){var v,y=n&I,w=n&P,O=n&T;if(i&&(v=l?i(t,c,l,f):i(t)),v!==r)return v;if(!ct(t))return t;var N=M(t);if(N){if(v=Vd(t),!y)return Dt(t,v)}else{var R=St(t),A=R==On||R==Go;if(We(t))return vc(t,y);if(R==Ee||R==fr||A&&!l){if(v=w||A?{}:jc(t),!y)return w?Dd(t,rd(v,t)):Td(t,Wa(v,t))}else{if(!nt[R])return l?t:{};v=Fd(t,R,y)}}f||(f=new ue);var q=f.get(t);if(q)return q;f.set(t,v),lu(t)?t.forEach(function(U){v.add(te(U,n,i,U,t,f))}):cu(t)&&t.forEach(function(U,F){v.set(F,te(U,n,i,F,t,f))});var k=O?w?ki:$i:w?jt:mt,H=N?r:k(t);return Yt(H||t,function(U,F){H&&(F=U,U=t[F]),Yr(v,F,te(U,n,i,F,t,f))}),v}function nd(t){var n=mt(t);return function(i){return Ba(i,t,n)}}function Ba(t,n,i){var c=i.length;if(t==null)return!c;for(t=rt(t);c--;){var l=i[c],f=n[l],v=t[l];if(v===r&&!(l in t)||!f(v))return!1}return!0}function Ga(t,n,i){if(typeof t!="function")throw new Zt(h);return sn(function(){t.apply(r,i)},n)}function Zr(t,n,i,c){var l=-1,f=An,v=!0,y=t.length,w=[],O=n.length;if(!y)return w;i&&(n=ot(n,Ht(i))),c?(f=ni,v=!1):n.length>=a&&(f=Fr,v=!1,n=new er(n));t:for(;++l<y;){var N=t[l],R=i==null?N:i(N);if(N=c||N!==0?N:0,v&&R===R){for(var A=O;A--;)if(n[A]===R)continue t;w.push(N)}else f(n,R,c)||w.push(N)}return w}var Ke=_c(ye),Qa=_c(wi,!0);function sd(t,n){var i=!0;return Ke(t,function(c,l,f){return i=!!n(c,l,f),i}),i}function Qn(t,n,i){for(var c=-1,l=t.length;++c<l;){var f=t[c],v=n(f);if(v!=null&&(y===r?v===v&&!Ft(v):i(v,y)))var y=v,w=f}return w}function id(t,n,i,c){var l=t.length;for(i=K(i),i<0&&(i=-i>l?0:l+i),c=c===r||c>l?l:K(c),c<0&&(c+=l),c=i>c?0:pu(c);i<c;)t[i++]=n;return t}function Ja(t,n){var i=[];return Ke(t,function(c,l,f){n(c,l,f)&&i.push(c)}),i}function It(t,n,i,c,l){var f=-1,v=t.length;for(i||(i=Bd),l||(l=[]);++f<v;){var y=t[f];n>0&&i(y)?n>1?It(y,n-1,i,c,l):ze(l,y):c||(l[l.length]=y)}return l}var mi=Ic(),Ya=Ic(!0);function ye(t,n){return t&&mi(t,n,mt)}function wi(t,n){return t&&Ya(t,n,mt)}function Jn(t,n){return Ue(n,function(i){return Ce(t[i])})}function nr(t,n){n=Ve(n,t);for(var i=0,c=n.length;t!=null&&i<c;)t=t[we(n[i++])];return i&&i==c?t:r}function Za(t,n,i){var c=n(t);return M(t)?c:ze(c,i(t))}function Rt(t){return t==null?t===r?Dh:Ah:Xe&&Xe in rt(t)?Ld(t):tg(t)}function bi(t,n){return t>n}function od(t,n){return t!=null&&tt.call(t,n)}function ad(t,n){return t!=null&&n in rt(t)}function cd(t,n,i){return t>=Pt(n,i)&&t<yt(n,i)}function _i(t,n,i){for(var c=i?ni:An,l=t[0].length,f=t.length,v=f,y=E(f),w=1/0,O=[];v--;){var N=t[v];v&&n&&(N=ot(N,Ht(n))),w=Pt(N.length,w),y[v]=!i&&(n||l>=120&&N.length>=120)?new er(v&&N):r}N=t[0];var R=-1,A=y[0];t:for(;++R<l&&O.length<w;){var q=N[R],k=n?n(q):q;if(q=i||q!==0?q:0,!(A?Fr(A,k):c(O,k,i))){for(v=f;--v;){var H=y[v];if(!(H?Fr(H,k):c(t[v],k,i)))continue t}A&&A.push(k),O.push(q)}}return O}function ud(t,n,i,c){return ye(t,function(l,f,v){n(c,i(l),f,v)}),c}function Xr(t,n,i){n=Ve(n,t),t=zc(t,n);var c=t==null?t:t[we(re(n))];return c==null?r:Kt(c,t,i)}function Xa(t){return ut(t)&&Rt(t)==fr}function ld(t){return ut(t)&&Rt(t)==Vr}function hd(t){return ut(t)&&Rt(t)==zr}function tn(t,n,i,c,l){return t===n?!0:t==null||n==null||!ut(t)&&!ut(n)?t!==t&&n!==n:pd(t,n,i,c,tn,l)}function pd(t,n,i,c,l,f){var v=M(t),y=M(n),w=v?Pn:St(t),O=y?Pn:St(n);w=w==fr?Ee:w,O=O==fr?Ee:O;var N=w==Ee,R=O==Ee,A=w==O;if(A&&We(t)){if(!We(n))return!1;v=!0,N=!1}if(A&&!N)return f||(f=new ue),v||Nr(t)?Tc(t,n,i,c,l,f):zd(t,n,w,i,c,l,f);if(!(i&x)){var q=N&&tt.call(t,"__wrapped__"),k=R&&tt.call(n,"__wrapped__");if(q||k){var H=q?t.value():t,U=k?n.value():n;return f||(f=new ue),l(H,U,i,c,f)}}return A?(f||(f=new ue),Md(t,n,i,c,l,f)):!1}function fd(t){return ut(t)&&St(t)==oe}function Ii(t,n,i,c){var l=i.length,f=l,v=!c;if(t==null)return!f;for(t=rt(t);l--;){var y=i[l];if(v&&y[2]?y[1]!==t[y[0]]:!(y[0]in t))return!1}for(;++l<f;){y=i[l];var w=y[0],O=t[w],N=y[1];if(v&&y[2]){if(O===r&&!(w in t))return!1}else{var R=new ue;if(c)var A=c(O,N,w,t,n,R);if(!(A===r?tn(N,O,x|L,c,R):A))return!1}}return!0}function tc(t){if(!ct(t)||Qd(t))return!1;var n=Ce(t)?ff:rp;return n.test(ir(t))}function dd(t){return ut(t)&&Rt(t)==Lr}function gd(t){return ut(t)&&St(t)==ae}function vd(t){return ut(t)&&fs(t.length)&&!!it[Rt(t)]}function ec(t){return typeof t=="function"?t:t==null?$t:typeof t=="object"?M(t)?sc(t[0],t[1]):nc(t):Eu(t)}function Ei(t){if(!nn(t))return wf(t);var n=[];for(var i in rt(t))tt.call(t,i)&&i!="constructor"&&n.push(i);return n}function yd(t){if(!ct(t))return Xd(t);var n=nn(t),i=[];for(var c in t)c=="constructor"&&(n||!tt.call(t,c))||i.push(c);return i}function Pi(t,n){return t<n}function rc(t,n){var i=-1,c=qt(t)?E(t.length):[];return Ke(t,function(l,f,v){c[++i]=n(l,f,v)}),c}function nc(t){var n=zi(t);return n.length==1&&n[0][2]?kc(n[0][0],n[0][1]):function(i){return i===t||Ii(i,t,n)}}function sc(t,n){return Li(t)&&$c(n)?kc(we(t),n):function(i){var c=Yi(i,t);return c===r&&c===n?Zi(i,t):tn(n,c,x|L)}}function Yn(t,n,i,c,l){t!==n&&mi(n,function(f,v){if(l||(l=new ue),ct(f))md(t,n,v,i,Yn,c,l);else{var y=c?c(Hi(t,v),f,v+"",t,n,l):r;y===r&&(y=f),vi(t,v,y)}},jt)}function md(t,n,i,c,l,f,v){var y=Hi(t,i),w=Hi(n,i),O=v.get(w);if(O){vi(t,i,O);return}var N=f?f(y,w,i+"",t,n,v):r,R=N===r;if(R){var A=M(w),q=!A&&We(w),k=!A&&!q&&Nr(w);N=w,A||q||k?M(y)?N=y:pt(y)?N=Dt(y):q?(R=!1,N=vc(w,!0)):k?(R=!1,N=yc(w,!0)):N=[]:on(w)||or(w)?(N=y,or(y)?N=fu(y):(!ct(y)||Ce(y))&&(N=jc(w))):R=!1}R&&(v.set(w,N),l(N,w,c,f,v),v.delete(w)),vi(t,i,N)}function ic(t,n){var i=t.length;if(i)return n+=n<0?i:0,xe(n,i)?t[n]:r}function oc(t,n,i){n.length?n=ot(n,function(f){return M(f)?function(v){return nr(v,f.length===1?f[0]:f)}:f}):n=[$t];var c=-1;n=ot(n,Ht($()));var l=rc(t,function(f,v,y){var w=ot(n,function(O){return O(f)});return{criteria:w,index:++c,value:f}});return Vp(l,function(f,v){return Ad(f,v,i)})}function wd(t,n){return ac(t,n,function(i,c){return Zi(t,c)})}function ac(t,n,i){for(var c=-1,l=n.length,f={};++c<l;){var v=n[c],y=nr(t,v);i(y,v)&&en(f,Ve(v,t),y)}return f}function bd(t){return function(n){return nr(n,t)}}function Si(t,n,i,c){var l=c?Hp:vr,f=-1,v=n.length,y=t;for(t===n&&(n=Dt(n)),i&&(y=ot(t,Ht(i)));++f<v;)for(var w=0,O=n[f],N=i?i(O):O;(w=l(y,N,w,c))>-1;)y!==t&&Ln.call(y,w,1),Ln.call(t,w,1);return t}function cc(t,n){for(var i=t?n.length:0,c=i-1;i--;){var l=n[i];if(i==c||l!==f){var f=l;xe(l)?Ln.call(t,l,1):xi(t,l)}}return t}function Oi(t,n){return t+Vn(Ka()*(n-t+1))}function _d(t,n,i,c){for(var l=-1,f=yt(Hn((n-t)/(i||1)),0),v=E(f);f--;)v[c?f:++l]=t,t+=i;return v}function Ni(t,n){var i="";if(!t||n<1||n>pr)return i;do n%2&&(i+=t),n=Vn(n/2),n&&(t+=t);while(n);return i}function V(t,n){return Vi(Uc(t,n,$t),t+"")}function Id(t){return Fa(Rr(t))}function Ed(t,n){var i=Rr(t);return as(i,rr(n,0,i.length))}function en(t,n,i,c){if(!ct(t))return t;n=Ve(n,t);for(var l=-1,f=n.length,v=f-1,y=t;y!=null&&++l<f;){var w=we(n[l]),O=i;if(w==="__proto__"||w==="constructor"||w==="prototype")return t;if(l!=v){var N=y[w];O=c?c(N,w,y):r,O===r&&(O=ct(N)?N:xe(n[l+1])?[]:{})}Yr(y,w,O),y=y[w]}return t}var uc=Fn?function(t,n){return Fn.set(t,n),t}:$t,Pd=Kn?function(t,n){return Kn(t,"toString",{configurable:!0,enumerable:!1,value:to(n),writable:!0})}:$t;function Sd(t){return as(Rr(t))}function ee(t,n,i){var c=-1,l=t.length;n<0&&(n=-n>l?0:l+n),i=i>l?l:i,i<0&&(i+=l),l=n>i?0:i-n>>>0,n>>>=0;for(var f=E(l);++c<l;)f[c]=t[c+n];return f}function Od(t,n){var i;return Ke(t,function(c,l,f){return i=n(c,l,f),!i}),!!i}function Zn(t,n,i){var c=0,l=t==null?c:t.length;if(typeof n=="number"&&n===n&&l<=Nh){for(;c<l;){var f=c+l>>>1,v=t[f];v!==null&&!Ft(v)&&(i?v<=n:v<n)?c=f+1:l=f}return l}return Ri(t,n,$t,i)}function Ri(t,n,i,c){var l=0,f=t==null?0:t.length;if(f===0)return 0;n=i(n);for(var v=n!==n,y=n===null,w=Ft(n),O=n===r;l<f;){var N=Vn((l+f)/2),R=i(t[N]),A=R!==r,q=R===null,k=R===R,H=Ft(R);if(v)var U=c||k;else O?U=k&&(c||A):y?U=k&&A&&(c||!q):w?U=k&&A&&!q&&(c||!H):q||H?U=!1:U=c?R<=n:R<n;U?l=N+1:f=N}return Pt(f,Oh)}function lc(t,n){for(var i=-1,c=t.length,l=0,f=[];++i<c;){var v=t[i],y=n?n(v):v;if(!i||!le(y,w)){var w=y;f[l++]=v===0?0:v}}return f}function hc(t){return typeof t=="number"?t:Ft(t)?En:+t}function Vt(t){if(typeof t=="string")return t;if(M(t))return ot(t,Vt)+"";if(Ft(t))return Ha?Ha.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function He(t,n,i){var c=-1,l=An,f=t.length,v=!0,y=[],w=y;if(i)v=!1,l=ni;else if(f>=a){var O=n?null:kd(t);if(O)return Dn(O);v=!1,l=Fr,w=new er}else w=n?[]:y;t:for(;++c<f;){var N=t[c],R=n?n(N):N;if(N=i||N!==0?N:0,v&&R===R){for(var A=w.length;A--;)if(w[A]===R)continue t;n&&w.push(R),y.push(N)}else l(w,R,i)||(w!==y&&w.push(R),y.push(N))}return y}function xi(t,n){return n=Ve(n,t),t=zc(t,n),t==null||delete t[we(re(n))]}function pc(t,n,i,c){return en(t,n,i(nr(t,n)),c)}function Xn(t,n,i,c){for(var l=t.length,f=c?l:-1;(c?f--:++f<l)&&n(t[f],f,t););return i?ee(t,c?0:f,c?f+1:l):ee(t,c?f+1:0,c?l:f)}function fc(t,n){var i=t;return i instanceof W&&(i=i.value()),si(n,function(c,l){return l.func.apply(l.thisArg,ze([c],l.args))},i)}function Ci(t,n,i){var c=t.length;if(c<2)return c?He(t[0]):[];for(var l=-1,f=E(c);++l<c;)for(var v=t[l],y=-1;++y<c;)y!=l&&(f[l]=Zr(f[l]||v,t[y],n,i));return He(It(f,1),n,i)}function dc(t,n,i){for(var c=-1,l=t.length,f=n.length,v={};++c<l;){var y=c<f?n[c]:r;i(v,t[c],y)}return v}function Ai(t){return pt(t)?t:[]}function Ti(t){return typeof t=="function"?t:$t}function Ve(t,n){return M(t)?t:Li(t,n)?[t]:Hc(X(t))}var Nd=V;function Fe(t,n,i){var c=t.length;return i=i===r?c:i,!n&&i>=c?t:ee(t,n,i)}var gc=df||function(t){return _t.clearTimeout(t)};function vc(t,n){if(n)return t.slice();var i=t.length,c=ka?ka(i):new t.constructor(i);return t.copy(c),c}function Di(t){var n=new t.constructor(t.byteLength);return new zn(n).set(new zn(t)),n}function Rd(t,n){var i=n?Di(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function xd(t){var n=new t.constructor(t.source,Xo.exec(t));return n.lastIndex=t.lastIndex,n}function Cd(t){return Jr?rt(Jr.call(t)):{}}function yc(t,n){var i=n?Di(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function mc(t,n){if(t!==n){var i=t!==r,c=t===null,l=t===t,f=Ft(t),v=n!==r,y=n===null,w=n===n,O=Ft(n);if(!y&&!O&&!f&&t>n||f&&v&&w&&!y&&!O||c&&v&&w||!i&&w||!l)return 1;if(!c&&!f&&!O&&t<n||O&&i&&l&&!c&&!f||y&&i&&l||!v&&l||!w)return-1}return 0}function Ad(t,n,i){for(var c=-1,l=t.criteria,f=n.criteria,v=l.length,y=i.length;++c<v;){var w=mc(l[c],f[c]);if(w){if(c>=y)return w;var O=i[c];return w*(O=="desc"?-1:1)}}return t.index-n.index}function wc(t,n,i,c){for(var l=-1,f=t.length,v=i.length,y=-1,w=n.length,O=yt(f-v,0),N=E(w+O),R=!c;++y<w;)N[y]=n[y];for(;++l<v;)(R||l<f)&&(N[i[l]]=t[l]);for(;O--;)N[y++]=t[l++];return N}function bc(t,n,i,c){for(var l=-1,f=t.length,v=-1,y=i.length,w=-1,O=n.length,N=yt(f-y,0),R=E(N+O),A=!c;++l<N;)R[l]=t[l];for(var q=l;++w<O;)R[q+w]=n[w];for(;++v<y;)(A||l<f)&&(R[q+i[v]]=t[l++]);return R}function Dt(t,n){var i=-1,c=t.length;for(n||(n=E(c));++i<c;)n[i]=t[i];return n}function me(t,n,i,c){var l=!i;i||(i={});for(var f=-1,v=n.length;++f<v;){var y=n[f],w=c?c(i[y],t[y],y,i,t):r;w===r&&(w=t[y]),l?Oe(i,y,w):Yr(i,y,w)}return i}function Td(t,n){return me(t,Mi(t),n)}function Dd(t,n){return me(t,Dc(t),n)}function ts(t,n){return function(i,c){var l=M(i)?kp:ed,f=n?n():{};return l(i,t,$(c,2),f)}}function Pr(t){return V(function(n,i){var c=-1,l=i.length,f=l>1?i[l-1]:r,v=l>2?i[2]:r;for(f=t.length>3&&typeof f=="function"?(l--,f):r,v&&xt(i[0],i[1],v)&&(f=l<3?r:f,l=1),n=rt(n);++c<l;){var y=i[c];y&&t(n,y,c,f)}return n})}function _c(t,n){return function(i,c){if(i==null)return i;if(!qt(i))return t(i,c);for(var l=i.length,f=n?l:-1,v=rt(i);(n?f--:++f<l)&&c(v[f],f,v)!==!1;);return i}}function Ic(t){return function(n,i,c){for(var l=-1,f=rt(n),v=c(n),y=v.length;y--;){var w=v[t?y:++l];if(i(f[w],w,f)===!1)break}return n}}function qd(t,n,i){var c=n&et,l=rn(t);function f(){var v=this&&this!==_t&&this instanceof f?l:t;return v.apply(c?i:this,arguments)}return f}function Ec(t){return function(n){n=X(n);var i=yr(n)?ce(n):r,c=i?i[0]:n.charAt(0),l=i?Fe(i,1).join(""):n.slice(1);return c[t]()+l}}function Sr(t){return function(n){return si(_u(bu(n).replace(Ep,"")),t,"")}}function rn(t){return function(){var n=arguments;switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3]);case 5:return new t(n[0],n[1],n[2],n[3],n[4]);case 6:return new t(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new t(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var i=Er(t.prototype),c=t.apply(i,n);return ct(c)?c:i}}function jd(t,n,i){var c=rn(t);function l(){for(var f=arguments.length,v=E(f),y=f,w=Or(l);y--;)v[y]=arguments[y];var O=f<3&&v[0]!==w&&v[f-1]!==w?[]:Me(v,w);if(f-=O.length,f<i)return Rc(t,n,es,l.placeholder,r,v,O,r,r,i-f);var N=this&&this!==_t&&this instanceof l?c:t;return Kt(N,this,v)}return l}function Pc(t){return function(n,i,c){var l=rt(n);if(!qt(n)){var f=$(i,3);n=mt(n),i=function(y){return f(l[y],y,l)}}var v=t(n,i,c);return v>-1?l[f?n[v]:v]:r}}function Sc(t){return Re(function(n){var i=n.length,c=i,l=Xt.prototype.thru;for(t&&n.reverse();c--;){var f=n[c];if(typeof f!="function")throw new Zt(h);if(l&&!v&&is(f)=="wrapper")var v=new Xt([],!0)}for(c=v?c:i;++c<i;){f=n[c];var y=is(f),w=y=="wrapper"?Ui(f):r;w&&Ki(w[0])&&w[1]==(ht|J|st|Nt)&&!w[4].length&&w[9]==1?v=v[is(w[0])].apply(v,w[3]):v=f.length==1&&Ki(f)?v[y]():v.thru(f)}return function(){var O=arguments,N=O[0];if(v&&O.length==1&&M(N))return v.plant(N).value();for(var R=0,A=i?n[R].apply(this,O):N;++R<i;)A=n[R].call(this,A);return A}})}function es(t,n,i,c,l,f,v,y,w,O){var N=n&ht,R=n&et,A=n&B,q=n&(J|Y),k=n&ke,H=A?r:rn(t);function U(){for(var F=arguments.length,G=E(F),Wt=F;Wt--;)G[Wt]=arguments[Wt];if(q)var Ct=Or(U),Bt=Wp(G,Ct);if(c&&(G=wc(G,c,l,q)),f&&(G=bc(G,f,v,q)),F-=Bt,q&&F<O){var ft=Me(G,Ct);return Rc(t,n,es,U.placeholder,i,G,ft,y,w,O-F)}var he=R?i:this,Te=A?he[t]:t;return F=G.length,y?G=eg(G,y):k&&F>1&&G.reverse(),N&&w<F&&(G.length=w),this&&this!==_t&&this instanceof U&&(Te=H||rn(Te)),Te.apply(he,G)}return U}function Oc(t,n){return function(i,c){return ud(i,t,n(c),{})}}function rs(t,n){return function(i,c){var l;if(i===r&&c===r)return n;if(i!==r&&(l=i),c!==r){if(l===r)return c;typeof i=="string"||typeof c=="string"?(i=Vt(i),c=Vt(c)):(i=hc(i),c=hc(c)),l=t(i,c)}return l}}function qi(t){return Re(function(n){return n=ot(n,Ht($())),V(function(i){var c=this;return t(n,function(l){return Kt(l,c,i)})})})}function ns(t,n){n=n===r?" ":Vt(n);var i=n.length;if(i<2)return i?Ni(n,t):n;var c=Ni(n,Hn(t/mr(n)));return yr(n)?Fe(ce(c),0,t).join(""):c.slice(0,t)}function $d(t,n,i,c){var l=n&et,f=rn(t);function v(){for(var y=-1,w=arguments.length,O=-1,N=c.length,R=E(N+w),A=this&&this!==_t&&this instanceof v?f:t;++O<N;)R[O]=c[O];for(;w--;)R[O++]=arguments[++y];return Kt(A,l?i:this,R)}return v}function Nc(t){return function(n,i,c){return c&&typeof c!="number"&&xt(n,i,c)&&(i=c=r),n=Ae(n),i===r?(i=n,n=0):i=Ae(i),c=c===r?n<i?1:-1:Ae(c),_d(n,i,c,t)}}function ss(t){return function(n,i){return typeof n=="string"&&typeof i=="string"||(n=ne(n),i=ne(i)),t(n,i)}}function Rc(t,n,i,c,l,f,v,y,w,O){var N=n&J,R=N?v:r,A=N?r:v,q=N?f:r,k=N?r:f;n|=N?st:Tt,n&=~(N?Tt:st),n&gt||(n&=-4);var H=[t,n,l,q,R,k,A,y,w,O],U=i.apply(r,H);return Ki(t)&&Mc(U,H),U.placeholder=c,Lc(U,t,n)}function ji(t){var n=vt[t];return function(i,c){if(i=ne(i),c=c==null?0:Pt(K(c),292),c&&La(i)){var l=(X(i)+"e").split("e"),f=n(l[0]+"e"+(+l[1]+c));return l=(X(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return n(i)}}var kd=_r&&1/Dn(new _r([,-0]))[1]==In?function(t){return new _r(t)}:no;function xc(t){return function(n){var i=St(n);return i==oe?hi(n):i==ae?Xp(n):Fp(n,t(n))}}function Ne(t,n,i,c,l,f,v,y){var w=n&B;if(!w&&typeof t!="function")throw new Zt(h);var O=c?c.length:0;if(O||(n&=-97,c=l=r),v=v===r?v:yt(K(v),0),y=y===r?y:K(y),O-=l?l.length:0,n&Tt){var N=c,R=l;c=l=r}var A=w?r:Ui(t),q=[t,n,i,c,l,N,R,f,v,y];if(A&&Zd(q,A),t=q[0],n=q[1],i=q[2],c=q[3],l=q[4],y=q[9]=q[9]===r?w?0:t.length:yt(q[9]-O,0),!y&&n&(J|Y)&&(n&=-25),!n||n==et)var k=qd(t,n,i);else n==J||n==Y?k=jd(t,n,y):(n==st||n==(et|st))&&!l.length?k=$d(t,n,i,c):k=es.apply(r,q);var H=A?uc:Mc;return Lc(H(k,q),t,n)}function Cc(t,n,i,c){return t===r||le(t,br[i])&&!tt.call(c,i)?n:t}function Ac(t,n,i,c,l,f){return ct(t)&&ct(n)&&(f.set(n,t),Yn(t,n,r,Ac,f),f.delete(n)),t}function Ud(t){return on(t)?r:t}function Tc(t,n,i,c,l,f){var v=i&x,y=t.length,w=n.length;if(y!=w&&!(v&&w>y))return!1;var O=f.get(t),N=f.get(n);if(O&&N)return O==n&&N==t;var R=-1,A=!0,q=i&L?new er:r;for(f.set(t,n),f.set(n,t);++R<y;){var k=t[R],H=n[R];if(c)var U=v?c(H,k,R,n,t,f):c(k,H,R,t,n,f);if(U!==r){if(U)continue;A=!1;break}if(q){if(!ii(n,function(F,G){if(!Fr(q,G)&&(k===F||l(k,F,i,c,f)))return q.push(G)})){A=!1;break}}else if(!(k===H||l(k,H,i,c,f))){A=!1;break}}return f.delete(t),f.delete(n),A}function zd(t,n,i,c,l,f,v){switch(i){case dr:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case Vr:return!(t.byteLength!=n.byteLength||!f(new zn(t),new zn(n)));case Ur:case zr:case Mr:return le(+t,+n);case Sn:return t.name==n.name&&t.message==n.message;case Lr:case Kr:return t==n+"";case oe:var y=hi;case ae:var w=c&x;if(y||(y=Dn),t.size!=n.size&&!w)return!1;var O=v.get(t);if(O)return O==n;c|=L,v.set(t,n);var N=Tc(y(t),y(n),c,l,f,v);return v.delete(t),N;case Nn:if(Jr)return Jr.call(t)==Jr.call(n)}return!1}function Md(t,n,i,c,l,f){var v=i&x,y=$i(t),w=y.length,O=$i(n),N=O.length;if(w!=N&&!v)return!1;for(var R=w;R--;){var A=y[R];if(!(v?A in n:tt.call(n,A)))return!1}var q=f.get(t),k=f.get(n);if(q&&k)return q==n&&k==t;var H=!0;f.set(t,n),f.set(n,t);for(var U=v;++R<w;){A=y[R];var F=t[A],G=n[A];if(c)var Wt=v?c(G,F,A,n,t,f):c(F,G,A,t,n,f);if(!(Wt===r?F===G||l(F,G,i,c,f):Wt)){H=!1;break}U||(U=A=="constructor")}if(H&&!U){var Ct=t.constructor,Bt=n.constructor;Ct!=Bt&&"constructor"in t&&"constructor"in n&&!(typeof Ct=="function"&&Ct instanceof Ct&&typeof Bt=="function"&&Bt instanceof Bt)&&(H=!1)}return f.delete(t),f.delete(n),H}function Re(t){return Vi(Uc(t,r,Bc),t+"")}function $i(t){return Za(t,mt,Mi)}function ki(t){return Za(t,jt,Dc)}var Ui=Fn?function(t){return Fn.get(t)}:no;function is(t){for(var n=t.name+"",i=Ir[n],c=tt.call(Ir,n)?i.length:0;c--;){var l=i[c],f=l.func;if(f==null||f==t)return l.name}return n}function Or(t){var n=tt.call(p,"placeholder")?p:t;return n.placeholder}function $(){var t=p.iteratee||eo;return t=t===eo?ec:t,arguments.length?t(arguments[0],arguments[1]):t}function os(t,n){var i=t.__data__;return Gd(n)?i[typeof n=="string"?"string":"hash"]:i.map}function zi(t){for(var n=mt(t),i=n.length;i--;){var c=n[i],l=t[c];n[i]=[c,l,$c(l)]}return n}function sr(t,n){var i=Jp(t,n);return tc(i)?i:r}function Ld(t){var n=tt.call(t,Xe),i=t[Xe];try{t[Xe]=r;var c=!0}catch{}var l=kn.call(t);return c&&(n?t[Xe]=i:delete t[Xe]),l}var Mi=fi?function(t){return t==null?[]:(t=rt(t),Ue(fi(t),function(n){return za.call(t,n)}))}:so,Dc=fi?function(t){for(var n=[];t;)ze(n,Mi(t)),t=Mn(t);return n}:so,St=Rt;(di&&St(new di(new ArrayBuffer(1)))!=dr||Br&&St(new Br)!=oe||gi&&St(gi.resolve())!=Qo||_r&&St(new _r)!=ae||Gr&&St(new Gr)!=Hr)&&(St=function(t){var n=Rt(t),i=n==Ee?t.constructor:r,c=i?ir(i):"";if(c)switch(c){case Ef:return dr;case Pf:return oe;case Sf:return Qo;case Of:return ae;case Nf:return Hr}return n});function Kd(t,n,i){for(var c=-1,l=i.length;++c<l;){var f=i[c],v=f.size;switch(f.type){case"drop":t+=v;break;case"dropRight":n-=v;break;case"take":n=Pt(n,t+v);break;case"takeRight":t=yt(t,n-v);break}}return{start:t,end:n}}function Hd(t){var n=t.match(Gh);return n?n[1].split(Qh):[]}function qc(t,n,i){n=Ve(n,t);for(var c=-1,l=n.length,f=!1;++c<l;){var v=we(n[c]);if(!(f=t!=null&&i(t,v)))break;t=t[v]}return f||++c!=l?f:(l=t==null?0:t.length,!!l&&fs(l)&&xe(v,l)&&(M(t)||or(t)))}function Vd(t){var n=t.length,i=new t.constructor(n);return n&&typeof t[0]=="string"&&tt.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function jc(t){return typeof t.constructor=="function"&&!nn(t)?Er(Mn(t)):{}}function Fd(t,n,i){var c=t.constructor;switch(n){case Vr:return Di(t);case Ur:case zr:return new c(+t);case dr:return Rd(t,i);case zs:case Ms:case Ls:case Ks:case Hs:case Vs:case Fs:case Ws:case Bs:return yc(t,i);case oe:return new c;case Mr:case Kr:return new c(t);case Lr:return xd(t);case ae:return new c;case Nn:return Cd(t)}}function Wd(t,n){var i=n.length;if(!i)return t;var c=i-1;return n[c]=(i>1?"& ":"")+n[c],n=n.join(i>2?", ":" "),t.replace(Bh,`{
/* [wrapped with `+n+`] */
`)}function Bd(t){return M(t)||or(t)||!!(Ma&&t&&t[Ma])}function xe(t,n){var i=typeof t;return n=n??pr,!!n&&(i=="number"||i!="symbol"&&sp.test(t))&&t>-1&&t%1==0&&t<n}function xt(t,n,i){if(!ct(i))return!1;var c=typeof n;return(c=="number"?qt(i)&&xe(n,i.length):c=="string"&&n in i)?le(i[n],t):!1}function Li(t,n){if(M(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||Ft(t)?!0:Hh.test(t)||!Kh.test(t)||n!=null&&t in rt(n)}function Gd(t){var n=typeof t;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null}function Ki(t){var n=is(t),i=p[n];if(typeof i!="function"||!(n in W.prototype))return!1;if(t===i)return!0;var c=Ui(i);return!!c&&t===c[0]}function Qd(t){return!!$a&&$a in t}var Jd=jn?Ce:io;function nn(t){var n=t&&t.constructor,i=typeof n=="function"&&n.prototype||br;return t===i}function $c(t){return t===t&&!ct(t)}function kc(t,n){return function(i){return i==null?!1:i[t]===n&&(n!==r||t in rt(i))}}function Yd(t){var n=hs(t,function(c){return i.size===d&&i.clear(),c}),i=n.cache;return n}function Zd(t,n){var i=t[1],c=n[1],l=i|c,f=l<(et|B|ht),v=c==ht&&i==J||c==ht&&i==Nt&&t[7].length<=n[8]||c==(ht|Nt)&&n[7].length<=n[8]&&i==J;if(!(f||v))return t;c&et&&(t[2]=n[2],l|=i&et?0:gt);var y=n[3];if(y){var w=t[3];t[3]=w?wc(w,y,n[4]):y,t[4]=w?Me(t[3],_):n[4]}return y=n[5],y&&(w=t[5],t[5]=w?bc(w,y,n[6]):y,t[6]=w?Me(t[5],_):n[6]),y=n[7],y&&(t[7]=y),c&ht&&(t[8]=t[8]==null?n[8]:Pt(t[8],n[8])),t[9]==null&&(t[9]=n[9]),t[0]=n[0],t[1]=l,t}function Xd(t){var n=[];if(t!=null)for(var i in rt(t))n.push(i);return n}function tg(t){return kn.call(t)}function Uc(t,n,i){return n=yt(n===r?t.length-1:n,0),function(){for(var c=arguments,l=-1,f=yt(c.length-n,0),v=E(f);++l<f;)v[l]=c[n+l];l=-1;for(var y=E(n+1);++l<n;)y[l]=c[l];return y[n]=i(v),Kt(t,this,y)}}function zc(t,n){return n.length<2?t:nr(t,ee(n,0,-1))}function eg(t,n){for(var i=t.length,c=Pt(n.length,i),l=Dt(t);c--;){var f=n[c];t[c]=xe(f,i)?l[f]:r}return t}function Hi(t,n){if(!(n==="constructor"&&typeof t[n]=="function")&&n!="__proto__")return t[n]}var Mc=Kc(uc),sn=vf||function(t,n){return _t.setTimeout(t,n)},Vi=Kc(Pd);function Lc(t,n,i){var c=n+"";return Vi(t,Wd(c,rg(Hd(c),i)))}function Kc(t){var n=0,i=0;return function(){var c=bf(),l=Ih-(c-i);if(i=c,l>0){if(++n>=_h)return arguments[0]}else n=0;return t.apply(r,arguments)}}function as(t,n){var i=-1,c=t.length,l=c-1;for(n=n===r?c:n;++i<n;){var f=Oi(i,l),v=t[f];t[f]=t[i],t[i]=v}return t.length=n,t}var Hc=Yd(function(t){var n=[];return t.charCodeAt(0)===46&&n.push(""),t.replace(Vh,function(i,c,l,f){n.push(l?f.replace(Zh,"$1"):c||i)}),n});function we(t){if(typeof t=="string"||Ft(t))return t;var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function ir(t){if(t!=null){try{return $n.call(t)}catch{}try{return t+""}catch{}}return""}function rg(t,n){return Yt(Rh,function(i){var c="_."+i[0];n&i[1]&&!An(t,c)&&t.push(c)}),t.sort()}function Vc(t){if(t instanceof W)return t.clone();var n=new Xt(t.__wrapped__,t.__chain__);return n.__actions__=Dt(t.__actions__),n.__index__=t.__index__,n.__values__=t.__values__,n}function ng(t,n,i){(i?xt(t,n,i):n===r)?n=1:n=yt(K(n),0);var c=t==null?0:t.length;if(!c||n<1)return[];for(var l=0,f=0,v=E(Hn(c/n));l<c;)v[f++]=ee(t,l,l+=n);return v}function sg(t){for(var n=-1,i=t==null?0:t.length,c=0,l=[];++n<i;){var f=t[n];f&&(l[c++]=f)}return l}function ig(){var t=arguments.length;if(!t)return[];for(var n=E(t-1),i=arguments[0],c=t;c--;)n[c-1]=arguments[c];return ze(M(i)?Dt(i):[i],It(n,1))}var og=V(function(t,n){return pt(t)?Zr(t,It(n,1,pt,!0)):[]}),ag=V(function(t,n){var i=re(n);return pt(i)&&(i=r),pt(t)?Zr(t,It(n,1,pt,!0),$(i,2)):[]}),cg=V(function(t,n){var i=re(n);return pt(i)&&(i=r),pt(t)?Zr(t,It(n,1,pt,!0),r,i):[]});function ug(t,n,i){var c=t==null?0:t.length;return c?(n=i||n===r?1:K(n),ee(t,n<0?0:n,c)):[]}function lg(t,n,i){var c=t==null?0:t.length;return c?(n=i||n===r?1:K(n),n=c-n,ee(t,0,n<0?0:n)):[]}function hg(t,n){return t&&t.length?Xn(t,$(n,3),!0,!0):[]}function pg(t,n){return t&&t.length?Xn(t,$(n,3),!0):[]}function fg(t,n,i,c){var l=t==null?0:t.length;return l?(i&&typeof i!="number"&&xt(t,n,i)&&(i=0,c=l),id(t,n,i,c)):[]}function Fc(t,n,i){var c=t==null?0:t.length;if(!c)return-1;var l=i==null?0:K(i);return l<0&&(l=yt(c+l,0)),Tn(t,$(n,3),l)}function Wc(t,n,i){var c=t==null?0:t.length;if(!c)return-1;var l=c-1;return i!==r&&(l=K(i),l=i<0?yt(c+l,0):Pt(l,c-1)),Tn(t,$(n,3),l,!0)}function Bc(t){var n=t==null?0:t.length;return n?It(t,1):[]}function dg(t){var n=t==null?0:t.length;return n?It(t,In):[]}function gg(t,n){var i=t==null?0:t.length;return i?(n=n===r?1:K(n),It(t,n)):[]}function vg(t){for(var n=-1,i=t==null?0:t.length,c={};++n<i;){var l=t[n];c[l[0]]=l[1]}return c}function Gc(t){return t&&t.length?t[0]:r}function yg(t,n,i){var c=t==null?0:t.length;if(!c)return-1;var l=i==null?0:K(i);return l<0&&(l=yt(c+l,0)),vr(t,n,l)}function mg(t){var n=t==null?0:t.length;return n?ee(t,0,-1):[]}var wg=V(function(t){var n=ot(t,Ai);return n.length&&n[0]===t[0]?_i(n):[]}),bg=V(function(t){var n=re(t),i=ot(t,Ai);return n===re(i)?n=r:i.pop(),i.length&&i[0]===t[0]?_i(i,$(n,2)):[]}),_g=V(function(t){var n=re(t),i=ot(t,Ai);return n=typeof n=="function"?n:r,n&&i.pop(),i.length&&i[0]===t[0]?_i(i,r,n):[]});function Ig(t,n){return t==null?"":mf.call(t,n)}function re(t){var n=t==null?0:t.length;return n?t[n-1]:r}function Eg(t,n,i){var c=t==null?0:t.length;if(!c)return-1;var l=c;return i!==r&&(l=K(i),l=l<0?yt(c+l,0):Pt(l,c-1)),n===n?ef(t,n,l):Tn(t,Ra,l,!0)}function Pg(t,n){return t&&t.length?ic(t,K(n)):r}var Sg=V(Qc);function Qc(t,n){return t&&t.length&&n&&n.length?Si(t,n):t}function Og(t,n,i){return t&&t.length&&n&&n.length?Si(t,n,$(i,2)):t}function Ng(t,n,i){return t&&t.length&&n&&n.length?Si(t,n,r,i):t}var Rg=Re(function(t,n){var i=t==null?0:t.length,c=yi(t,n);return cc(t,ot(n,function(l){return xe(l,i)?+l:l}).sort(mc)),c});function xg(t,n){var i=[];if(!(t&&t.length))return i;var c=-1,l=[],f=t.length;for(n=$(n,3);++c<f;){var v=t[c];n(v,c,t)&&(i.push(v),l.push(c))}return cc(t,l),i}function Fi(t){return t==null?t:If.call(t)}function Cg(t,n,i){var c=t==null?0:t.length;return c?(i&&typeof i!="number"&&xt(t,n,i)?(n=0,i=c):(n=n==null?0:K(n),i=i===r?c:K(i)),ee(t,n,i)):[]}function Ag(t,n){return Zn(t,n)}function Tg(t,n,i){return Ri(t,n,$(i,2))}function Dg(t,n){var i=t==null?0:t.length;if(i){var c=Zn(t,n);if(c<i&&le(t[c],n))return c}return-1}function qg(t,n){return Zn(t,n,!0)}function jg(t,n,i){return Ri(t,n,$(i,2),!0)}function $g(t,n){var i=t==null?0:t.length;if(i){var c=Zn(t,n,!0)-1;if(le(t[c],n))return c}return-1}function kg(t){return t&&t.length?lc(t):[]}function Ug(t,n){return t&&t.length?lc(t,$(n,2)):[]}function zg(t){var n=t==null?0:t.length;return n?ee(t,1,n):[]}function Mg(t,n,i){return t&&t.length?(n=i||n===r?1:K(n),ee(t,0,n<0?0:n)):[]}function Lg(t,n,i){var c=t==null?0:t.length;return c?(n=i||n===r?1:K(n),n=c-n,ee(t,n<0?0:n,c)):[]}function Kg(t,n){return t&&t.length?Xn(t,$(n,3),!1,!0):[]}function Hg(t,n){return t&&t.length?Xn(t,$(n,3)):[]}var Vg=V(function(t){return He(It(t,1,pt,!0))}),Fg=V(function(t){var n=re(t);return pt(n)&&(n=r),He(It(t,1,pt,!0),$(n,2))}),Wg=V(function(t){var n=re(t);return n=typeof n=="function"?n:r,He(It(t,1,pt,!0),r,n)});function Bg(t){return t&&t.length?He(t):[]}function Gg(t,n){return t&&t.length?He(t,$(n,2)):[]}function Qg(t,n){return n=typeof n=="function"?n:r,t&&t.length?He(t,r,n):[]}function Wi(t){if(!(t&&t.length))return[];var n=0;return t=Ue(t,function(i){if(pt(i))return n=yt(i.length,n),!0}),ui(n,function(i){return ot(t,oi(i))})}function Jc(t,n){if(!(t&&t.length))return[];var i=Wi(t);return n==null?i:ot(i,function(c){return Kt(n,r,c)})}var Jg=V(function(t,n){return pt(t)?Zr(t,n):[]}),Yg=V(function(t){return Ci(Ue(t,pt))}),Zg=V(function(t){var n=re(t);return pt(n)&&(n=r),Ci(Ue(t,pt),$(n,2))}),Xg=V(function(t){var n=re(t);return n=typeof n=="function"?n:r,Ci(Ue(t,pt),r,n)}),tv=V(Wi);function ev(t,n){return dc(t||[],n||[],Yr)}function rv(t,n){return dc(t||[],n||[],en)}var nv=V(function(t){var n=t.length,i=n>1?t[n-1]:r;return i=typeof i=="function"?(t.pop(),i):r,Jc(t,i)});function Yc(t){var n=p(t);return n.__chain__=!0,n}function sv(t,n){return n(t),t}function cs(t,n){return n(t)}var iv=Re(function(t){var n=t.length,i=n?t[0]:0,c=this.__wrapped__,l=function(f){return yi(f,t)};return n>1||this.__actions__.length||!(c instanceof W)||!xe(i)?this.thru(l):(c=c.slice(i,+i+(n?1:0)),c.__actions__.push({func:cs,args:[l],thisArg:r}),new Xt(c,this.__chain__).thru(function(f){return n&&!f.length&&f.push(r),f}))});function ov(){return Yc(this)}function av(){return new Xt(this.value(),this.__chain__)}function cv(){this.__values__===r&&(this.__values__=hu(this.value()));var t=this.__index__>=this.__values__.length,n=t?r:this.__values__[this.__index__++];return{done:t,value:n}}function uv(){return this}function lv(t){for(var n,i=this;i instanceof Bn;){var c=Vc(i);c.__index__=0,c.__values__=r,n?l.__wrapped__=c:n=c;var l=c;i=i.__wrapped__}return l.__wrapped__=t,n}function hv(){var t=this.__wrapped__;if(t instanceof W){var n=t;return this.__actions__.length&&(n=new W(this)),n=n.reverse(),n.__actions__.push({func:cs,args:[Fi],thisArg:r}),new Xt(n,this.__chain__)}return this.thru(Fi)}function pv(){return fc(this.__wrapped__,this.__actions__)}var fv=ts(function(t,n,i){tt.call(t,i)?++t[i]:Oe(t,i,1)});function dv(t,n,i){var c=M(t)?Oa:sd;return i&&xt(t,n,i)&&(n=r),c(t,$(n,3))}function gv(t,n){var i=M(t)?Ue:Ja;return i(t,$(n,3))}var vv=Pc(Fc),yv=Pc(Wc);function mv(t,n){return It(us(t,n),1)}function wv(t,n){return It(us(t,n),In)}function bv(t,n,i){return i=i===r?1:K(i),It(us(t,n),i)}function Zc(t,n){var i=M(t)?Yt:Ke;return i(t,$(n,3))}function Xc(t,n){var i=M(t)?Up:Qa;return i(t,$(n,3))}var _v=ts(function(t,n,i){tt.call(t,i)?t[i].push(n):Oe(t,i,[n])});function Iv(t,n,i,c){t=qt(t)?t:Rr(t),i=i&&!c?K(i):0;var l=t.length;return i<0&&(i=yt(l+i,0)),ds(t)?i<=l&&t.indexOf(n,i)>-1:!!l&&vr(t,n,i)>-1}var Ev=V(function(t,n,i){var c=-1,l=typeof n=="function",f=qt(t)?E(t.length):[];return Ke(t,function(v){f[++c]=l?Kt(n,v,i):Xr(v,n,i)}),f}),Pv=ts(function(t,n,i){Oe(t,i,n)});function us(t,n){var i=M(t)?ot:rc;return i(t,$(n,3))}function Sv(t,n,i,c){return t==null?[]:(M(n)||(n=n==null?[]:[n]),i=c?r:i,M(i)||(i=i==null?[]:[i]),oc(t,n,i))}var Ov=ts(function(t,n,i){t[i?0:1].push(n)},function(){return[[],[]]});function Nv(t,n,i){var c=M(t)?si:Ca,l=arguments.length<3;return c(t,$(n,4),i,l,Ke)}function Rv(t,n,i){var c=M(t)?zp:Ca,l=arguments.length<3;return c(t,$(n,4),i,l,Qa)}function xv(t,n){var i=M(t)?Ue:Ja;return i(t,ps($(n,3)))}function Cv(t){var n=M(t)?Fa:Id;return n(t)}function Av(t,n,i){(i?xt(t,n,i):n===r)?n=1:n=K(n);var c=M(t)?Xf:Ed;return c(t,n)}function Tv(t){var n=M(t)?td:Sd;return n(t)}function Dv(t){if(t==null)return 0;if(qt(t))return ds(t)?mr(t):t.length;var n=St(t);return n==oe||n==ae?t.size:Ei(t).length}function qv(t,n,i){var c=M(t)?ii:Od;return i&&xt(t,n,i)&&(n=r),c(t,$(n,3))}var jv=V(function(t,n){if(t==null)return[];var i=n.length;return i>1&&xt(t,n[0],n[1])?n=[]:i>2&&xt(n[0],n[1],n[2])&&(n=[n[0]]),oc(t,It(n,1),[])}),ls=gf||function(){return _t.Date.now()};function $v(t,n){if(typeof n!="function")throw new Zt(h);return t=K(t),function(){if(--t<1)return n.apply(this,arguments)}}function tu(t,n,i){return n=i?r:n,n=t&&n==null?t.length:n,Ne(t,ht,r,r,r,r,n)}function eu(t,n){var i;if(typeof n!="function")throw new Zt(h);return t=K(t),function(){return--t>0&&(i=n.apply(this,arguments)),t<=1&&(n=r),i}}var Bi=V(function(t,n,i){var c=et;if(i.length){var l=Me(i,Or(Bi));c|=st}return Ne(t,c,n,i,l)}),ru=V(function(t,n,i){var c=et|B;if(i.length){var l=Me(i,Or(ru));c|=st}return Ne(n,c,t,i,l)});function nu(t,n,i){n=i?r:n;var c=Ne(t,J,r,r,r,r,r,n);return c.placeholder=nu.placeholder,c}function su(t,n,i){n=i?r:n;var c=Ne(t,Y,r,r,r,r,r,n);return c.placeholder=su.placeholder,c}function iu(t,n,i){var c,l,f,v,y,w,O=0,N=!1,R=!1,A=!0;if(typeof t!="function")throw new Zt(h);n=ne(n)||0,ct(i)&&(N=!!i.leading,R="maxWait"in i,f=R?yt(ne(i.maxWait)||0,n):f,A="trailing"in i?!!i.trailing:A);function q(ft){var he=c,Te=l;return c=l=r,O=ft,v=t.apply(Te,he),v}function k(ft){return O=ft,y=sn(F,n),N?q(ft):v}function H(ft){var he=ft-w,Te=ft-O,Pu=n-he;return R?Pt(Pu,f-Te):Pu}function U(ft){var he=ft-w,Te=ft-O;return w===r||he>=n||he<0||R&&Te>=f}function F(){var ft=ls();if(U(ft))return G(ft);y=sn(F,H(ft))}function G(ft){return y=r,A&&c?q(ft):(c=l=r,v)}function Wt(){y!==r&&gc(y),O=0,c=w=l=y=r}function Ct(){return y===r?v:G(ls())}function Bt(){var ft=ls(),he=U(ft);if(c=arguments,l=this,w=ft,he){if(y===r)return k(w);if(R)return gc(y),y=sn(F,n),q(w)}return y===r&&(y=sn(F,n)),v}return Bt.cancel=Wt,Bt.flush=Ct,Bt}var kv=V(function(t,n){return Ga(t,1,n)}),Uv=V(function(t,n,i){return Ga(t,ne(n)||0,i)});function zv(t){return Ne(t,ke)}function hs(t,n){if(typeof t!="function"||n!=null&&typeof n!="function")throw new Zt(h);var i=function(){var c=arguments,l=n?n.apply(this,c):c[0],f=i.cache;if(f.has(l))return f.get(l);var v=t.apply(this,c);return i.cache=f.set(l,v)||f,v};return i.cache=new(hs.Cache||Se),i}hs.Cache=Se;function ps(t){if(typeof t!="function")throw new Zt(h);return function(){var n=arguments;switch(n.length){case 0:return!t.call(this);case 1:return!t.call(this,n[0]);case 2:return!t.call(this,n[0],n[1]);case 3:return!t.call(this,n[0],n[1],n[2])}return!t.apply(this,n)}}function Mv(t){return eu(2,t)}var Lv=Nd(function(t,n){n=n.length==1&&M(n[0])?ot(n[0],Ht($())):ot(It(n,1),Ht($()));var i=n.length;return V(function(c){for(var l=-1,f=Pt(c.length,i);++l<f;)c[l]=n[l].call(this,c[l]);return Kt(t,this,c)})}),Gi=V(function(t,n){var i=Me(n,Or(Gi));return Ne(t,st,r,n,i)}),ou=V(function(t,n){var i=Me(n,Or(ou));return Ne(t,Tt,r,n,i)}),Kv=Re(function(t,n){return Ne(t,Nt,r,r,r,n)});function Hv(t,n){if(typeof t!="function")throw new Zt(h);return n=n===r?n:K(n),V(t,n)}function Vv(t,n){if(typeof t!="function")throw new Zt(h);return n=n==null?0:yt(K(n),0),V(function(i){var c=i[n],l=Fe(i,0,n);return c&&ze(l,c),Kt(t,this,l)})}function Fv(t,n,i){var c=!0,l=!0;if(typeof t!="function")throw new Zt(h);return ct(i)&&(c="leading"in i?!!i.leading:c,l="trailing"in i?!!i.trailing:l),iu(t,n,{leading:c,maxWait:n,trailing:l})}function Wv(t){return tu(t,1)}function Bv(t,n){return Gi(Ti(n),t)}function Gv(){if(!arguments.length)return[];var t=arguments[0];return M(t)?t:[t]}function Qv(t){return te(t,T)}function Jv(t,n){return n=typeof n=="function"?n:r,te(t,T,n)}function Yv(t){return te(t,I|T)}function Zv(t,n){return n=typeof n=="function"?n:r,te(t,I|T,n)}function Xv(t,n){return n==null||Ba(t,n,mt(n))}function le(t,n){return t===n||t!==t&&n!==n}var ty=ss(bi),ey=ss(function(t,n){return t>=n}),or=Xa(function(){return arguments}())?Xa:function(t){return ut(t)&&tt.call(t,"callee")&&!za.call(t,"callee")},M=E.isArray,ry=ba?Ht(ba):ld;function qt(t){return t!=null&&fs(t.length)&&!Ce(t)}function pt(t){return ut(t)&&qt(t)}function ny(t){return t===!0||t===!1||ut(t)&&Rt(t)==Ur}var We=yf||io,sy=_a?Ht(_a):hd;function iy(t){return ut(t)&&t.nodeType===1&&!on(t)}function oy(t){if(t==null)return!0;if(qt(t)&&(M(t)||typeof t=="string"||typeof t.splice=="function"||We(t)||Nr(t)||or(t)))return!t.length;var n=St(t);if(n==oe||n==ae)return!t.size;if(nn(t))return!Ei(t).length;for(var i in t)if(tt.call(t,i))return!1;return!0}function ay(t,n){return tn(t,n)}function cy(t,n,i){i=typeof i=="function"?i:r;var c=i?i(t,n):r;return c===r?tn(t,n,r,i):!!c}function Qi(t){if(!ut(t))return!1;var n=Rt(t);return n==Sn||n==Ch||typeof t.message=="string"&&typeof t.name=="string"&&!on(t)}function uy(t){return typeof t=="number"&&La(t)}function Ce(t){if(!ct(t))return!1;var n=Rt(t);return n==On||n==Go||n==xh||n==Th}function au(t){return typeof t=="number"&&t==K(t)}function fs(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=pr}function ct(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}function ut(t){return t!=null&&typeof t=="object"}var cu=Ia?Ht(Ia):fd;function ly(t,n){return t===n||Ii(t,n,zi(n))}function hy(t,n,i){return i=typeof i=="function"?i:r,Ii(t,n,zi(n),i)}function py(t){return uu(t)&&t!=+t}function fy(t){if(Jd(t))throw new z(u);return tc(t)}function dy(t){return t===null}function gy(t){return t==null}function uu(t){return typeof t=="number"||ut(t)&&Rt(t)==Mr}function on(t){if(!ut(t)||Rt(t)!=Ee)return!1;var n=Mn(t);if(n===null)return!0;var i=tt.call(n,"constructor")&&n.constructor;return typeof i=="function"&&i instanceof i&&$n.call(i)==hf}var Ji=Ea?Ht(Ea):dd;function vy(t){return au(t)&&t>=-9007199254740991&&t<=pr}var lu=Pa?Ht(Pa):gd;function ds(t){return typeof t=="string"||!M(t)&&ut(t)&&Rt(t)==Kr}function Ft(t){return typeof t=="symbol"||ut(t)&&Rt(t)==Nn}var Nr=Sa?Ht(Sa):vd;function yy(t){return t===r}function my(t){return ut(t)&&St(t)==Hr}function wy(t){return ut(t)&&Rt(t)==qh}var by=ss(Pi),_y=ss(function(t,n){return t<=n});function hu(t){if(!t)return[];if(qt(t))return ds(t)?ce(t):Dt(t);if(Wr&&t[Wr])return Zp(t[Wr]());var n=St(t),i=n==oe?hi:n==ae?Dn:Rr;return i(t)}function Ae(t){if(!t)return t===0?t:0;if(t=ne(t),t===In||t===-1/0){var n=t<0?-1:1;return n*Sh}return t===t?t:0}function K(t){var n=Ae(t),i=n%1;return n===n?i?n-i:n:0}function pu(t){return t?rr(K(t),0,ve):0}function ne(t){if(typeof t=="number")return t;if(Ft(t))return En;if(ct(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=ct(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=Aa(t);var i=ep.test(t);return i||np.test(t)?jp(t.slice(2),i?2:8):tp.test(t)?En:+t}function fu(t){return me(t,jt(t))}function Iy(t){return t?rr(K(t),-9007199254740991,pr):t===0?t:0}function X(t){return t==null?"":Vt(t)}var Ey=Pr(function(t,n){if(nn(n)||qt(n)){me(n,mt(n),t);return}for(var i in n)tt.call(n,i)&&Yr(t,i,n[i])}),du=Pr(function(t,n){me(n,jt(n),t)}),gs=Pr(function(t,n,i,c){me(n,jt(n),t,c)}),Py=Pr(function(t,n,i,c){me(n,mt(n),t,c)}),Sy=Re(yi);function Oy(t,n){var i=Er(t);return n==null?i:Wa(i,n)}var Ny=V(function(t,n){t=rt(t);var i=-1,c=n.length,l=c>2?n[2]:r;for(l&&xt(n[0],n[1],l)&&(c=1);++i<c;)for(var f=n[i],v=jt(f),y=-1,w=v.length;++y<w;){var O=v[y],N=t[O];(N===r||le(N,br[O])&&!tt.call(t,O))&&(t[O]=f[O])}return t}),Ry=V(function(t){return t.push(r,Ac),Kt(gu,r,t)});function xy(t,n){return Na(t,$(n,3),ye)}function Cy(t,n){return Na(t,$(n,3),wi)}function Ay(t,n){return t==null?t:mi(t,$(n,3),jt)}function Ty(t,n){return t==null?t:Ya(t,$(n,3),jt)}function Dy(t,n){return t&&ye(t,$(n,3))}function qy(t,n){return t&&wi(t,$(n,3))}function jy(t){return t==null?[]:Jn(t,mt(t))}function $y(t){return t==null?[]:Jn(t,jt(t))}function Yi(t,n,i){var c=t==null?r:nr(t,n);return c===r?i:c}function ky(t,n){return t!=null&&qc(t,n,od)}function Zi(t,n){return t!=null&&qc(t,n,ad)}var Uy=Oc(function(t,n,i){n!=null&&typeof n.toString!="function"&&(n=kn.call(n)),t[n]=i},to($t)),zy=Oc(function(t,n,i){n!=null&&typeof n.toString!="function"&&(n=kn.call(n)),tt.call(t,n)?t[n].push(i):t[n]=[i]},$),My=V(Xr);function mt(t){return qt(t)?Va(t):Ei(t)}function jt(t){return qt(t)?Va(t,!0):yd(t)}function Ly(t,n){var i={};return n=$(n,3),ye(t,function(c,l,f){Oe(i,n(c,l,f),c)}),i}function Ky(t,n){var i={};return n=$(n,3),ye(t,function(c,l,f){Oe(i,l,n(c,l,f))}),i}var Hy=Pr(function(t,n,i){Yn(t,n,i)}),gu=Pr(function(t,n,i,c){Yn(t,n,i,c)}),Vy=Re(function(t,n){var i={};if(t==null)return i;var c=!1;n=ot(n,function(f){return f=Ve(f,t),c||(c=f.length>1),f}),me(t,ki(t),i),c&&(i=te(i,I|P|T,Ud));for(var l=n.length;l--;)xi(i,n[l]);return i});function Fy(t,n){return vu(t,ps($(n)))}var Wy=Re(function(t,n){return t==null?{}:wd(t,n)});function vu(t,n){if(t==null)return{};var i=ot(ki(t),function(c){return[c]});return n=$(n),ac(t,i,function(c,l){return n(c,l[0])})}function By(t,n,i){n=Ve(n,t);var c=-1,l=n.length;for(l||(l=1,t=r);++c<l;){var f=t==null?r:t[we(n[c])];f===r&&(c=l,f=i),t=Ce(f)?f.call(t):f}return t}function Gy(t,n,i){return t==null?t:en(t,n,i)}function Qy(t,n,i,c){return c=typeof c=="function"?c:r,t==null?t:en(t,n,i,c)}var yu=xc(mt),mu=xc(jt);function Jy(t,n,i){var c=M(t),l=c||We(t)||Nr(t);if(n=$(n,4),i==null){var f=t&&t.constructor;l?i=c?new f:[]:ct(t)?i=Ce(f)?Er(Mn(t)):{}:i={}}return(l?Yt:ye)(t,function(v,y,w){return n(i,v,y,w)}),i}function Yy(t,n){return t==null?!0:xi(t,n)}function Zy(t,n,i){return t==null?t:pc(t,n,Ti(i))}function Xy(t,n,i,c){return c=typeof c=="function"?c:r,t==null?t:pc(t,n,Ti(i),c)}function Rr(t){return t==null?[]:li(t,mt(t))}function tm(t){return t==null?[]:li(t,jt(t))}function em(t,n,i){return i===r&&(i=n,n=r),i!==r&&(i=ne(i),i=i===i?i:0),n!==r&&(n=ne(n),n=n===n?n:0),rr(ne(t),n,i)}function rm(t,n,i){return n=Ae(n),i===r?(i=n,n=0):i=Ae(i),t=ne(t),cd(t,n,i)}function nm(t,n,i){if(i&&typeof i!="boolean"&&xt(t,n,i)&&(n=i=r),i===r&&(typeof n=="boolean"?(i=n,n=r):typeof t=="boolean"&&(i=t,t=r)),t===r&&n===r?(t=0,n=1):(t=Ae(t),n===r?(n=t,t=0):n=Ae(n)),t>n){var c=t;t=n,n=c}if(i||t%1||n%1){var l=Ka();return Pt(t+l*(n-t+qp("1e-"+((l+"").length-1))),n)}return Oi(t,n)}var sm=Sr(function(t,n,i){return n=n.toLowerCase(),t+(i?wu(n):n)});function wu(t){return Xi(X(t).toLowerCase())}function bu(t){return t=X(t),t&&t.replace(ip,Bp).replace(Pp,"")}function im(t,n,i){t=X(t),n=Vt(n);var c=t.length;i=i===r?c:rr(K(i),0,c);var l=i;return i-=n.length,i>=0&&t.slice(i,l)==n}function om(t){return t=X(t),t&&zh.test(t)?t.replace(Yo,Gp):t}function am(t){return t=X(t),t&&Fh.test(t)?t.replace(Gs,"\\$&"):t}var cm=Sr(function(t,n,i){return t+(i?"-":"")+n.toLowerCase()}),um=Sr(function(t,n,i){return t+(i?" ":"")+n.toLowerCase()}),lm=Ec("toLowerCase");function hm(t,n,i){t=X(t),n=K(n);var c=n?mr(t):0;if(!n||c>=n)return t;var l=(n-c)/2;return ns(Vn(l),i)+t+ns(Hn(l),i)}function pm(t,n,i){t=X(t),n=K(n);var c=n?mr(t):0;return n&&c<n?t+ns(n-c,i):t}function fm(t,n,i){t=X(t),n=K(n);var c=n?mr(t):0;return n&&c<n?ns(n-c,i)+t:t}function dm(t,n,i){return i||n==null?n=0:n&&(n=+n),_f(X(t).replace(Qs,""),n||0)}function gm(t,n,i){return(i?xt(t,n,i):n===r)?n=1:n=K(n),Ni(X(t),n)}function vm(){var t=arguments,n=X(t[0]);return t.length<3?n:n.replace(t[1],t[2])}var ym=Sr(function(t,n,i){return t+(i?"_":"")+n.toLowerCase()});function mm(t,n,i){return i&&typeof i!="number"&&xt(t,n,i)&&(n=i=r),i=i===r?ve:i>>>0,i?(t=X(t),t&&(typeof n=="string"||n!=null&&!Ji(n))&&(n=Vt(n),!n&&yr(t))?Fe(ce(t),0,i):t.split(n,i)):[]}var wm=Sr(function(t,n,i){return t+(i?" ":"")+Xi(n)});function bm(t,n,i){return t=X(t),i=i==null?0:rr(K(i),0,t.length),n=Vt(n),t.slice(i,i+n.length)==n}function _m(t,n,i){var c=p.templateSettings;i&&xt(t,n,i)&&(n=r),t=X(t),n=gs({},n,c,Cc);var l=gs({},n.imports,c.imports,Cc),f=mt(l),v=li(l,f),y,w,O=0,N=n.interpolate||Rn,R="__p += '",A=pi((n.escape||Rn).source+"|"+N.source+"|"+(N===Zo?Xh:Rn).source+"|"+(n.evaluate||Rn).source+"|$","g"),q="//# sourceURL="+(tt.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++xp+"]")+`
`;t.replace(A,function(U,F,G,Wt,Ct,Bt){return G||(G=Wt),R+=t.slice(O,Bt).replace(op,Qp),F&&(y=!0,R+=`' +
__e(`+F+`) +
'`),Ct&&(w=!0,R+=`';
`+Ct+`;
__p += '`),G&&(R+=`' +
((__t = (`+G+`)) == null ? '' : __t) +
'`),O=Bt+U.length,U}),R+=`';
`;var k=tt.call(n,"variable")&&n.variable;if(!k)R=`with (obj) {
`+R+`
}
`;else if(Yh.test(k))throw new z(g);R=(w?R.replace(jh,""):R).replace($h,"$1").replace(kh,"$1;"),R="function("+(k||"obj")+`) {
`+(k?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(y?", __e = _.escape":"")+(w?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+R+`return __p
}`;var H=Iu(function(){return Z(f,q+"return "+R).apply(r,v)});if(H.source=R,Qi(H))throw H;return H}function Im(t){return X(t).toLowerCase()}function Em(t){return X(t).toUpperCase()}function Pm(t,n,i){if(t=X(t),t&&(i||n===r))return Aa(t);if(!t||!(n=Vt(n)))return t;var c=ce(t),l=ce(n),f=Ta(c,l),v=Da(c,l)+1;return Fe(c,f,v).join("")}function Sm(t,n,i){if(t=X(t),t&&(i||n===r))return t.slice(0,ja(t)+1);if(!t||!(n=Vt(n)))return t;var c=ce(t),l=Da(c,ce(n))+1;return Fe(c,0,l).join("")}function Om(t,n,i){if(t=X(t),t&&(i||n===r))return t.replace(Qs,"");if(!t||!(n=Vt(n)))return t;var c=ce(t),l=Ta(c,ce(n));return Fe(c,l).join("")}function Nm(t,n){var i=wh,c=bh;if(ct(n)){var l="separator"in n?n.separator:l;i="length"in n?K(n.length):i,c="omission"in n?Vt(n.omission):c}t=X(t);var f=t.length;if(yr(t)){var v=ce(t);f=v.length}if(i>=f)return t;var y=i-mr(c);if(y<1)return c;var w=v?Fe(v,0,y).join(""):t.slice(0,y);if(l===r)return w+c;if(v&&(y+=w.length-y),Ji(l)){if(t.slice(y).search(l)){var O,N=w;for(l.global||(l=pi(l.source,X(Xo.exec(l))+"g")),l.lastIndex=0;O=l.exec(N);)var R=O.index;w=w.slice(0,R===r?y:R)}}else if(t.indexOf(Vt(l),y)!=y){var A=w.lastIndexOf(l);A>-1&&(w=w.slice(0,A))}return w+c}function Rm(t){return t=X(t),t&&Uh.test(t)?t.replace(Jo,rf):t}var xm=Sr(function(t,n,i){return t+(i?" ":"")+n.toUpperCase()}),Xi=Ec("toUpperCase");function _u(t,n,i){return t=X(t),n=i?r:n,n===r?Yp(t)?of(t):Kp(t):t.match(n)||[]}var Iu=V(function(t,n){try{return Kt(t,r,n)}catch(i){return Qi(i)?i:new z(i)}}),Cm=Re(function(t,n){return Yt(n,function(i){i=we(i),Oe(t,i,Bi(t[i],t))}),t});function Am(t){var n=t==null?0:t.length,i=$();return t=n?ot(t,function(c){if(typeof c[1]!="function")throw new Zt(h);return[i(c[0]),c[1]]}):[],V(function(c){for(var l=-1;++l<n;){var f=t[l];if(Kt(f[0],this,c))return Kt(f[1],this,c)}})}function Tm(t){return nd(te(t,I))}function to(t){return function(){return t}}function Dm(t,n){return t==null||t!==t?n:t}var qm=Sc(),jm=Sc(!0);function $t(t){return t}function eo(t){return ec(typeof t=="function"?t:te(t,I))}function $m(t){return nc(te(t,I))}function km(t,n){return sc(t,te(n,I))}var Um=V(function(t,n){return function(i){return Xr(i,t,n)}}),zm=V(function(t,n){return function(i){return Xr(t,i,n)}});function ro(t,n,i){var c=mt(n),l=Jn(n,c);i==null&&!(ct(n)&&(l.length||!c.length))&&(i=n,n=t,t=this,l=Jn(n,mt(n)));var f=!(ct(i)&&"chain"in i)||!!i.chain,v=Ce(t);return Yt(l,function(y){var w=n[y];t[y]=w,v&&(t.prototype[y]=function(){var O=this.__chain__;if(f||O){var N=t(this.__wrapped__),R=N.__actions__=Dt(this.__actions__);return R.push({func:w,args:arguments,thisArg:t}),N.__chain__=O,N}return w.apply(t,ze([this.value()],arguments))})}),t}function Mm(){return _t._===this&&(_t._=pf),this}function no(){}function Lm(t){return t=K(t),V(function(n){return ic(n,t)})}var Km=qi(ot),Hm=qi(Oa),Vm=qi(ii);function Eu(t){return Li(t)?oi(we(t)):bd(t)}function Fm(t){return function(n){return t==null?r:nr(t,n)}}var Wm=Nc(),Bm=Nc(!0);function so(){return[]}function io(){return!1}function Gm(){return{}}function Qm(){return""}function Jm(){return!0}function Ym(t,n){if(t=K(t),t<1||t>pr)return[];var i=ve,c=Pt(t,ve);n=$(n),t-=ve;for(var l=ui(c,n);++i<t;)n(i);return l}function Zm(t){return M(t)?ot(t,we):Ft(t)?[t]:Dt(Hc(X(t)))}function Xm(t){var n=++lf;return X(t)+n}var tw=rs(function(t,n){return t+n},0),ew=ji("ceil"),rw=rs(function(t,n){return t/n},1),nw=ji("floor");function sw(t){return t&&t.length?Qn(t,$t,bi):r}function iw(t,n){return t&&t.length?Qn(t,$(n,2),bi):r}function ow(t){return xa(t,$t)}function aw(t,n){return xa(t,$(n,2))}function cw(t){return t&&t.length?Qn(t,$t,Pi):r}function uw(t,n){return t&&t.length?Qn(t,$(n,2),Pi):r}var lw=rs(function(t,n){return t*n},1),hw=ji("round"),pw=rs(function(t,n){return t-n},0);function fw(t){return t&&t.length?ci(t,$t):0}function dw(t,n){return t&&t.length?ci(t,$(n,2)):0}return p.after=$v,p.ary=tu,p.assign=Ey,p.assignIn=du,p.assignInWith=gs,p.assignWith=Py,p.at=Sy,p.before=eu,p.bind=Bi,p.bindAll=Cm,p.bindKey=ru,p.castArray=Gv,p.chain=Yc,p.chunk=ng,p.compact=sg,p.concat=ig,p.cond=Am,p.conforms=Tm,p.constant=to,p.countBy=fv,p.create=Oy,p.curry=nu,p.curryRight=su,p.debounce=iu,p.defaults=Ny,p.defaultsDeep=Ry,p.defer=kv,p.delay=Uv,p.difference=og,p.differenceBy=ag,p.differenceWith=cg,p.drop=ug,p.dropRight=lg,p.dropRightWhile=hg,p.dropWhile=pg,p.fill=fg,p.filter=gv,p.flatMap=mv,p.flatMapDeep=wv,p.flatMapDepth=bv,p.flatten=Bc,p.flattenDeep=dg,p.flattenDepth=gg,p.flip=zv,p.flow=qm,p.flowRight=jm,p.fromPairs=vg,p.functions=jy,p.functionsIn=$y,p.groupBy=_v,p.initial=mg,p.intersection=wg,p.intersectionBy=bg,p.intersectionWith=_g,p.invert=Uy,p.invertBy=zy,p.invokeMap=Ev,p.iteratee=eo,p.keyBy=Pv,p.keys=mt,p.keysIn=jt,p.map=us,p.mapKeys=Ly,p.mapValues=Ky,p.matches=$m,p.matchesProperty=km,p.memoize=hs,p.merge=Hy,p.mergeWith=gu,p.method=Um,p.methodOf=zm,p.mixin=ro,p.negate=ps,p.nthArg=Lm,p.omit=Vy,p.omitBy=Fy,p.once=Mv,p.orderBy=Sv,p.over=Km,p.overArgs=Lv,p.overEvery=Hm,p.overSome=Vm,p.partial=Gi,p.partialRight=ou,p.partition=Ov,p.pick=Wy,p.pickBy=vu,p.property=Eu,p.propertyOf=Fm,p.pull=Sg,p.pullAll=Qc,p.pullAllBy=Og,p.pullAllWith=Ng,p.pullAt=Rg,p.range=Wm,p.rangeRight=Bm,p.rearg=Kv,p.reject=xv,p.remove=xg,p.rest=Hv,p.reverse=Fi,p.sampleSize=Av,p.set=Gy,p.setWith=Qy,p.shuffle=Tv,p.slice=Cg,p.sortBy=jv,p.sortedUniq=kg,p.sortedUniqBy=Ug,p.split=mm,p.spread=Vv,p.tail=zg,p.take=Mg,p.takeRight=Lg,p.takeRightWhile=Kg,p.takeWhile=Hg,p.tap=sv,p.throttle=Fv,p.thru=cs,p.toArray=hu,p.toPairs=yu,p.toPairsIn=mu,p.toPath=Zm,p.toPlainObject=fu,p.transform=Jy,p.unary=Wv,p.union=Vg,p.unionBy=Fg,p.unionWith=Wg,p.uniq=Bg,p.uniqBy=Gg,p.uniqWith=Qg,p.unset=Yy,p.unzip=Wi,p.unzipWith=Jc,p.update=Zy,p.updateWith=Xy,p.values=Rr,p.valuesIn=tm,p.without=Jg,p.words=_u,p.wrap=Bv,p.xor=Yg,p.xorBy=Zg,p.xorWith=Xg,p.zip=tv,p.zipObject=ev,p.zipObjectDeep=rv,p.zipWith=nv,p.entries=yu,p.entriesIn=mu,p.extend=du,p.extendWith=gs,ro(p,p),p.add=tw,p.attempt=Iu,p.camelCase=sm,p.capitalize=wu,p.ceil=ew,p.clamp=em,p.clone=Qv,p.cloneDeep=Yv,p.cloneDeepWith=Zv,p.cloneWith=Jv,p.conformsTo=Xv,p.deburr=bu,p.defaultTo=Dm,p.divide=rw,p.endsWith=im,p.eq=le,p.escape=om,p.escapeRegExp=am,p.every=dv,p.find=vv,p.findIndex=Fc,p.findKey=xy,p.findLast=yv,p.findLastIndex=Wc,p.findLastKey=Cy,p.floor=nw,p.forEach=Zc,p.forEachRight=Xc,p.forIn=Ay,p.forInRight=Ty,p.forOwn=Dy,p.forOwnRight=qy,p.get=Yi,p.gt=ty,p.gte=ey,p.has=ky,p.hasIn=Zi,p.head=Gc,p.identity=$t,p.includes=Iv,p.indexOf=yg,p.inRange=rm,p.invoke=My,p.isArguments=or,p.isArray=M,p.isArrayBuffer=ry,p.isArrayLike=qt,p.isArrayLikeObject=pt,p.isBoolean=ny,p.isBuffer=We,p.isDate=sy,p.isElement=iy,p.isEmpty=oy,p.isEqual=ay,p.isEqualWith=cy,p.isError=Qi,p.isFinite=uy,p.isFunction=Ce,p.isInteger=au,p.isLength=fs,p.isMap=cu,p.isMatch=ly,p.isMatchWith=hy,p.isNaN=py,p.isNative=fy,p.isNil=gy,p.isNull=dy,p.isNumber=uu,p.isObject=ct,p.isObjectLike=ut,p.isPlainObject=on,p.isRegExp=Ji,p.isSafeInteger=vy,p.isSet=lu,p.isString=ds,p.isSymbol=Ft,p.isTypedArray=Nr,p.isUndefined=yy,p.isWeakMap=my,p.isWeakSet=wy,p.join=Ig,p.kebabCase=cm,p.last=re,p.lastIndexOf=Eg,p.lowerCase=um,p.lowerFirst=lm,p.lt=by,p.lte=_y,p.max=sw,p.maxBy=iw,p.mean=ow,p.meanBy=aw,p.min=cw,p.minBy=uw,p.stubArray=so,p.stubFalse=io,p.stubObject=Gm,p.stubString=Qm,p.stubTrue=Jm,p.multiply=lw,p.nth=Pg,p.noConflict=Mm,p.noop=no,p.now=ls,p.pad=hm,p.padEnd=pm,p.padStart=fm,p.parseInt=dm,p.random=nm,p.reduce=Nv,p.reduceRight=Rv,p.repeat=gm,p.replace=vm,p.result=By,p.round=hw,p.runInContext=m,p.sample=Cv,p.size=Dv,p.snakeCase=ym,p.some=qv,p.sortedIndex=Ag,p.sortedIndexBy=Tg,p.sortedIndexOf=Dg,p.sortedLastIndex=qg,p.sortedLastIndexBy=jg,p.sortedLastIndexOf=$g,p.startCase=wm,p.startsWith=bm,p.subtract=pw,p.sum=fw,p.sumBy=dw,p.template=_m,p.times=Ym,p.toFinite=Ae,p.toInteger=K,p.toLength=pu,p.toLower=Im,p.toNumber=ne,p.toSafeInteger=Iy,p.toString=X,p.toUpper=Em,p.trim=Pm,p.trimEnd=Sm,p.trimStart=Om,p.truncate=Nm,p.unescape=Rm,p.uniqueId=Xm,p.upperCase=xm,p.upperFirst=Xi,p.each=Zc,p.eachRight=Xc,p.first=Gc,ro(p,function(){var t={};return ye(p,function(n,i){tt.call(p.prototype,i)||(t[i]=n)}),t}(),{chain:!1}),p.VERSION=s,Yt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){p[t].placeholder=p}),Yt(["drop","take"],function(t,n){W.prototype[t]=function(i){i=i===r?1:yt(K(i),0);var c=this.__filtered__&&!n?new W(this):this.clone();return c.__filtered__?c.__takeCount__=Pt(i,c.__takeCount__):c.__views__.push({size:Pt(i,ve),type:t+(c.__dir__<0?"Right":"")}),c},W.prototype[t+"Right"]=function(i){return this.reverse()[t](i).reverse()}}),Yt(["filter","map","takeWhile"],function(t,n){var i=n+1,c=i==Bo||i==Ph;W.prototype[t]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:$(l,3),type:i}),f.__filtered__=f.__filtered__||c,f}}),Yt(["head","last"],function(t,n){var i="take"+(n?"Right":"");W.prototype[t]=function(){return this[i](1).value()[0]}}),Yt(["initial","tail"],function(t,n){var i="drop"+(n?"":"Right");W.prototype[t]=function(){return this.__filtered__?new W(this):this[i](1)}}),W.prototype.compact=function(){return this.filter($t)},W.prototype.find=function(t){return this.filter(t).head()},W.prototype.findLast=function(t){return this.reverse().find(t)},W.prototype.invokeMap=V(function(t,n){return typeof t=="function"?new W(this):this.map(function(i){return Xr(i,t,n)})}),W.prototype.reject=function(t){return this.filter(ps($(t)))},W.prototype.slice=function(t,n){t=K(t);var i=this;return i.__filtered__&&(t>0||n<0)?new W(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),n!==r&&(n=K(n),i=n<0?i.dropRight(-n):i.take(n-t)),i)},W.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},W.prototype.toArray=function(){return this.take(ve)},ye(W.prototype,function(t,n){var i=/^(?:filter|find|map|reject)|While$/.test(n),c=/^(?:head|last)$/.test(n),l=p[c?"take"+(n=="last"?"Right":""):n],f=c||/^find/.test(n);l&&(p.prototype[n]=function(){var v=this.__wrapped__,y=c?[1]:arguments,w=v instanceof W,O=y[0],N=w||M(v),R=function(F){var G=l.apply(p,ze([F],y));return c&&A?G[0]:G};N&&i&&typeof O=="function"&&O.length!=1&&(w=N=!1);var A=this.__chain__,q=!!this.__actions__.length,k=f&&!A,H=w&&!q;if(!f&&N){v=H?v:new W(this);var U=t.apply(v,y);return U.__actions__.push({func:cs,args:[R],thisArg:r}),new Xt(U,A)}return k&&H?t.apply(this,y):(U=this.thru(R),k?c?U.value()[0]:U.value():U)})}),Yt(["pop","push","shift","sort","splice","unshift"],function(t){var n=qn[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",c=/^(?:pop|shift)$/.test(t);p.prototype[t]=function(){var l=arguments;if(c&&!this.__chain__){var f=this.value();return n.apply(M(f)?f:[],l)}return this[i](function(v){return n.apply(M(v)?v:[],l)})}}),ye(W.prototype,function(t,n){var i=p[n];if(i){var c=i.name+"";tt.call(Ir,c)||(Ir[c]=[]),Ir[c].push({name:n,func:i})}}),Ir[es(r,B).name]=[{name:"wrapper",func:r}],W.prototype.clone=Rf,W.prototype.reverse=xf,W.prototype.value=Cf,p.prototype.at=iv,p.prototype.chain=ov,p.prototype.commit=av,p.prototype.next=cv,p.prototype.plant=lv,p.prototype.reverse=hv,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=pv,p.prototype.first=p.prototype.head,Wr&&(p.prototype[Wr]=uv),p},wr=af();Ze?((Ze.exports=wr)._=wr,ei._=wr):_t._=wr}).call(fn)})(Co,Co.exports);var aP=Object.defineProperty,cP=Object.defineProperties,uP=Object.getOwnPropertyDescriptors,Pl=Object.getOwnPropertySymbols,lP=Object.prototype.hasOwnProperty,hP=Object.prototype.propertyIsEnumerable,Sl=(o,e,r)=>e in o?aP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,bs=(o,e)=>{for(var r in e||(e={}))lP.call(e,r)&&Sl(o,r,e[r]);if(Pl)for(var r of Pl(e))hP.call(e,r)&&Sl(o,r,e[r]);return o},pP=(o,e)=>cP(o,uP(e));function Je(o,e,r){var s;const a=kw(o);return((s=e.rpcMap)==null?void 0:s[a.reference])||`${oP}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function hr(o){return o.includes(":")?o.split(":")[1]:o}function yh(o){return o.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function fP(o,e){const r=Object.keys(e.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=e.namespaces[a].accounts;s.push(...u)}),s}function dP(o={},e={}){const r=Ol(o),s=Ol(e);return Co.exports.merge(r,s)}function Ol(o){var e,r,s,a;const u={};if(!Dr(o))return u;for(const[h,g]of Object.entries(o)){const b=Lo(h)?[h]:g.chains,d=g.methods||[],_=g.events||[],I=g.rpcMap||{},P=dn(h);u[P]=pP(bs(bs({},u[P]),g),{chains:oo(b,(e=u[P])==null?void 0:e.chains),methods:oo(d,(r=u[P])==null?void 0:r.methods),events:oo(_,(s=u[P])==null?void 0:s.events),rpcMap:bs(bs({},I),(a=u[P])==null?void 0:a.rpcMap)})}return u}function gP(o){return o.includes(":")?o.split(":")[2]:o}function vP(o){const e={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],h=s.accounts||[],g=Lo(r)?[r]:s.chains?s.chains:yh(s.accounts);e[r]={chains:g,methods:a,events:u,accounts:h}}return e}function go(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const mh={},at=o=>mh[o],vo=(o,e)=>{mh[o]=e};class yP{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const a=hr(r);e[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Je(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}}class mP{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r),this.chainId=parseInt(e),this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const s=r||Je(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(hr(r));e[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}async handleSwitchChain(e){var r,s;let a=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}}class wP{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const a=hr(r);e[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Je(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}}class bP{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const a=hr(r);e[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Je(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}}class _P{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=hr(r);e[a]=this.createHttpProvider(a,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}getCardanoRPCUrl(e){const r=this.namespace.rpcMap;if(r)return r[e]}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}}class IP{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const a=hr(r);e[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Je(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}}class EP{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r),this.chainId=e,this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;const a=hr(r);e[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Je(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new je(new Ye(s,at("disableProviderPing")))}}class PP{constructor(e){this.name="near",this.namespace=e.namespace,this.events=at("events"),this.client=at("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const s=r||Je(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit($e.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var s;e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,r){const s=this.createHttpProvider(e,r);s&&(this.httpProviders[e]=s)}createHttpProvider(e,r){const s=r||Je(e,this.namespace);return typeof s>"u"?void 0:new je(new Ye(s,at("disableProviderPing")))}}var SP=Object.defineProperty,OP=Object.defineProperties,NP=Object.getOwnPropertyDescriptors,Nl=Object.getOwnPropertySymbols,RP=Object.prototype.hasOwnProperty,xP=Object.prototype.propertyIsEnumerable,Rl=(o,e,r)=>e in o?SP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,_s=(o,e)=>{for(var r in e||(e={}))RP.call(e,r)&&Rl(o,r,e[r]);if(Nl)for(var r of Nl(e))xP.call(e,r)&&Rl(o,r,e[r]);return o},yo=(o,e)=>OP(o,NP(e));class Fo{constructor(e){this.events=new qo,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Cs(As({level:(e==null?void 0:e.logger)||Il})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new Fo(e);return await r.initialize(),r}async request(e,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:_s({},e),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(e,r,s){const a=new Date().getTime();this.request(e,s).then(u=>r(null,Ts(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:lt("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=vP(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==gh)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[s,a]=this.validateChain(e);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Ie(r)){for(const s of r)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await rP.init({logger:this.providerOpts.logger||Il,relayUrl:this.providerOpts.relayUrl||nP,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>dn(r)))];vo("client",this.client),vo("events",this.events),vo("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const s=fP(r,this.session),a=yh(s),u=dP(this.namespaces,this.optionalNamespaces),h=yo(_s({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new mP({namespace:h});break;case"solana":this.rpcProviders[r]=new wP({namespace:h});break;case"cosmos":this.rpcProviders[r]=new bP({namespace:h});break;case"polkadot":this.rpcProviders[r]=new yP({namespace:h});break;case"cip34":this.rpcProviders[r]=new _P({namespace:h});break;case"elrond":this.rpcProviders[r]=new IP({namespace:h});break;case"multiversx":this.rpcProviders[r]=new EP({namespace:h});break;case"near":this.rpcProviders[r]=new PP({namespace:h});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&Ie(a)&&this.events.emit("accountsChanged",a.map(gP))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,h=dn(a),g=go(a)!==go(u)?`${h}:${go(u)}`:a;this.onChainChanged(g)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(e);this.session=yo(_s({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",yo(_s({},lt("USER_DISCONNECTED")),{data:e.topic}))}),this.on($e.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=e;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(e){const[r,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(h=>dn(h)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=dn(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(e);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,r){this.client.core.storage.setItem(`${El}/${e}`,r)}async getFromStore(e){return await this.client.core.storage.getItem(`${El}/${e}`)}}const CP=Fo,AP="wc",TP="ethereum_provider",DP=`${AP}@2:${TP}:`,qP="https://rpc.walletconnect.com/v1/",Ao=["eth_sendTransaction","personal_sign"],jP=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],To=["chainChanged","accountsChanged"],$P=["chainChanged","accountsChanged","message","disconnect","connect"];var kP=Object.defineProperty,UP=Object.defineProperties,zP=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,MP=Object.prototype.hasOwnProperty,LP=Object.prototype.propertyIsEnumerable,Cl=(o,e,r)=>e in o?kP(o,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[e]=r,vn=(o,e)=>{for(var r in e||(e={}))MP.call(e,r)&&Cl(o,r,e[r]);if(xl)for(var r of xl(e))LP.call(e,r)&&Cl(o,r,e[r]);return o},Al=(o,e)=>UP(o,zP(e));function xs(o){return Number(o[0].split(":")[1])}function mo(o){return`0x${o.toString(16)}`}function KP(o){const{chains:e,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:h,rpcMap:g}=o;if(!Ie(e))throw new Error("Invalid chains");const b={chains:e,methods:s||Ao,events:u||To,rpcMap:vn({},e.length?{[xs(e)]:g[xs(e)]}:{})},d=u==null?void 0:u.filter(T=>!To.includes(T)),_=s==null?void 0:s.filter(T=>!Ao.includes(T));if(!r&&!h&&!a&&!(d!=null&&d.length)&&!(_!=null&&_.length))return{required:e.length?b:void 0};const I=(d==null?void 0:d.length)&&(_==null?void 0:_.length)||!r,P={chains:[...new Set(I?b.chains.concat(r||[]):r)],methods:[...new Set(b.methods.concat(a!=null&&a.length?a:jP))],events:[...new Set(b.events.concat(h!=null&&h.length?h:$P))],rpcMap:g};return{required:e.length?b:void 0,optional:r.length?P:void 0}}class Wo{constructor(){this.events=new ge.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=DP,this.on=(e,r)=>(this.events.on(e,r),this),this.once=(e,r)=>(this.events.once(e,r),this),this.removeListener=(e,r)=>(this.events.removeListener(e,r),this),this.off=(e,r)=>(this.events.off(e,r),this),this.parseAccount=e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e,this.signer={},this.rpc={}}static async init(e){const r=new Wo;return await r.initialize(e),r}async request(e){return await this.signer.request(e,this.formatChainId(this.chainId))}sendAsync(e,r){this.signer.sendAsync(e,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:r,optional:s}=KP(this.rpc);try{const a=await new Promise(async(h,g)=>{var b;this.rpc.showQrModal&&((b=this.modal)==null||b.subscribeModal(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),g(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Al(vn({namespaces:vn({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic})).then(d=>{h(d)}).catch(d=>{g(new Error(d.message))})});if(!a)return;const u=Uw(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:mo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",e)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",mo(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Al(vn({},lt("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:e})),this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",mo(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,s,a]=e.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,s;const a=(r=e==null?void 0:e.chains)!=null?r:[],u=(s=e==null?void 0:e.optionalChains)!=null?s:[],h=a.concat(u);if(!h.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const g=a.length?(e==null?void 0:e.methods)||Ao:[],b=a.length?(e==null?void 0:e.events)||To:[],d=(e==null?void 0:e.optionalMethods)||[],_=(e==null?void 0:e.optionalEvents)||[],I=(e==null?void 0:e.rpcMap)||this.buildRpcMap(h,e.projectId),P=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(T=>this.formatChainId(T)),optionalChains:u.map(T=>this.formatChainId(T)),methods:g,events:b,optionalMethods:d,optionalEvents:_,rpcMap:I,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:P,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const s={};return e.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?xs(this.rpc.chains):xs(this.rpc.optionalChains),this.signer=await CP.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storageOptions:e.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await gw(async()=>{const{WalletConnectModal:a}=await import("./index-DuXi1xNY-DWC___-m.js");return{WalletConnectModal:a}},__vite__mapDeps([0,1,2])).then(a=>a.i);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(vn({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:s,rpcMap:a}=e;r&&Ie(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&Ie(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(e,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[e])||`${qP}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const BP=Wo;export{BP as EthereumProvider,$P as OPTIONAL_EVENTS,jP as OPTIONAL_METHODS,To as REQUIRED_EVENTS,Ao as REQUIRED_METHODS,Wo as default};
