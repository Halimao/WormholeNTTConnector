const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/solanaEmbed.esm-a7S5N_pS-BbRCgkuf.js","assets/index-BGLdF6jF.js","assets/index-CUtl-BF5.css","assets/index-CuHybtft-BXlf5Z1L.js","assets/secp256k1-BFBj5yVh-pcCAbJ0I.js","assets/util--bw7gFPs-CFDtl-lf.js","assets/wallets-B2tqS5lZ-CMHWyddi.js","assets/signer-CinqaaXD-CK79ZFw-.js","assets/index-CNWcuxPc-C5KIuBWR.js","assets/index.es-CEy-pF4C-DURb_lgF.js","assets/secp256k1-C56YnRUb-DCBSmDbq.js","assets/basic-zSaFlloC-C1fIY3Mr.js","assets/index-dPmy3HXi-BrmjQzGt.js","assets/w3m-modal-DksS6aIT-Dd1VgM2E.js"])))=>i.map(i=>d[i]);
import{aC as N,bb as rb,a_ as Os,aP as ym,bc as nb,aO as Xi,_ as Bo,b3 as ob,bd as Ju,b1 as Xu,b7 as Sa,be as ch,bf as ab,a$ as ed,bg as td,bh as cb,aQ as lh,bi as hh,bj as lb,bk as hb,bl as Hn,aA as xt}from"./index-BGLdF6jF.js";import{w as ub}from"./util--bw7gFPs-CFDtl-lf.js";import{m as db}from"./wallets-B2tqS5lZ-CMHWyddi.js";import{q as pb,v as gb}from"./signer-CinqaaXD-CK79ZFw-.js";import{a3 as E,v as fb,a4 as vm,t as ll,I as id,p as sd,a5 as Vs,a6 as qc,a7 as bm}from"./index-CNWcuxPc-C5KIuBWR.js";import{L as Vn,O as ys,U as Ws,T as Ae,v as qe,G as tt,j as Kt,N as mb,P as pi,Q as it,$ as Nr,M as Wn,C as yu,p as Ge,b as Ne,y as yi,X as vt,h as $t,V as na,n as Ar,z as rd,_ as wb,D as yb,a as ws,m as vb,H as bb,c as Im,d as vc,e as Em,x as Nm,F as Am,E as _m,w as Cm,R as bc,u as Sm,f as Pm,I as kn,g as Ds,i as Tm,k as Pn}from"./index.es-CEy-pF4C-DURb_lgF.js";var Ib=Object.defineProperty,Eb=(t,e,i)=>e in t?Ib(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,zt=(t,e,i)=>Eb(t,typeof e!="symbol"?e+"":e,i);class kt extends Error{constructor(e,i){super(e),this.error=i}}class Ks extends kt{constructor(){super(...arguments),this.name="WalletNotReadyError"}}class Nb extends kt{constructor(){super(...arguments),this.name="WalletLoadError"}}class Nn extends kt{constructor(){super(...arguments),this.name="WalletConfigError"}}class Bc extends kt{constructor(){super(...arguments),this.name="WalletConnectionError"}}class Mm extends kt{constructor(){super(...arguments),this.name="WalletDisconnectedError"}}class oa extends kt{constructor(){super(...arguments),this.name="WalletDisconnectionError"}}class Pi extends kt{constructor(){super(...arguments),this.name="WalletAccountError"}}class _r extends kt{constructor(){super(...arguments),this.name="WalletPublicKeyError"}}class $e extends kt{constructor(){super(...arguments),this.name="WalletNotConnectedError"}}class cr extends kt{constructor(){super(...arguments),this.name="WalletSendTransactionError"}}class et extends kt{constructor(){super(...arguments),this.name="WalletSignTransactionError"}}class aa extends kt{constructor(){super(...arguments),this.name="WalletSignMessageError"}}class nd extends kt{constructor(){super(...arguments),this.name="WalletSignInError"}}class Ab extends kt{constructor(){super(...arguments),this.name="WalletWindowClosedError"}}var oe;(function(t){t.Installed="Installed",t.NotDetected="NotDetected",t.Loadable="Loadable",t.Unsupported="Unsupported"})(oe||(oe={}));class Om extends hb{get connected(){return!!this.publicKey}async autoConnect(){await this.connect()}async prepareTransaction(e,i,s={}){const r=this.publicKey;if(!r)throw new $e;return e.feePayer=e.feePayer||r,e.recentBlockhash=e.recentBlockhash||(await i.getLatestBlockhash({commitment:s.preflightCommitment,minContextSlot:s.minContextSlot})).blockhash,e}}function ca(t){if(typeof window>"u"||typeof document>"u")return;const e=[];function i(){if(t())for(const r of e)r()}const s=setInterval(i,1e3);e.push(()=>clearInterval(s)),document.readyState==="loading"&&(document.addEventListener("DOMContentLoaded",i,{once:!0}),e.push(()=>document.removeEventListener("DOMContentLoaded",i))),document.readyState!=="complete"&&(window.addEventListener("load",i,{once:!0}),e.push(()=>window.removeEventListener("load",i))),i()}function ps(t){return"version"in t}class vu extends Om{async sendTransaction(e,i,s={}){let r=!0;try{if(ps(e)){if(!this.supportedTransactionVersions)throw new cr("Sending versioned transactions isn't supported by this wallet");if(!this.supportedTransactionVersions.has(e.version))throw new cr(`Sending transaction version ${e.version} isn't supported by this wallet`);try{e=await this.signTransaction(e);const n=e.serialize();return await i.sendRawTransaction(n,s)}catch(n){throw n instanceof et?(r=!1,n):new cr(n==null?void 0:n.message,n)}}else try{const{signers:n,...o}=s;e=await this.prepareTransaction(e,i,o),n!=null&&n.length&&e.partialSign(...n),e=await this.signTransaction(e);const a=e.serialize();return await i.sendRawTransaction(a,o)}catch(n){throw n instanceof et?(r=!1,n):new cr(n==null?void 0:n.message,n)}}catch(n){throw r&&this.emit("error",n),n}}async signAllTransactions(e){for(const s of e)if(ps(s)){if(!this.supportedTransactionVersions)throw new et("Signing versioned transactions isn't supported by this wallet");if(!this.supportedTransactionVersions.has(s.version))throw new et(`Signing transaction version ${s.version} isn't supported by this wallet`)}const i=[];for(const s of e)i.push(await this.signTransaction(s));return i}}class la extends vu{}const xs="solana:signAndSendTransaction",hl="solana:signIn",io="solana:signMessage",Tt="solana:signTransaction",xm="standard:connect",od="standard:disconnect",km="standard:events";function _b(t){return xm in t.features&&km in t.features&&(xs in t.features||Tt in t.features)}var Ho;(function(t){t.Mainnet="mainnet-beta",t.Testnet="testnet",t.Devnet="devnet"})(Ho||(Ho={}));const Cb="Bitget";class Sb extends la{constructor(e={}){super(),this.name=Cb,this.url="https://web3.bitget.com",this.icon="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjI1NiIgdmlld0JveD0iMCAwIDI1NiAyNTYiIHdpZHRoPSIyNTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxmaWx0ZXIgaWQ9ImEiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBoZWlnaHQ9IjQ1MS40MzEiIHdpZHRoPSI1NjkuNTU4IiB4PSItOTAuMjQxMSIgeT0iLTY5LjczNjkiPjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiBtb2RlPSJub3JtYWwiIHJlc3VsdD0ic2hhcGUiLz48ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzIwMzVfMTEwNiIgc3RkRGV2aWF0aW9uPSI0OS4yMzA4Ii8+PC9maWx0ZXI+PGZpbHRlciBpZD0iYiIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGhlaWdodD0iMzcxLjUwNyIgd2lkdGg9IjM1MS41OTYiIHg9Ii0xNjAuNTExIiB5PSItMTY1Ljk4NyI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIG1vZGU9Im5vcm1hbCIgcmVzdWx0PSJzaGFwZSIvPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImVmZmVjdDFfZm9yZWdyb3VuZEJsdXJfMjAzNV8xMTA2IiBzdGREZXZpYXRpb249IjQ5LjIzMDgiLz48L2ZpbHRlcj48ZmlsdGVyIGlkPSJjIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgaGVpZ2h0PSI0MjQuNDUyIiB3aWR0aD0iNDQ0Ljg1MSIgeD0iLTI0MS4wNzgiIHk9IjY3LjY0MiI+PGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIG1vZGU9Im5vcm1hbCIgcmVzdWx0PSJzaGFwZSIvPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImVmZmVjdDFfZm9yZWdyb3VuZEJsdXJfMjAzNV8xMTA2IiBzdGREZXZpYXRpb249IjQ5LjIzMDgiLz48L2ZpbHRlcj48ZmlsdGVyIGlkPSJkIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgaGVpZ2h0PSIzODUuMTA1IiB3aWR0aD0iNDMwLjE5MSIgeD0iLTIwLjM5NjgiIHk9Ii0yNDIuNzU4Ij48ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9IkJhY2tncm91bmRJbWFnZUZpeCIgbW9kZT0ibm9ybWFsIiByZXN1bHQ9InNoYXBlIi8+PGZlR2F1c3NpYW5CbHVyIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl8yMDM1XzExMDYiIHN0ZERldmlhdGlvbj0iNDkuMjMwOCIvPjwvZmlsdGVyPjxjbGlwUGF0aCBpZD0iZSI+PHBhdGggZD0ibTAgMGgyNTZ2MjU2aC0yNTZ6Ii8+PC9jbGlwUGF0aD48ZyBjbGlwLXBhdGg9InVybCgjZSkiPjxwYXRoIGQ9Im0wIDBoMjU2djI1NmgtMjU2eiIgZmlsbD0iIzU0ZmZmNSIvPjxnIGZpbHRlcj0idXJsKCNhKSI+PHBhdGggZD0ibTEzLjQ4MDYgMTk4LjYwNWMtNDIuODA4MiAxMjAuNDM4IDE4Ni4xODA0IDg2LjQyMiAzMDYuMDI2NCA1NC4zNTkgMTIyLjY1OC00MC43MDUgMzcuODc5LTIyMC4xMzcxLTUwLjA5Mi0yMjQuMTA4Mi04Ny45NzItMy45NzExIDEwLjkwNyA4Mi45NjgyLTYzLjgyIDEwNy44MDAyLTc0LjcyNyAyNC44MzEtMTM4LjYwNDMtODguNTk3Ny0xOTIuMTE0NCA2MS45NDl6IiBmaWxsPSIjZmZmIi8+PC9nPjxnIGZpbHRlcj0idXJsKCNiKSI+PHBhdGggZD0ibTg1LjUxMTgtNDUuODIyNWMtMjIuNDU1Ni02MS4zNTM1LTEwMi40MzA3IDIxLjgyNzItMTM5LjYxMTMgNzEuMDg2OC0zNS40NjU3IDUzLjU4MzYgNTcuMTA4ODcgOTkuODg3NyA5My40MjAzIDc0Ljc3MjcgMzYuMzExNS0yNS4xMTQzLTMxLjU0NjMyLTMwLjAwMDctOS45NS02Mi42NTg1IDIxLjU5NjMtMzIuNjU3NzQgODQuMjEwMi02LjUwOSA1Ni4xNDEtODMuMjAxeiIgZmlsbD0iIzAwZmZmMCIgZmlsbC1vcGFjaXR5PSIuNjciLz48L2c+PGcgZmlsdGVyPSJ1cmwoI2MpIj48cGF0aCBkPSJtOTYuNDc5NiAyMjUuNDI0Yy0zMC42Mjk0LTEwMy4wNjEtMTYyLjU2MTQtNDguNzg3LTIyNC42OTg2LTguNzY3LTU5Ljc3MSA0Ny4zODUgODIuMTQ3OSAxODMuNjkxIDE0MS4wOTE1IDE3Ni43MTkgNTguOTQzNi02Ljk3My00Ny4yODQzLTY2LjMxMS0xMC44ODU0OC05NS4yMDYgMzYuMzk4NzgtMjguODk0IDEzMi43Nzg5OCA1Ni4wNzkgOTQuNDkyNTgtNzIuNzQ2eiIgZmlsbD0iIzlkODFmZiIvPjwvZz48ZyBmaWx0ZXI9InVybCgjZCkiPjxwYXRoIGQ9Im0yODIuMTItMTA3LjM1M2MtNjYuMDczLTc4LjY3OC0xNjAuNjU3LTEzLjYxNy0xOTkuNjkwNCAyOC43NDgzLTM0LjE1NTcgNDcuOTYwMSAxNDEuODQ1NCAxMzUuODM1OSAxOTAuNjkxNCAxMjAuNzc2MSA0OC44NDctMTUuMDU5OS02Ni42MDktNDYuMjIxNzgtNDUuODI0LTc1LjQ1OTMgMjAuNzg1LTI5LjIzNzYgMTM3LjQxNSAyNC4yODIyNCA1NC44MjMtNzQuMDY1MXoiIGZpbGw9IiM0ZDk0ZmYiLz48L2c+PHBhdGggY2xpcC1ydWxlPSJldmVub2RkIiBkPSJtOTMuMTg5IDE1Mi44MzZoNDMuNDg1bC00OS40NjU0LTQ5Ljc4NSA1MC4xMDE0LTQ5Ljc4NDcgMTMuNjQ1LTEzLjI2NjNoLTQ1LjEzNmwtNTcuNDgzMSA1Ny43NzczYy0yLjkwMSAyLjkxMTctMi44ODYxIDcuNjI0Ny4wMjk3IDEwLjUyMTd6bTI2LjE0MS00OS42NjhoLS4zMzVsLjMzMS0uMDA0em0wIDAgNDkuNDYxIDQ5Ljc4MS01MC4xMDEgNDkuNzg1LTEzLjY0NSAxMy4yNjZoNDUuMTM1bDU3LjQ4NC01Ny43NzRjMi45MDEtMi45MTIgMi44ODYtNy42MjQtLjAzLTEwLjUyMWwtNDQuODIzLTQ0LjUzN3oiIGZpbGw9IiMwMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvZz48L3N2Zz4=",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==oe.Unsupported&&ca(()=>{var i,s;return(s=(i=window.bitkeep)==null?void 0:i.solana)!=null&&s.isBitKeep?(this._readyState=oe.Installed,this.emit("readyStateChange",this._readyState),!0):!1})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Installed)throw new Ks;this._connecting=!0;const e=window.bitkeep.solana;let i;try{i=await e.getAccount()}catch(r){throw new Pi(r==null?void 0:r.message,r)}let s;try{s=new Xi(i)}catch(r){throw new _r(r==null?void 0:r.message,r)}this._wallet=e,this._publicKey=s,this.emit("connect",s)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(i){this.emit("error",new oa(i==null?void 0:i.message,i))}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signTransaction(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signAllTransactions(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new $e;try{const{signature:s}=await i.signMessage(e);return s}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}const Pb="Clover";class Tb extends la{constructor(e={}){super(),this.name=Pb,this.url="https://clv.org",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTM2LjQ4IDBIMTEuNTJDNS4xNTc2OCAwIDAgNS4xNTc2OCAwIDExLjUyVjM2LjQ4QzAgNDIuODQyMyA1LjE1NzY4IDQ4IDExLjUyIDQ4SDM2LjQ4QzQyLjg0MjMgNDggNDggNDIuODQyMyA0OCAzNi40OFYxMS41MkM0OCA1LjE1NzY4IDQyLjg0MjMgMCAzNi40OCAwWiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzc5MTBfMTYzMzUxKSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI0LjAwMDYgMzkuMzYwNkMzMi40ODM3IDM5LjM2MDYgMzkuMzYwNiAzMi40ODM3IDM5LjM2MDYgMjQuMDAwNkMzOS4zNjA2IDE1LjUxNzUgMzIuNDgzNyA4LjY0MDYyIDI0LjAwMDYgOC42NDA2MkMxNS41MTc1IDguNjQwNjIgOC42NDA2MiAxNS41MTc1IDguNjQwNjIgMjQuMDAwNkM4LjY0MDYyIDMyLjQ4MzcgMTUuNTE3NSAzOS4zNjA2IDI0LjAwMDYgMzkuMzYwNlpNMjEuMjg5OSAxNS44Njg4SDI2LjcxMVYyMS4zNDdIMjEuMjkwNFYyNi42NTRIMjYuNzExVjMyLjEzMjJIMjEuMjg5OVYyNi44MjUySDE1Ljg2OTNWMjEuMzQ3SDIxLjI4OTlWMTUuODY4OFpNMjYuNzEyIDIxLjM0N0gzMi4xMzMxVjI2LjgyNTJIMjYuNzEyVjIxLjM0N1oiIGZpbGw9ImJsYWNrIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfNzkxMF8xNjMzNTEiIHgxPSI0OCIgeTE9Ii0xLjQzMDUxZS0wNiIgeDI9IjEuNDMwNTFlLTA2IiB5Mj0iNDgiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0E5RkZFMCIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM4NkQ1RkYiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4=",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==oe.Unsupported&&ca(()=>{var i;return(i=window.clover_solana)!=null&&i.isCloverWallet?(this._readyState=oe.Installed,this.emit("readyStateChange",this._readyState),!0):!1})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Installed)throw new Ks;this._connecting=!0;const e=window.clover_solana;let i;try{i=await e.getAccount()}catch(r){throw new Pi(r==null?void 0:r.message,r)}let s;try{s=new Xi(i)}catch(r){throw new _r(r==null?void 0:r.message,r)}this._wallet=e,this._publicKey=s,this.emit("connect",s)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){this._wallet&&(this._wallet=null,this._publicKey=null),this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signTransaction(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signAllTransactions(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new $e;try{const{signature:s}=await i.signMessage(e);return Uint8Array.from(s)}catch(s){throw new aa(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}function Mb(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let c=0;c<e.length;c++)e[c]=255;for(let c=0;c<t.length;c++){const h=t.charAt(c),u=h.charCodeAt(0);if(e[u]!==255)throw new TypeError(h+" is ambiguous");e[u]=c}const i=t.length,s=t.charAt(0),r=Math.log(i)/Math.log(256),n=Math.log(256)/Math.log(i);function o(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let h=0,u=0,d=0;const p=c.length;for(;d!==p&&c[d]===0;)d++,h++;const g=(p-d)*n+1>>>0,f=new Uint8Array(g);for(;d!==p;){let y=c[d],v=0;for(let I=g-1;(y!==0||v<u)&&I!==-1;I--,v++)y+=256*f[I]>>>0,f[I]=y%i>>>0,y=y/i>>>0;if(y!==0)throw new Error("Non-zero carry");u=v,d++}let w=g-u;for(;w!==g&&f[w]===0;)w++;let m=s.repeat(h);for(;w<g;++w)m+=t.charAt(f[w]);return m}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let h=0,u=0,d=0;for(;c[h]===s;)u++,h++;const p=(c.length-h)*r+1>>>0,g=new Uint8Array(p);for(;h<c.length;){const y=c.charCodeAt(h);if(y>255)return;let v=e[y];if(v===255)return;let I=0;for(let S=p-1;(v!==0||I<d)&&S!==-1;S--,I++)v+=i*g[S]>>>0,g[S]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=I,h++}let f=p-d;for(;f!==p&&g[f]===0;)f++;const w=new Uint8Array(u+(p-f));let m=u;for(;f!==p;)w[m++]=g[f++];return w}function l(c){const h=a(c);if(h)return h;throw new Error("Non-base"+i+" character")}return{encode:o,decodeUnsafe:a,decode:l}}var Ob="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const ul=Mb(Ob),xb="Coin98";class kb extends la{constructor(e={}){super(),this.name=xb,this.url="https://coin98.com",this.icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NiA3NSI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIxMDEuNjgxJSIgeDI9Ii0xLjU1NyUiIHkxPSIxNS4yNjglIiB5Mj0iODQuOTE3JSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNGMUQ5NjEiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjQ0RBMTQ2Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgPHJlY3Qgd2lkdGg9Ijc1IiBoZWlnaHQ9Ijc1IiBmaWxsPSIjMDAwIiByeD0iMTYiLz4KICAgIDxwYXRoIGZpbGw9InVybCgjYSkiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTYxLjQ0IDBhMTMuNzE0IDEzLjcxNCAwIDAgMSA5LjY4IDQuMDEgMTMuNjYxIDEzLjY2MSAwIDAgMSA0LjAwOCA5LjY2OHY0Ny42NDZhMTMuNjYgMTMuNjYgMCAwIDEtNC4wMDcgOS42NjZBMTMuNzEzIDEzLjcxMyAwIDAgMSA2MS40NCA3NUgxMy42ODZhMTMuNzEzIDEzLjcxMyAwIDAgMS05LjY4LTQuMDFBMTMuNjYgMTMuNjYgMCAwIDEgMCA2MS4zMjRWMTMuNjc4YzAtMy42MjUgMS40NC03LjEwMiA0LjAwNy05LjY2N0ExMy43MTQgMTMuNzE0IDAgMCAxIDEzLjY4NyAwWk0yMC4wNjMgNDYuMjMxaC00LjgyNWExMC4wMzIgMTAuMDMyIDAgMCAwIDIuOTQ2IDcuMDg2IDEwLjA3IDEwLjA3IDAgMCAwIDcuMSAyLjk0MiAxMC4wNjUgMTAuMDY1IDAgMCAwIDcuMTA4LTIuOTM1IDEwLjAzIDEwLjAzIDAgMCAwIDIuOTQ2LTcuMDkzaC00LjgyNGE1LjIwNyA1LjIwNyAwIDAgMS0xLjUzIDMuNjg4IDUuMjI1IDUuMjI1IDAgMCAxLTMuNjk2IDEuNTI4IDUuMjM0IDUuMjM0IDAgMCAxLTMuNjk1LTEuNTI4IDUuMjEzIDUuMjEzIDAgMCAxLTEuNTMtMy42ODhaTTU0LjMzIDMzLjcxNmExMS43NjMgMTEuNzYzIDAgMCAwLTEyLjc5OSAyLjUzOEExMS42OTcgMTEuNjk3IDAgMCAwIDM4Ljk5IDQ5LjAzYTExLjcyMyAxMS43MjMgMCAwIDAgNC4zMjggNS4yNTkgMTEuNzU3IDExLjc1NyAwIDAgMCA2LjUyNiAxLjk3IDExLjc2NiAxMS43NjYgMCAwIDAgOC4yOS0zLjQzNSAxMS43MiAxMS43MiAwIDAgMCAzLjQ0Mi04LjI3NCAxMS43MDIgMTEuNzAyIDAgMCAwLTEuOTc1LTYuNTE0IDExLjczNiAxMS43MzYgMCAwIDAtNS4yNjktNC4zMlptLTQuNDg4IDMuOTJhNi45MzcgNi45MzcgMCAwIDEgNC45IDIuMDI1IDYuOTEgNi45MSAwIDAgMSAyLjAyOCA0Ljg5MiA2Ljg5NyA2Ljg5NyAwIDAgMS0xLjE3IDMuODM0IDYuOTMyIDYuOTMyIDAgMCAxLTEwLjY0MyAxLjA0MiA2LjkwMiA2LjkwMiAwIDAgMS0xLjUtNy41MjIgNi45MDkgNi45MDkgMCAwIDEgMi41NDQtMy4xIDYuOTI4IDYuOTI4IDAgMCAxIDMuODQxLTEuMTY3Wm0uMTcgNC41NTJhMi40MzEgMi40MzEgMCAwIDAtMi4yNDEgMS4xNTQgMi40MTggMi40MTggMCAwIDAtLjM1NiAxLjI1NyAyLjM5NSAyLjM5NSAwIDAgMCAxLjYxOSAyLjI5djEuNzUzaDEuNjE4di0xLjc1NGEyLjQyNyAyLjQyNyAwIDAgMCAxLjU5NC0xLjk1IDIuNDE4IDIuNDE4IDAgMCAwLTEtMi4zMSAyLjQzMSAyLjQzMSAwIDAgMC0xLjIzNC0uNDRabS0yMC4yMi0yMi41NTJhMTEuNzYyIDExLjc2MiAwIDAgMC0xMi43OTYgMi41MzEgMTEuNjk3IDExLjY5NyAwIDAgMC0yLjU1NCAxMi43NjkgMTEuNzIzIDExLjcyMyAwIDAgMCA0LjMyIDUuMjYyIDExLjc1NyAxMS43NTcgMCAwIDAgMTQuODI1LTEuNDQ2IDExLjcxNyAxMS43MTcgMCAwIDAgMy40NDUtOC4yODQgMTEuNzAzIDExLjcwMyAwIDAgMC0xLjk3NC02LjUxMiAxMS43MzYgMTEuNzM2IDAgMCAwLTUuMjY2LTQuMzJabS00LjUxIDMuOTE3YTYuOTQ1IDYuOTQ1IDAgMCAxIDQuODk3IDIuMDI5IDYuOTE4IDYuOTE4IDAgMCAxIDIuMDMyIDQuODg2IDYuOTA2IDYuOTA2IDAgMCAxLTEuMTY4IDMuODQyIDYuOTQgNi45NCAwIDAgMS0xMC42NiAxLjA0OCA2LjkxMSA2LjkxMSAwIDAgMS0xLjUtNy41MzYgNi45MTggNi45MTggMCAwIDEgMi41NS0zLjEwMyA2LjkzNyA2LjkzNyAwIDAgMSAzLjg1LTEuMTY2Wm0yNC41Ni00LjgxYTEwLjA1OSAxMC4wNTkgMCAwIDAtNy4xMDMgMi45NCAxMC4wMiAxMC4wMiAwIDAgMC0yLjk0IDcuMDkgOS45IDkuOSAwIDAgMCAxLjIzIDQuNzk1IDEzLjU3NSAxMy41NzUgMCAwIDEgNC4yMTQtMi4zMjIgNS4wODIgNS4wODIgMCAwIDEtLjYyNS0yLjQ3NyA1LjIwNiA1LjIwNiAwIDAgMSAxLjUwMy0zLjczNiA1LjIyMyA1LjIyMyAwIDAgMSAzLjcyMi0xLjU1NCA1LjIzNCA1LjIzNCAwIDAgMSAzLjcyIDEuNTU0IDUuMjEzIDUuMjEzIDAgMCAxIDEuNTA1IDMuNzM2IDUuMjc5IDUuMjc5IDAgMCAxLS42MjMgMi40NzMgMTMuNTc0IDEzLjU3NCAwIDAgMSA0LjIxMyAyLjMyMiA5LjkwMyA5LjkwMyAwIDAgMCAxLjIzLTQuNzk1IDEwLjAzMiAxMC4wMzIgMCAwIDAtMi45NDYtNy4wODYgMTAuMDcgMTAuMDcgMCAwIDAtNy4xLTIuOTRabS0yMy43NSA3Ljk5aC0xLjYxN3YxLjc1YTIuNDE5IDIuNDE5IDAgMCAwLTEuNTgyIDIuNjg3IDIuNDE0IDIuNDE0IDAgMCAwIDIuMzkgMi4wMDYgMi40NSAyLjQ1IDAgMCAwIDEuNTU1LS41NzQgMi40MTQgMi40MTQgMCAwIDAtLjc0Ni00LjExOXYtMS43NVoiLz4KICA8L2c+Cjwvc3ZnPgo=",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==oe.Unsupported&&ca(()=>{var i;return(i=window.coin98)!=null&&i.sol?(this._readyState=oe.Installed,this.emit("readyStateChange",this._readyState),!0):!1})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!!((e=this._wallet)!=null&&e.isConnected())}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Installed)throw new Ks;this._connecting=!0;const e=window.coin98.sol;let i;try{i=(await e.connect())[0]}catch(r){throw new Pi(r==null?void 0:r.message,r)}let s;try{s=new Xi(i)}catch(r){throw new _r(r==null?void 0:r.message,r)}this._wallet=e,this._publicKey=s,this.emit("connect",s)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(i){this.emit("error",new oa(i==null?void 0:i.message,i))}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{const s=await i.request({method:"sol_sign",params:[e]}),r=new Xi(s.publicKey),n=ul.decode(s.signature);return e.addSignature(r,N.Buffer.from(n)),e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new $e;try{const s=await i.request({method:"sol_signAllTransactions",params:[e]}),r=new Xi(s.publicKey),n=s.signatures;return e.map((o,a)=>{const l=ul.decode(n[a]);return o.addSignature(r,N.Buffer.from(l)),o})}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new $e;try{const s=await i.request({method:"sol_signMessage",params:[e]});return ul.decode(s.signature)}catch(s){throw new aa(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}const Db="Nightly";class jb extends la{constructor(){super(),this.name=Db,this.url="https://nightly.app",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTQ4IDk2Qzc0LjUwOTcgOTYgOTYgNzQuNTA5NyA5NiA0OEM5NiAyMS40OTAzIDc0LjUwOTcgMCA0OCAwQzIxLjQ5MDMgMCAwIDIxLjQ5MDMgMCA0OEMwIDc0LjUwOTcgMjEuNDkwMyA5NiA0OCA5NloiIGZpbGw9IiM2RDczRjgiLz4KPHBhdGggZD0iTTQ4IDg1LjYzNTZDNDggODUuNjM1NiA1Mi40NTMzIDg1LjYzNTYgNTUuNDQgODIuNTg2N0M1OC45MTU1IDc5LjI4MDEgNTcuMzUxMSA3NS40MzEyIDYyLjI3NTUgNzEuNDMxMkM2Ni45ODY2IDY3LjY0NDUgNzIuOTI0NCA3MC4zMzc5IDcyLjkyNDQgNzAuMzM3OUM3Ny4wMjIyIDYyLjEyNDUgNzQuNzkxMSA1Mi41NjkgNzQuNzkxMSA1Mi41NjlDODEuNzY4OCAzNC4yNTc5IDc1Ljk2NDQgMjEuMTU1NyA3NC40NDQ0IDE3LjM2MDFDNjkuNDQ4OCAyNC4zMzc5IDYzLjE5MTEgMjkuMTczNCA1NS43OTU1IDMyLjQwOUM1My4yMjY2IDMxLjcwNjggNTAuNTk1NSAzMS4zMzM0IDQ4IDMxLjM2MDFDNDUuNDEzMyAzMS4zMzM0IDQyLjc3MzMgMzEuNzA2OCA0MC4yMDQ0IDMyLjQwOUMzMi44MTc3IDI5LjE2NDUgMjYuNTUxMSAyNC4zMzc5IDIxLjU1NTUgMTcuMzYwMUMyMC4wMzU1IDIxLjE1NTcgMTQuMjMxMSAzNC4yNTc5IDIxLjIwODkgNTIuNTY5QzIxLjIwODkgNTIuNTY5IDE4Ljk3NzggNjIuMTI0NSAyMy4wNzU1IDcwLjMzNzlDMjMuMDc1NSA3MC4zMzc5IDI5LjAxMzMgNjcuNjQ0NSAzMy43MjQ0IDcxLjQzMTJDMzguNjU3NyA3NS40MzEyIDM3LjA4NDQgNzkuMjgwMSA0MC41NiA4Mi41ODY3QzQzLjU0NjYgODUuNjM1NiA0OCA4NS42MzU2IDQ4IDg1LjYzNTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNDIuNDc5OSA2NS4yOThDNDIuMjkzMyA1OS4yMTggMzYuMzAyMSA1Ny4yNjI0IDMyLjIxMzMgNTkuODIyNEMzMi4yMTMzIDU5LjgyMjQgMzIuODUzMyA2Mi40MzU4IDM1LjgzOTkgNjMuNzUxM0MzOC4yNzU1IDY0LjgyNjkgMzkuMzI0NCA2My4zODY5IDQyLjQ3OTkgNjUuMjk4WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNMjIuNDk3NyAyMy4wOTM1QzIwLjA4ODggMzEuNTQ2OCAyMS4xMjg4IDQyLjI0MDIgMjQuOTMzMyA1MC4wMjY5QzI4LjgyNjYgNDcuMjcxMyAzMi45MTU1IDQzLjAxMzUgMzUuMDkzMyAzOC41MDY5QzI5Ljk2NDQgMzQuNzExMyAyNS42NjIyIDMxLjEwMjQgMjIuNDk3NyAyMy4wOTM1WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNNTMuNTE5OSA2NS4yOThDNTMuNzA2NiA1OS4yMTggNTkuNjk3NyA1Ny4yNjI0IDYzLjc4NjYgNTkuODIyNEM2My43ODY2IDU5LjgyMjQgNjMuMTQ2NiA2Mi40MzU4IDYwLjE1OTkgNjMuNzUxM0M1Ny43MjQzIDY0LjgyNjkgNTYuNjc1NSA2My4zODY5IDUzLjUxOTkgNjUuMjk4WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNNzMuNTAyMiAyMy4wOTM1Qzc1LjkxMTEgMzEuNTQ2OCA3NC44NzExIDQyLjI0MDIgNzEuMDY2NiA1MC4wMjY5QzY3LjE3MzMgNDcuMjcxMyA2My4wODQ0IDQzLjAxMzUgNjAuOTA2NiAzOC41MDY5QzY2LjAzNTUgMzQuNzExMyA3MC4zMzc3IDMxLjEwMjQgNzMuNTAyMiAyMy4wOTM1WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNNDcuOTk5OSA4NS4zMDY5QzUwLjE0MDQgODUuMzA2OSA1MS44NzU1IDgzLjc3ODcgNTEuODc1NSA4MS44OTM2QzUxLjg3NTUgODAuMDA4NCA1MC4xNDA0IDc4LjQ4MDIgNDcuOTk5OSA3OC40ODAyQzQ1Ljg1OTUgNzguNDgwMiA0NC4xMjQ0IDgwLjAwODQgNDQuMTI0NCA4MS44OTM2QzQ0LjEyNDQgODMuNzc4NyA0NS44NTk1IDg1LjMwNjkgNDcuOTk5OSA4NS4zMDY5WiIgZmlsbD0iIzdCODFGOSIvPgo8L3N2Zz4K",this.supportedTransactionVersions=new Set(["legacy",0]),this._readyState=typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.NotDetected,this._connecting=!1,this._publicKey=null,this._wallet=null,this._readyState!==oe.Unsupported&&ca(()=>{var e;return(e=window==null?void 0:window.nightly)!=null&&e.solana?(this._readyState=oe.Installed,this.emit("readyStateChange",this._readyState),!0):!1})}get connecting(){return this._connecting}get readyState(){return this._readyState}get publicKey(){return this._publicKey}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Installed)throw new Ks;this._connecting=!0;const e=window.nightly.solana;try{await e.connect()}catch(s){throw new Bc(s==null?void 0:s.message,s)}if(e.publicKey.toString()==="11111111111111111111111111111111")throw new Pi;let i;try{i=new Xi(e.publicKey.toBytes())}catch(s){throw new _r(s==null?void 0:s.message,s)}this._wallet=e,this._publicKey=i,this.emit("connect",i)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch{this.emit("error",new Mm)}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signTransaction(e)}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signAllTransactions(e)}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new $e;try{return i.signMessage(new TextDecoder().decode(e))}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}const ad="solana:mainnet",Rb="solana:devnet",Ub="solana:testnet",Lb="solana:localnet",zb="Solong";class $b extends vu{constructor(e={}){super(),this.name=zb,this.url="https://solongwallet.io",this.icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAGlklEQVR4Ae3bA5DsyhfH8TNr49r2/du2bdu2bdu2zcdNrm3b9toz533rvctUn3Umk9p01WfdvVW/6nROBxJVS1rSkpa0pCUtaUlLWtKSpl4VXos3GJ4sujQFuUKfWl+qT730arzB8Ex9YksKcgXjFOCVeIPhBYydB8mawQ+yiGC8n0EN6zAVcgXhpQjoq1DDdsyDAAB9Pwo1HMC9INk0FIM8Bt1Qh9WohQQCvD+BtEMdtmC8I7y5aIE67MV0SBwDvB3qsE/UHwMJIpC/QB1OYiLEEeCPoQ7nMRcSwwDrao3Zl8aTIEGEUYlL0IAMXuQOr66UvsegDm+ExDJAPNiafSg0AlyIbmjAWX1aQzEkiH6T0QkNaEdpnAN8NNRhPcSF9e9el2ebBhyAuNBvGtLQgIuQOAd4D6jDMRQbM3AmOqEBDfq0xjJIEP3GohkakEFVjAP0y401sAsLnAE+pb6EsC5AA9J4sHsG+kX0PQR1eFJ8AwTWQh0+DjFm4a1Qh2/AOoz/BHX4ZdwD/CDU4aioX2GUMW+AOnB2bqiBBDHe86EOTYw5GRKJwQ/ijUM91OGTxgysxSmowzeNw7j08m5DHX4l7Igg2TY0g9hbLBZ+f7oxC98CdWjDvYzD+MVQh07GfEQsZyDgVWA71OGvorfnQQCAcqaYUFZDHW6j/itAoB70GcergzqsEa0rhGTTEA7mP0koK4xdyeOMmvBBhJU2zsjPMw7lu9O3zShpXheHk4hhcZ4w26AOG4RSxDiUfwZ12KdPqy+FBDHeV6EOZxizIg6HsMGbiQ5jdjzBXRfeefGg3tgbv9BYC0fhZE7sjUMY9Pf9rdcI5XtQh39BjBA/C3VYnM0zcgiDek+GOhzh93mQoMs7kIxze/eMhnxIEOPNM9bcFtTEeAb6I419axu/m2CsgxU4Aw1A/UxIUM/bO/9+cVkDDd5x42x8N1iH8Taow0NhHcZLoQ5Pi/MMzDMW+DTu7g6vIY9AdkAdHmaUMyn6roA6PD22AeLB6DbWplHG7LubfY+kfiIkiH5T0AJ1uFtMA1xUzOc1UIclzvCeXF+o7DygDlvds29RgVVzYj+K4xhgEX4NdcjgecE++rSL+ZdLmIxRB77Ose7l4XPIQB3eF8M60C/n8++ghltE/QLIFfqUiyUE8kOoYSW7jmLIFXeN4X0NaajDDlG/NG6XswrxKdxu+G/weh27j3wCej9uN9zEOjc3sObl4S243XBLhDfWE0mAMQjwZfhxDng7pG/8Sj4/ER/Gd/BdfBhPRGW2A/wxNAfcBOnFCHwZZ6GGs/gqapMAb/QEnIT20Uk8IQkQeB7aof3UihcM9wDvhyboANHXv1+IdWBOB2hsIftto+iSPEif8aGPcjrA50GHyPMiOIT9B/N5apaMgQT8D2poxMdwt8s+hkao4X9ZDxBTIdHwy/h8AeqQxhMhAU9BB9ThPMqHTYCYjU6owy3uPstSfL4Z6uZPC+Mk8gOomz8DEg3vXshAHb4MMXwZarhXGDPwa739w2j48623BPAniOFPUMPsMAL8INTw9AgDrLZOCmjFPEjA3WD1aUJVGAG+CGr4ECRCy6GGg3iyaF0+n/PwFByEGpaJ+qkw1sB7QA3/hUTozdBetFymvXhTWGVMOc7bp36/FhKRamNW9dcxZmpZiI+32ad+vAQSoWejGzpAXXh22Fek3wY1rDD2kVnijR3ExYQMPgkJOUB/nFW0Is3vnw6JhlHX9a4N70Iq/ACBv0MNu7J9WxHw7jaA2deFOtw32zeVHtHLWvMN0dtSkOzwS3spYy7iH1hx2d/wYdyTvnkR3BdeQjjerVBDN14JyZIfQWH5RC7e1rw32npZV54LCc+SPD5/HgqYD3WW5+gTqt6X+rA4v0701hRkKF0+bL+HTM9Hgv/MHH60wyvHWigsafwA1ZAhMguLoL34kbDcQEI1uAH8mcbuxPHImf8i5EMGxqvER9EI7cUqVMTl0Y6HoxHaBzvxNkyC9EEe7oEv4Sy0D/YQ+IS4ver1JNT38z7sWnwbb8TT8Cg8Gs/Gu/Ar7EEXtI/2ud7Ni0GAYCbiJDQiazA57k9nTcdqaJb9UtSvitXbmjavCJ9AMzRkJ/B80boUJBLhDe7Nw1/QCR1i9fgKRg6HByzvjZ/hInQQMjiCT2PSMHxC1a/l8wvwGxyG9kEaW/EtPI4xiiE5JcLrd6PxcLwM78SH8EG8Fc/H/UUXVUByGh8SSYBJgEmASYCJJMAkwBi6A3xCqZhiBz8+AAAAAElFTkSuQmCC",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==oe.Unsupported&&ca(()=>window.solong?(this._readyState=oe.Installed,this.emit("readyStateChange",this._readyState),!0):!1)}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!!((e=this._wallet)!=null&&e.currentAccount)}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Installed)throw new Ks;this._connecting=!0;const e=window.solong;let i;try{i=await e.selectAccount()}catch(r){throw new Pi(r==null?void 0:r.message,r)}let s;try{s=new Xi(i)}catch(r){throw new _r(r==null?void 0:r.message,r)}this._wallet=e,this._publicKey=s,this.emit("connect",s)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){this._wallet&&(this._wallet=null,this._publicKey=null),this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signTransaction(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}const qb="Torus";class Bb extends la{constructor({params:e={showTorusButton:!1}}={params:{showTorusButton:!1}}){super(),this.name=qb,this.url="https://tor.us",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzMiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMyAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYuNSIgY3k9IjE2IiByPSIxNiIgZmlsbD0iIzAzNjRGRiIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExLjIxODYgOS40OTIxOUMxMC40NTM5IDkuNDkyMTkgOS44MzM5OCAxMC4xMTIxIDkuODMzOTggMTAuODc2OFYxMi40ODk4QzkuODMzOTggMTMuMjU0NSAxMC40NTM5IDEzLjg3NDQgMTEuMjE4NiAxMy44NzQ0SDEzLjY2ODRWMjIuODk3NkMxMy42Njg0IDIzLjY2MjMgMTQuMjg4MyAyNC4yODIyIDE1LjA1MyAyNC4yODIySDE2LjY2NkMxNy40MzA3IDI0LjI4MjIgMTguMDUwNiAyMy42NjIzIDE4LjA1MDYgMjIuODk3NlYxMi41MDE1QzE4LjA1MDYgMTIuNDk3NiAxOC4wNTA2IDEyLjQ5MzcgMTguMDUwNiAxMi40ODk4VjEwLjg3NjhDMTguMDUwNiAxMC4xMTIxIDE3LjQzMDcgOS40OTIxOSAxNi42NjYgOS40OTIxOUgxNS4wNTNIMTEuMjE4NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0yMS4zMzc2IDEzLjg3NDRDMjIuNTQ3NyAxMy44NzQ0IDIzLjUyODcgMTIuODkzNCAyMy41Mjg3IDExLjY4MzNDMjMuNTI4NyAxMC40NzMyIDIyLjU0NzcgOS40OTIxOSAyMS4zMzc2IDkuNDkyMTlDMjAuMTI3NSA5LjQ5MjE5IDE5LjE0NjUgMTAuNDczMiAxOS4xNDY1IDExLjY4MzNDMTkuMTQ2NSAxMi44OTM0IDIwLjEyNzUgMTMuODc0NCAyMS4zMzc2IDEzLjg3NDRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.Loadable,this._connecting=!1,this._wallet=null,this._publicKey=null,this._params=e}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!!((e=this._wallet)!=null&&e.isLoggedIn)}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Loadable)throw new Ks;this._connecting=!0;let e;try{e=(await Bo(async()=>{const{default:n}=await import("./solanaEmbed.esm-a7S5N_pS-BbRCgkuf.js");return{default:n}},__vite__mapDeps([0,1,2,3]))).default}catch(n){throw new Nb(n==null?void 0:n.message,n)}let i;try{i=window.torus||new e}catch(n){throw new Nn(n==null?void 0:n.message,n)}if(!i.isInitialized)try{await i.init(this._params)}catch(n){throw new Bc(n==null?void 0:n.message,n)}let s;try{s=await i.login()}catch(n){throw new Pi(n==null?void 0:n.message,n)}let r;try{r=new Xi(s[0])}catch(n){throw new _r(n==null?void 0:n.message,n)}this._wallet=i,this._publicKey=r,this.emit("connect",r)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{e.isLoggedIn&&await e.cleanUp()}catch(i){this.emit("error",new oa(i==null?void 0:i.message,i))}}this.emit("disconnect")}async sendTransaction(e,i,s={}){try{const r=this._wallet;if(!r)throw new $e;try{const{signers:n,...o}=s;e=await this.prepareTransaction(e,i,o),n!=null&&n.length&&e.partialSign(...n),o.preflightCommitment=o.preflightCommitment||i.commitment;const{signature:a}=await r.signAndSendTransaction(e,o);return a}catch(n){throw n instanceof kt?n:new cr(n==null?void 0:n.message,n)}}catch(r){throw this.emit("error",r),r}}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signTransaction(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signAllTransactions(e)||e}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signMessage(e)}catch(s){throw new aa(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}function dl(t){switch(t){case"processed":case"confirmed":case"finalized":case void 0:return t;case"recent":return"processed";case"single":case"singleGossip":return"confirmed";case"max":case"root":return"finalized";default:return}}const Hb="https://api.mainnet-beta.solana.com";function Vb(t){return t.includes(Hb)?ad:/\bdevnet\b/i.test(t)?Rb:/\btestnet\b/i.test(t)?Ub:/\blocalhost\b/i.test(t)||/\b127\.0\.0\.1\b/.test(t)?Lb:ad}var Ic;(function(t){t.Mainnet="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",t.Devnet="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",t.Deprecated_Mainnet="solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ",t.Deprecated_Devnet="solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"})(Ic||(Ic={}));var Si;(function(t){t.signTransaction="solana_signTransaction",t.signMessage="solana_signMessage",t.signAndSendTransaction="solana_signAndSendTransaction",t.signAndSendAllTransactions="solana_signAndSendAllTransactions",t.signAllTransactions="solana_signAllTransactions"})(Si||(Si={}));const dt={Mainnet:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",Devnet:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",Deprecated_Mainnet:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ",Deprecated_Devnet:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"};let Wb=class extends yi{constructor(t){super()}};const cd=E.FIVE_SECONDS,qi={pulse:"heartbeat_pulse"};let Dm=class jm extends Wb{constructor(e){super(e),this.events=new xt.EventEmitter,this.interval=cd,this.interval=(e==null?void 0:e.interval)||cd}static async init(e){const i=new jm(e);return await i.init(),i}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),E.toMiliseconds(this.interval))}pulse(){this.events.emit(qi.pulse)}};function Kb(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function wt(t,...e){try{return Kb(t(...e))}catch(i){return Promise.reject(i)}}function Fb(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Gb(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function tc(t){if(Fb(t))return String(t);if(Gb(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return tc(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const uh="base64:";function Yb(t){return typeof t=="string"?t:uh+Jb(t)}function Qb(t){return typeof t!="string"||!t.startsWith(uh)?t:Zb(t.slice(uh.length))}function Zb(t){return globalThis.Buffer?N.Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Jb(t){return globalThis.Buffer?N.Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Xt(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Xb(...t){return Xt(t.join(":"))}function Pa(t){return t=Xt(t),t?t+":":""}function e0(t,e){if(e===void 0)return!0;let i=0,s=t.indexOf(":");for(;s>-1;)i++,s=t.indexOf(":",s+1);return i<=e}function t0(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const i0="memory",s0=()=>{const t=new Map;return{name:i0,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,i){t.set(e,i)},setItemRaw(e,i){t.set(e,i)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function r0(t={}){const e={mounts:{"":t.driver||s0()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=c=>{for(const h of e.mountpoints)if(c.startsWith(h))return{base:h,relativeKey:c.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:c,driver:e.mounts[""]}},s=(c,h)=>e.mountpoints.filter(u=>u.startsWith(c)||h&&c.startsWith(u)).map(u=>({relativeBase:c.length>u.length?c.slice(u.length):void 0,mountpoint:u,driver:e.mounts[u]})),r=(c,h)=>{if(e.watching){h=Xt(h);for(const u of e.watchListeners)u(c,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await ld(e.mounts[c],r,c)}},o=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},a=(c,h,u)=>{const d=new Map,p=g=>{let f=d.get(g.base);return f||(f={driver:g.driver,base:g.base,items:[]},d.set(g.base,f)),f};for(const g of c){const f=typeof g=="string",w=Xt(f?g:g.key),m=f?void 0:g.value,y=f||!g.options?h:{...h,...g.options},v=i(w);p(v).items.push({key:w,value:m,relativeKey:v.relativeKey,options:y})}return Promise.all([...d.values()].map(g=>u(g))).then(g=>g.flat())},l={hasItem(c,h={}){c=Xt(c);const{relativeKey:u,driver:d}=i(c);return wt(d.hasItem,u,h)},getItem(c,h={}){c=Xt(c);const{relativeKey:u,driver:d}=i(c);return wt(d.getItem,u,h).then(p=>Ds(p))},getItems(c,h={}){return a(c,h,u=>u.driver.getItems?wt(u.driver.getItems,u.items.map(d=>({key:d.relativeKey,options:d.options})),h).then(d=>d.map(p=>({key:Xb(u.base,p.key),value:Ds(p.value)}))):Promise.all(u.items.map(d=>wt(u.driver.getItem,d.relativeKey,d.options).then(p=>({key:d.key,value:Ds(p)})))))},getItemRaw(c,h={}){c=Xt(c);const{relativeKey:u,driver:d}=i(c);return d.getItemRaw?wt(d.getItemRaw,u,h):wt(d.getItem,u,h).then(p=>Qb(p))},async setItem(c,h,u={}){if(h===void 0)return l.removeItem(c);c=Xt(c);const{relativeKey:d,driver:p}=i(c);p.setItem&&(await wt(p.setItem,d,tc(h),u),p.watch||r("update",c))},async setItems(c,h){await a(c,h,async u=>{if(u.driver.setItems)return wt(u.driver.setItems,u.items.map(d=>({key:d.relativeKey,value:tc(d.value),options:d.options})),h);u.driver.setItem&&await Promise.all(u.items.map(d=>wt(u.driver.setItem,d.relativeKey,tc(d.value),d.options)))})},async setItemRaw(c,h,u={}){if(h===void 0)return l.removeItem(c,u);c=Xt(c);const{relativeKey:d,driver:p}=i(c);if(p.setItemRaw)await wt(p.setItemRaw,d,h,u);else if(p.setItem)await wt(p.setItem,d,Yb(h),u);else return;p.watch||r("update",c)},async removeItem(c,h={}){typeof h=="boolean"&&(h={removeMeta:h}),c=Xt(c);const{relativeKey:u,driver:d}=i(c);d.removeItem&&(await wt(d.removeItem,u,h),(h.removeMeta||h.removeMata)&&await wt(d.removeItem,u+"$",h),d.watch||r("remove",c))},async getMeta(c,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),c=Xt(c);const{relativeKey:u,driver:d}=i(c),p=Object.create(null);if(d.getMeta&&Object.assign(p,await wt(d.getMeta,u,h)),!h.nativeOnly){const g=await wt(d.getItem,u+"$",h).then(f=>Ds(f));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(p,g))}return p},setMeta(c,h,u={}){return this.setItem(c+"$",h,u)},removeMeta(c,h={}){return this.removeItem(c+"$",h)},async getKeys(c,h={}){var u;c=Pa(c);const d=s(c,!0);let p=[];const g=[];let f=!0;for(const m of d){(u=m.driver.flags)!=null&&u.maxDepth||(f=!1);const y=await wt(m.driver.getKeys,m.relativeBase,h);for(const v of y){const I=m.mountpoint+Xt(v);p.some(S=>I.startsWith(S))||g.push(I)}p=[m.mountpoint,...p.filter(v=>!v.startsWith(m.mountpoint))]}const w=h.maxDepth!==void 0&&!f;return g.filter(m=>(!w||e0(m,h.maxDepth))&&t0(m,c))},async clear(c,h={}){c=Pa(c),await Promise.all(s(c,!1).map(async u=>{if(u.driver.clear)return wt(u.driver.clear,u.relativeBase,h);if(u.driver.removeItem){const d=await u.driver.getKeys(u.relativeBase||"",h);return Promise.all(d.map(p=>u.driver.removeItem(p,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>hd(c)))},async watch(c){return await n(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==c),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(c,h){if(c=Pa(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((u,d)=>d.length-u.length)),e.mounts[c]=h,e.watching&&Promise.resolve(ld(h,r,c)).then(u=>{e.unwatch[c]=u}).catch(console.error),l},async unmount(c,h=!0){var u,d;c=Pa(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&((d=(u=e.unwatch)[c])==null||d.call(u),delete e.unwatch[c]),h&&await hd(e.mounts[c]),e.mountpoints=e.mountpoints.filter(p=>p!==c),delete e.mounts[c])},getMount(c=""){c=Xt(c)+":";const h=i(c);return{driver:h.driver,base:h.base}},getMounts(c="",h={}){return c=Xt(c),s(c,h.parents).map(u=>({driver:u.driver,base:u.mountpoint}))},keys:(c,h={})=>l.getKeys(c,h),get:(c,h={})=>l.getItem(c,h),set:(c,h,u={})=>l.setItem(c,h,u),has:(c,h={})=>l.hasItem(c,h),del:(c,h={})=>l.removeItem(c,h),remove:(c,h={})=>l.removeItem(c,h)};return l}function ld(t,e,i){return t.watch?t.watch((s,r)=>e(s,i+r)):()=>{}}async function hd(t){typeof t.dispose=="function"&&await wt(t.dispose)}const n0="idb-keyval";var o0=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",i=r=>e+r;let s;return t.dbName&&t.storeName&&(s=Im(t.dbName,t.storeName)),{name:n0,options:t,async hasItem(r){return!(typeof await vc(i(r),s)>"u")},async getItem(r){return await vc(i(r),s)??null},setItem(r,n){return Em(i(r),n,s)},removeItem(r){return Nm(i(r),s)},getKeys(){return Am(s)},clear(){return _m(s)}}};const a0="WALLET_CONNECT_V2_INDEXED_DB",c0="keyvaluestorage";let l0=class{constructor(){this.indexedDb=r0({driver:o0({dbName:a0,storeName:c0})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const e=await this.indexedDb.getItem(t);if(e!==null)return e}async setItem(t,e){await this.indexedDb.setItem(t,Ar(e))}async removeItem(t){await this.indexedDb.removeItem(t)}};var pl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof N.global<"u"?N.global:typeof self<"u"?self:{},ic={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},t.prototype.setItem=function(i,s){this[i]=String(s)},t.prototype.removeItem=function(i){delete this[i]},t.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(s){i[s]=void 0,delete i[s]})},t.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof pl<"u"&&pl.localStorage?ic.exports=pl.localStorage:typeof window<"u"&&window.localStorage?ic.exports=window.localStorage:ic.exports=new e})();function h0(t){var e;return[t[0],ws((e=t[1])!=null?e:"")]}let u0=class{constructor(){this.localStorage=ic.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(h0)}async getItem(t){const e=this.localStorage.getItem(t);if(e!==null)return ws(e)}async setItem(t,e){this.localStorage.setItem(t,Ar(e))}async removeItem(t){this.localStorage.removeItem(t)}};const d0="wc_storage_version",ud=1,p0=async(t,e,i)=>{const s=d0,r=await e.getItem(s);if(r&&r>=ud){i(e);return}const n=await t.getKeys();if(!n.length){i(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const l=a.toLowerCase();if(l.includes("wc@")||l.includes("walletconnect")||l.includes("wc_")||l.includes("wallet_connect")){const c=await t.getItem(a);await e.setItem(a,c),o.push(a)}}await e.setItem(s,ud),i(e),g0(t,o)},g0=async(t,e)=>{e.length&&e.forEach(async i=>{await t.removeItem(i)})};let f0=class{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const t=new u0;this.storage=t;try{const e=new l0;p0(t,e,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,e){return await this.initialize(),this.storage.setItem(t,e)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const e=setInterval(()=>{this.initialized&&(clearInterval(e),t())},20)})}};var m0=Object.defineProperty,w0=(t,e,i)=>e in t?m0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,dd=(t,e,i)=>w0(t,typeof e!="symbol"?e+"":e,i);let y0=class extends yi{constructor(t){super(),this.opts=t,dd(this,"protocol","wc"),dd(this,"version",2)}};var v0=Object.defineProperty,b0=(t,e,i)=>e in t?v0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,I0=(t,e,i)=>b0(t,e+"",i);let E0=class extends yi{constructor(t,e){super(),this.core=t,this.logger=e,I0(this,"records",new Map)}},N0=class{constructor(t,e){this.logger=t,this.core=e}},A0=class extends yi{constructor(t,e){super(),this.relayer=t,this.logger=e}},_0=class extends yi{constructor(t){super()}},C0=class{constructor(t,e,i,s){this.core=t,this.logger=e,this.name=i}},S0=class extends yi{constructor(t,e){super(),this.relayer=t,this.logger=e}},P0=class extends yi{constructor(t,e){super(),this.core=t,this.logger=e}},T0=class{constructor(t,e,i){this.core=t,this.logger=e,this.store=i}},M0=class{constructor(t,e){this.projectId=t,this.logger=e}},O0=class{constructor(t,e,i){this.core=t,this.logger=e,this.telemetryEnabled=i}};function Vo(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function pd(t){return Vo(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Rm="2.23.2";let Ta={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:i})=>e?`${t??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${Rm}`},Hc=class dh extends Error{constructor(e,i={}){var s;const r=(()=>{var l;return i.cause instanceof dh?i.cause.details:(l=i.cause)!=null&&l.message?i.cause.message:i.details})(),n=i.cause instanceof dh&&i.cause.docsPath||i.docsPath,o=(s=Ta.getDocsUrl)==null?void 0:s.call(Ta,{...i,docsPath:n}),a=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...r?[`Details: ${r}`]:[],...Ta.version?[`Version: ${Ta.version}`]:[]].join(`
`);super(a,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=n,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=Rm}walk(e){return Um(this,e)}};function Um(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Um(t.cause,e):e?null:t}let Lm=class extends Hc{constructor({size:t,targetSize:e,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${t}) exceeds padding size (${e}).`,{name:"SizeExceedsPaddingSizeError"})}};function Kn(t,{dir:e,size:i=32}={}){return typeof t=="string"?x0(t,{dir:e,size:i}):k0(t,{dir:e,size:i})}function x0(t,{dir:e,size:i=32}={}){if(i===null)return t;const s=t.replace("0x","");if(s.length>i*2)throw new Lm({size:Math.ceil(s.length/2),targetSize:i,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function k0(t,{dir:e,size:i=32}={}){if(i===null)return t;if(t.length>i)throw new Lm({size:t.length,targetSize:i,type:"bytes"});const s=new Uint8Array(i);for(let r=0;r<i;r++){const n=e==="right";s[n?r:i-r-1]=t[n?r:t.length-r-1]}return s}let D0=class extends Hc{constructor({max:t,min:e,signed:i,size:s,value:r}){super(`Number "${r}" is not in safe ${s?`${s*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${t?`(${e} to ${t})`:`(above ${e})`}`,{name:"IntegerOutOfRangeError"})}},j0=class extends Hc{constructor({givenSize:t,maxSize:e}){super(`Size cannot exceed ${e} bytes. Given size: ${t} bytes.`,{name:"SizeOverflowError"})}};function Fn(t,{size:e}){if(pd(t)>e)throw new j0({givenSize:pd(t),maxSize:e})}function ph(t,e={}){const{signed:i}=e;e.size&&Fn(t,{size:e.size});const s=BigInt(t);if(!i)return s;const r=(t.length-2)/2,n=(1n<<BigInt(r)*8n-1n)-1n;return s<=n?s:s-BigInt(`0x${"f".padStart(r*2,"f")}`)-1n}function R0(t,e={}){return Number(ph(t,e))}const U0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function gh(t,e={}){return typeof t=="number"||typeof t=="bigint"?$m(t,e):typeof t=="string"?$0(t,e):typeof t=="boolean"?L0(t,e):zm(t,e)}function L0(t,e={}){const i=`0x${Number(t)}`;return typeof e.size=="number"?(Fn(i,{size:e.size}),Kn(i,{size:e.size})):i}function zm(t,e={}){let i="";for(let r=0;r<t.length;r++)i+=U0[t[r]];const s=`0x${i}`;return typeof e.size=="number"?(Fn(s,{size:e.size}),Kn(s,{dir:"right",size:e.size})):s}function $m(t,e={}){const{signed:i,size:s}=e,r=BigInt(t);let n;s?i?n=(1n<<BigInt(s)*8n-1n)-1n:n=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&i?-n-1n:0;if(n&&r>n||r<o){const l=typeof t=="bigint"?"n":"";throw new D0({max:n?`${n}${l}`:void 0,min:`${o}${l}`,signed:i,size:s,value:`${t}${l}`})}const a=`0x${(i&&r<0?(1n<<BigInt(s*8))+BigInt(r):r).toString(16)}`;return s?Kn(a,{size:s}):a}const z0=new TextEncoder;function $0(t,e={}){const i=z0.encode(t);return zm(i,e)}const q0=new TextEncoder;function B0(t,e={}){return typeof t=="number"||typeof t=="bigint"?V0(t,e):typeof t=="boolean"?H0(t,e):Vo(t)?qm(t,e):Bm(t,e)}function H0(t,e={}){const i=new Uint8Array(1);return i[0]=Number(t),typeof e.size=="number"?(Fn(i,{size:e.size}),Kn(i,{size:e.size})):i}const rs={zero:48,nine:57,A:65,F:70,a:97,f:102};function gd(t){if(t>=rs.zero&&t<=rs.nine)return t-rs.zero;if(t>=rs.A&&t<=rs.F)return t-(rs.A-10);if(t>=rs.a&&t<=rs.f)return t-(rs.a-10)}function qm(t,e={}){let i=t;e.size&&(Fn(i,{size:e.size}),i=Kn(i,{dir:"right",size:e.size}));let s=i.slice(2);s.length%2&&(s=`0${s}`);const r=s.length/2,n=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const l=gd(s.charCodeAt(a++)),c=gd(s.charCodeAt(a++));if(l===void 0||c===void 0)throw new Hc(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);n[o]=l*16+c}return n}function V0(t,e){const i=$m(t,e);return qm(i)}function Bm(t,e={}){const i=q0.encode(t);return typeof e.size=="number"?(Fn(i,{size:e.size}),Kn(i,{dir:"right",size:e.size})):i}function Ec(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function W0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Vc(t,...e){if(!W0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Hq(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ec(t.outputLen),Ec(t.blockLen)}function fd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function K0(t,e){Vc(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Ma=BigInt(2**32-1),md=BigInt(32);function F0(t,e=!1){return e?{h:Number(t&Ma),l:Number(t>>md&Ma)}:{h:Number(t>>md&Ma)|0,l:Number(t&Ma)|0}}function G0(t,e=!1){let i=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let r=0;r<t.length;r++){const{h:n,l:o}=F0(t[r],e);[i[r],s[r]]=[n,o]}return[i,s]}const Y0=(t,e,i)=>t<<i|e>>>32-i,Q0=(t,e,i)=>e<<i|t>>>32-i,Z0=(t,e,i)=>e<<i-32|t>>>64-i,J0=(t,e,i)=>t<<i-32|e>>>64-i,jr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function X0(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Vq(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Wq(t,e){return t<<32-e|t>>>e}const wd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function eI(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function yd(t){for(let e=0;e<t.length;e++)t[e]=eI(t[e])}function tI(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Hm(t){return typeof t=="string"&&(t=tI(t)),Vc(t),t}function Kq(...t){let e=0;for(let s=0;s<t.length;s++){const r=t[s];Vc(r),e+=r.length}const i=new Uint8Array(e);for(let s=0,r=0;s<t.length;s++){const n=t[s];i.set(n,r),r+=n.length}return i}let iI=class{clone(){return this._cloneInto()}};function sI(t){const e=s=>t().update(Hm(s)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function Fq(t=32){if(jr&&typeof jr.getRandomValues=="function")return jr.getRandomValues(new Uint8Array(t));if(jr&&typeof jr.randomBytes=="function")return jr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Vm=[],Wm=[],Km=[],rI=BigInt(0),so=BigInt(1),nI=BigInt(2),oI=BigInt(7),aI=BigInt(256),cI=BigInt(113);for(let t=0,e=so,i=1,s=0;t<24;t++){[i,s]=[s,(2*i+3*s)%5],Vm.push(2*(5*s+i)),Wm.push((t+1)*(t+2)/2%64);let r=rI;for(let n=0;n<7;n++)e=(e<<so^(e>>oI)*cI)%aI,e&nI&&(r^=so<<(so<<BigInt(n))-so);Km.push(r)}const[lI,hI]=G0(Km,!0),vd=(t,e,i)=>i>32?Z0(t,e,i):Y0(t,e,i),bd=(t,e,i)=>i>32?J0(t,e,i):Q0(t,e,i);function uI(t,e=24){const i=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=i[l],h=i[l+1],u=vd(c,h,1)^i[a],d=bd(c,h,1)^i[a+1];for(let p=0;p<50;p+=10)t[o+p]^=u,t[o+p+1]^=d}let r=t[2],n=t[3];for(let o=0;o<24;o++){const a=Wm[o],l=vd(r,n,a),c=bd(r,n,a),h=Vm[o];r=t[h],n=t[h+1],t[h]=l,t[h+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=lI[s],t[1]^=hI[s]}i.fill(0)}let dI=class Fm extends iI{constructor(e,i,s,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=s,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ec(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=X0(this.state)}keccak(){wd||yd(this.state32),uI(this.state32,this.rounds),wd||yd(this.state32),this.posOut=0,this.pos=0}update(e){fd(this);const{blockLen:i,state:s}=this;e=Hm(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(i-this.pos,r-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:s,blockLen:r}=this;e[s]^=i,i&128&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){fd(this,!1),Vc(e),this.finish();const i=this.state,{blockLen:s}=this;for(let r=0,n=e.length;r<n;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,n-r);e.set(i.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ec(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(K0(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:s,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new Fm(i,s,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}};const pI=(t,e,i)=>sI(()=>new dI(e,t,i)),gI=pI(1,136,256/8);function Gm(t,e){const i=e||"hex",s=gI(Vo(t,{strict:!1})?B0(t):t);return i==="bytes"?s:gh(s)}let fI=class extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const e=super.get(t);return super.has(t)&&e!==void 0&&(this.delete(t),super.set(t,e)),e}set(t,e){if(super.set(t,e),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}};const gl=new fI(8192);function mI(t,e){if(gl.has(`${t}.${e}`))return gl.get(`${t}.${e}`);const i=t.substring(2).toLowerCase(),s=Gm(Bm(i),"bytes"),r=i.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(s[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const n=`0x${r.join("")}`;return gl.set(`${t}.${e}`,n),n}function wI(t){const e=Gm(`0x${t.substring(4)}`).substring(26);return mI(`0x${e}`)}async function yI({hash:t,signature:e}){const i=Vo(t)?t:gh(t),{secp256k1:s}=await Bo(async()=>{const{secp256k1:r}=await import("./secp256k1-BFBj5yVh-pcCAbJ0I.js");return{secp256k1:r}},__vite__mapDeps([4,1,2,5,6,7,8,9]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:a,s:l,v:c,yParity:h}=e,u=Number(h??c),d=Id(u);return new s.Signature(ph(a),ph(l)).addRecoveryBit(d)}const r=Vo(e)?e:gh(e),n=R0(`0x${r.slice(130)}`),o=Id(n);return s.Signature.fromCompact(r.substring(2,130)).addRecoveryBit(o)})().recoverPublicKey(i.substring(2)).toHex(!1)}`}function Id(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function vI({hash:t,signature:e}){return wI(await yI({hash:t,signature:e}))}var Ym=rb();const Qm=":";function Tn(t){const[e,i]=t.split(Qm);return{namespace:e,reference:i}}function bI(t){const[e,i,s]=t.split(Qm);return{namespace:e,reference:i,address:s}}function Zm(t,e){return t.includes(":")?[t]:e.chains||[]}const II="ReactNative",gi={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},EI="js";function Nc(){return typeof N.process<"u"&&typeof N.process.versions<"u"&&typeof N.process.versions.node<"u"}function Fs(){return!Vs()&&!!qc()&&navigator.product===II}function NI(){return Fs()&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Platform)<"u"&&(N.global==null?void 0:N.global.Platform.OS)==="android"}function AI(){return Fs()&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Platform)<"u"&&(N.global==null?void 0:N.global.Platform.OS)==="ios"}function ha(){return!Nc()&&!!qc()&&!!Vs()}function ua(){return Fs()?gi.reactNative:Nc()?gi.node:ha()?gi.browser:gi.unknown}function Ed(){var t;try{return Fs()&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Application)<"u"?(t=N.global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function _I(t,e){const i=new URLSearchParams(t);for(const s of Object.keys(e).sort())if(e.hasOwnProperty(s)){const r=e[s];r!==void 0&&i.set(s,r)}return i.toString()}function Jm(){return vm()||{name:"",description:"",url:"",icons:[""]}}function CI(){if(ua()===gi.reactNative&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Platform)<"u"){const{OS:i,Version:s}=N.global.Platform;return[i,s].join("-")}const t=Tm();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function SI(){var t;const e=ua();return e===gi.browser?[e,((t=bm())==null?void 0:t.host)||"unknown"].join(":"):e}function Xm(t,e,i){const s=CI(),r=SI();return[[t,e].join("-"),[EI,i].join("-"),s,r].join("/")}function PI({protocol:t,version:e,relayUrl:i,sdkVersion:s,auth:r,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:l}){const c=i.split("?"),h=Xm(t,e,s),u={auth:r,ua:h,projectId:n,useOnCloseEvent:o,packageName:l||void 0,bundleId:a||void 0},d=_I(c[1]||"",u);return c[0]+"?"+d}function lr(t,e){return t.filter(i=>e.includes(i)).length===t.length}function ew(t){return Object.fromEntries(t.entries())}function tw(t){return new Map(Object.entries(t))}function tr(t=E.FIVE_MINUTES,e){const i=E.toMiliseconds(t||E.FIVE_MINUTES);let s,r,n,o;return{resolve:a=>{n&&s&&(clearTimeout(n),s(a),o=Promise.resolve(a))},reject:a=>{n&&r&&(clearTimeout(n),r(a))},done:()=>new Promise((a,l)=>{if(o)return a(o);n=setTimeout(()=>{const c=new Error(e);o=Promise.reject(c),l(c)},i),s=a,r=l})}}function js(t,e,i){return new Promise(async(s,r)=>{const n=setTimeout(()=>r(new Error(i)),e);try{const o=await t;s(o)}catch(o){r(o)}clearTimeout(n)})}function iw(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function TI(t){return iw("topic",t)}function MI(t){return iw("id",t)}function sw(t){const[e,i]=t.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")s.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))s.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return s}function ht(t,e){return E.fromMiliseconds(Date.now()+E.toMiliseconds(t))}function Ss(t){return Date.now()>=E.toMiliseconds(t)}function Ie(t,e){return`${t}${e?`:${e}`:""}`}function sc(t=[],e=[]){return[...new Set([...t,...e])]}async function OI({id:t,topic:e,wcDeepLink:i}){var s;try{if(!i)return;const r=typeof i=="string"?JSON.parse(i):i,n=r==null?void 0:r.href;if(typeof n!="string")return;const o=xI(n,t,e),a=ua();if(a===gi.browser){if(!((s=Vs())!=null&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}kI(o)}else a===gi.reactNative&&typeof(N.global==null?void 0:N.global.Linking)<"u"&&await N.global.Linking.openURL(o)}catch(r){console.error(r)}}function xI(t,e,i){const s=`requestId=${e}&sessionTopic=${i}`;t.endsWith("/")&&(t=t.slice(0,-1));let r=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";r=`${r}${n}${UI(s,!0)}`}else r=`${r}/wc?${s}`;return r}function kI(t){let e="_self";RI()?e="_top":(jI()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function DI(t,e){let i="";try{if(ha()&&(i=localStorage.getItem(e),i))return i;i=await t.getItem(e)}catch(s){console.error(s)}return i}function Nd(t,e){if(!t.includes(e))return null;const i=t.split(/([&,?,=])/),s=i.indexOf(e);return i[s+2]}function Ad(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function bu(){return typeof N.process<"u"&&N.process.env.IS_VITEST==="true"}function jI(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function RI(){try{return window.self!==window.top}catch{return!1}}function UI(t,e=!1){const i=N.Buffer.from(t).toString("base64");return e?i.replace(/[=]/g,""):i}function rw(t){return N.Buffer.from(t,"base64").toString("utf-8")}function LI(t){return new Promise(e=>setTimeout(e,t))}function Wo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function zI(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Wc(t,...e){if(!zI(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Iu(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Wo(t.outputLen),Wo(t.blockLen)}function Dn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function nw(t,e){Wc(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Oa=BigInt(2**32-1),_d=BigInt(32);function $I(t,e=!1){return e?{h:Number(t&Oa),l:Number(t>>_d&Oa)}:{h:Number(t>>_d&Oa)|0,l:Number(t&Oa)|0}}function qI(t,e=!1){let i=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let r=0;r<t.length;r++){const{h:n,l:o}=$I(t[r],e);[i[r],s[r]]=[n,o]}return[i,s]}const BI=(t,e,i)=>t<<i|e>>>32-i,HI=(t,e,i)=>e<<i|t>>>32-i,VI=(t,e,i)=>e<<i-32|t>>>64-i,WI=(t,e,i)=>t<<i-32|e>>>64-i,Rr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function KI(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function fl(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Bi(t,e){return t<<32-e|t>>>e}const Cd=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function FI(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Sd(t){for(let e=0;e<t.length;e++)t[e]=FI(t[e])}function GI(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function jn(t){return typeof t=="string"&&(t=GI(t)),Wc(t),t}let Eu=class{clone(){return this._cloneInto()}};function ow(t){const e=s=>t().update(jn(s)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function da(t=32){if(Rr&&typeof Rr.getRandomValues=="function")return Rr.getRandomValues(new Uint8Array(t));if(Rr&&typeof Rr.randomBytes=="function")return Rr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const aw=[],cw=[],lw=[],YI=BigInt(0),ro=BigInt(1),QI=BigInt(2),ZI=BigInt(7),JI=BigInt(256),XI=BigInt(113);for(let t=0,e=ro,i=1,s=0;t<24;t++){[i,s]=[s,(2*i+3*s)%5],aw.push(2*(5*s+i)),cw.push((t+1)*(t+2)/2%64);let r=YI;for(let n=0;n<7;n++)e=(e<<ro^(e>>ZI)*XI)%JI,e&QI&&(r^=ro<<(ro<<BigInt(n))-ro);lw.push(r)}const[eE,tE]=qI(lw,!0),Pd=(t,e,i)=>i>32?VI(t,e,i):BI(t,e,i),Td=(t,e,i)=>i>32?WI(t,e,i):HI(t,e,i);function iE(t,e=24){const i=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=i[l],h=i[l+1],u=Pd(c,h,1)^i[a],d=Td(c,h,1)^i[a+1];for(let p=0;p<50;p+=10)t[o+p]^=u,t[o+p+1]^=d}let r=t[2],n=t[3];for(let o=0;o<24;o++){const a=cw[o],l=Pd(r,n,a),c=Td(r,n,a),h=aw[o];r=t[h],n=t[h+1],t[h]=l,t[h+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=eE[s],t[1]^=tE[s]}i.fill(0)}let sE=class hw extends Eu{constructor(e,i,s,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=s,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Wo(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=KI(this.state)}keccak(){Cd||Sd(this.state32),iE(this.state32,this.rounds),Cd||Sd(this.state32),this.posOut=0,this.pos=0}update(e){Dn(this);const{blockLen:i,state:s}=this;e=jn(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(i-this.pos,r-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:s,blockLen:r}=this;e[s]^=i,i&128&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Dn(this,!1),Wc(e),this.finish();const i=this.state,{blockLen:s}=this;for(let r=0,n=e.length;r<n;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,n-r);e.set(i.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Wo(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(nw(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:s,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new hw(i,s,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}};const rE=(t,e,i)=>ow(()=>new sE(e,t,i)),nE=rE(1,136,256/8),oE="https://rpc.walletconnect.org/v1";function uw(t){const e=`Ethereum Signed Message:
${t.length}`,i=new TextEncoder().encode(e+t);return"0x"+N.Buffer.from(nE(i)).toString("hex")}async function aE(t,e,i,s,r,n){switch(i.t){case"eip191":return await cE(t,e,i.s);case"eip1271":return await lE(t,e,i.s,s,r,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${i.t}`)}}async function cE(t,e,i){return(await vI({hash:uw(e),signature:i})).toLowerCase()===t.toLowerCase()}async function lE(t,e,i,s,r,n){const o=Tn(s);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${s}`);try{const a="0x1626ba7e",l="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",h=i.substring(2),u=uw(e).substring(2),d=a+u+l+c+h,p=await fetch(`${n||oE}/?chainId=${s}&projectId=${r}`,{method:"POST",body:JSON.stringify({id:hE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:g}=await p.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function hE(){return Date.now()+Math.floor(Math.random()*1e3)}var uE=Object.defineProperty,dE=Object.defineProperties,pE=Object.getOwnPropertyDescriptors,Md=Object.getOwnPropertySymbols,gE=Object.prototype.hasOwnProperty,fE=Object.prototype.propertyIsEnumerable,Od=(t,e,i)=>e in t?uE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,mE=(t,e)=>{for(var i in e||(e={}))gE.call(e,i)&&Od(t,i,e[i]);if(Md)for(var i of Md(e))fE.call(e,i)&&Od(t,i,e[i]);return t},wE=(t,e)=>dE(t,pE(e));const yE="did:pkh:",Nu=t=>t==null?void 0:t.split(":"),vE=t=>{const e=t&&Nu(t);if(e)return t.includes(yE)?e[3]:e[1]},fh=t=>{const e=t&&Nu(t);if(e)return e[2]+":"+e[3]},Ac=t=>{const e=t&&Nu(t);if(e)return e.pop()};async function xd(t){const{cacao:e,projectId:i}=t,{s,p:r}=e,n=dw(r,r.iss),o=Ac(r.iss);return await aE(o,n,s,fh(r.iss),i)}const dw=(t,e)=>{const i=`${t.domain} wants you to sign in with your Ethereum account:`,s=Ac(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${vE(e)}`,l=`Nonce: ${t.nonce}`,c=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,u=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(f=>`
- ${f}`).join("")}`:void 0,g=rc(t.resources);if(g){const f=Ko(g);r=PE(r,f)}return[i,s,"",r,"",n,o,a,l,c,h,u,d,p].filter(f=>f!=null).join(`
`)};function bE(t){return N.Buffer.from(JSON.stringify(t)).toString("base64")}function IE(t){return JSON.parse(N.Buffer.from(t,"base64").toString("utf-8"))}function gr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(i=>{const s=t.att[i];if(Array.isArray(s))throw new Error(`Resource must be an object: ${i}`);if(typeof s!="object")throw new Error(`Resource must be an object: ${i}`);if(!Object.keys(s).length)throw new Error(`Resource object is empty: ${i}`);Object.keys(s).forEach(r=>{const n=s[r];if(!Array.isArray(n))throw new Error(`Ability limits ${r} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${r} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${r}) must be an array of objects, found: ${o}`)})})})}function EE(t,e,i,s={}){return i==null||i.sort((r,n)=>r.localeCompare(n)),{att:{[t]:NE(e,i,s)}}}function NE(t,e,i={}){e=e==null?void 0:e.sort((r,n)=>r.localeCompare(n));const s=e.map(r=>({[`${t}/${r}`]:[i]}));return Object.assign({},...s)}function pw(t){return gr(t),`urn:recap:${bE(t).replace(/=/g,"")}`}function Ko(t){const e=IE(t.replace("urn:recap:",""));return gr(e),e}function AE(t,e,i){const s=EE(t,e,i);return pw(s)}function _E(t){return t&&t.includes("urn:recap:")}function CE(t,e){const i=Ko(t),s=Ko(e),r=SE(i,s);return pw(r)}function SE(t,e){gr(t),gr(e);const i=Object.keys(t.att).concat(Object.keys(e.att)).sort((r,n)=>r.localeCompare(n)),s={att:{}};return i.forEach(r=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[r])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[r])||{})).sort((a,l)=>a.localeCompare(l)).forEach(a=>{var l,c;s.att[r]=wE(mE({},s.att[r]),{[a]:((l=t.att[r])==null?void 0:l[a])||((c=e.att[r])==null?void 0:c[a])})})}),s}function PE(t="",e){gr(e);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(i))return t;const s=[];let r=0;Object.keys(e.att).forEach(a=>{const l=Object.keys(e.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));l.sort((u,d)=>u.action.localeCompare(d.action));const c={};l.forEach(u=>{c[u.ability]||(c[u.ability]=[]),c[u.ability].push(u.action)});const h=Object.keys(c).map(u=>(r++,`(${r}) '${u}': '${c[u].join("', '")}' for '${a}'.`));s.push(h.join(", ").replace(".,","."))});const n=s.join(" "),o=`${i}${n}`;return`${t?t+" ":""}${o}`}function kd(t){var e;const i=Ko(t);gr(i);const s=(e=i.att)==null?void 0:e.eip155;return s?Object.keys(s).map(r=>r.split("/")[1]):[]}function Dd(t){const e=Ko(t);gr(e);const i=[];return Object.values(e.att).forEach(s=>{Object.values(s).forEach(r=>{var n;(n=r==null?void 0:r[0])!=null&&n.chains&&i.push(r[0].chains)})}),[...new Set(i.flat())]}function rc(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return _E(e)?e:void 0}function ml(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function gw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ui(t,...e){if(!gw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function jd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function TE(t,e){ui(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function Rd(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const $s=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),ME=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),OE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!OE)throw new Error("Non little-endian hardware is not supported");function xE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function mh(t){if(typeof t=="string")t=xE(t);else if(gw(t))t=wh(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function kE(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function DE(t,e){if(t.length!==e.length)return!1;let i=0;for(let s=0;s<t.length;s++)i|=t[s]^e[s];return i===0}const jE=(t,e)=>{function i(s,...r){if(ui(s),t.nonceLength!==void 0){const c=r[0];if(!c)throw new Error("nonce / iv required");t.varSizeNonce?ui(c):ui(c,t.nonceLength)}const n=t.tagLength;n&&r[1]!==void 0&&ui(r[1]);const o=e(s,...r),a=(c,h)=>{if(h!==void 0){if(c!==2)throw new Error("cipher output not supported");ui(h)}};let l=!1;return{encrypt(c,h){if(l)throw new Error("cannot encrypt() twice with same key + nonce");return l=!0,ui(c),a(o.encrypt.length,h),o.encrypt(c,h)},decrypt(c,h){if(ui(c),n&&c.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,h),o.decrypt(c,h)}}}return Object.assign(i,t),i};function Ud(t,e,i=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(i&&!RE(e))throw new Error("invalid output, must be aligned");return e}function Ld(t,e,i,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,s);const r=BigInt(32),n=BigInt(4294967295),o=Number(i>>r&n),a=Number(i&n);t.setUint32(e+4,o,s),t.setUint32(e+0,a,s)}function RE(t){return t.byteOffset%4===0}function wh(t){return Uint8Array.from(t)}function Rn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const fw=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),UE=fw("expand 16-byte k"),LE=fw("expand 32-byte k"),zE=$s(UE),$E=$s(LE);function de(t,e){return t<<e|t>>>32-e}function yh(t){return t.byteOffset%4===0}const xa=64,qE=16,mw=2**32-1,zd=new Uint32Array;function BE(t,e,i,s,r,n,o,a){const l=r.length,c=new Uint8Array(xa),h=$s(c),u=yh(r)&&yh(n),d=u?$s(r):zd,p=u?$s(n):zd;for(let g=0;g<l;o++){if(t(e,i,s,h,o,a),o>=mw)throw new Error("arx: counter overflow");const f=Math.min(xa,l-g);if(u&&f===xa){const w=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let m=0,y;m<qE;m++)y=w+m,p[y]=d[y]^h[m];g+=xa;continue}for(let w=0,m;w<f;w++)m=g+w,n[m]=r[m]^c[w];g+=f}}function HE(t,e){const{allowShortKeys:i,extendNonceFn:s,counterLength:r,counterRight:n,rounds:o}=kE({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return ml(r),ml(o),Rd(n),Rd(i),(a,l,c,h,u=0)=>{ui(a),ui(l),ui(c);const d=c.length;if(h===void 0&&(h=new Uint8Array(d)),ui(h),ml(u),u<0||u>=mw)throw new Error("arx: counter overflow");if(h.length<d)throw new Error(`arx: output (${h.length}) is shorter than data (${d})`);const p=[];let g=a.length,f,w;if(g===32)p.push(f=wh(a)),w=$E;else if(g===16&&i)f=new Uint8Array(32),f.set(a),f.set(a,16),w=zE,p.push(f);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);yh(l)||p.push(l=wh(l));const m=$s(f);if(s){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(w,m,$s(l.subarray(0,16)),m),l=l.subarray(16)}const y=16-r;if(y!==l.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const I=new Uint8Array(12);I.set(l,n?0:12-l.length),l=I,p.push(l)}const v=$s(l);return BE(t,w,m,v,c,h,u,o),Rn(...p),h}}const Nt=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let VE=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=mh(t),ui(t,32);const e=Nt(t,0),i=Nt(t,2),s=Nt(t,4),r=Nt(t,6),n=Nt(t,8),o=Nt(t,10),a=Nt(t,12),l=Nt(t,14);this.r[0]=e&8191,this.r[1]=(e>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|r<<9)&8191,this.r[4]=(r>>>4|n<<12)&255,this.r[5]=n>>>1&8190,this.r[6]=(n>>>14|o<<2)&8191,this.r[7]=(o>>>11|a<<5)&8065,this.r[8]=(a>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let c=0;c<8;c++)this.pad[c]=Nt(t,16+2*c)}process(t,e,i=!1){const s=i?0:2048,{h:r,r:n}=this,o=n[0],a=n[1],l=n[2],c=n[3],h=n[4],u=n[5],d=n[6],p=n[7],g=n[8],f=n[9],w=Nt(t,e+0),m=Nt(t,e+2),y=Nt(t,e+4),v=Nt(t,e+6),I=Nt(t,e+8),S=Nt(t,e+10),T=Nt(t,e+12),P=Nt(t,e+14);let _=r[0]+(w&8191),A=r[1]+((w>>>13|m<<3)&8191),M=r[2]+((m>>>10|y<<6)&8191),k=r[3]+((y>>>7|v<<9)&8191),B=r[4]+((v>>>4|I<<12)&8191),$=r[5]+(I>>>1&8191),q=r[6]+((I>>>14|S<<2)&8191),L=r[7]+((S>>>11|T<<5)&8191),H=r[8]+((T>>>8|P<<8)&8191),V=r[9]+(P>>>5|s),C=0,U=C+_*o+A*(5*f)+M*(5*g)+k*(5*p)+B*(5*d);C=U>>>13,U&=8191,U+=$*(5*u)+q*(5*h)+L*(5*c)+H*(5*l)+V*(5*a),C+=U>>>13,U&=8191;let W=C+_*a+A*o+M*(5*f)+k*(5*g)+B*(5*p);C=W>>>13,W&=8191,W+=$*(5*d)+q*(5*u)+L*(5*h)+H*(5*c)+V*(5*l),C+=W>>>13,W&=8191;let Q=C+_*l+A*a+M*o+k*(5*f)+B*(5*g);C=Q>>>13,Q&=8191,Q+=$*(5*p)+q*(5*d)+L*(5*u)+H*(5*h)+V*(5*c),C+=Q>>>13,Q&=8191;let F=C+_*c+A*l+M*a+k*o+B*(5*f);C=F>>>13,F&=8191,F+=$*(5*g)+q*(5*p)+L*(5*d)+H*(5*u)+V*(5*h),C+=F>>>13,F&=8191;let ne=C+_*h+A*c+M*l+k*a+B*o;C=ne>>>13,ne&=8191,ne+=$*(5*f)+q*(5*g)+L*(5*p)+H*(5*d)+V*(5*u),C+=ne>>>13,ne&=8191;let ve=C+_*u+A*h+M*c+k*l+B*a;C=ve>>>13,ve&=8191,ve+=$*o+q*(5*f)+L*(5*g)+H*(5*p)+V*(5*d),C+=ve>>>13,ve&=8191;let De=C+_*d+A*u+M*h+k*c+B*l;C=De>>>13,De&=8191,De+=$*a+q*o+L*(5*f)+H*(5*g)+V*(5*p),C+=De>>>13,De&=8191;let Xe=C+_*p+A*d+M*u+k*h+B*c;C=Xe>>>13,Xe&=8191,Xe+=$*l+q*a+L*o+H*(5*f)+V*(5*g),C+=Xe>>>13,Xe&=8191;let Ke=C+_*g+A*p+M*d+k*u+B*h;C=Ke>>>13,Ke&=8191,Ke+=$*c+q*l+L*a+H*o+V*(5*f),C+=Ke>>>13,Ke&=8191;let Fe=C+_*f+A*g+M*p+k*d+B*u;C=Fe>>>13,Fe&=8191,Fe+=$*h+q*c+L*l+H*a+V*o,C+=Fe>>>13,Fe&=8191,C=(C<<2)+C|0,C=C+U|0,U=C&8191,C=C>>>13,W+=C,r[0]=U,r[1]=W,r[2]=Q,r[3]=F,r[4]=ne,r[5]=ve,r[6]=De,r[7]=Xe,r[8]=Ke,r[9]=Fe}finalize(){const{h:t,pad:e}=this,i=new Uint16Array(10);let s=t[1]>>>13;t[1]&=8191;for(let o=2;o<10;o++)t[o]+=s,s=t[o]>>>13,t[o]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,i[0]=t[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=t[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let r=(s^1)-1;for(let o=0;o<10;o++)i[o]&=r;r=~r;for(let o=0;o<10;o++)t[o]=t[o]&r|i[o];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let n=t[0]+e[0];t[0]=n&65535;for(let o=1;o<8;o++)n=(t[o]+e[o]|0)+(n>>>16)|0,t[o]=n&65535;Rn(i)}update(t){jd(this);const{buffer:e,blockLen:i}=this;t=mh(t);const s=t.length;for(let r=0;r<s;){const n=Math.min(i-this.pos,s-r);if(n===i){for(;i<=s-r;r+=i)this.process(t,r);continue}e.set(t.subarray(r,r+n),this.pos),this.pos+=n,r+=n,this.pos===i&&(this.process(e,0,!1),this.pos=0)}return this}destroy(){Rn(this.h,this.r,this.buffer,this.pad)}digestInto(t){jd(this),TE(t,this),this.finished=!0;const{buffer:e,h:i}=this;let{pos:s}=this;if(s){for(e[s++]=1;s<16;s++)e[s]=0;this.process(e,0,!0)}this.finalize();let r=0;for(let n=0;n<8;n++)t[r++]=i[n]>>>0,t[r++]=i[n]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}};function WE(t){const e=(s,r)=>t(r).update(mh(s)).digest(),i=t(new Uint8Array(32));return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=s=>t(s),e}const KE=WE(t=>new VE(t));function FE(t,e,i,s,r,n=20){let o=t[0],a=t[1],l=t[2],c=t[3],h=e[0],u=e[1],d=e[2],p=e[3],g=e[4],f=e[5],w=e[6],m=e[7],y=r,v=i[0],I=i[1],S=i[2],T=o,P=a,_=l,A=c,M=h,k=u,B=d,$=p,q=g,L=f,H=w,V=m,C=y,U=v,W=I,Q=S;for(let ne=0;ne<n;ne+=2)T=T+M|0,C=de(C^T,16),q=q+C|0,M=de(M^q,12),T=T+M|0,C=de(C^T,8),q=q+C|0,M=de(M^q,7),P=P+k|0,U=de(U^P,16),L=L+U|0,k=de(k^L,12),P=P+k|0,U=de(U^P,8),L=L+U|0,k=de(k^L,7),_=_+B|0,W=de(W^_,16),H=H+W|0,B=de(B^H,12),_=_+B|0,W=de(W^_,8),H=H+W|0,B=de(B^H,7),A=A+$|0,Q=de(Q^A,16),V=V+Q|0,$=de($^V,12),A=A+$|0,Q=de(Q^A,8),V=V+Q|0,$=de($^V,7),T=T+k|0,Q=de(Q^T,16),H=H+Q|0,k=de(k^H,12),T=T+k|0,Q=de(Q^T,8),H=H+Q|0,k=de(k^H,7),P=P+B|0,C=de(C^P,16),V=V+C|0,B=de(B^V,12),P=P+B|0,C=de(C^P,8),V=V+C|0,B=de(B^V,7),_=_+$|0,U=de(U^_,16),q=q+U|0,$=de($^q,12),_=_+$|0,U=de(U^_,8),q=q+U|0,$=de($^q,7),A=A+M|0,W=de(W^A,16),L=L+W|0,M=de(M^L,12),A=A+M|0,W=de(W^A,8),L=L+W|0,M=de(M^L,7);let F=0;s[F++]=o+T|0,s[F++]=a+P|0,s[F++]=l+_|0,s[F++]=c+A|0,s[F++]=h+M|0,s[F++]=u+k|0,s[F++]=d+B|0,s[F++]=p+$|0,s[F++]=g+q|0,s[F++]=f+L|0,s[F++]=w+H|0,s[F++]=m+V|0,s[F++]=y+C|0,s[F++]=v+U|0,s[F++]=I+W|0,s[F++]=S+Q|0}const GE=HE(FE,{counterRight:!1,counterLength:4,allowShortKeys:!1}),YE=new Uint8Array(16),$d=(t,e)=>{t.update(e);const i=e.length%16;i&&t.update(YE.subarray(i))},QE=new Uint8Array(32);function qd(t,e,i,s,r){const n=t(e,i,QE),o=KE.create(n);r&&$d(o,r),$d(o,s);const a=new Uint8Array(16),l=ME(a);Ld(l,0,BigInt(r?r.length:0),!0),Ld(l,8,BigInt(s.length),!0),o.update(a);const c=o.digest();return Rn(n,a),c}const ZE=t=>(e,i,s)=>({encrypt(r,n){const o=r.length;n=Ud(o+16,n,!1),n.set(r);const a=n.subarray(0,-16);t(e,i,a,a,1);const l=qd(t,e,i,a,s);return n.set(l,o),Rn(l),n},decrypt(r,n){n=Ud(r.length-16,n,!1);const o=r.subarray(0,-16),a=r.subarray(-16),l=qd(t,e,i,o,s);if(!DE(a,l))throw new Error("invalid tag");return n.set(r.subarray(0,-16)),t(e,i,n,n,1),Rn(l),n}}),ww=jE({blockSize:64,nonceLength:12,tagLength:16},ZE(GE));let yw=class extends Eu{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Iu(t);const i=jn(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,r=new Uint8Array(s);r.set(i.length>s?t.create().update(i).digest():i);for(let n=0;n<r.length;n++)r[n]^=54;this.iHash.update(r),this.oHash=t.create();for(let n=0;n<r.length;n++)r[n]^=106;this.oHash.update(r),r.fill(0)}update(t){return Dn(this),this.iHash.update(t),this}digestInto(t){Dn(this),Wc(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:s,destroyed:r,blockLen:n,outputLen:o}=this;return t=t,t.finished=s,t.destroyed=r,t.blockLen=n,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Au=(t,e,i)=>new yw(t,e).update(i).digest();Au.create=(t,e)=>new yw(t,e);function JE(t,e,i){return Iu(t),i===void 0&&(i=new Uint8Array(t.outputLen)),Au(t,jn(i),jn(e))}const wl=new Uint8Array([0]),Bd=new Uint8Array;function XE(t,e,i,s=32){if(Iu(t),Wo(s),s>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const r=Math.ceil(s/t.outputLen);i===void 0&&(i=Bd);const n=new Uint8Array(r*t.outputLen),o=Au.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<r;c++)wl[0]=c+1,a.update(c===0?Bd:l).update(i).update(wl).digestInto(l),n.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),wl.fill(0),n.slice(0,s)}const eN=(t,e,i,s,r)=>XE(t,JE(t,e,i),s,r);function tN(t,e,i,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,s);const r=BigInt(32),n=BigInt(4294967295),o=Number(i>>r&n),a=Number(i&n),l=s?4:0,c=s?0:4;t.setUint32(e+l,o,s),t.setUint32(e+c,a,s)}function iN(t,e,i){return t&e^~t&i}function sN(t,e,i){return t&e^t&i^e&i}let rN=class extends Eu{constructor(t,e,i,s){super(),this.blockLen=t,this.outputLen=e,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=fl(this.buffer)}update(t){Dn(this);const{view:e,buffer:i,blockLen:s}=this;t=jn(t);const r=t.length;for(let n=0;n<r;){const o=Math.min(s-this.pos,r-n);if(o===s){const a=fl(t);for(;s<=r-n;n+=s)this.process(a,n);continue}i.set(t.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===s&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Dn(this),nw(t,this),this.finished=!0;const{buffer:e,view:i,blockLen:s,isLE:r}=this;let{pos:n}=this;e[n++]=128,this.buffer.subarray(n).fill(0),this.padOffset>s-n&&(this.process(i,0),n=0);for(let h=n;h<s;h++)e[h]=0;tN(i,s-8,BigInt(this.length*8),r),this.process(i,0);const o=fl(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)o.setUint32(4*h,c[h],r)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:i,length:s,finished:r,destroyed:n,pos:o}=this;return t.length=s,t.pos=o,t.finished=r,t.destroyed=n,s%e&&t.buffer.set(i),t}};const nN=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vs=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),bs=new Uint32Array(64);let oN=class extends rN{constructor(){super(64,32,8,!1),this.A=vs[0]|0,this.B=vs[1]|0,this.C=vs[2]|0,this.D=vs[3]|0,this.E=vs[4]|0,this.F=vs[5]|0,this.G=vs[6]|0,this.H=vs[7]|0}get(){const{A:t,B:e,C:i,D:s,E:r,F:n,G:o,H:a}=this;return[t,e,i,s,r,n,o,a]}set(t,e,i,s,r,n,o,a){this.A=t|0,this.B=e|0,this.C=i|0,this.D=s|0,this.E=r|0,this.F=n|0,this.G=o|0,this.H=a|0}process(t,e){for(let h=0;h<16;h++,e+=4)bs[h]=t.getUint32(e,!1);for(let h=16;h<64;h++){const u=bs[h-15],d=bs[h-2],p=Bi(u,7)^Bi(u,18)^u>>>3,g=Bi(d,17)^Bi(d,19)^d>>>10;bs[h]=g+bs[h-7]+p+bs[h-16]|0}let{A:i,B:s,C:r,D:n,E:o,F:a,G:l,H:c}=this;for(let h=0;h<64;h++){const u=Bi(o,6)^Bi(o,11)^Bi(o,25),d=c+u+iN(o,a,l)+nN[h]+bs[h]|0,p=(Bi(i,2)^Bi(i,13)^Bi(i,22))+sN(i,s,r)|0;c=l,l=a,a=o,o=n+d|0,n=r,r=s,s=i,i=d+p|0}i=i+this.A|0,s=s+this.B|0,r=r+this.C|0,n=n+this.D|0,o=o+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(i,s,r,n,o,a,l,c)}roundClean(){bs.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Kc=ow(()=>new oN);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vw=BigInt(0);function _u(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function bw(t){if(!_u(t))throw new Error("Uint8Array expected")}const aN=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function cN(t){bw(t);let e="";for(let i=0;i<t.length;i++)e+=aN[t[i]];return e}function lN(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?vw:BigInt("0x"+t)}const ns={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hd(t){if(t>=ns._0&&t<=ns._9)return t-ns._0;if(t>=ns.A&&t<=ns.F)return t-(ns.A-10);if(t>=ns.a&&t<=ns.f)return t-(ns.a-10)}function Iw(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,i=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(i);for(let r=0,n=0;r<i;r++,n+=2){const o=Hd(t.charCodeAt(n)),a=Hd(t.charCodeAt(n+1));if(o===void 0||a===void 0){const l=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+n)}s[r]=o*16+a}return s}function Vd(t){return bw(t),lN(cN(Uint8Array.from(t).reverse()))}function hN(t,e){return Iw(t.toString(16).padStart(e*2,"0"))}function uN(t,e){return hN(t,e).reverse()}function Wd(t,e,i){let s;if(typeof e=="string")try{s=Iw(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(_u(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=s.length;if(typeof i=="number"&&r!==i)throw new Error(t+" of length "+i+" expected, got "+r);return s}const yl=t=>typeof t=="bigint"&&vw<=t;function dN(t,e,i){return yl(t)&&yl(e)&&yl(i)&&e<=t&&t<i}function Kd(t,e,i,s){if(!dN(e,i,s))throw new Error("expected valid "+t+": "+i+" <= n < "+s+", got "+e)}const pN={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||_u(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function gN(t,e,i={}){const s=(r,n,o)=>{const a=pN[n];if(typeof a!="function")throw new Error("invalid validator function");const l=t[r];if(!(o&&l===void 0)&&!a(l,t))throw new Error("param "+String(r)+" is invalid. Expected "+n+", got "+l)};for(const[r,n]of Object.entries(e))s(r,n,!1);for(const[r,n]of Object.entries(i))s(r,n,!0);return t}const An=BigInt(0),ka=BigInt(1);function Ew(t,e){const i=t%e;return i>=An?i:e+i}function fN(t,e,i){if(e<An)throw new Error("invalid exponent, negatives unsupported");if(i<=An)throw new Error("invalid modulus");if(i===ka)return An;let s=ka;for(;e>An;)e&ka&&(s=s*t%i),t=t*t%i,e>>=ka;return s}function Li(t,e,i){let s=t;for(;e-- >An;)s*=s,s%=i;return s}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Ur=BigInt(0),vl=BigInt(1);function mN(t){return gN(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function wN(t){const e=mN(t),{P:i}=e,s=y=>Ew(y,i),r=e.montgomeryBits,n=Math.ceil(r/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),l=e.powPminus2||(y=>fN(y,i-BigInt(2),i));function c(y,v,I){const S=s(y*(v-I));return v=s(v-S),I=s(I+S),[v,I]}const h=(e.a-BigInt(2))/BigInt(4);function u(y,v){Kd("u",y,Ur,i),Kd("scalar",v,Ur,i);const I=v,S=y;let T=vl,P=Ur,_=y,A=vl,M=Ur,k;for(let $=BigInt(r-1);$>=Ur;$--){const q=I>>$&vl;M^=q,k=c(M,T,_),T=k[0],_=k[1],k=c(M,P,A),P=k[0],A=k[1],M=q;const L=T+P,H=s(L*L),V=T-P,C=s(V*V),U=H-C,W=_+A,Q=_-A,F=s(Q*L),ne=s(W*V),ve=F+ne,De=F-ne;_=s(ve*ve),A=s(S*s(De*De)),T=s(H*C),P=s(U*(H+s(h*U)))}k=c(M,T,_),T=k[0],_=k[1],k=c(M,P,A),P=k[0],A=k[1];const B=l(P);return s(T*B)}function d(y){return uN(s(y),n)}function p(y){const v=Wd("u coordinate",y,n);return o===32&&(v[31]&=127),Vd(v)}function g(y){const v=Wd("scalar",y),I=v.length;if(I!==n&&I!==o){let S=""+n+" or "+o;throw new Error("invalid scalar, expected "+S+" bytes, got "+I)}return Vd(a(v))}function f(y,v){const I=p(v),S=g(y),T=u(I,S);if(T===Ur)throw new Error("invalid private or public key received");return d(T)}const w=d(e.Gu);function m(y){return f(y,w)}return{scalarMult:f,scalarMultBase:m,getSharedSecret:(y,v)=>f(y,v),getPublicKey:y=>m(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}const vh=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const yN=BigInt(1),Fd=BigInt(2),vN=BigInt(3),bN=BigInt(5);BigInt(8);function IN(t){const e=BigInt(10),i=BigInt(20),s=BigInt(40),r=BigInt(80),n=vh,o=t*t%n*t%n,a=Li(o,Fd,n)*o%n,l=Li(a,yN,n)*t%n,c=Li(l,bN,n)*l%n,h=Li(c,e,n)*c%n,u=Li(h,i,n)*h%n,d=Li(u,s,n)*u%n,p=Li(d,r,n)*d%n,g=Li(p,r,n)*d%n,f=Li(g,e,n)*c%n;return{pow_p_5_8:Li(f,Fd,n)*t%n,b2:o}}function EN(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const bh=wN({P:vh,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=vh,{pow_p_5_8:i,b2:s}=IN(t);return Ew(Li(i,vN,e)*s,e)},adjustScalarBytes:EN,randomBytes:da}),Nw="base10",Bt="base16",Rs="base64pad",no="base64url",pa="utf8",Aw=0,gs=1,ga=2,NN=0,Gd=1,ko=12,Cu=32;function AN(){const t=bh.utils.randomPrivateKey(),e=bh.getPublicKey(t);return{privateKey:Ne(t,Bt),publicKey:Ne(e,Bt)}}function Ih(){const t=da(Cu);return Ne(t,Bt)}function _N(t,e){const i=bh.getSharedSecret(Ge(t,Bt),Ge(e,Bt)),s=eN(Kc,i,void 0,void 0,Cu);return Ne(s,Bt)}function nc(t){const e=Kc(Ge(t,Bt));return Ne(e,Bt)}function ds(t){const e=Kc(Ge(t,pa));return Ne(e,Bt)}function _w(t){return Ge(`${t}`,Nw)}function fr(t){return Number(Ne(t,Nw))}function CN(t){const e=_w(typeof t.type<"u"?t.type:Aw);if(fr(e)===gs&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof t.senderPublicKey<"u"?Ge(t.senderPublicKey,Bt):void 0,s=typeof t.iv<"u"?Ge(t.iv,Bt):da(ko),r=Ge(t.symKey,Bt),n=ww(r,s).encrypt(Ge(t.message,pa));return Cw({type:e,sealed:n,iv:s,senderPublicKey:i,encoding:t.encoding})}function SN(t){const e=Ge(t.symKey,Bt),{sealed:i,iv:s}=Fo(t),r=ww(e,s).decrypt(i);if(r===null)throw new Error("Failed to decrypt");return Ne(r,pa)}function PN(t,e){const i=_w(ga),s=da(ko),r=Ge(t,pa);return Cw({type:i,sealed:r,iv:s,encoding:e})}function TN(t,e){const{sealed:i}=Fo({encoded:t,encoding:e});return Ne(i,pa)}function Cw(t){const{encoding:e=Rs}=t;if(fr(t.type)===ga)return Ne(Pn([t.type,t.sealed]),e);if(fr(t.type)===gs){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ne(Pn([t.type,t.senderPublicKey,t.iv,t.sealed]),e)}return Ne(Pn([t.type,t.iv,t.sealed]),e)}function Fo(t){const{encoded:e,encoding:i=Rs}=t,s=Ge(e,i),r=s.slice(NN,Gd),n=Gd;if(fr(r)===gs){const c=n+Cu,h=c+ko,u=s.slice(n,c),d=s.slice(c,h),p=s.slice(h);return{type:r,sealed:p,iv:d,senderPublicKey:u}}if(fr(r)===ga){const c=s.slice(n),h=da(ko);return{type:r,sealed:c,iv:h}}const o=n+ko,a=s.slice(n,o),l=s.slice(o);return{type:r,sealed:l,iv:a}}function MN(t,e){const i=Fo({encoded:t,encoding:e==null?void 0:e.encoding});return Sw({type:fr(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?Ne(i.senderPublicKey,Bt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Sw(t){const e=(t==null?void 0:t.type)||Aw;if(e===gs){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Yd(t){return t.type===gs&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Qd(t){return t.type===ga}function ON(t){return new Ym.ec("p256").keyFromPublic({x:N.Buffer.from(t.x,"base64").toString("hex"),y:N.Buffer.from(t.y,"base64").toString("hex")},"hex")}function xN(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const i=e.length%4;return i>0&&(e+="=".repeat(4-i)),e}function kN(t){return N.Buffer.from(xN(t),"base64")}function DN(t,e){const[i,s,r]=t.split("."),n=kN(r);if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32).toString("hex"),a=n.slice(32,64).toString("hex"),l=`${i}.${s}`,c=Kc(l),h=ON(e),u=Ne(c,Bt);if(!h.verify(u,{r:o,s:a}))throw new Error("Invalid signature");return kn(t).payload}const jN="irn";function _c(t){return(t==null?void 0:t.relay)||{protocol:jN}}function _o(t){const e=Cm[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function RN(t,e="-"){const i={},s="relay"+e;return Object.keys(t).forEach(r=>{if(r.startsWith(s)){const n=r.replace(s,""),o=t[r];i[n]=o}}),i}function Zd(t){if(!t.includes("wc:")){const c=rw(t);c!=null&&c.includes("wc:")&&(t=c)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),i=t.indexOf("?")!==-1?t.indexOf("?"):void 0,s=t.substring(0,e),r=t.substring(e+1,i).split("@"),n=typeof i<"u"?t.substring(i):"",o=new URLSearchParams(n),a={};o.forEach((c,h)=>{a[h]=c});const l=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:s,topic:UN(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:RN(a),methods:l,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function UN(t){return t.startsWith("//")?t.substring(2):t}function LN(t,e="-"){const i="relay",s={};return Object.keys(t).forEach(r=>{const n=r,o=i+e+n;t[n]&&(s[o]=t[n])}),s}function Jd(t){const e=new URLSearchParams,i=LN(t.relay);Object.keys(i).sort().forEach(r=>{e.set(r,i[r])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const s=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${s}`}function Da(t,e,i){return`${t}?wc_ev=${i}&topic=${e}`}function Gn(t){const e=[];return t.forEach(i=>{const[s,r]=i.split(":");e.push(`${s}:${r}`)}),e}function zN(t){const e=[];return Object.values(t).forEach(i=>{e.push(...Gn(i.accounts))}),e}function $N(t,e){const i=[];return Object.values(t).forEach(s=>{Gn(s.accounts).includes(e)&&i.push(...s.methods)}),i}function qN(t,e){const i=[];return Object.values(t).forEach(s=>{Gn(s.accounts).includes(e)&&i.push(...s.events)}),i}function Su(t){return t.includes(":")}function Co(t){return Su(t)?t.split(":")[0]:t}function BN(t){const e={};return t==null||t.forEach(i=>{var s;const[r,n]=i.split(":");e[r]||(e[r]={accounts:[],chains:[],events:[],methods:[]}),e[r].accounts.push(i),(s=e[r].chains)==null||s.push(`${r}:${n}`)}),e}function Xd(t,e){e=e.map(s=>s.replace("did:pkh:",""));const i=BN(e);for(const[s,r]of Object.entries(i))r.methods?r.methods=sc(r.methods,t):r.methods=t,r.events=["chainChanged","accountsChanged"];return i}const HN={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},VN={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function j(t,e){const{message:i,code:s}=VN[t];return{message:e?`${i} ${e}`:i,code:s}}function Me(t,e){const{message:i,code:s}=HN[t];return{message:e?`${i} ${e}`:i,code:s}}function mr(t,e){return!!Array.isArray(t)}function Go(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ri(t){return typeof t>"u"}function st(t,e){return e&&ri(t)?!0:typeof t=="string"&&!!t.trim().length}function Pu(t,e){return typeof t=="number"&&!isNaN(t)}function WN(t,e){const{requiredNamespaces:i}=e,s=Object.keys(t.namespaces),r=Object.keys(i);let n=!0;return lr(r,s)?(s.forEach(o=>{const{accounts:a,methods:l,events:c}=t.namespaces[o],h=Gn(a),u=i[o];(!lr(Zm(o,u),h)||!lr(u.methods,l)||!lr(u.events,c))&&(n=!1)}),n):!1}function Cc(t){return st(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function KN(t){if(st(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const i=e[0]+":"+e[1];return!!e[2]&&Cc(i)}}return!1}function FN(t){function e(i){try{return typeof new URL(i)<"u"}catch{return!1}}try{if(st(t,!1)){if(e(t))return!0;const i=rw(t);return e(i)}}catch{}return!1}function GN(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function YN(t){return t==null?void 0:t.topic}function QN(t,e){let i=null;return st(t==null?void 0:t.publicKey,!1)||(i=j("MISSING_OR_INVALID",`${e} controller public key should be a string`)),i}function ep(t){let e=!0;return mr(t)?t.length&&(e=t.every(i=>st(i,!1))):e=!1,e}function ZN(t,e,i){let s=null;return mr(e)&&e.length?e.forEach(r=>{s||Cc(r)||(s=Me("UNSUPPORTED_CHAINS",`${i}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):Cc(t)||(s=Me("UNSUPPORTED_CHAINS",`${i}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function JN(t,e,i){let s=null;return Object.entries(t).forEach(([r,n])=>{if(s)return;const o=ZN(r,Zm(r,n),`${e} ${i}`);o&&(s=o)}),s}function XN(t,e){let i=null;return mr(t)?t.forEach(s=>{i||KN(s)||(i=Me("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):i=Me("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function eA(t,e){let i=null;return Object.values(t).forEach(s=>{if(i)return;const r=XN(s==null?void 0:s.accounts,`${e} namespace`);r&&(i=r)}),i}function tA(t,e){let i=null;return ep(t==null?void 0:t.methods)?ep(t==null?void 0:t.events)||(i=Me("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):i=Me("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),i}function Pw(t,e){let i=null;return Object.values(t).forEach(s=>{if(i)return;const r=tA(s,`${e}, namespace`);r&&(i=r)}),i}function iA(t,e,i){let s=null;if(t&&Go(t)){const r=Pw(t,e);r&&(s=r);const n=JN(t,e,i);n&&(s=n)}else s=j("MISSING_OR_INVALID",`${e}, ${i} should be an object with data`);return s}function bl(t,e){let i=null;if(t&&Go(t)){const s=Pw(t,e);s&&(i=s);const r=eA(t,e);r&&(i=r)}else i=j("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return i}function Tw(t){return st(t.protocol,!0)}function sA(t,e){let i=!1;return t?t&&mr(t)&&t.length&&t.forEach(s=>{i=Tw(s)}):i=!0,i}function rA(t){return typeof t=="number"}function ti(t){return typeof t<"u"&&typeof t!==null}function nA(t){return!(!t||typeof t!="object"||!t.code||!Pu(t.code)||!t.message||!st(t.message,!1))}function oA(t){return!(ri(t)||!st(t.method,!1))}function aA(t){return!(ri(t)||ri(t.result)&&ri(t.error)||!Pu(t.id)||!st(t.jsonrpc,!1))}function cA(t){return!(ri(t)||!st(t.name,!1))}function tp(t,e){return!(!Cc(e)||!zN(t).includes(e))}function lA(t,e,i){return st(i,!1)?$N(t,e).includes(i):!1}function hA(t,e,i){return st(i,!1)?qN(t,e).includes(i):!1}function ip(t,e,i){let s=null;const r=uA(t),n=dA(e),o=Object.keys(r),a=Object.keys(n),l=sp(Object.keys(t)),c=sp(Object.keys(e)),h=l.filter(u=>!c.includes(u));return h.length&&(s=j("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),lr(o,a)||(s=j("NON_CONFORMING_NAMESPACES",`${i} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||s)return;const d=Gn(e[u].accounts);d.includes(u)||(s=j("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${d.toString()}`))}),o.forEach(u=>{s||(lr(r[u].methods,n[u].methods)?lr(r[u].events,n[u].events)||(s=j("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${u}`)):s=j("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${u}`))}),s}function uA(t){const e={};return Object.keys(t).forEach(i=>{var s;i.includes(":")?e[i]=t[i]:(s=t[i].chains)==null||s.forEach(r=>{e[r]={methods:t[i].methods,events:t[i].events}})}),e}function sp(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function dA(t){const e={};return Object.keys(t).forEach(i=>{if(i.includes(":"))e[i]=t[i];else{const s=Gn(t[i].accounts);s==null||s.forEach(r=>{e[r]={accounts:t[i].accounts.filter(n=>n.includes(`${r}:`)),methods:t[i].methods,events:t[i].events}})}}),e}function pA(t,e){return Pu(t)&&t<=e.max&&t>=e.min}function rp(){const t=ua();return new Promise(e=>{switch(t){case gi.browser:e(gA());break;case gi.reactNative:e(fA());break;case gi.node:e(mA());break;default:e(!0)}})}function gA(){return ha()&&(navigator==null?void 0:navigator.onLine)}async function fA(){if(Fs()&&typeof N.global<"u"&&N.global!=null&&N.global.NetInfo){const t=await(N.global==null?void 0:N.global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function mA(){return!0}function wA(t){switch(ua()){case gi.browser:yA(t);break;case gi.reactNative:vA(t);break}}function yA(t){!Fs()&&ha()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function vA(t){var e;Fs()&&typeof N.global<"u"&&N.global!=null&&N.global.NetInfo&&((e=N.global)==null||e.NetInfo.addEventListener(i=>t(i==null?void 0:i.isConnected)))}const Il={};let oo=class{static get(t){return Il[t]}static set(t,e){Il[t]=e}static delete(t){delete Il[t]}},Ye=class extends mb{constructor(t){super(t),this.events=new xt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async request(t,e){return this.requestStrict(Kt(t.method,t.params||[],t.id||pi().toString()),e)}async requestStrict(t,e){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(r){s(r)}this.events.on(`${t.id}`,r=>{it(r)?s(r.error):i(r.result)});try{await this.connection.send(t,e)}catch(r){s(r)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Nr(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const bA=()=>typeof WebSocket<"u"?WebSocket:typeof N.global<"u"&&typeof N.global.WebSocket<"u"?N.global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),IA=()=>typeof WebSocket<"u"||typeof N.global<"u"&&typeof N.global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",np=t=>t.split("?")[0],op=10,EA=bA();let Mw=class{constructor(t){if(this.url=t,this.events=new xt.EventEmitter,this.registering=!1,!rd(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,e)=>{if(typeof this.socket>"u"){e(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ar(t))}catch(e){this.onError(t.id,e)}}register(t=this.url){if(!rd(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const e=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=e||this.events.listenerCount("open")>=e)&&this.events.setMaxListeners(e+1),new Promise((i,s)=>{this.events.once("register_error",r=>{this.resetMaxListeners(),s(r)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=t,this.registering=!0,new Promise((e,i)=>{const s=wb.isReactNative()?void 0:{rejectUnauthorized:!yb(t)},r=new EA(t,[],s);IA()?r.onerror=n=>{const o=n;i(this.emitError(o.error))}:r.on("error",n=>{i(this.emitError(n))}),r.onopen=()=>{this.onOpen(r),e(r)}})}onOpen(t){t.onmessage=e=>this.onPayload(e),t.onclose=e=>this.onClose(e),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const e=typeof t.data=="string"?ws(t.data):t.data;this.events.emit("payload",e)}onError(t,e){const i=this.parseError(e),s=i.message||i.toString(),r=na(t,s);this.events.emit("payload",r)}parseError(t,e=this.url){return vb(t,np(e),"WS")}resetMaxListeners(){this.events.getMaxListeners()>op&&this.events.setMaxListeners(op)}emitError(t){const e=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${np(this.url)}`));return this.events.emit("register_error",e),e}};const Ow="wc",xw=2,Eh="core",ts=`${Ow}@2:${Eh}:`,NA={logger:"error"},AA={database:":memory:"},_A="crypto",ap="client_ed25519_seed",CA=E.ONE_DAY,SA="keychain",PA="0.3",TA="messages",MA="0.3",cp=E.SIX_HOURS,OA="publisher",kw="irn",xA="error",Dw="wss://relay.walletconnect.org",kA="relayer",bt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},DA="_subscription",bi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},jA=.1,Nh="2.19.0",Ve={link_mode:"link_mode",relay:"relay"},RA="0.3",UA="WALLETCONNECT_CLIENT_ID",lp="WALLETCONNECT_LINK_MODE_APPS",li={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},LA="subscription",zA="0.3",$A=E.FIVE_SECONDS*1e3,qA="pairing",BA="0.3",ao={wc_pairingDelete:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:E.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:E.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:E.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:E.ONE_DAY,prompt:!1,tag:0},res:{ttl:E.ONE_DAY,prompt:!1,tag:0}}},nr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Oi={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},HA="history",VA="0.3",WA="expirer",_i={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},KA="0.3",FA="verify-api",GA="https://verify.walletconnect.com",jw="https://verify.walletconnect.org",Do=jw,YA=`${Do}/v3`,QA=[GA,jw],ZA="echo",JA="https://echo.walletconnect.com",Qi={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},hs={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},xi={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Qs={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Zs={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},co={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},XA=.1,e_="event-client",t_=86400,i_="https://pulse.walletconnect.org/batch";function s_(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var r=0;r<t.length;r++){var n=t.charAt(r),o=n.charCodeAt(0);if(i[o]!==255)throw new TypeError(n+" is ambiguous");i[o]=r}var a=t.length,l=t.charAt(0),c=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var f=0,w=0,m=0,y=g.length;m!==y&&g[m]===0;)m++,f++;for(var v=(y-m)*h+1>>>0,I=new Uint8Array(v);m!==y;){for(var S=g[m],T=0,P=v-1;(S!==0||T<w)&&P!==-1;P--,T++)S+=256*I[P]>>>0,I[P]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=T,m++}for(var _=v-w;_!==v&&I[_]===0;)_++;for(var A=l.repeat(f);_<v;++_)A+=t.charAt(I[_]);return A}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var f=0;if(g[f]!==" "){for(var w=0,m=0;g[f]===l;)w++,f++;for(var y=(g.length-f)*c+1>>>0,v=new Uint8Array(y);g[f];){var I=i[g.charCodeAt(f)];if(I===255)return;for(var S=0,T=y-1;(I!==0||S<m)&&T!==-1;T--,S++)I+=a*v[T]>>>0,v[T]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");m=S,f++}if(g[f]!==" "){for(var P=y-m;P!==y&&v[P]===0;)P++;for(var _=new Uint8Array(w+(y-P)),A=w;P!==y;)_[A++]=v[P++];return _}}}function p(g){var f=d(g);if(f)return f;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:d,decode:p}}var r_=s_,n_=r_;const Rw=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},o_=t=>new TextEncoder().encode(t),a_=t=>new TextDecoder().decode(t);let c_=class{constructor(t,e,i){this.name=t,this.prefix=e,this.baseEncode=i}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},l_=class{constructor(t,e,i){if(this.name=t,this.prefix=e,e.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=i}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Uw(this,t)}},h_=class{constructor(t){this.decoders=t}or(t){return Uw(this,t)}decode(t){const e=t[0],i=this.decoders[e];if(i)return i.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Uw=(t,e)=>new h_({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let u_=class{constructor(t,e,i,s){this.name=t,this.prefix=e,this.baseEncode=i,this.baseDecode=s,this.encoder=new c_(t,e,i),this.decoder=new l_(t,e,s)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};const Fc=({name:t,prefix:e,encode:i,decode:s})=>new u_(t,e,i,s),fa=({prefix:t,name:e,alphabet:i})=>{const{encode:s,decode:r}=n_(i,e);return Fc({prefix:t,name:e,encode:s,decode:n=>Rw(r(n))})},d_=(t,e,i,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*i/8|0);let a=0,l=0,c=0;for(let h=0;h<n;++h){const u=r[t[h]];if(u===void 0)throw new SyntaxError(`Non-${s} character`);l=l<<i|u,a+=i,a>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=i||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return o},p_=(t,e,i)=>{const s=e[e.length-1]==="=",r=(1<<i)-1;let n="",o=0,a=0;for(let l=0;l<t.length;++l)for(a=a<<8|t[l],o+=8;o>i;)o-=i,n+=e[r&a>>o];if(o&&(n+=e[r&a<<i-o]),s)for(;n.length*i&7;)n+="=";return n},Dt=({name:t,prefix:e,bitsPerChar:i,alphabet:s})=>Fc({prefix:e,name:t,encode(r){return p_(r,s,i)},decode(r){return d_(r,s,i,t)}}),g_=Fc({prefix:"\0",name:"identity",encode:t=>a_(t),decode:t=>o_(t)});var f_=Object.freeze({__proto__:null,identity:g_});const m_=Dt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var w_=Object.freeze({__proto__:null,base2:m_});const y_=Dt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var v_=Object.freeze({__proto__:null,base8:y_});const b_=fa({prefix:"9",name:"base10",alphabet:"0123456789"});var I_=Object.freeze({__proto__:null,base10:b_});const E_=Dt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N_=Dt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var A_=Object.freeze({__proto__:null,base16:E_,base16upper:N_});const __=Dt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),C_=Dt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),S_=Dt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),P_=Dt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),T_=Dt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M_=Dt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),O_=Dt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),x_=Dt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),k_=Dt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var D_=Object.freeze({__proto__:null,base32:__,base32upper:C_,base32pad:S_,base32padupper:P_,base32hex:T_,base32hexupper:M_,base32hexpad:O_,base32hexpadupper:x_,base32z:k_});const j_=fa({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),R_=fa({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var U_=Object.freeze({__proto__:null,base36:j_,base36upper:R_});const L_=fa({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),z_=fa({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var $_=Object.freeze({__proto__:null,base58btc:L_,base58flickr:z_});const q_=Dt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),B_=Dt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),H_=Dt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),V_=Dt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var W_=Object.freeze({__proto__:null,base64:q_,base64pad:B_,base64url:H_,base64urlpad:V_});const Lw=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),K_=Lw.reduce((t,e,i)=>(t[i]=e,t),[]),F_=Lw.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function G_(t){return t.reduce((e,i)=>(e+=K_[i],e),"")}function Y_(t){const e=[];for(const i of t){const s=F_[i.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(s)}return new Uint8Array(e)}const Q_=Fc({prefix:"🚀",name:"base256emoji",encode:G_,decode:Y_});var Z_=Object.freeze({__proto__:null,base256emoji:Q_}),J_=zw,hp=128,X_=-128,eC=Math.pow(2,31);function zw(t,e,i){e=e||[],i=i||0;for(var s=i;t>=eC;)e[i++]=t&255|hp,t/=128;for(;t&X_;)e[i++]=t&255|hp,t>>>=7;return e[i]=t|0,zw.bytes=i-s+1,e}var tC=Ah,iC=128,up=127;function Ah(t,s){var i=0,s=s||0,r=0,n=s,o,a=t.length;do{if(n>=a)throw Ah.bytes=0,new RangeError("Could not decode varint");o=t[n++],i+=r<28?(o&up)<<r:(o&up)*Math.pow(2,r),r+=7}while(o>=iC);return Ah.bytes=n-s,i}var sC=Math.pow(2,7),rC=Math.pow(2,14),nC=Math.pow(2,21),oC=Math.pow(2,28),aC=Math.pow(2,35),cC=Math.pow(2,42),lC=Math.pow(2,49),hC=Math.pow(2,56),uC=Math.pow(2,63),dC=function(t){return t<sC?1:t<rC?2:t<nC?3:t<oC?4:t<aC?5:t<cC?6:t<lC?7:t<hC?8:t<uC?9:10},pC={encode:J_,decode:tC,encodingLength:dC},$w=pC;const dp=(t,e,i=0)=>($w.encode(t,e,i),e),pp=t=>$w.encodingLength(t),_h=(t,e)=>{const i=e.byteLength,s=pp(t),r=s+pp(i),n=new Uint8Array(r+i);return dp(t,n,0),dp(i,n,s),n.set(e,r),new gC(t,i,e,n)};let gC=class{constructor(t,e,i,s){this.code=t,this.size=e,this.digest=i,this.bytes=s}};const qw=({name:t,code:e,encode:i})=>new fC(t,e,i);let fC=class{constructor(t,e,i){this.name=t,this.code=e,this.encode=i}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?_h(this.code,e):e.then(i=>_h(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Bw=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),mC=qw({name:"sha2-256",code:18,encode:Bw("SHA-256")}),wC=qw({name:"sha2-512",code:19,encode:Bw("SHA-512")});var yC=Object.freeze({__proto__:null,sha256:mC,sha512:wC});const Hw=0,vC="identity",Vw=Rw,bC=t=>_h(Hw,Vw(t)),IC={code:Hw,name:vC,encode:Vw,digest:bC};var EC=Object.freeze({__proto__:null,identity:IC});new TextEncoder,new TextDecoder;const gp={...f_,...w_,...v_,...I_,...A_,...D_,...U_,...$_,...W_,...Z_};({...yC,...EC});function NC(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Ww(t,e,i,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:s}}}const fp=Ww("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),El=Ww("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=NC(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),AC={utf8:fp,"utf-8":fp,hex:gp.base16,latin1:El,ascii:El,binary:El,...gp};function _C(t,e="utf8"){const i=AC[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}var CC=Object.defineProperty,SC=(t,e,i)=>e in t?CC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Hi=(t,e,i)=>SC(t,typeof e!="symbol"?e+"":e,i);let PC=class{constructor(t,e){this.core=t,this.logger=e,Hi(this,"keychain",new Map),Hi(this,"name",SA),Hi(this,"version",PA),Hi(this,"initialized",!1),Hi(this,"storagePrefix",ts),Hi(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),Hi(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Hi(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),Hi(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(r)}return s}),Hi(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=t,this.logger=Ae(e,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,ew(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?tw(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}};var TC=Object.defineProperty,MC=(t,e,i)=>e in t?TC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,At=(t,e,i)=>MC(t,typeof e!="symbol"?e+"":e,i);let OC=class{constructor(t,e,i){this.core=t,this.logger=e,At(this,"name",_A),At(this,"keychain"),At(this,"randomSessionIdentifier",Ih()),At(this,"initialized",!1),At(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),At(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),At(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),r=bc(s);return Sm(r.publicKey)}),At(this,"generateKeyPair",()=>{this.isInitialized();const s=AN();return this.setPrivateKey(s.publicKey,s.privateKey)}),At(this,"signJWT",async s=>{this.isInitialized();const r=await this.getClientSeed(),n=bc(r),o=this.randomSessionIdentifier;return await Pm(o,s,CA,n)}),At(this,"generateSharedKey",(s,r,n)=>{this.isInitialized();const o=this.getPrivateKey(s),a=_N(o,r);return this.setSymKey(a,n)}),At(this,"setSymKey",async(s,r)=>{this.isInitialized();const n=r||nc(s);return await this.keychain.set(n,s),n}),At(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),At(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),At(this,"encode",async(s,r,n)=>{this.isInitialized();const o=Sw(n),a=Ar(r);if(Qd(o))return PN(a,n==null?void 0:n.encoding);if(Yd(o)){const u=o.senderPublicKey,d=o.receiverPublicKey;s=await this.generateSharedKey(u,d)}const l=this.getSymKey(s),{type:c,senderPublicKey:h}=o;return CN({type:c,symKey:l,message:a,senderPublicKey:h,encoding:n==null?void 0:n.encoding})}),At(this,"decode",async(s,r,n)=>{this.isInitialized();const o=MN(r,n);if(Qd(o)){const a=TN(r,n==null?void 0:n.encoding);return ws(a)}if(Yd(o)){const a=o.receiverPublicKey,l=o.senderPublicKey;s=await this.generateSharedKey(a,l)}try{const a=this.getSymKey(s),l=SN({symKey:a,encoded:r,encoding:n==null?void 0:n.encoding});return ws(l)}catch(a){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(a)}}),At(this,"getPayloadType",(s,r=Rs)=>{const n=Fo({encoded:s,encoding:r});return fr(n.type)}),At(this,"getPayloadSenderPublicKey",(s,r=Rs)=>{const n=Fo({encoded:s,encoding:r});return n.senderPublicKey?Ne(n.senderPublicKey,Bt):void 0}),this.core=t,this.logger=Ae(e,this.name),this.keychain=i||new PC(this.core,this.logger)}get context(){return qe(this.logger)}async setPrivateKey(t,e){return await this.keychain.set(t,e),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(ap)}catch{t=Ih(),await this.keychain.set(ap,t)}return _C(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}};var xC=Object.defineProperty,kC=(t,e,i)=>e in t?xC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Vi=(t,e,i)=>kC(t,typeof e!="symbol"?e+"":e,i);let DC=class extends N0{constructor(t,e){super(t,e),this.logger=t,this.core=e,Vi(this,"messages",new Map),Vi(this,"name",TA),Vi(this,"version",MA),Vi(this,"initialized",!1),Vi(this,"storagePrefix",ts),Vi(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Vi(this,"set",async(i,s)=>{this.isInitialized();const r=ds(s);let n=this.messages.get(i);return typeof n>"u"&&(n={}),typeof n[r]<"u"||(n[r]=s,this.messages.set(i,n),await this.persist()),r}),Vi(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),Vi(this,"has",(i,s)=>{this.isInitialized();const r=this.get(i),n=ds(s);return typeof r[n]<"u"}),Vi(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()}),this.logger=Ae(t,this.name),this.core=e}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,ew(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?tw(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}};var jC=Object.defineProperty,RC=Object.defineProperties,UC=Object.getOwnPropertyDescriptors,mp=Object.getOwnPropertySymbols,LC=Object.prototype.hasOwnProperty,zC=Object.prototype.propertyIsEnumerable,Ch=(t,e,i)=>e in t?jC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ja=(t,e)=>{for(var i in e||(e={}))LC.call(e,i)&&Ch(t,i,e[i]);if(mp)for(var i of mp(e))zC.call(e,i)&&Ch(t,i,e[i]);return t},Nl=(t,e)=>RC(t,UC(e)),ki=(t,e,i)=>Ch(t,typeof e!="symbol"?e+"":e,i);let $C=class extends A0{constructor(t,e){super(t,e),this.relayer=t,this.logger=e,ki(this,"events",new xt.EventEmitter),ki(this,"name",OA),ki(this,"queue",new Map),ki(this,"publishTimeout",E.toMiliseconds(E.ONE_MINUTE)),ki(this,"initialPublishTimeout",E.toMiliseconds(E.ONE_SECOND*15)),ki(this,"needsTransportRestart",!1),ki(this,"publish",async(i,s,r)=>{var n;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:r}});const o=(r==null?void 0:r.ttl)||cp,a=_c(r),l=(r==null?void 0:r.prompt)||!1,c=(r==null?void 0:r.tag)||0,h=(r==null?void 0:r.id)||pi().toString(),u={topic:i,message:s,opts:{ttl:o,relay:a,prompt:l,tag:c,id:h,attestation:r==null?void 0:r.attestation,tvf:r==null?void 0:r.tvf}},d=`Failed to publish payload, please try again. id:${h} tag:${c}`;try{const p=new Promise(async g=>{const f=({id:m})=>{u.opts.id===m&&(this.removeRequestFromQueue(m),this.relayer.events.removeListener(bt.publish,f),g(u))};this.relayer.events.on(bt.publish,f);const w=js(new Promise((m,y)=>{this.rpcPublish({topic:i,message:s,ttl:o,prompt:l,tag:c,id:h,attestation:r==null?void 0:r.attestation,tvf:r==null?void 0:r.tvf}).then(m).catch(v=>{this.logger.warn(v,v==null?void 0:v.message),y(v)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${c}`);try{await w,this.events.removeListener(bt.publish,f)}catch(m){this.queue.set(h,Nl(ja({},u),{attempt:1})),this.logger.warn(m,m==null?void 0:m.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:i,message:s,opts:r}}),await js(p,this.publishTimeout,d)}catch(p){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(p),(n=r==null?void 0:r.internal)!=null&&n.throwOnFailedPublish)throw p}finally{this.queue.delete(h)}}),ki(this,"on",(i,s)=>{this.events.on(i,s)}),ki(this,"once",(i,s)=>{this.events.once(i,s)}),ki(this,"off",(i,s)=>{this.events.off(i,s)}),ki(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=t,this.logger=Ae(e,this.name),this.registerEventListeners()}get context(){return qe(this.logger)}async rpcPublish(t){var e,i,s,r;const{topic:n,message:o,ttl:a=cp,prompt:l,tag:c,id:h,attestation:u,tvf:d}=t,p={method:_o(_c().protocol).publish,params:ja({topic:n,message:o,ttl:a,prompt:l,tag:c,attestation:u},d),id:h};ri((e=p.params)==null?void 0:e.prompt)&&((i=p.params)==null||delete i.prompt),ri((s=p.params)==null?void 0:s.tag)&&((r=p.params)==null||delete r.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(bt.publish,t),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async(t,e)=>{const i=t.attempt+1;this.queue.set(e,Nl(ja({},t),{attempt:i}));const{topic:s,message:r,opts:n,attestation:o}=t;this.logger.warn({},`Publisher: queue->publishing: ${t.opts.id}, tag: ${t.opts.tag}, attempt: ${i}`),await this.rpcPublish(Nl(ja({},t),{topic:s,message:r,ttl:n.ttl,prompt:n.prompt,tag:n.tag,id:n.id,attestation:o,tvf:n.tvf})),this.logger.warn({},`Publisher: queue->published: ${t.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(qi.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(bt.connection_stalled);return}this.checkQueue()}),this.relayer.on(bt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}};var qC=Object.defineProperty,BC=(t,e,i)=>e in t?qC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Lr=(t,e,i)=>BC(t,typeof e!="symbol"?e+"":e,i);let HC=class{constructor(){Lr(this,"map",new Map),Lr(this,"set",(t,e)=>{const i=this.get(t);this.exists(t,e)||this.map.set(t,[...i,e])}),Lr(this,"get",t=>this.map.get(t)||[]),Lr(this,"exists",(t,e)=>this.get(t).includes(e)),Lr(this,"delete",(t,e)=>{if(typeof e>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const i=this.get(t);if(!this.exists(t,e))return;const s=i.filter(r=>r!==e);if(!s.length){this.map.delete(t);return}this.map.set(t,s)}),Lr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var VC=Object.defineProperty,WC=Object.defineProperties,KC=Object.getOwnPropertyDescriptors,wp=Object.getOwnPropertySymbols,FC=Object.prototype.hasOwnProperty,GC=Object.prototype.propertyIsEnumerable,Sh=(t,e,i)=>e in t?VC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,lo=(t,e)=>{for(var i in e||(e={}))FC.call(e,i)&&Sh(t,i,e[i]);if(wp)for(var i of wp(e))GC.call(e,i)&&Sh(t,i,e[i]);return t},Al=(t,e)=>WC(t,KC(e)),Te=(t,e,i)=>Sh(t,typeof e!="symbol"?e+"":e,i);let YC=class extends S0{constructor(t,e){super(t,e),this.relayer=t,this.logger=e,Te(this,"subscriptions",new Map),Te(this,"topicMap",new HC),Te(this,"events",new xt.EventEmitter),Te(this,"name",LA),Te(this,"version",zA),Te(this,"pending",new Map),Te(this,"cached",[]),Te(this,"initialized",!1),Te(this,"pendingSubscriptionWatchLabel","pending_sub_watch_label"),Te(this,"pollingInterval",20),Te(this,"storagePrefix",ts),Te(this,"subscribeTimeout",E.toMiliseconds(E.ONE_MINUTE)),Te(this,"initialSubscribeTimeout",E.toMiliseconds(E.ONE_SECOND*15)),Te(this,"clientId"),Te(this,"batchSubscribeTopicsLimit",500),Te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Te(this,"subscribe",async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const r=_c(s),n={topic:i,relay:r,transportType:s==null?void 0:s.transportType};this.pending.set(i,n);const o=await this.rpcSubscribe(i,r,s);return typeof o=="string"&&(this.onSubscribe(o,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),o}catch(r){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(r),r}}),Te(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),Te(this,"isSubscribed",async i=>{if(this.topics.includes(i))return!0;const s=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((r,n)=>{const o=new E.Watch;o.start(s);const a=setInterval(()=>{(!this.pending.has(i)&&this.topics.includes(i)||this.cached.some(l=>l.topic===i))&&(clearInterval(a),o.stop(s),r(!0)),o.elapsed(s)>=$A&&(clearInterval(a),o.stop(s),n(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)}),Te(this,"on",(i,s)=>{this.events.on(i,s)}),Te(this,"once",(i,s)=>{this.events.once(i,s)}),Te(this,"off",(i,s)=>{this.events.off(i,s)}),Te(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),Te(this,"start",async()=>{await this.onConnect()}),Te(this,"stop",async()=>{await this.onDisconnect()}),Te(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Te(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),Te(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(qi.pulse,async()=>{await this.checkPending()}),this.events.on(li.created,async i=>{const s=li.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(li.deleted,async i=>{const s=li.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=t,this.logger=Ae(e,this.name),this.clientId=""}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(t,e){let i=!1;try{i=this.getSubscription(t).topic===e}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,e){const i=this.topicMap.get(t);await Promise.all(i.map(async s=>await this.unsubscribeById(t,s,e)))}async unsubscribeById(t,e,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:e,opts:i}});try{const s=_c(i);await this.restartToComplete({topic:t,id:e,relay:s}),await this.rpcUnsubscribe(t,e,s);const r=Me("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,e,r),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:e,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(t,e,i){var s;(!i||(i==null?void 0:i.transportType)===Ve.relay)&&await this.restartToComplete({topic:t,id:t,relay:e});const r={method:_o(e.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});const n=(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;try{const o=await this.getSubscriptionId(t);if((i==null?void 0:i.transportType)===Ve.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(r).catch(c=>this.logger.warn(c))},E.toMiliseconds(E.ONE_SECOND)),o;const a=new Promise(async c=>{const h=u=>{u.topic===t&&(this.events.removeListener(li.created,h),c(u.id))};this.events.on(li.created,h);try{const u=await js(new Promise((d,p)=>{this.relayer.request(r).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),p(g)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${t} failed, please try again`);this.events.removeListener(li.created,h),c(u)}catch{}}),l=await js(a,this.subscribeTimeout,`Subscribing to ${t} failed, please try again`);if(!l&&n)throw new Error(`Subscribing to ${t} failed, please try again`);return l?o:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(bt.connection_stalled),n)throw o}return null}async rpcBatchSubscribe(t){if(!t.length)return;const e=t[0].relay,i={method:_o(e.protocol).batchSubscribe,params:{topics:t.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await js(new Promise(s=>{this.relayer.request(i).catch(r=>this.logger.warn(r)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(bt.connection_stalled)}}async rpcBatchFetchMessages(t){if(!t.length)return;const e=t[0].relay,i={method:_o(e.protocol).batchFetchMessages,params:{topics:t.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await js(new Promise((r,n)=>{this.relayer.request(i).catch(o=>{this.logger.warn(o),n(o)}).then(r)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(bt.connection_stalled)}return s}rpcUnsubscribe(t,e,i){const s={method:_o(i.protocol).unsubscribe,params:{topic:t,id:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(t,e){this.setSubscription(t,Al(lo({},e),{id:t})),this.pending.delete(e.topic)}onBatchSubscribe(t){t.length&&t.forEach(e=>{this.setSubscription(e.id,lo({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(t,e,i){this.events.removeAllListeners(e),this.hasSubscription(e,t)&&this.deleteSubscription(e,i),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,e){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:e}),this.addSubscription(t,e)}addSubscription(t,e){this.subscriptions.set(t,lo({},e)),this.topicMap.set(e.topic,t),this.events.emit(li.created,e)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const e=this.subscriptions.get(t);if(!e){const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(i)}return e}deleteSubscription(t,e){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:e});const i=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(i.topic,t),this.events.emit(li.deleted,Al(lo({},i),{reason:e}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(li.sync)}async onRestart(){if(this.cached.length){const t=[...this.cached],e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<e;i++){const s=t.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(li.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:e}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){t.length&&(await this.rpcBatchSubscribe(t),this.onBatchSubscribe(await Promise.all(t.map(async e=>Al(lo({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(t){if(!t.length)return;this.logger.trace(`Fetching batch messages for ${t.length} subscriptions`);const e=await this.rpcBatchFetchMessages(t);e&&e.messages&&(await LI(E.toMiliseconds(E.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(e.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(t){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(t),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(t){return ds(t+await this.getClientId())}};var QC=Object.defineProperty,yp=Object.getOwnPropertySymbols,ZC=Object.prototype.hasOwnProperty,JC=Object.prototype.propertyIsEnumerable,Ph=(t,e,i)=>e in t?QC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,vp=(t,e)=>{for(var i in e||(e={}))ZC.call(e,i)&&Ph(t,i,e[i]);if(yp)for(var i of yp(e))JC.call(e,i)&&Ph(t,i,e[i]);return t},pe=(t,e,i)=>Ph(t,typeof e!="symbol"?e+"":e,i);let XC=class extends _0{constructor(t){super(t),pe(this,"protocol","wc"),pe(this,"version",2),pe(this,"core"),pe(this,"logger"),pe(this,"events",new xt.EventEmitter),pe(this,"provider"),pe(this,"messages"),pe(this,"subscriber"),pe(this,"publisher"),pe(this,"name",kA),pe(this,"transportExplicitlyClosed",!1),pe(this,"initialized",!1),pe(this,"connectionAttemptInProgress",!1),pe(this,"relayUrl"),pe(this,"projectId"),pe(this,"packageName"),pe(this,"bundleId"),pe(this,"hasExperiencedNetworkDisruption",!1),pe(this,"pingTimeout"),pe(this,"heartBeatTimeout",E.toMiliseconds(E.THIRTY_SECONDS+E.FIVE_SECONDS)),pe(this,"reconnectTimeout"),pe(this,"connectPromise"),pe(this,"reconnectInProgress",!1),pe(this,"requestsInFlight",[]),pe(this,"connectTimeout",E.toMiliseconds(E.ONE_SECOND*15)),pe(this,"request",async e=>{var i,s;this.logger.debug("Publishing Request Payload");const r=e.id||pi().toString();await this.toEstablishConnection();try{this.logger.trace({id:r,method:e.method,topic:(i=e.params)==null?void 0:i.topic},"relayer.request - publishing...");const n=`${r}:${((s=e.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(n);const o=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==n),o}catch(n){throw this.logger.debug(`Failed to Publish Request: ${r}`),n}}),pe(this,"resetPingTimeout",()=>{if(Nc())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,i,s;this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null||s.terminate()},this.heartBeatTimeout)}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}),pe(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),pe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(bt.connect)}),pe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),pe(this,"onProviderErrorHandler",e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit(bt.error,e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),pe(this,"registerProviderListeners",()=>{this.provider.on(bi.payload,this.onPayloadHandler),this.provider.on(bi.connect,this.onConnectHandler),this.provider.on(bi.disconnect,this.onDisconnectHandler),this.provider.on(bi.error,this.onProviderErrorHandler)}),this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ae(t.logger,this.name):Vn(ys({level:t.logger||xA})),this.messages=new DC(this.logger,t.core),this.subscriber=new YC(this,this.logger),this.publisher=new $C(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||Dw,this.projectId=t.projectId,NI()?this.packageName=Ed():AI()&&(this.bundleId=Ed()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(t){this.logger.warn(t,t==null?void 0:t.message)}}get context(){return qe(this.logger)}get connected(){var t,e,i;return((i=(e=(t=this.provider)==null?void 0:t.connection)==null?void 0:e.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var t,e,i;return((i=(e=(t=this.provider)==null?void 0:t.connection)==null?void 0:e.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(t,e,i){this.isInitialized(),await this.publisher.publish(t,e,i),await this.recordMessageEvent({topic:t,message:e,publishedAt:Date.now(),transportType:Ve.relay})}async subscribe(t,e){var i,s,r;this.isInitialized(),(!(e!=null&&e.transportType)||(e==null?void 0:e.transportType)==="relay")&&await this.toEstablishConnection();const n=typeof((i=e==null?void 0:e.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=e==null?void 0:e.internal)==null?void 0:s.throwOnFailedPublish;let o=((r=this.subscriber.topicMap.get(t))==null?void 0:r[0])||"",a;const l=c=>{c.topic===t&&(this.subscriber.off(li.created,l),a())};return await Promise.all([new Promise(c=>{a=c,this.subscriber.on(li.created,l)}),new Promise(async(c,h)=>{o=await this.subscriber.subscribe(t,vp({internal:{throwOnFailedPublish:n}},e)).catch(u=>{n&&h(u)})||o,c()})]),o}async unsubscribe(t,e){this.isInitialized(),await this.subscriber.unsubscribe(t,e)}on(t,e){this.events.on(t,e)}once(t,e){this.events.once(t,e)}off(t,e){this.events.off(t,e)}removeListener(t,e){this.events.removeListener(t,e)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await js(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(t){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(e,i)=>{await this.connect(t).then(e).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(t){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await rp())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(t){if((t==null?void 0:t.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const e=t.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${e.length} message events sorted`);for(const i of e)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${e.length} message events processed`)}async onLinkMessageEvent(t,e){const{topic:i}=t;if(!e.sessionExists){const s=ht(E.FIVE_MINUTES),r={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,r)}this.events.emit(bt.message,t),await this.recordMessageEvent(t)}async connect(t){await this.confirmOnlineStateOrThrow(),t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let e=1;for(;e<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${e}...`),await this.createProvider(),await new Promise(async(i,s)=>{const r=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(bi.disconnect,r),await js(new Promise((n,o)=>{this.provider.connect().then(n).catch(o)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(n=>{s(n)}).finally(()=>{this.provider.off(bi.disconnect,r),clearTimeout(this.reconnectTimeout)}),await new Promise(async(n,o)=>{const a=()=>{o(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(bi.disconnect,a),await this.subscriber.start().then(n).catch(o).finally(()=>{this.provider.off(bi.disconnect,a)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${e}`);break}await new Promise(i=>setTimeout(i,E.toMiliseconds(e*1))),e++}}startPingTimeout(){var t,e,i,s,r;if(Nc())try{(e=(t=this.provider)==null?void 0:t.connection)!=null&&e.socket&&((r=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||r.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(n){this.logger.warn(n,n==null?void 0:n.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ye(new Mw(PI({sdkVersion:Nh,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:e,message:i}=t;await this.messages.set(e,i)}async shouldIgnoreMessageEvent(t){const{topic:e,message:i}=t;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(e))return this.logger.warn(`Ignoring message for non-subscribed topic ${e}`),!0;const s=this.messages.has(e,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Wn(t)){if(!t.method.endsWith(DA))return;const e=t.params,{topic:i,message:s,publishedAt:r,attestation:n}=e.data,o={topic:i,message:s,publishedAt:r,transportType:Ve.relay,attestation:n};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(vp({type:"event",event:e.id},o)),this.events.emit(e.id,o),await this.acknowledgePayload(t),await this.onMessageEvent(o)}else Nr(t)&&this.events.emit(bt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(bt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const e=Ws(t.id,!0);await this.provider.connection.send(e)}unregisterProviderListeners(){this.provider.off(bi.payload,this.onPayloadHandler),this.provider.off(bi.connect,this.onConnectHandler),this.provider.off(bi.disconnect,this.onDisconnectHandler),this.provider.off(bi.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await rp();wA(async e=>{t!==e&&(t=e,e?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(bt.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(t=>this.logger.error(t,t==null?void 0:t.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},E.toMiliseconds(jA)))))}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}};var e1=Object.defineProperty,bp=Object.getOwnPropertySymbols,t1=Object.prototype.hasOwnProperty,i1=Object.prototype.propertyIsEnumerable,Th=(t,e,i)=>e in t?e1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ip=(t,e)=>{for(var i in e||(e={}))t1.call(e,i)&&Th(t,i,e[i]);if(bp)for(var i of bp(e))i1.call(e,i)&&Th(t,i,e[i]);return t},Gt=(t,e,i)=>Th(t,typeof e!="symbol"?e+"":e,i);let Cr=class extends C0{constructor(t,e,i,s=ts,r=void 0){super(t,e,i,s),this.core=t,this.logger=e,this.name=i,Gt(this,"map",new Map),Gt(this,"version",RA),Gt(this,"cached",[]),Gt(this,"initialized",!1),Gt(this,"getKey"),Gt(this,"storagePrefix",ts),Gt(this,"recentlyDeleted",[]),Gt(this,"recentlyDeletedLimit",200),Gt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>{this.getKey&&n!==null&&!ri(n)?this.map.set(this.getKey(n),n):GN(n)?this.map.set(n.id,n):YN(n)&&this.map.set(n.topic,n)}),this.cached=[],this.initialized=!0)}),Gt(this,"set",async(n,o)=>{this.isInitialized(),this.map.has(n)?await this.update(n,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:n,value:o}),this.map.set(n,o),await this.persist())}),Gt(this,"get",n=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:n}),this.getData(n))),Gt(this,"getAll",n=>(this.isInitialized(),n?this.values.filter(o=>Object.keys(n).every(a=>bb(o[a],n[a]))):this.values)),Gt(this,"update",async(n,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:n,update:o});const a=Ip(Ip({},this.getData(n)),o);this.map.set(n,a),await this.persist()}),Gt(this,"delete",async(n,o)=>{this.isInitialized(),this.map.has(n)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:n,reason:o}),this.map.delete(n),this.addToRecentlyDeleted(n),await this.persist())}),this.logger=Ae(e,this.name),this.storagePrefix=s,this.getKey=r}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(t){this.recentlyDeleted.push(t),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const e=this.map.get(t);if(!e){if(this.recentlyDeleted.includes(t)){const{message:s}=j("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(i),new Error(i)}return e}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:e}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}};var s1=Object.defineProperty,r1=(t,e,i)=>e in t?s1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ae=(t,e,i)=>r1(t,typeof e!="symbol"?e+"":e,i);let n1=class{constructor(t,e){this.core=t,this.logger=e,ae(this,"name",qA),ae(this,"version",BA),ae(this,"events",new Hn),ae(this,"pairings"),ae(this,"initialized",!1),ae(this,"storagePrefix",ts),ae(this,"ignoredPayloadTypes",[gs]),ae(this,"registeredMethods",[]),ae(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ae(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),ae(this,"create",async i=>{this.isInitialized();const s=Ih(),r=await this.core.crypto.setSymKey(s),n=ht(E.FIVE_MINUTES),o={protocol:kw},a={topic:r,expiry:n,relay:o,active:!1,methods:i==null?void 0:i.methods},l=Jd({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:s,relay:o,expiryTimestamp:n,methods:i==null?void 0:i.methods});return this.events.emit(nr.create,a),this.core.expirer.set(r,n),await this.pairings.set(r,a),await this.core.relayer.subscribe(r,{transportType:i==null?void 0:i.transportType}),{topic:r,uri:l}}),ae(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[Qi.pairing_started]}});this.isValidPair(i,s);const{topic:r,symKey:n,relay:o,expiryTimestamp:a,methods:l}=Zd(i.uri);s.props.properties.topic=r,s.addTrace(Qi.pairing_uri_validation_success),s.addTrace(Qi.pairing_uri_not_expired);let c;if(this.pairings.keys.includes(r)){if(c=this.pairings.get(r),s.addTrace(Qi.existing_pairing),c.active)throw s.setError(hs.active_pairing_already_exists),new Error(`Pairing already exists: ${r}. Please try again with a new connection URI.`);s.addTrace(Qi.pairing_not_expired)}const h=a||ht(E.FIVE_MINUTES),u={topic:r,relay:o,expiry:h,active:!1,methods:l};this.core.expirer.set(r,h),await this.pairings.set(r,u),s.addTrace(Qi.store_new_pairing),i.activatePairing&&await this.activate({topic:r}),this.events.emit(nr.create,u),s.addTrace(Qi.emit_inactive_pairing),this.core.crypto.keychain.has(r)||await this.core.crypto.setSymKey(n,r),s.addTrace(Qi.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(hs.no_internet_connection)}try{await this.core.relayer.subscribe(r,{relay:o})}catch(d){throw s.setError(hs.subscribe_pairing_topic_failure),d}return s.addTrace(Qi.subscribe_pairing_topic_success),u}),ae(this,"activate",async({topic:i})=>{this.isInitialized();const s=ht(E.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),ae(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const r=await this.sendRequest(s,"wc_pairingPing",{}),{done:n,resolve:o,reject:a}=tr();this.events.once(Ie("pairing_ping",r),({error:l})=>{l?a(l):o()}),await n()}}),ae(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),ae(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),ae(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ae(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Me("USER_DISCONNECTED")),await this.deletePairing(s))}),ae(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:r,expiry:n,methods:o}=i,a=this.core.crypto.keychain.get(s);return Jd({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:a,relay:r,expiryTimestamp:n,methods:o})}),ae(this,"sendRequest",async(i,s,r)=>{const n=Kt(s,r),o=await this.core.crypto.encode(i,n),a=ao[s].req;return this.core.history.set(i,n),this.core.relayer.publish(i,o,a),n.id}),ae(this,"sendResult",async(i,s,r)=>{const n=Ws(i,r),o=await this.core.crypto.encode(s,n),a=(await this.core.history.get(s,i)).request.method,l=ao[a].res;await this.core.relayer.publish(s,o,l),await this.core.history.resolve(n)}),ae(this,"sendError",async(i,s,r)=>{const n=na(i,r),o=await this.core.crypto.encode(s,n),a=(await this.core.history.get(s,i)).request.method,l=ao[a]?ao[a].res:ao.unregistered_method.res;await this.core.relayer.publish(s,o,l),await this.core.history.resolve(n)}),ae(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Me("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),ae(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>Ss(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),ae(this,"onRelayEventRequest",i=>{const{topic:s,payload:r}=i;switch(r.method){case"wc_pairingPing":return this.onPairingPingRequest(s,r);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,r);default:return this.onUnknownRpcMethodRequest(s,r)}}),ae(this,"onRelayEventResponse",async i=>{const{topic:s,payload:r}=i,n=(await this.core.history.get(s,r.id)).request.method;switch(n){case"wc_pairingPing":return this.onPairingPingResponse(s,r);default:return this.onUnknownRpcMethodResponse(n)}}),ae(this,"onPairingPingRequest",async(i,s)=>{const{id:r}=s;try{this.isValidPing({topic:i}),await this.sendResult(r,i,!0),this.events.emit(nr.ping,{id:r,topic:i})}catch(n){await this.sendError(r,i,n),this.logger.error(n)}}),ae(this,"onPairingPingResponse",(i,s)=>{const{id:r}=s;setTimeout(()=>{vt(s)?this.events.emit(Ie("pairing_ping",r),{}):it(s)&&this.events.emit(Ie("pairing_ping",r),{error:s.error})},500)}),ae(this,"onPairingDeleteRequest",async(i,s)=>{const{id:r}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(nr.delete,{id:r,topic:i})}catch(n){await this.sendError(r,i,n),this.logger.error(n)}}),ae(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:r,method:n}=s;try{if(this.registeredMethods.includes(n))return;const o=Me("WC_METHOD_UNSUPPORTED",n);await this.sendError(r,i,o),this.logger.error(o)}catch(o){await this.sendError(r,i,o),this.logger.error(o)}}),ae(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(Me("WC_METHOD_UNSUPPORTED",i))}),ae(this,"isValidPair",(i,s)=>{var r;if(!ti(i)){const{message:o}=j("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(hs.malformed_pairing_uri),new Error(o)}if(!FN(i.uri)){const{message:o}=j("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(hs.malformed_pairing_uri),new Error(o)}const n=Zd(i==null?void 0:i.uri);if(!((r=n==null?void 0:n.relay)!=null&&r.protocol)){const{message:o}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(hs.malformed_pairing_uri),new Error(o)}if(!(n!=null&&n.symKey)){const{message:o}=j("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(hs.malformed_pairing_uri),new Error(o)}if(n!=null&&n.expiryTimestamp&&E.toMiliseconds(n==null?void 0:n.expiryTimestamp)<Date.now()){s.setError(hs.pairing_expired);const{message:o}=j("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(o)}}),ae(this,"isValidPing",async i=>{if(!ti(i)){const{message:r}=j("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidPairingTopic(s)}),ae(this,"isValidDisconnect",async i=>{if(!ti(i)){const{message:r}=j("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidPairingTopic(s)}),ae(this,"isValidPairingTopic",async i=>{if(!st(i,!1)){const{message:s}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Ss(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=j("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=t,this.logger=Ae(e,this.name),this.pairings=new Cr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return qe(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(bt.message,async t=>{const{topic:e,message:i,transportType:s}=t;if(!this.pairings.keys.includes(e)||s===Ve.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const r=await this.core.crypto.decode(e,i);try{Wn(r)?(this.core.history.set(e,r),this.onRelayEventRequest({topic:e,payload:r})):Nr(r)&&(await this.core.history.resolve(r),await this.onRelayEventResponse({topic:e,payload:r}),this.core.history.delete(e,r.id))}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(_i.expired,async t=>{const{topic:e}=sw(t.target);e&&this.pairings.keys.includes(e)&&(await this.deletePairing(e,!0),this.events.emit(nr.expire,{topic:e}))})}};var o1=Object.defineProperty,a1=(t,e,i)=>e in t?o1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,_t=(t,e,i)=>a1(t,typeof e!="symbol"?e+"":e,i);let c1=class extends E0{constructor(t,e){super(t,e),this.core=t,this.logger=e,_t(this,"records",new Map),_t(this,"events",new xt.EventEmitter),_t(this,"name",HA),_t(this,"version",VA),_t(this,"cached",[]),_t(this,"initialized",!1),_t(this,"storagePrefix",ts),_t(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),_t(this,"set",(i,s,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:r}),this.records.has(s.id))return;const n={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:r,expiry:ht(E.THIRTY_DAYS)};this.records.set(n.id,n),this.persist(),this.events.emit(Oi.created,n)}),_t(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=it(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(Oi.updated,s))}),_t(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),_t(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(r=>{if(r.topic===i){if(typeof s<"u"&&r.id!==s)return;this.records.delete(r.id),this.events.emit(Oi.deleted,r)}}),this.persist()}),_t(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),_t(this,"on",(i,s)=>{this.events.on(i,s)}),_t(this,"once",(i,s)=>{this.events.once(i,s)}),_t(this,"off",(i,s)=>{this.events.off(i,s)}),_t(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ae(e,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(e=>{if(typeof e.response<"u")return;const i={topic:e.topic,request:Kt(e.request.method,e.request.params,e.id),chainId:e.chainId};return t.push(i)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const e=this.records.get(t);if(!e){const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(i)}return e}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Oi.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:e}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Oi.created,t=>{const e=Oi.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t})}),this.events.on(Oi.updated,t=>{const e=Oi.updated;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t})}),this.events.on(Oi.deleted,t=>{const e=Oi.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,record:t})}),this.core.heartbeat.on(qi.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let t=!1;this.records.forEach(e=>{E.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.records.delete(e.id),this.events.emit(Oi.deleted,e,!1),t=!0)}),t&&this.persist()}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}};var l1=Object.defineProperty,h1=(t,e,i)=>e in t?l1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Rt=(t,e,i)=>h1(t,typeof e!="symbol"?e+"":e,i);let u1=class extends P0{constructor(t,e){super(t,e),this.core=t,this.logger=e,Rt(this,"expirations",new Map),Rt(this,"events",new xt.EventEmitter),Rt(this,"name",WA),Rt(this,"version",KA),Rt(this,"cached",[]),Rt(this,"initialized",!1),Rt(this,"storagePrefix",ts),Rt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Rt(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Rt(this,"set",(i,s)=>{this.isInitialized();const r=this.formatTarget(i),n={target:r,expiry:s};this.expirations.set(r,n),this.checkExpiry(r,n),this.events.emit(_i.created,{target:r,expiration:n})}),Rt(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Rt(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),r=this.getExpiration(s);this.expirations.delete(s),this.events.emit(_i.deleted,{target:s,expiration:r})}}),Rt(this,"on",(i,s)=>{this.events.on(i,s)}),Rt(this,"once",(i,s)=>{this.events.once(i,s)}),Rt(this,"off",(i,s)=>{this.events.off(i,s)}),Rt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=Ae(e,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return TI(t);if(typeof t=="number")return MI(t);const{message:e}=j("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(e)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(_i.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:e}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const e=this.expirations.get(t);if(!e){const{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.warn(i),new Error(i)}return e}checkExpiry(t,e){const{expiry:i}=e;E.toMiliseconds(i)-Date.now()<=0&&this.expire(t,e)}expire(t,e){this.expirations.delete(t),this.events.emit(_i.expired,{target:t,expiration:e})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,e)=>this.checkExpiry(e,t))}registerEventListeners(){this.core.heartbeat.on(qi.pulse,()=>this.checkExpirations()),this.events.on(_i.created,t=>{const e=_i.created;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()}),this.events.on(_i.expired,t=>{const e=_i.expired;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()}),this.events.on(_i.deleted,t=>{const e=_i.deleted;this.logger.info(`Emitting ${e}`),this.logger.debug({type:"event",event:e,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}};var d1=Object.defineProperty,p1=(t,e,i)=>e in t?d1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,rt=(t,e,i)=>p1(t,typeof e!="symbol"?e+"":e,i);let g1=class extends T0{constructor(t,e,i){super(t,e,i),this.core=t,this.logger=e,this.store=i,rt(this,"name",FA),rt(this,"abortController"),rt(this,"isDevEnv"),rt(this,"verifyUrlV3",YA),rt(this,"storagePrefix",ts),rt(this,"version",xw),rt(this,"publicKey"),rt(this,"fetchPromise"),rt(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&E.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),rt(this,"register",async s=>{if(!ha()||this.isDevEnv)return;const r=window.location.origin,{id:n,decryptedId:o}=s,a=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${r}&id=${n}&decryptedId=${o}`;try{const l=Vs(),c=this.startAbortTimer(E.ONE_SECOND*5),h=await new Promise((u,d)=>{const p=()=>{window.removeEventListener("message",f),l.body.removeChild(g),d("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=l.createElement("iframe");g.src=a,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const f=w=>{if(w.data&&typeof w.data=="string")try{const m=JSON.parse(w.data);if(m.type==="verify_attestation"){if(kn(m.attestation).payload.id!==n)return;clearInterval(c),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",f),u(m.attestation===null?"":m.attestation)}}catch(m){this.logger.warn(m)}};l.body.appendChild(g),window.addEventListener("message",f,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),rt(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:r,hash:n,encryptedId:o}=s;if(r===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(r){if(kn(r).payload.id!==o)return;const l=await this.isValidJwtAttestation(r);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!n)return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(n,a)}),rt(this,"fetchAttestation",async(s,r)=>{this.logger.debug(`resolving attestation: ${s} from url: ${r}`);const n=this.startAbortTimer(E.ONE_SECOND*5),o=await fetch(`${r}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(n),o.status===200?await o.json():void 0}),rt(this,"getVerifyUrl",s=>{let r=s||Do;return QA.includes(r)||(this.logger.info(`verify url: ${r}, not included in trusted list, assigning default: ${Do}`),r=Do),r}),rt(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(E.FIVE_SECONDS),r=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await r.json()}catch(s){this.logger.warn(s)}}),rt(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),rt(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),rt(this,"isValidJwtAttestation",async s=>{const r=await this.getPublicKey();try{if(r)return this.validateAttestation(s,r)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}const n=await this.fetchAndPersistPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(o){this.logger.error(o),this.logger.warn("error validating attestation")}}),rt(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),rt(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async r=>{const n=await this.fetchPublicKey();n&&(await this.persistPublicKey(n),r(n))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),rt(this,"validateAttestation",(s,r)=>{const n=DN(s,r.publicKey),o={hasExpired:E.toMiliseconds(n.exp)<Date.now(),payload:n};if(o.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:o.payload.origin,isScam:o.payload.isScam,isVerified:o.payload.isVerified}}),this.logger=Ae(e,this.name),this.abortController=new AbortController,this.isDevEnv=bu(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return qe(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),E.toMiliseconds(t))}};var f1=Object.defineProperty,m1=(t,e,i)=>e in t?f1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ep=(t,e,i)=>m1(t,typeof e!="symbol"?e+"":e,i);let w1=class extends M0{constructor(t,e){super(t,e),this.projectId=t,this.logger=e,Ep(this,"context",ZA),Ep(this,"registerDeviceToken",async i=>{const{clientId:s,token:r,notificationType:n,enableEncrypted:o=!1}=i,a=`${JA}/${this.projectId}/clients`;await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:n,token:r,always_raw:o})})}),this.logger=Ae(e,this.context)}};var y1=Object.defineProperty,Np=Object.getOwnPropertySymbols,v1=Object.prototype.hasOwnProperty,b1=Object.prototype.propertyIsEnumerable,Mh=(t,e,i)=>e in t?y1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ho=(t,e)=>{for(var i in e||(e={}))v1.call(e,i)&&Mh(t,i,e[i]);if(Np)for(var i of Np(e))b1.call(e,i)&&Mh(t,i,e[i]);return t},pt=(t,e,i)=>Mh(t,typeof e!="symbol"?e+"":e,i);let I1=class extends O0{constructor(t,e,i=!0){super(t,e,i),this.core=t,this.logger=e,pt(this,"context",e_),pt(this,"storagePrefix",ts),pt(this,"storageVersion",XA),pt(this,"events",new Map),pt(this,"shouldPersist",!1),pt(this,"init",async()=>{if(!bu())try{const s={eventId:Ad(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Xm(this.core.relayer.protocol,this.core.relayer.version,Nh)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),pt(this,"createEvent",s=>{const{event:r="ERROR",type:n="",properties:{topic:o,trace:a}}=s,l=Ad(),c=this.core.projectId||"",h=Date.now(),u=ho({eventId:l,timestamp:h,props:{event:r,type:n,properties:{topic:o,trace:a}},bundleId:c,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,u),this.shouldPersist=!0),u}),pt(this,"getEvent",s=>{const{eventId:r,topic:n}=s;if(r)return this.events.get(r);const o=Array.from(this.events.values()).find(a=>a.props.properties.topic===n);if(o)return ho(ho({},o),this.setMethods(o.eventId))}),pt(this,"deleteEvent",s=>{const{eventId:r}=s;this.events.delete(r),this.shouldPersist=!0}),pt(this,"setEventListeners",()=>{this.core.heartbeat.on(qi.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{E.fromMiliseconds(Date.now())-E.fromMiliseconds(s.timestamp)>t_&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),pt(this,"setMethods",s=>({addTrace:r=>this.addTrace(s,r),setError:r=>this.setError(s,r)})),pt(this,"addTrace",(s,r)=>{const n=this.events.get(s);n&&(n.props.properties.trace.push(r),this.events.set(s,n),this.shouldPersist=!0)}),pt(this,"setError",(s,r)=>{const n=this.events.get(s);n&&(n.props.type=r,n.timestamp=Date.now(),this.events.set(s,n),this.shouldPersist=!0)}),pt(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),pt(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(r=>{this.events.set(r.eventId,ho(ho({},r),this.setMethods(r.eventId)))})}catch(s){this.logger.warn(s)}}),pt(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[r,n]of this.events)n.props.type&&s.push(n);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const r of s)this.events.delete(r.eventId),this.shouldPersist=!0}catch(r){this.logger.warn(r)}}),pt(this,"sendEvent",async s=>{const r=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${i_}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Nh}${r}`,{method:"POST",body:JSON.stringify(s)})}),pt(this,"getAppDomain",()=>Jm().url),this.logger=Ae(e,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var E1=Object.defineProperty,Ap=Object.getOwnPropertySymbols,N1=Object.prototype.hasOwnProperty,A1=Object.prototype.propertyIsEnumerable,Oh=(t,e,i)=>e in t?E1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,_p=(t,e)=>{for(var i in e||(e={}))N1.call(e,i)&&Oh(t,i,e[i]);if(Ap)for(var i of Ap(e))A1.call(e,i)&&Oh(t,i,e[i]);return t},je=(t,e,i)=>Oh(t,typeof e!="symbol"?e+"":e,i);let _1=class Kw extends y0{constructor(e){var i;super(e),je(this,"protocol",Ow),je(this,"version",xw),je(this,"name",Eh),je(this,"relayUrl"),je(this,"projectId"),je(this,"customStoragePrefix"),je(this,"events",new xt.EventEmitter),je(this,"logger"),je(this,"heartbeat"),je(this,"relayer"),je(this,"crypto"),je(this,"storage"),je(this,"history"),je(this,"expirer"),je(this,"pairing"),je(this,"verify"),je(this,"echoClient"),je(this,"linkModeSupportedApps"),je(this,"eventClient"),je(this,"initialized",!1),je(this,"logChunkController"),je(this,"on",(o,a)=>this.events.on(o,a)),je(this,"once",(o,a)=>this.events.once(o,a)),je(this,"off",(o,a)=>this.events.off(o,a)),je(this,"removeListener",(o,a)=>this.events.removeListener(o,a)),je(this,"dispatchEnvelope",({topic:o,message:a,sessionExists:l})=>{if(!o||!a)return;const c={topic:o,message:a,publishedAt:Date.now(),transportType:Ve.link_mode};this.relayer.onLinkMessageEvent(c,{sessionExists:l})}),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Dw,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=ys({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:NA.logger,name:Eh}),{logger:r,chunkLoggerController:n}=yu({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=n,(i=this.logChunkController)!=null&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var o,a;(o=this.logChunkController)!=null&&o.downloadLogsBlobInBrowser&&((a=this.logChunkController)==null||a.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ae(r,this.name),this.heartbeat=new Dm,this.crypto=new OC(this,this.logger,e==null?void 0:e.keychain),this.history=new c1(this,this.logger),this.expirer=new u1(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new f0(_p(_p({},AA),e==null?void 0:e.storageOptions)),this.relayer=new XC({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new n1(this,this.logger),this.verify=new g1(this,this.logger,this.storage),this.echoClient=new w1(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new I1(this,this.logger,e==null?void 0:e.telemetryEnabled)}static async init(e){const i=new Kw(e);await i.initialize();const s=await i.crypto.getClientId();return await i.storage.setItem(UA,s),i}get context(){return qe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(lp,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(lp)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const C1=_1;var S1=Object.defineProperty,P1=(t,e,i)=>e in t?S1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Cp=(t,e,i)=>P1(t,typeof e!="symbol"?e+"":e,i);let T1=class{constructor(t){this.opts=t,Cp(this,"protocol","wc"),Cp(this,"version",2)}},M1=class{constructor(t){this.client=t}};const Fw="wc",Gw=2,Yw="client",Tu=`${Fw}@${Gw}:${Yw}:`,_l={name:Yw,logger:"error"},Sp="WALLETCONNECT_DEEPLINK_CHOICE",O1="proposal",Pp="Proposal expired",x1="session",zr=E.SEVEN_DAYS,k1="engine",gt={wc_sessionPropose:{req:{ttl:E.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1104},res:{ttl:E.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1106},res:{ttl:E.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:E.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:E.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1112},res:{ttl:E.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1114},res:{ttl:E.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:E.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:E.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1119}}},Cl={min:E.FIVE_MINUTES,max:E.SEVEN_DAYS},Wi={idle:"IDLE",active:"ACTIVE"},Tp={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},D1="request",j1=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],R1="wc",U1="auth",L1="authKeys",z1="pairingTopics",$1="requests",Gc=`${R1}@${1.5}:${U1}:`,oc=`${Gc}:PUB_KEY`;var q1=Object.defineProperty,B1=Object.defineProperties,H1=Object.getOwnPropertyDescriptors,Mp=Object.getOwnPropertySymbols,V1=Object.prototype.hasOwnProperty,W1=Object.prototype.propertyIsEnumerable,xh=(t,e,i)=>e in t?q1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Qe=(t,e)=>{for(var i in e||(e={}))V1.call(e,i)&&xh(t,i,e[i]);if(Mp)for(var i of Mp(e))W1.call(e,i)&&xh(t,i,e[i]);return t},Yt=(t,e)=>B1(t,H1(e)),x=(t,e,i)=>xh(t,typeof e!="symbol"?e+"":e,i);let K1=class extends M1{constructor(t){super(t),x(this,"name",k1),x(this,"events",new Hn),x(this,"initialized",!1),x(this,"requestQueue",{state:Wi.idle,queue:[]}),x(this,"sessionRequestQueue",{state:Wi.idle,queue:[]}),x(this,"requestQueueDelay",E.ONE_SECOND),x(this,"expectedPairingMethodMap",new Map),x(this,"recentlyDeletedMap",new Map),x(this,"recentlyDeletedLimit",200),x(this,"relayMessageCache",[]),x(this,"pendingSessions",new Map),x(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(gt)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},E.toMiliseconds(this.requestQueueDelay)))}),x(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Yt(Qe({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:s,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:o,relays:a}=i;let l=s,c,h=!1;try{if(l){const I=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=I.active}}catch(I){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),I}if(!l||!h){const{topic:I,uri:S}=await this.client.core.pairing.create();l=I,c=S}if(!l){const{message:I}=j("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(I)}const u=await this.client.core.crypto.generateKeyPair(),d=gt.wc_sessionPropose.req.ttl||E.FIVE_MINUTES,p=ht(d),g=Yt(Qe({requiredNamespaces:r,optionalNamespaces:n,relays:a??[{protocol:kw}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:l},o&&{sessionProperties:o}),{id:$t()}),f=Ie("session_connect",g.id),{reject:w,resolve:m,done:y}=tr(d,Pp),v=({id:I})=>{I===g.id&&(this.client.events.off("proposal_expire",v),this.pendingSessions.delete(g.id),this.events.emit(f,{error:{message:Pp,code:0}}))};return this.client.events.on("proposal_expire",v),this.events.once(f,({error:I,session:S})=>{this.client.events.off("proposal_expire",v),I?w(I):S&&m(S)}),await this.sendRequest({topic:l,method:"wc_sessionPropose",params:g,throwOnFailedPublish:!0,clientRpcId:g.id}),await this.setProposal(g.id,g),{uri:c,approval:y}}),x(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(i){throw this.client.logger.error("pair() failed"),i}}),x(this,"approve",async e=>{var i,s,r;const n=this.client.core.eventClient.createEvent({properties:{topic:(i=e==null?void 0:e.id)==null?void 0:i.toString(),trace:[xi.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(P){throw n.setError(Qs.no_internet_connection),P}try{await this.isValidProposalId(e==null?void 0:e.id)}catch(P){throw this.client.logger.error(`approve() -> proposal.get(${e==null?void 0:e.id}) failed`),n.setError(Qs.proposal_not_found),P}try{await this.isValidApprove(e)}catch(P){throw this.client.logger.error("approve() -> isValidApprove() failed"),n.setError(Qs.session_approve_namespace_validation_failure),P}const{id:o,relayProtocol:a,namespaces:l,sessionProperties:c,sessionConfig:h}=e,u=this.client.proposal.get(o);this.client.core.eventClient.deleteEvent({eventId:n.eventId});const{pairingTopic:d,proposer:p,requiredNamespaces:g,optionalNamespaces:f}=u;let w=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:d});w||(w=(r=this.client.core.eventClient)==null?void 0:r.createEvent({type:xi.session_approve_started,properties:{topic:d,trace:[xi.session_approve_started,xi.session_namespaces_validation_success]}}));const m=await this.client.core.crypto.generateKeyPair(),y=p.publicKey,v=await this.client.core.crypto.generateSharedKey(m,y),I=Qe(Qe({relay:{protocol:a??"irn"},namespaces:l,controller:{publicKey:m,metadata:this.client.metadata},expiry:ht(zr)},c&&{sessionProperties:c}),h&&{sessionConfig:h}),S=Ve.relay;w.addTrace(xi.subscribing_session_topic);try{await this.client.core.relayer.subscribe(v,{transportType:S})}catch(P){throw w.setError(Qs.subscribe_session_topic_failure),P}w.addTrace(xi.subscribe_session_topic_success);const T=Yt(Qe({},I),{topic:v,requiredNamespaces:g,optionalNamespaces:f,pairingTopic:d,acknowledged:!1,self:I.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:Ve.relay});await this.client.session.set(v,T),w.addTrace(xi.store_session);try{w.addTrace(xi.publishing_session_settle),await this.sendRequest({topic:v,method:"wc_sessionSettle",params:I,throwOnFailedPublish:!0}).catch(P=>{throw w==null||w.setError(Qs.session_settle_publish_failure),P}),w.addTrace(xi.session_settle_publish_success),w.addTrace(xi.publishing_session_approve),await this.sendResult({id:o,topic:d,result:{relay:{protocol:a??"irn"},responderPublicKey:m},throwOnFailedPublish:!0}).catch(P=>{throw w==null||w.setError(Qs.session_approve_publish_failure),P}),w.addTrace(xi.session_approve_publish_success)}catch(P){throw this.client.logger.error(P),this.client.session.delete(v,Me("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(v),P}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:p.metadata}),await this.client.proposal.delete(o,Me("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(v,ht(zr)),{topic:v,acknowledged:()=>Promise.resolve(this.client.session.get(v))}}),x(this,"reject",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(n){throw this.client.logger.error("reject() -> isValidReject() failed"),n}const{id:i,reason:s}=e;let r;try{r=this.client.proposal.get(i).pairingTopic}catch(n){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),n}r&&(await this.sendError({id:i,topic:r,error:s,rpcOpts:gt.wc_sessionPropose.reject}),await this.client.proposal.delete(i,Me("USER_DISCONNECTED")))}),x(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:s}=e,{done:r,resolve:n,reject:o}=tr(),a=$t(),l=pi().toString(),c=this.client.session.get(i).namespaces;return this.events.once(Ie("session_update",a),({error:h})=>{h?o(h):n()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:c}),o(h)}),{acknowledged:r}}),x(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}const{topic:i}=e,s=$t(),{done:r,resolve:n,reject:o}=tr();return this.events.once(Ie("session_extend",s),({error:a})=>{a?o(a):n()}),await this.setExpiry(i,ht(zr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(a=>{o(a)}),{acknowledged:r}}),x(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:i,request:s,topic:r,expiry:n=gt.wc_sessionRequest.req.ttl}=e,o=this.client.session.get(r);(o==null?void 0:o.transportType)===Ve.relay&&await this.confirmOnlineStateOrThrow();const a=$t(),l=pi().toString(),{done:c,resolve:h,reject:u}=tr(n,"Request expired. Please try again.");this.events.once(Ie("session_request",a),({error:w,result:m})=>{w?u(w):h(m)});const d="wc_sessionRequest",p=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);if(p)return await this.sendRequest({clientRpcId:a,relayRpcId:l,topic:r,method:d,params:{request:Yt(Qe({},s),{expiryTimestamp:ht(n)}),chainId:i},expiry:n,throwOnFailedPublish:!0,appLink:p}).catch(w=>u(w)),this.client.events.emit("session_request_sent",{topic:r,request:s,chainId:i,id:a}),await c();const g={request:Yt(Qe({},s),{expiryTimestamp:ht(n)}),chainId:i},f=this.shouldSetTVF(d,g);return await Promise.all([new Promise(async w=>{await this.sendRequest(Qe({clientRpcId:a,relayRpcId:l,topic:r,method:d,params:g,expiry:n,throwOnFailedPublish:!0},f&&{tvf:this.getTVFParams(a,g)})).catch(m=>u(m)),this.client.events.emit("session_request_sent",{topic:r,request:s,chainId:i,id:a}),w()}),new Promise(async w=>{var m;if(!((m=o.sessionConfig)!=null&&m.disableDeepLink)){const y=await DI(this.client.core.storage,Sp);await OI({id:a,topic:r,wcDeepLink:y})}w()}),c()]).then(w=>w[2])}),x(this,"respond",async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:i,response:s}=e,{id:r}=s,n=this.client.session.get(i);n.transportType===Ve.relay&&await this.confirmOnlineStateOrThrow();const o=this.getAppLinkIfEnabled(n.peer.metadata,n.transportType);vt(s)?await this.sendResult({id:r,topic:i,result:s.result,throwOnFailedPublish:!0,appLink:o}):it(s)&&await this.sendError({id:r,topic:i,error:s.error,appLink:o}),this.cleanupAfterResponse(e)}),x(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=e;if(this.client.session.keys.includes(i)){const s=$t(),r=pi().toString(),{done:n,resolve:o,reject:a}=tr();this.events.once(Ie("session_ping",s),({error:l})=>{l?a(l):o()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:r}),n()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),x(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);const{topic:i,event:s,chainId:r}=e,n=pi().toString(),o=$t();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:r},throwOnFailedPublish:!0,relayRpcId:n,clientRpcId:o})}),x(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);const{topic:i}=e;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:Me("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=j("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),x(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(i=>WN(i,e)))),x(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),x(this,"authenticate",async(e,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(e);const r=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),n=r?Ve.link_mode:Ve.relay;n===Ve.relay&&await this.confirmOnlineStateOrThrow();const{chains:o,statement:a="",uri:l,domain:c,nonce:h,type:u,exp:d,nbf:p,methods:g=[],expiry:f}=e,w=[...e.resources||[]],{topic:m,uri:y}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:n});this.client.logger.info({message:"Generated new pairing",pairing:{topic:m,uri:y}});const v=await this.client.core.crypto.generateKeyPair(),I=nc(v);if(await Promise.all([this.client.auth.authKeys.set(oc,{responseTopic:I,publicKey:v}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:m})]),await this.client.core.relayer.subscribe(I,{transportType:n}),this.client.logger.info(`sending request to new pairing topic: ${m}`),g.length>0){const{namespace:C}=Tn(o[0]);let U=AE(C,"request",g);rc(w)&&(U=CE(U,w.pop())),w.push(U)}const S=f&&f>gt.wc_sessionAuthenticate.req.ttl?f:gt.wc_sessionAuthenticate.req.ttl,T={authPayload:{type:u??"caip122",chains:o,statement:a,aud:l,domain:c,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:p,resources:w},requester:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:ht(S)},P={eip155:{chains:o,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},_={requiredNamespaces:{},optionalNamespaces:P,relays:[{protocol:"irn"}],pairingTopic:m,proposer:{publicKey:v,metadata:this.client.metadata},expiryTimestamp:ht(gt.wc_sessionPropose.req.ttl),id:$t()},{done:A,resolve:M,reject:k}=tr(S,"Request expired"),B=$t(),$=Ie("session_connect",_.id),q=Ie("session_request",B),L=async({error:C,session:U})=>{this.events.off(q,H),C?k(C):U&&M({session:U})},H=async C=>{var U,W,Q;if(await this.deletePendingAuthRequest(B,{message:"fulfilled",code:0}),C.error){const Fe=Me("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return C.error.code===Fe.code?void 0:(this.events.off($,L),k(C.error.message))}await this.deleteProposal(_.id),this.events.off($,L);const{cacaos:F,responder:ne}=C.result,ve=[],De=[];for(const Fe of F){await xd({cacao:Fe,projectId:this.client.core.projectId})||(this.client.logger.error(Fe,"Signature verification failed"),k(Me("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ss}=Fe,Ys=rc(ss.resources),Dr=[fh(ss.iss)],Ca=Ac(ss.iss);if(Ys){const eo=kd(Ys),to=Dd(Ys);ve.push(...eo),Dr.push(...to)}for(const eo of Dr)De.push(`${eo}:${Ca}`)}const Xe=await this.client.core.crypto.generateSharedKey(v,ne.publicKey);let Ke;ve.length>0&&(Ke={topic:Xe,acknowledged:!0,self:{publicKey:v,metadata:this.client.metadata},peer:ne,controller:ne.publicKey,expiry:ht(zr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:m,namespaces:Xd([...new Set(ve)],[...new Set(De)]),transportType:n},await this.client.core.relayer.subscribe(Xe,{transportType:n}),await this.client.session.set(Xe,Ke),m&&await this.client.core.pairing.updateMetadata({topic:m,metadata:ne.metadata}),Ke=this.client.session.get(Xe)),(U=this.client.metadata.redirect)!=null&&U.linkMode&&(W=ne.metadata.redirect)!=null&&W.linkMode&&(Q=ne.metadata.redirect)!=null&&Q.universal&&i&&(this.client.core.addLinkModeSupportedApp(ne.metadata.redirect.universal),this.client.session.update(Xe,{transportType:Ve.link_mode})),M({auths:F,session:Ke})};this.events.once($,L),this.events.once(q,H);let V;try{if(r){const C=Kt("wc_sessionAuthenticate",T,B);this.client.core.history.set(m,C);const U=await this.client.core.crypto.encode("",C,{type:ga,encoding:no});V=Da(i,m,U)}else await Promise.all([this.sendRequest({topic:m,method:"wc_sessionAuthenticate",params:T,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:B}),this.sendRequest({topic:m,method:"wc_sessionPropose",params:_,expiry:gt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:_.id})])}catch(C){throw this.events.off($,L),this.events.off(q,H),C}return await this.setProposal(_.id,_),await this.setAuthRequest(B,{request:Yt(Qe({},T),{verifyContext:{}}),pairingTopic:m,transportType:n}),{uri:V??y,response:A}}),x(this,"approveSessionAuthenticate",async e=>{const{id:i,auths:s}=e,r=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Zs.authenticated_session_approve_started]}});try{this.isInitialized()}catch(f){throw r.setError(co.no_internet_connection),f}const n=this.getPendingAuthRequest(i);if(!n)throw r.setError(co.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const o=n.transportType||Ve.relay;o===Ve.relay&&await this.confirmOnlineStateOrThrow();const a=n.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),c=nc(a),h={type:gs,receiverPublicKey:a,senderPublicKey:l},u=[],d=[];for(const f of s){if(!await xd({cacao:f,projectId:this.client.core.projectId})){r.setError(co.invalid_cacao);const I=Me("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:c,error:I,encodeOpts:h}),new Error(I.message)}r.addTrace(Zs.cacaos_verified);const{p:w}=f,m=rc(w.resources),y=[fh(w.iss)],v=Ac(w.iss);if(m){const I=kd(m),S=Dd(m);u.push(...I),y.push(...S)}for(const I of y)d.push(`${I}:${v}`)}const p=await this.client.core.crypto.generateSharedKey(l,a);r.addTrace(Zs.create_authenticated_session_topic);let g;if((u==null?void 0:u.length)>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:a,metadata:n.requester.metadata},controller:a,expiry:ht(zr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:n.pairingTopic,namespaces:Xd([...new Set(u)],[...new Set(d)]),transportType:o},r.addTrace(Zs.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:o})}catch(f){throw r.setError(co.subscribe_authenticated_session_topic_failure),f}r.addTrace(Zs.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),r.addTrace(Zs.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:n.pairingTopic,metadata:n.requester.metadata})}r.addTrace(Zs.publishing_authenticated_session_approve);try{await this.sendResult({topic:c,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(n.requester.metadata,o)})}catch(f){throw r.setError(co.authenticated_session_approve_publish_failure),f}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:n.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:r.eventId}),{session:g}}),x(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();const{id:i,reason:s}=e,r=this.getPendingAuthRequest(i);if(!r)throw new Error(`Could not find pending auth request with id ${i}`);r.transportType===Ve.relay&&await this.confirmOnlineStateOrThrow();const n=r.requester.publicKey,o=await this.client.core.crypto.generateKeyPair(),a=nc(n),l={type:gs,receiverPublicKey:n,senderPublicKey:o};await this.sendError({id:i,topic:a,error:s,encodeOpts:l,rpcOpts:gt.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(r.requester.metadata,r.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.client.proposal.delete(i,Me("USER_DISCONNECTED"))}),x(this,"formatAuthMessage",e=>{this.isInitialized();const{request:i,iss:s}=e;return dw(i,s)}),x(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),x(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{const i=this.client.core.pairing.pairings.get(e.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(r=>{var n,o;return((n=r.peerMetadata)==null?void 0:n.url)&&((o=r.peerMetadata)==null?void 0:o.url)===e.peer.metadata.url&&r.topic&&r.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(r=>this.client.core.pairing.disconnect({topic:r.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),x(this,"deleteSession",async e=>{var i;const{topic:s,expirerHasDeleted:r=!1,emitEvent:n=!0,id:o=0}=e,{self:a}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,Me("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),r||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Sp).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,Me("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Wi.idle),n&&this.client.events.emit("session_delete",{id:o,topic:s})}),x(this,"deleteProposal",async(e,i)=>{if(i)try{const s=this.client.proposal.get(e),r=this.client.core.eventClient.getEvent({topic:s.pairingTopic});r==null||r.setError(Qs.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(e,Me("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),x(this,"deletePendingSessionRequest",async(e,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,i),s?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(r=>r.id!==e),s&&(this.sessionRequestQueue.state=Wi.idle,this.client.events.emit("session_request_expire",{id:e}))}),x(this,"deletePendingAuthRequest",async(e,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(e,i),s?Promise.resolve():this.client.core.expirer.del(e)])}),x(this,"setExpiry",async(e,i)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,i),await this.client.session.update(e,{expiry:i}))}),x(this,"setProposal",async(e,i)=>{this.client.core.expirer.set(e,ht(gt.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,i)}),x(this,"setAuthRequest",async(e,i)=>{const{request:s,pairingTopic:r,transportType:n=Ve.relay}=i;this.client.core.expirer.set(e,s.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:e,pairingTopic:r,verifyContext:s.verifyContext,transportType:n})}),x(this,"setPendingSessionRequest",async e=>{const{id:i,topic:s,params:r,verifyContext:n}=e,o=r.request.expiryTimestamp||ht(gt.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,o),await this.client.pendingRequest.set(i,{id:i,topic:s,params:r,verifyContext:n})}),x(this,"sendRequest",async e=>{const{topic:i,method:s,params:r,expiry:n,relayRpcId:o,clientRpcId:a,throwOnFailedPublish:l,appLink:c,tvf:h}=e,u=Kt(s,r,a);let d;const p=!!c;try{const w=p?no:Rs;d=await this.client.core.crypto.encode(i,u,{encoding:w})}catch(w){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),w}let g;if(j1.includes(s)){const w=ds(JSON.stringify(u)),m=ds(d);g=await this.client.core.verify.register({id:m,decryptedId:w})}const f=gt[s].req;if(f.attestation=g,n&&(f.ttl=n),o&&(f.id=o),this.client.core.history.set(i,u),p){const w=Da(c,i,d);await N.global.Linking.openURL(w,this.client.name)}else{const w=gt[s].req;n&&(w.ttl=n),o&&(w.id=o),w.tvf=Yt(Qe({},h),{correlationId:u.id}),l?(w.internal=Yt(Qe({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,w)):this.client.core.relayer.publish(i,d,w).catch(m=>this.client.logger.error(m))}return u.id}),x(this,"sendResult",async e=>{const{id:i,topic:s,result:r,throwOnFailedPublish:n,encodeOpts:o,appLink:a}=e,l=Ws(i,r);let c;const h=a&&typeof(N.global==null?void 0:N.global.Linking)<"u";try{const p=h?no:Rs;c=await this.client.core.crypto.encode(s,l,Yt(Qe({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let u,d;try{u=await this.client.core.history.get(s,i);const p=u.request;try{this.shouldSetTVF(p.method,p.params)&&(d=this.getTVFParams(i,p.params,r))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),p}if(h){const p=Da(a,s,c);await N.global.Linking.openURL(p,this.client.name)}else{const p=u.request.method,g=gt[p].res;g.tvf=Yt(Qe({},d),{correlationId:i}),n?(g.internal=Yt(Qe({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,c,g)):this.client.core.relayer.publish(s,c,g).catch(f=>this.client.logger.error(f))}await this.client.core.history.resolve(l)}),x(this,"sendError",async e=>{const{id:i,topic:s,error:r,encodeOpts:n,rpcOpts:o,appLink:a}=e,l=na(i,r);let c;const h=a&&typeof(N.global==null?void 0:N.global.Linking)<"u";try{const d=h?no:Rs;c=await this.client.core.crypto.encode(s,l,Yt(Qe({},n||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let u;try{u=await this.client.core.history.get(s,i)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),d}if(h){const d=Da(a,s,c);await N.global.Linking.openURL(d,this.client.name)}else{const d=u.request.method,p=o||gt[d].res;this.client.core.relayer.publish(s,c,p)}await this.client.core.history.resolve(l)}),x(this,"cleanup",async()=>{const e=[],i=[];this.client.session.getAll().forEach(s=>{let r=!1;Ss(s.expiry)&&(r=!0),this.client.core.crypto.keychain.has(s.topic)||(r=!0),r&&e.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ss(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...e.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),x(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),x(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Wi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Wi.active;const e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Wi.idle}),x(this,"processRequest",async e=>{const{topic:i,payload:s,attestation:r,transportType:n,encryptedId:o}=e,a=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:a}))switch(a){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:r,encryptedId:o});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:r,encryptedId:o,transportType:n});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:r,encryptedId:o,transportType:n});default:return this.client.logger.info(`Unsupported request method ${a}`)}}),x(this,"onRelayEventResponse",async e=>{const{topic:i,payload:s,transportType:r}=e,n=(await this.client.core.history.get(i,s.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,r);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${n}`)}}),x(this,"onRelayEventUnknownPayload",e=>{const{topic:i}=e,{message:s}=j("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),x(this,"shouldIgnorePairingRequest",e=>{const{topic:i,requestMethod:s}=e,r=this.expectedPairingMethodMap.get(i);return!r||r.includes(s)?!1:!!(r.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),x(this,"onSessionProposeRequest",async e=>{const{topic:i,payload:s,attestation:r,encryptedId:n}=e,{params:o,id:a}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(hs.proposal_listener_not_found)),this.isValidConnect(Qe({},s.params));const c=o.expiryTimestamp||ht(gt.wc_sessionPropose.req.ttl),h=Qe({id:a,pairingTopic:i,expiryTimestamp:c},o);await this.setProposal(a,h);const u=await this.getVerifyContext({attestationId:r,hash:ds(JSON.stringify(s)),encryptedId:n,metadata:h.proposer.metadata});l==null||l.addTrace(Qi.emit_session_proposal),this.client.events.emit("session_proposal",{id:a,params:h,verifyContext:u})}catch(l){await this.sendError({id:a,topic:i,error:l,rpcOpts:gt.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),x(this,"onSessionProposeResponse",async(e,i,s)=>{const{id:r}=i;if(vt(i)){const{result:n}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const o=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:o});const a=o.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});const l=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const c=await this.client.core.crypto.generateSharedKey(a,l);this.pendingSessions.set(r,{sessionTopic:c,pairingTopic:e,proposalId:r,publicKey:a});const h=await this.client.core.relayer.subscribe(c,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:e})}else if(it(i)){await this.client.proposal.delete(r,Me("USER_DISCONNECTED"));const n=Ie("session_connect",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners, 954`);this.events.emit(n,{error:i.error})}}),x(this,"onSessionSettleRequest",async(e,i)=>{const{id:s,params:r}=i;try{this.isValidSessionSettleRequest(r);const{relay:n,controller:o,expiry:a,namespaces:l,sessionProperties:c,sessionConfig:h}=i.params,u=[...this.pendingSessions.values()].find(g=>g.sessionTopic===e);if(!u)return this.client.logger.error(`Pending session not found for topic ${e}`);const d=this.client.proposal.get(u.proposalId),p=Yt(Qe(Qe({topic:e,relay:n,expiry:a,namespaces:l,acknowledged:!0,pairingTopic:u.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:o.publicKey,self:{publicKey:u.publicKey,metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}},c&&{sessionProperties:c}),h&&{sessionConfig:h}),{transportType:Ve.relay});await this.client.session.set(p.topic,p),await this.setExpiry(p.topic,p.expiry),await this.client.core.pairing.updateMetadata({topic:u.pairingTopic,metadata:p.peer.metadata}),this.client.events.emit("session_connect",{session:p}),this.events.emit(Ie("session_connect",u.proposalId),{session:p}),this.pendingSessions.delete(u.proposalId),this.deleteProposal(u.proposalId,!1),this.cleanupDuplicatePairings(p),await this.sendResult({id:i.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(n){await this.sendError({id:s,topic:e,error:n}),this.client.logger.error(n)}}),x(this,"onSessionSettleResponse",async(e,i)=>{const{id:s}=i;vt(i)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(Ie("session_approve",s),{})):it(i)&&(await this.client.session.delete(e,Me("USER_DISCONNECTED")),this.events.emit(Ie("session_approve",s),{error:i.error}))}),x(this,"onSessionUpdateRequest",async(e,i)=>{const{params:s,id:r}=i;try{const n=`${e}_session_update`,o=oo.get(n);if(o&&this.isRequestOutOfSync(o,r)){this.client.logger.warn(`Discarding out of sync request - ${r}`),this.sendError({id:r,topic:e,error:Me("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Qe({topic:e},s));try{oo.set(n,r),await this.client.session.update(e,{namespaces:s.namespaces}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0})}catch(a){throw oo.delete(n),a}this.client.events.emit("session_update",{id:r,topic:e,params:s})}catch(n){await this.sendError({id:r,topic:e,error:n}),this.client.logger.error(n)}}),x(this,"isRequestOutOfSync",(e,i)=>i.toString().slice(0,-3)<e.toString().slice(0,-3)),x(this,"onSessionUpdateResponse",(e,i)=>{const{id:s}=i,r=Ie("session_update",s);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);vt(i)?this.events.emit(Ie("session_update",s),{}):it(i)&&this.events.emit(Ie("session_update",s),{error:i.error})}),x(this,"onSessionExtendRequest",async(e,i)=>{const{id:s}=i;try{this.isValidExtend({topic:e}),await this.setExpiry(e,ht(zr)),await this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:s,topic:e})}catch(r){await this.sendError({id:s,topic:e,error:r}),this.client.logger.error(r)}}),x(this,"onSessionExtendResponse",(e,i)=>{const{id:s}=i,r=Ie("session_extend",s);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);vt(i)?this.events.emit(Ie("session_extend",s),{}):it(i)&&this.events.emit(Ie("session_extend",s),{error:i.error})}),x(this,"onSessionPingRequest",async(e,i)=>{const{id:s}=i;try{this.isValidPing({topic:e}),await this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:e})}catch(r){await this.sendError({id:s,topic:e,error:r}),this.client.logger.error(r)}}),x(this,"onSessionPingResponse",(e,i)=>{const{id:s}=i,r=Ie("session_ping",s);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);setTimeout(()=>{vt(i)?this.events.emit(Ie("session_ping",s),{}):it(i)&&this.events.emit(Ie("session_ping",s),{error:i.error})},500)}),x(this,"onSessionDeleteRequest",async(e,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:e,reason:i.params}),Promise.all([new Promise(r=>{this.client.core.relayer.once(bt.publish,async()=>{r(await this.deleteSession({topic:e,id:s}))})}),this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:Me("USER_DISCONNECTED")})]).catch(r=>this.client.logger.error(r))}catch(r){this.client.logger.error(r)}}),x(this,"onSessionRequest",async e=>{var i,s,r;const{topic:n,payload:o,attestation:a,encryptedId:l,transportType:c}=e,{id:h,params:u}=o;try{await this.isValidRequest(Qe({topic:n},u));const d=this.client.session.get(n),p=await this.getVerifyContext({attestationId:a,hash:ds(JSON.stringify(Kt("wc_sessionRequest",u,h))),encryptedId:l,metadata:d.peer.metadata,transportType:c}),g={id:h,topic:n,params:u,verifyContext:p};await this.setPendingSessionRequest(g),c===Ve.link_mode&&(i=d.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(r=this.client.signConfig)!=null&&r.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:n,error:d}),this.client.logger.error(d)}}),x(this,"onSessionRequestResponse",(e,i)=>{const{id:s}=i,r=Ie("session_request",s);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);vt(i)?this.events.emit(Ie("session_request",s),{result:i.result}):it(i)&&this.events.emit(Ie("session_request",s),{error:i.error})}),x(this,"onSessionEventRequest",async(e,i)=>{const{id:s,params:r}=i;try{const n=`${e}_session_event_${r.event.name}`,o=oo.get(n);if(o&&this.isRequestOutOfSync(o,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(Qe({topic:e},r)),this.client.events.emit("session_event",{id:s,topic:e,params:r}),oo.set(n,s)}catch(n){await this.sendError({id:s,topic:e,error:n}),this.client.logger.error(n)}}),x(this,"onSessionAuthenticateResponse",(e,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:i}),vt(i)?this.events.emit(Ie("session_request",s),{result:i.result}):it(i)&&this.events.emit(Ie("session_request",s),{error:i.error})}),x(this,"onSessionAuthenticateRequest",async e=>{var i;const{topic:s,payload:r,attestation:n,encryptedId:o,transportType:a}=e;try{const{requester:l,authPayload:c,expiryTimestamp:h}=r.params,u=await this.getVerifyContext({attestationId:n,hash:ds(JSON.stringify(r)),encryptedId:o,metadata:l.metadata,transportType:a}),d={requester:l,pairingTopic:s,id:r.id,authPayload:c,verifyContext:u,expiryTimestamp:h};await this.setAuthRequest(r.id,{request:d,pairingTopic:s,transportType:a}),a===Ve.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:r.params,id:r.id,verifyContext:u})}catch(l){this.client.logger.error(l);const c=r.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=this.getAppLinkIfEnabled(r.params.requester.metadata,a),d={type:gs,receiverPublicKey:c,senderPublicKey:h};await this.sendError({id:r.id,topic:s,error:l,encodeOpts:d,rpcOpts:gt.wc_sessionAuthenticate.autoReject,appLink:u})}}),x(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),x(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Wi.idle,this.processSessionRequestQueue()},E.toMiliseconds(this.requestQueueDelay))}),x(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(r=>r.topic===e&&r.request.method==="wc_sessionRequest").forEach(r=>{const n=r.request.id,o=Ie("session_request",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners`);this.events.emit(Ie("session_request",r.request.id),{error:i})})}),x(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Wi.active){this.client.logger.info("session request queue is already active.");return}const e=this.sessionRequestQueue.queue[0];if(!e){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Wi.active,this.emitSessionRequest(e)}catch(i){this.client.logger.error(i)}}),x(this,"emitSessionRequest",e=>{this.client.events.emit("session_request",e)}),x(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===e.topic);i&&this.onSessionProposeRequest({topic:e.topic,payload:Kt("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id)})}),x(this,"isValidConnect",async e=>{if(!ti(e)){const{message:a}=j("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw new Error(a)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:r,sessionProperties:n,relays:o}=e;if(ri(i)||await this.isValidPairingTopic(i),!sA(o)){const{message:a}=j("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(a)}!ri(s)&&Go(s)!==0&&this.validateNamespaces(s,"requiredNamespaces"),!ri(r)&&Go(r)!==0&&this.validateNamespaces(r,"optionalNamespaces"),ri(n)||this.validateSessionProps(n,"sessionProperties")}),x(this,"validateNamespaces",(e,i)=>{const s=iA(e,"connect()",i);if(s)throw new Error(s.message)}),x(this,"isValidApprove",async e=>{if(!ti(e))throw new Error(j("MISSING_OR_INVALID",`approve() params: ${e}`).message);const{id:i,namespaces:s,relayProtocol:r,sessionProperties:n}=e;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const o=this.client.proposal.get(i),a=bl(s,"approve()");if(a)throw new Error(a.message);const l=ip(o.requiredNamespaces,s,"approve()");if(l)throw new Error(l.message);if(!st(r,!0)){const{message:c}=j("MISSING_OR_INVALID",`approve() relayProtocol: ${r}`);throw new Error(c)}ri(n)||this.validateSessionProps(n,"sessionProperties")}),x(this,"isValidReject",async e=>{if(!ti(e)){const{message:r}=j("MISSING_OR_INVALID",`reject() params: ${e}`);throw new Error(r)}const{id:i,reason:s}=e;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!nA(s)){const{message:r}=j("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(r)}}),x(this,"isValidSessionSettleRequest",e=>{if(!ti(e)){const{message:l}=j("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw new Error(l)}const{relay:i,controller:s,namespaces:r,expiry:n}=e;if(!Tw(i)){const{message:l}=j("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const o=QN(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);const a=bl(r,"onSessionSettleRequest()");if(a)throw new Error(a.message);if(Ss(n)){const{message:l}=j("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),x(this,"isValidUpdate",async e=>{if(!ti(e)){const{message:a}=j("MISSING_OR_INVALID",`update() params: ${e}`);throw new Error(a)}const{topic:i,namespaces:s}=e;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const r=this.client.session.get(i),n=bl(s,"update()");if(n)throw new Error(n.message);const o=ip(r.requiredNamespaces,s,"update()");if(o)throw new Error(o.message)}),x(this,"isValidExtend",async e=>{if(!ti(e)){const{message:s}=j("MISSING_OR_INVALID",`extend() params: ${e}`);throw new Error(s)}const{topic:i}=e;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),x(this,"isValidRequest",async e=>{if(!ti(e)){const{message:a}=j("MISSING_OR_INVALID",`request() params: ${e}`);throw new Error(a)}const{topic:i,request:s,chainId:r,expiry:n}=e;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!tp(o,r)){const{message:a}=j("MISSING_OR_INVALID",`request() chainId: ${r}`);throw new Error(a)}if(!oA(s)){const{message:a}=j("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(a)}if(!lA(o,r,s.method)){const{message:a}=j("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(a)}if(n&&!pA(n,Cl)){const{message:a}=j("MISSING_OR_INVALID",`request() expiry: ${n}. Expiry must be a number (in seconds) between ${Cl.min} and ${Cl.max}`);throw new Error(a)}}),x(this,"isValidRespond",async e=>{var i;if(!ti(e)){const{message:n}=j("MISSING_OR_INVALID",`respond() params: ${e}`);throw new Error(n)}const{topic:s,response:r}=e;try{await this.isValidSessionTopic(s)}catch(n){throw(i=e==null?void 0:e.response)!=null&&i.id&&this.cleanupAfterResponse(e),n}if(!aA(r)){const{message:n}=j("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(r)}`);throw new Error(n)}}),x(this,"isValidPing",async e=>{if(!ti(e)){const{message:s}=j("MISSING_OR_INVALID",`ping() params: ${e}`);throw new Error(s)}const{topic:i}=e;await this.isValidSessionOrPairingTopic(i)}),x(this,"isValidEmit",async e=>{if(!ti(e)){const{message:o}=j("MISSING_OR_INVALID",`emit() params: ${e}`);throw new Error(o)}const{topic:i,event:s,chainId:r}=e;await this.isValidSessionTopic(i);const{namespaces:n}=this.client.session.get(i);if(!tp(n,r)){const{message:o}=j("MISSING_OR_INVALID",`emit() chainId: ${r}`);throw new Error(o)}if(!cA(s)){const{message:o}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}if(!hA(n,r,s.name)){const{message:o}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(o)}}),x(this,"isValidDisconnect",async e=>{if(!ti(e)){const{message:s}=j("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw new Error(s)}const{topic:i}=e;await this.isValidSessionOrPairingTopic(i)}),x(this,"isValidAuthenticate",e=>{const{chains:i,uri:s,domain:r,nonce:n}=e;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!st(s,!1))throw new Error("uri is required parameter");if(!st(r,!1))throw new Error("domain is required parameter");if(!st(n,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(a=>Tn(a).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:o}=Tn(i[0]);if(o!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),x(this,"getVerifyContext",async e=>{const{attestationId:i,hash:s,encryptedId:r,metadata:n,transportType:o}=e,a={verified:{verifyUrl:n.verifyUrl||Do,validation:"UNKNOWN",origin:n.url||""}};try{if(o===Ve.link_mode){const c=this.getAppLinkIfEnabled(n,o);return a.verified.validation=c&&new URL(c).origin===new URL(n.url).origin?"VALID":"INVALID",a}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:r,verifyUrl:n.verifyUrl});l&&(a.verified.origin=l.origin,a.verified.isScam=l.isScam,a.verified.validation=l.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(a)}`),a}),x(this,"validateSessionProps",(e,i)=>{Object.values(e).forEach(s=>{if(!st(s,!1)){const{message:r}=j("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(s)}`);throw new Error(r)}})}),x(this,"getPendingAuthRequest",e=>{const i=this.client.auth.requests.get(e);return typeof i=="object"?i:void 0}),x(this,"addToRecentlyDeleted",(e,i)=>{if(this.recentlyDeletedMap.set(e,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const r=this.recentlyDeletedLimit/2;for(const n of this.recentlyDeletedMap.keys()){if(s++>=r)break;this.recentlyDeletedMap.delete(n)}}}),x(this,"checkRecentlyDeleted",e=>{const i=this.recentlyDeletedMap.get(e);if(i){const{message:s}=j("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${e}`);throw new Error(s)}}),x(this,"isLinkModeEnabled",(e,i)=>{var s,r,n,o,a,l,c,h,u;return!e||i!==Ve.link_mode?!1:((r=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:r.linkMode)===!0&&((o=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:o.universal)!==void 0&&((l=(a=this.client.metadata)==null?void 0:a.redirect)==null?void 0:l.universal)!==""&&((c=e==null?void 0:e.redirect)==null?void 0:c.universal)!==void 0&&((h=e==null?void 0:e.redirect)==null?void 0:h.universal)!==""&&((u=e==null?void 0:e.redirect)==null?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(N.global==null?void 0:N.global.Linking)<"u"}),x(this,"getAppLinkIfEnabled",(e,i)=>{var s;return this.isLinkModeEnabled(e,i)?(s=e==null?void 0:e.redirect)==null?void 0:s.universal:void 0}),x(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;const i=Nd(e,"topic")||"",s=decodeURIComponent(Nd(e,"wc_ev")||""),r=this.client.session.keys.includes(i);r&&this.client.session.update(i,{transportType:Ve.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:r})}),x(this,"registerLinkModeListeners",async()=>{var e;if(bu()||Fs()&&(e=this.client.metadata.redirect)!=null&&e.linkMode){const i=N.global==null?void 0:N.global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),x(this,"shouldSetTVF",(e,i)=>{if(!i||e!=="wc_sessionRequest")return!1;const{request:s}=i;return Object.keys(Tp).includes(s.method)}),x(this,"getTVFParams",(e,i,s)=>{var r,n;try{const o=i.request.method,a=this.extractTxHashesFromResult(o,s);return Yt(Qe({correlationId:e,rpcMethods:[o],chainId:i.chainId},this.isValidContractData(i.request.params)&&{contractAddresses:[(n=(r=i.request.params)==null?void 0:r[0])==null?void 0:n.to]}),{txHashes:a})}catch(o){this.client.logger.warn("Error getting TVF params",o)}return{}}),x(this,"isValidContractData",e=>{var i;if(!e)return!1;try{const s=(e==null?void 0:e.data)||((i=e==null?void 0:e[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const r=s.slice(2);return/^[0-9a-fA-F]*$/.test(r)?r.length%2===0:!1}catch{}return!1}),x(this,"extractTxHashesFromResult",(e,i)=>{try{const s=Tp[e];if(typeof i=="string")return[i];const r=i[s.key];if(mr(r))return r;if(typeof r=="string")return[r]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}isInitialized(){if(!this.initialized){const{message:t}=j("NOT_INITIALIZED",this.name);throw new Error(t)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(bt.message,t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):this.onRelayMessage(t)})}async onRelayMessage(t){const{topic:e,message:i,attestation:s,transportType:r}=t,{publicKey:n}=this.client.auth.authKeys.keys.includes(oc)?this.client.auth.authKeys.get(oc):{publicKey:void 0},o=await this.client.core.crypto.decode(e,i,{receiverPublicKey:n,encoding:r===Ve.link_mode?no:Rs});try{Wn(o)?(this.client.core.history.set(e,o),this.onRelayEventRequest({topic:e,payload:o,attestation:s,transportType:r,encryptedId:ds(i)})):Nr(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:e,payload:o,transportType:r}),this.client.core.history.delete(e,o.id)):this.onRelayEventUnknownPayload({topic:e,payload:o,transportType:r})}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(_i.expired,async t=>{const{topic:e,id:i}=sw(t.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,j("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,j("EXPIRED"),!0);e?this.client.session.keys.includes(e)&&(await this.deleteSession({topic:e,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:e})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(nr.create,t=>this.onPairingCreated(t)),this.client.core.pairing.events.on(nr.delete,t=>{this.addToRecentlyDeleted(t.topic,"pairing")})}isValidPairingTopic(t){if(!st(t,!1)){const{message:e}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(e)}if(Ss(this.client.core.pairing.pairings.get(t).expiry)){const{message:e}=j("EXPIRED",`pairing topic: ${t}`);throw new Error(e)}}async isValidSessionTopic(t){if(!st(t,!1)){const{message:e}=j("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(e)}if(this.checkRecentlyDeleted(t),!this.client.session.keys.includes(t)){const{message:e}=j("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(e)}if(Ss(this.client.session.get(t).expiry)){await this.deleteSession({topic:t});const{message:e}=j("EXPIRED",`session topic: ${t}`);throw new Error(e)}if(!this.client.core.crypto.keychain.has(t)){const{message:e}=j("MISSING_OR_INVALID",`session topic does not exist in keychain: ${t}`);throw await this.deleteSession({topic:t}),new Error(e)}}async isValidSessionOrPairingTopic(t){if(this.checkRecentlyDeleted(t),this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(st(t,!1)){const{message:e}=j("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(e)}else{const{message:e}=j("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(e)}}async isValidProposalId(t){if(!rA(t)){const{message:e}=j("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(e)}if(!this.client.proposal.keys.includes(t)){const{message:e}=j("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(e)}if(Ss(this.client.proposal.get(t).expiryTimestamp)){await this.deleteProposal(t);const{message:e}=j("EXPIRED",`proposal id: ${t}`);throw new Error(e)}}},F1=class extends Cr{constructor(t,e){super(t,e,O1,Tu),this.core=t,this.logger=e}},G1=class extends Cr{constructor(t,e){super(t,e,x1,Tu),this.core=t,this.logger=e}},Y1=class extends Cr{constructor(t,e){super(t,e,D1,Tu,i=>i.id),this.core=t,this.logger=e}},Q1=class extends Cr{constructor(t,e){super(t,e,L1,Gc,()=>oc),this.core=t,this.logger=e}},Z1=class extends Cr{constructor(t,e){super(t,e,z1,Gc),this.core=t,this.logger=e}},J1=class extends Cr{constructor(t,e){super(t,e,$1,Gc,i=>i.id),this.core=t,this.logger=e}};var X1=Object.defineProperty,eS=(t,e,i)=>e in t?X1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Sl=(t,e,i)=>eS(t,typeof e!="symbol"?e+"":e,i);let tS=class{constructor(t,e){this.core=t,this.logger=e,Sl(this,"authKeys"),Sl(this,"pairingTopics"),Sl(this,"requests"),this.authKeys=new Q1(this.core,this.logger),this.pairingTopics=new Z1(this.core,this.logger),this.requests=new J1(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}};var iS=Object.defineProperty,sS=(t,e,i)=>e in t?iS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ce=(t,e,i)=>sS(t,typeof e!="symbol"?e+"":e,i);let rS=class Qw extends T1{constructor(e){super(e),ce(this,"protocol",Fw),ce(this,"version",Gw),ce(this,"name",_l.name),ce(this,"metadata"),ce(this,"core"),ce(this,"logger"),ce(this,"events",new xt.EventEmitter),ce(this,"engine"),ce(this,"session"),ce(this,"proposal"),ce(this,"pendingRequest"),ce(this,"auth"),ce(this,"signConfig"),ce(this,"on",(s,r)=>this.events.on(s,r)),ce(this,"once",(s,r)=>this.events.once(s,r)),ce(this,"off",(s,r)=>this.events.off(s,r)),ce(this,"removeListener",(s,r)=>this.events.removeListener(s,r)),ce(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),ce(this,"connect",async s=>{try{return await this.engine.connect(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"pair",async s=>{try{return await this.engine.pair(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"approve",async s=>{try{return await this.engine.approve(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"reject",async s=>{try{return await this.engine.reject(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"update",async s=>{try{return await this.engine.update(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"extend",async s=>{try{return await this.engine.extend(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"request",async s=>{try{return await this.engine.request(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"respond",async s=>{try{return await this.engine.respond(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"ping",async s=>{try{return await this.engine.ping(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"emit",async s=>{try{return await this.engine.emit(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"disconnect",async s=>{try{return await this.engine.disconnect(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"find",s=>{try{return this.engine.find(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),ce(this,"authenticate",async(s,r)=>{try{return await this.engine.authenticate(s,r)}catch(n){throw this.logger.error(n.message),n}}),ce(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"approveSessionAuthenticate",async s=>{try{return await this.engine.approveSessionAuthenticate(s)}catch(r){throw this.logger.error(r.message),r}}),ce(this,"rejectSessionAuthenticate",async s=>{try{return await this.engine.rejectSessionAuthenticate(s)}catch(r){throw this.logger.error(r.message),r}}),this.name=(e==null?void 0:e.name)||_l.name,this.metadata=(e==null?void 0:e.metadata)||Jm(),this.signConfig=e==null?void 0:e.signConfig;const i=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Vn(ys({level:(e==null?void 0:e.logger)||_l.logger}));this.core=(e==null?void 0:e.core)||new C1(e),this.logger=Ae(i,this.name),this.session=new G1(this.core,this.logger),this.proposal=new F1(this.core,this.logger),this.pendingRequest=new Y1(this.core,this.logger),this.engine=new K1(this),this.auth=new tS(this.core,this.logger)}static async init(e){const i=new Qw(e);return await i.initialize(),i}get context(){return qe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},E.toMiliseconds(E.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Op="error",nS="wss://relay.walletconnect.org",oS="wc",aS="universal_provider",xp=`${oS}@2:${aS}:`,Zw="https://rpc.walletconnect.org/v1/",fn="generic",cS=`${Zw}bundler`,Ti={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ra=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof N.global<"u"?N.global:typeof self<"u"?self:{};function lS(){this.__data__=[],this.size=0}var hS=lS;function uS(t,e){return t===e||t!==t&&e!==e}var Yc=uS,dS=Yc;function pS(t,e){for(var i=t.length;i--;)if(dS(t[i][0],e))return i;return-1}var Qc=pS,gS=Qc,fS=Array.prototype,mS=fS.splice;function wS(t){var e=this.__data__,i=gS(e,t);if(i<0)return!1;var s=e.length-1;return i==s?e.pop():mS.call(e,i,1),--this.size,!0}var yS=wS,vS=Qc;function bS(t){var e=this.__data__,i=vS(e,t);return i<0?void 0:e[i][1]}var IS=bS,ES=Qc;function NS(t){return ES(this.__data__,t)>-1}var AS=NS,_S=Qc;function CS(t,e){var i=this.__data__,s=_S(i,t);return s<0?(++this.size,i.push([t,e])):i[s][1]=e,this}var SS=CS,PS=hS,TS=yS,MS=IS,OS=AS,xS=SS;function mn(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}mn.prototype.clear=PS,mn.prototype.delete=TS,mn.prototype.get=MS,mn.prototype.has=OS,mn.prototype.set=xS;var Zc=mn,kS=Zc;function DS(){this.__data__=new kS,this.size=0}var jS=DS;function RS(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}var US=RS;function LS(t){return this.__data__.get(t)}var zS=LS;function $S(t){return this.__data__.has(t)}var qS=$S,BS=typeof Ra=="object"&&Ra&&Ra.Object===Object&&Ra,Jw=BS,HS=Jw,VS=typeof self=="object"&&self&&self.Object===Object&&self,WS=HS||VS||Function("return this")(),Yn=WS,KS=Yn,FS=KS.Symbol,Xw=FS,kp=Xw,ey=Object.prototype,GS=ey.hasOwnProperty,YS=ey.toString,uo=kp?kp.toStringTag:void 0;function QS(t){var e=GS.call(t,uo),i=t[uo];try{t[uo]=void 0;var s=!0}catch{}var r=YS.call(t);return s&&(e?t[uo]=i:delete t[uo]),r}var ZS=QS,JS=Object.prototype,XS=JS.toString;function eP(t){return XS.call(t)}var tP=eP,Dp=Xw,iP=ZS,sP=tP,rP="[object Null]",nP="[object Undefined]",jp=Dp?Dp.toStringTag:void 0;function oP(t){return t==null?t===void 0?nP:rP:jp&&jp in Object(t)?iP(t):sP(t)}var Jc=oP;function aP(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Sr=aP,cP=Jc,lP=Sr,hP="[object AsyncFunction]",uP="[object Function]",dP="[object GeneratorFunction]",pP="[object Proxy]";function gP(t){if(!lP(t))return!1;var e=cP(t);return e==uP||e==dP||e==hP||e==pP}var Mu=gP,fP=Yn,mP=fP["__core-js_shared__"],wP=mP,Pl=wP,Rp=function(){var t=/[^.]+$/.exec(Pl&&Pl.keys&&Pl.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function yP(t){return!!Rp&&Rp in t}var vP=yP,bP=Function.prototype,IP=bP.toString;function EP(t){if(t!=null){try{return IP.call(t)}catch{}try{return t+""}catch{}}return""}var NP=EP,AP=Mu,_P=vP,CP=Sr,SP=NP,PP=/[\\^$.*+?()[\]{}|]/g,TP=/^\[object .+?Constructor\]$/,MP=Function.prototype,OP=Object.prototype,xP=MP.toString,kP=OP.hasOwnProperty,DP=RegExp("^"+xP.call(kP).replace(PP,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function jP(t){if(!CP(t)||_P(t))return!1;var e=AP(t)?DP:TP;return e.test(SP(t))}var RP=jP;function UP(t,e){return t==null?void 0:t[e]}var LP=UP,zP=RP,$P=LP;function qP(t,e){var i=$P(t,e);return zP(i)?i:void 0}var Ou=qP,BP=Ou,HP=Yn,VP=BP(HP,"Map"),ty=VP,WP=Ou,KP=WP(Object,"create"),Xc=KP,Up=Xc;function FP(){this.__data__=Up?Up(null):{},this.size=0}var GP=FP;function YP(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var QP=YP,ZP=Xc,JP="__lodash_hash_undefined__",XP=Object.prototype,eT=XP.hasOwnProperty;function tT(t){var e=this.__data__;if(ZP){var i=e[t];return i===JP?void 0:i}return eT.call(e,t)?e[t]:void 0}var iT=tT,sT=Xc,rT=Object.prototype,nT=rT.hasOwnProperty;function oT(t){var e=this.__data__;return sT?e[t]!==void 0:nT.call(e,t)}var aT=oT,cT=Xc,lT="__lodash_hash_undefined__";function hT(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=cT&&e===void 0?lT:e,this}var uT=hT,dT=GP,pT=QP,gT=iT,fT=aT,mT=uT;function wn(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}wn.prototype.clear=dT,wn.prototype.delete=pT,wn.prototype.get=gT,wn.prototype.has=fT,wn.prototype.set=mT;var wT=wn,Lp=wT,yT=Zc,vT=ty;function bT(){this.size=0,this.__data__={hash:new Lp,map:new(vT||yT),string:new Lp}}var IT=bT;function ET(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var NT=ET,AT=NT;function _T(t,e){var i=t.__data__;return AT(e)?i[typeof e=="string"?"string":"hash"]:i.map}var el=_T,CT=el;function ST(t){var e=CT(this,t).delete(t);return this.size-=e?1:0,e}var PT=ST,TT=el;function MT(t){return TT(this,t).get(t)}var OT=MT,xT=el;function kT(t){return xT(this,t).has(t)}var DT=kT,jT=el;function RT(t,e){var i=jT(this,t),s=i.size;return i.set(t,e),this.size+=i.size==s?0:1,this}var UT=RT,LT=IT,zT=PT,$T=OT,qT=DT,BT=UT;function yn(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}yn.prototype.clear=LT,yn.prototype.delete=zT,yn.prototype.get=$T,yn.prototype.has=qT,yn.prototype.set=BT;var HT=yn,VT=Zc,WT=ty,KT=HT,FT=200;function GT(t,e){var i=this.__data__;if(i instanceof VT){var s=i.__data__;if(!WT||s.length<FT-1)return s.push([t,e]),this.size=++i.size,this;i=this.__data__=new KT(s)}return i.set(t,e),this.size=i.size,this}var YT=GT,QT=Zc,ZT=jS,JT=US,XT=zS,eM=qS,tM=YT;function vn(t){var e=this.__data__=new QT(t);this.size=e.size}vn.prototype.clear=ZT,vn.prototype.delete=JT,vn.prototype.get=XT,vn.prototype.has=eM,vn.prototype.set=tM;var iM=vn,sM=Ou,rM=function(){try{var t=sM(Object,"defineProperty");return t({},"",{}),t}catch{}}(),iy=rM,zp=iy;function nM(t,e,i){e=="__proto__"&&zp?zp(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var xu=nM,oM=xu,aM=Yc;function cM(t,e,i){(i!==void 0&&!aM(t[e],i)||i===void 0&&!(e in t))&&oM(t,e,i)}var sy=cM;function lM(t){return function(e,i,s){for(var r=-1,n=Object(e),o=s(e),a=o.length;a--;){var l=o[t?a:++r];if(i(n[l],l,n)===!1)break}return e}}var hM=lM,uM=hM,dM=uM(),pM=dM,kh={exports:{}};(function(t,e){var i=Yn,s=e&&!e.nodeType&&e,r=s&&!0&&t&&!t.nodeType&&t,n=r&&r.exports===s,o=n?i.Buffer:void 0,a=o?o.allocUnsafe:void 0;function l(c,h){if(h)return c.slice();var u=c.length,d=a?a(u):new c.constructor(u);return c.copy(d),d}t.exports=l})(kh,kh.exports);var gM=Yn,fM=gM.Uint8Array,mM=fM,$p=mM;function wM(t){var e=new t.constructor(t.byteLength);return new $p(e).set(new $p(t)),e}var yM=wM,vM=yM;function bM(t,e){var i=e?vM(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var IM=bM;function EM(t,e){var i=-1,s=t.length;for(e||(e=Array(s));++i<s;)e[i]=t[i];return e}var NM=EM,AM=Sr,qp=Object.create,_M=function(){function t(){}return function(e){if(!AM(e))return{};if(qp)return qp(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}(),CM=_M;function SM(t,e){return function(i){return t(e(i))}}var PM=SM,TM=PM,MM=TM(Object.getPrototypeOf,Object),ry=MM,OM=Object.prototype;function xM(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||OM;return t===i}var ny=xM,kM=CM,DM=ry,jM=ny;function RM(t){return typeof t.constructor=="function"&&!jM(t)?kM(DM(t)):{}}var UM=RM;function LM(t){return t!=null&&typeof t=="object"}var ma=LM,zM=Jc,$M=ma,qM="[object Arguments]";function BM(t){return $M(t)&&zM(t)==qM}var HM=BM,Bp=HM,VM=ma,oy=Object.prototype,WM=oy.hasOwnProperty,KM=oy.propertyIsEnumerable,FM=Bp(function(){return arguments}())?Bp:function(t){return VM(t)&&WM.call(t,"callee")&&!KM.call(t,"callee")},ay=FM,GM=Array.isArray,cy=GM,YM=9007199254740991;function QM(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=YM}var ly=QM,ZM=Mu,JM=ly;function XM(t){return t!=null&&JM(t.length)&&!ZM(t)}var ku=XM,eO=ku,tO=ma;function iO(t){return tO(t)&&eO(t)}var sO=iO,Sc={exports:{}};function rO(){return!1}var nO=rO;(function(t,e){var i=Yn,s=nO,r=e&&!e.nodeType&&e,n=r&&!0&&t&&!t.nodeType&&t,o=n&&n.exports===r,a=o?i.Buffer:void 0,l=a?a.isBuffer:void 0,c=l||s;t.exports=c})(Sc,Sc.exports);var oO=Jc,aO=ry,cO=ma,lO="[object Object]",hO=Function.prototype,uO=Object.prototype,hy=hO.toString,dO=uO.hasOwnProperty,pO=hy.call(Object);function gO(t){if(!cO(t)||oO(t)!=lO)return!1;var e=aO(t);if(e===null)return!0;var i=dO.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&hy.call(i)==pO}var fO=gO,mO=Jc,wO=ly,yO=ma,vO="[object Arguments]",bO="[object Array]",IO="[object Boolean]",EO="[object Date]",NO="[object Error]",AO="[object Function]",_O="[object Map]",CO="[object Number]",SO="[object Object]",PO="[object RegExp]",TO="[object Set]",MO="[object String]",OO="[object WeakMap]",xO="[object ArrayBuffer]",kO="[object DataView]",DO="[object Float32Array]",jO="[object Float64Array]",RO="[object Int8Array]",UO="[object Int16Array]",LO="[object Int32Array]",zO="[object Uint8Array]",$O="[object Uint8ClampedArray]",qO="[object Uint16Array]",BO="[object Uint32Array]",He={};He[DO]=He[jO]=He[RO]=He[UO]=He[LO]=He[zO]=He[$O]=He[qO]=He[BO]=!0,He[vO]=He[bO]=He[xO]=He[IO]=He[kO]=He[EO]=He[NO]=He[AO]=He[_O]=He[CO]=He[SO]=He[PO]=He[TO]=He[MO]=He[OO]=!1;function HO(t){return yO(t)&&wO(t.length)&&!!He[mO(t)]}var VO=HO;function WO(t){return function(e){return t(e)}}var KO=WO,Dh={exports:{}};(function(t,e){var i=Jw,s=e&&!e.nodeType&&e,r=s&&!0&&t&&!t.nodeType&&t,n=r&&r.exports===s,o=n&&i.process,a=function(){try{var l=r&&r.require&&r.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();t.exports=a})(Dh,Dh.exports);var FO=VO,GO=KO,Hp=Dh.exports,Vp=Hp&&Hp.isTypedArray,YO=Vp?GO(Vp):FO,uy=YO;function QO(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var dy=QO,ZO=xu,JO=Yc,XO=Object.prototype,ex=XO.hasOwnProperty;function tx(t,e,i){var s=t[e];(!(ex.call(t,e)&&JO(s,i))||i===void 0&&!(e in t))&&ZO(t,e,i)}var ix=tx,sx=ix,rx=xu;function nx(t,e,i,s){var r=!i;i||(i={});for(var n=-1,o=e.length;++n<o;){var a=e[n],l=s?s(i[a],t[a],a,i,t):void 0;l===void 0&&(l=t[a]),r?rx(i,a,l):sx(i,a,l)}return i}var ox=nx;function ax(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}var cx=ax,lx=9007199254740991,hx=/^(?:0|[1-9]\d*)$/;function ux(t,e){var i=typeof t;return e=e??lx,!!e&&(i=="number"||i!="symbol"&&hx.test(t))&&t>-1&&t%1==0&&t<e}var py=ux,dx=cx,px=ay,gx=cy,fx=Sc.exports,mx=py,wx=uy,yx=Object.prototype,vx=yx.hasOwnProperty;function bx(t,e){var i=gx(t),s=!i&&px(t),r=!i&&!s&&fx(t),n=!i&&!s&&!r&&wx(t),o=i||s||r||n,a=o?dx(t.length,String):[],l=a.length;for(var c in t)(e||vx.call(t,c))&&!(o&&(c=="length"||r&&(c=="offset"||c=="parent")||n&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||mx(c,l)))&&a.push(c);return a}var Ix=bx;function Ex(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var Nx=Ex,Ax=Sr,_x=ny,Cx=Nx,Sx=Object.prototype,Px=Sx.hasOwnProperty;function Tx(t){if(!Ax(t))return Cx(t);var e=_x(t),i=[];for(var s in t)s=="constructor"&&(e||!Px.call(t,s))||i.push(s);return i}var Mx=Tx,Ox=Ix,xx=Mx,kx=ku;function Dx(t){return kx(t)?Ox(t,!0):xx(t)}var gy=Dx,jx=ox,Rx=gy;function Ux(t){return jx(t,Rx(t))}var Lx=Ux,Wp=sy,zx=kh.exports,$x=IM,qx=NM,Bx=UM,Kp=ay,Fp=cy,Hx=sO,Vx=Sc.exports,Wx=Mu,Kx=Sr,Fx=fO,Gx=uy,Gp=dy,Yx=Lx;function Qx(t,e,i,s,r,n,o){var a=Gp(t,i),l=Gp(e,i),c=o.get(l);if(c){Wp(t,i,c);return}var h=n?n(a,l,i+"",t,e,o):void 0,u=h===void 0;if(u){var d=Fp(l),p=!d&&Vx(l),g=!d&&!p&&Gx(l);h=l,d||p||g?Fp(a)?h=a:Hx(a)?h=qx(a):p?(u=!1,h=zx(l,!0)):g?(u=!1,h=$x(l,!0)):h=[]:Fx(l)||Kp(l)?(h=a,Kp(a)?h=Yx(a):(!Kx(a)||Wx(a))&&(h=Bx(l))):u=!1}u&&(o.set(l,h),r(h,l,s,n,o),o.delete(l)),Wp(t,i,h)}var Zx=Qx,Jx=iM,Xx=sy,ek=pM,tk=Zx,ik=Sr,sk=gy,rk=dy;function fy(t,e,i,s,r){t!==e&&ek(e,function(n,o){if(r||(r=new Jx),ik(n))tk(t,e,o,i,fy,s,r);else{var a=s?s(rk(t,o),n,o+"",t,e,r):void 0;a===void 0&&(a=n),Xx(t,o,a)}},sk)}var nk=fy;function ok(t){return t}var my=ok;function ak(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var ck=ak,lk=ck,Yp=Math.max;function hk(t,e,i){return e=Yp(e===void 0?t.length-1:e,0),function(){for(var s=arguments,r=-1,n=Yp(s.length-e,0),o=Array(n);++r<n;)o[r]=s[e+r];r=-1;for(var a=Array(e+1);++r<e;)a[r]=s[r];return a[e]=i(o),lk(t,this,a)}}var uk=hk;function dk(t){return function(){return t}}var pk=dk,gk=pk,Qp=iy,fk=my,mk=Qp?function(t,e){return Qp(t,"toString",{configurable:!0,enumerable:!1,value:gk(e),writable:!0})}:fk,wk=mk,yk=800,vk=16,bk=Date.now;function Ik(t){var e=0,i=0;return function(){var s=bk(),r=vk-(s-i);if(i=s,r>0){if(++e>=yk)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var Ek=Ik,Nk=wk,Ak=Ek,_k=Ak(Nk),Ck=_k,Sk=my,Pk=uk,Tk=Ck;function Mk(t,e){return Tk(Pk(t,e,Sk),t+"")}var Ok=Mk,xk=Yc,kk=ku,Dk=py,jk=Sr;function Rk(t,e,i){if(!jk(i))return!1;var s=typeof e;return(s=="number"?kk(i)&&Dk(e,i.length):s=="string"&&e in i)?xk(i[e],t):!1}var Uk=Rk,Lk=Ok,zk=Uk;function $k(t){return Lk(function(e,i){var s=-1,r=i.length,n=r>1?i[r-1]:void 0,o=r>2?i[2]:void 0;for(n=t.length>3&&typeof n=="function"?(r--,n):void 0,o&&zk(i[0],i[1],o)&&(n=r<3?void 0:n,r=1),e=Object(e);++s<r;){var a=i[s];a&&t(e,a,s,n)}return e})}var qk=$k,Bk=nk,Hk=qk,Vk=Hk(function(t,e,i){Bk(t,e,i)}),Wk=Vk,Kk=Object.defineProperty,Fk=Object.defineProperties,Gk=Object.getOwnPropertyDescriptors,Zp=Object.getOwnPropertySymbols,Yk=Object.prototype.hasOwnProperty,Qk=Object.prototype.propertyIsEnumerable,Jp=(t,e,i)=>e in t?Kk(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ua=(t,e)=>{for(var i in e||(e={}))Yk.call(e,i)&&Jp(t,i,e[i]);if(Zp)for(var i of Zp(e))Qk.call(e,i)&&Jp(t,i,e[i]);return t},Zk=(t,e)=>Fk(t,Gk(e));function mi(t,e,i){var s;const r=Tn(t);return((s=e.rpcMap)==null?void 0:s[r.reference])||`${Zw}?chainId=${r.namespace}:${r.reference}&projectId=${i}`}function Pr(t){return t.includes(":")?t.split(":")[1]:t}function wy(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function Jk(t,e){const i=Object.keys(e.namespaces).filter(r=>r.includes(t));if(!i.length)return[];const s=[];return i.forEach(r=>{const n=e.namespaces[r].accounts;s.push(...n)}),s}function Tl(t={},e={}){const i=Xp(t),s=Xp(e);return Wk(i,s)}function Xp(t){var e,i,s,r;const n={};if(!Go(t))return n;for(const[o,a]of Object.entries(t)){const l=Su(o)?[o]:a.chains,c=a.methods||[],h=a.events||[],u=a.rpcMap||{},d=Co(o);n[d]=Zk(Ua(Ua({},n[d]),a),{chains:sc(l,(e=n[d])==null?void 0:e.chains),methods:sc(c,(i=n[d])==null?void 0:i.methods),events:sc(h,(s=n[d])==null?void 0:s.events),rpcMap:Ua(Ua({},u),(r=n[d])==null?void 0:r.rpcMap)})}return n}function Xk(t){return t.includes(":")?t.split(":")[2]:t}function eg(t){const e={};for(const[i,s]of Object.entries(t)){const r=s.methods||[],n=s.events||[],o=s.accounts||[],a=Su(i)?[i]:s.chains?s.chains:wy(s.accounts);e[i]={chains:a,methods:r,events:n,accounts:o}}return e}function Ml(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const yy={},we=t=>yy[t],Ol=(t,e)=>{yy[t]=e};var eD=Object.defineProperty,tD=(t,e,i)=>e in t?eD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,$r=(t,e,i)=>tD(t,typeof e!="symbol"?e+"":e,i);class iD{constructor(e){$r(this,"name","polkadot"),$r(this,"client"),$r(this,"httpProviders"),$r(this,"events"),$r(this,"namespace"),$r(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=Pr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var sD=Object.defineProperty,rD=Object.defineProperties,nD=Object.getOwnPropertyDescriptors,tg=Object.getOwnPropertySymbols,oD=Object.prototype.hasOwnProperty,aD=Object.prototype.propertyIsEnumerable,jh=(t,e,i)=>e in t?sD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ig=(t,e)=>{for(var i in e||(e={}))oD.call(e,i)&&jh(t,i,e[i]);if(tg)for(var i of tg(e))aD.call(e,i)&&jh(t,i,e[i]);return t},sg=(t,e)=>rD(t,nD(e)),qr=(t,e,i)=>jh(t,typeof e!="symbol"?e+"":e,i);class cD{constructor(e){qr(this,"name","eip155"),qr(this,"client"),qr(this,"chainId"),qr(this,"namespace"),qr(this,"httpProviders"),qr(this,"events"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(parseInt(e),i),this.chainId=parseInt(e),this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,i){const s=i||mi(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=parseInt(Pr(i));e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}async handleSwitchChain(e){var i,s;let r=e.request.params?(i=e.request.params[0])==null?void 0:i.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;const n=parseInt(r,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var i,s,r;const n=(s=(i=e.request)==null?void 0:i.params)==null?void 0:s[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const o=this.client.session.get(e.topic),a=((r=o==null?void 0:o.sessionProperties)==null?void 0:r.capabilities)||{};if(a!=null&&a[n])return a==null?void 0:a[n];const l=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:sg(ig({},o.sessionProperties||{}),{capabilities:sg(ig({},a||{}),{[n]:l})})})}catch(c){console.warn("Failed to update session with capabilities",c)}return l}async getCallStatus(e){var i,s;const r=this.client.session.get(e.topic),n=(i=r.sessionProperties)==null?void 0:i.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from bundler",l,a)}}const o=(s=r.sessionProperties)==null?void 0:s.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,i){var s;const r=new URL(e),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Kt("eth_getUserOperationReceipt",[(s=i.request.params)==null?void 0:s[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,i){return`${cS}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${i}`}}var lD=Object.defineProperty,hD=(t,e,i)=>e in t?lD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Br=(t,e,i)=>hD(t,typeof e!="symbol"?e+"":e,i);class uD{constructor(e){Br(this,"name","solana"),Br(this,"client"),Br(this,"httpProviders"),Br(this,"events"),Br(this,"namespace"),Br(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=Pr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var dD=Object.defineProperty,pD=(t,e,i)=>e in t?dD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Hr=(t,e,i)=>pD(t,typeof e!="symbol"?e+"":e,i);class gD{constructor(e){Hr(this,"name","cosmos"),Hr(this,"client"),Hr(this,"httpProviders"),Hr(this,"events"),Hr(this,"namespace"),Hr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=Pr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var fD=Object.defineProperty,mD=(t,e,i)=>e in t?fD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Vr=(t,e,i)=>mD(t,typeof e!="symbol"?e+"":e,i);class wD{constructor(e){Vr(this,"name","algorand"),Vr(this,"client"),Vr(this,"httpProviders"),Vr(this,"events"),Vr(this,"namespace"),Vr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){if(!this.httpProviders[e]){const s=i||mi(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ye(new tt(s,we("disableProviderPing")))}}var yD=Object.defineProperty,vD=(t,e,i)=>e in t?yD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Wr=(t,e,i)=>vD(t,typeof e!="symbol"?e+"":e,i);class bD{constructor(e){Wr(this,"name","cip34"),Wr(this,"client"),Wr(this,"httpProviders"),Wr(this,"events"),Wr(this,"namespace"),Wr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{const s=this.getCardanoRPCUrl(i),r=Pr(i);e[r]=this.createHttpProvider(r,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}getCardanoRPCUrl(e){const i=this.namespace.rpcMap;if(i)return i[e]}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var ID=Object.defineProperty,ED=(t,e,i)=>e in t?ID(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Kr=(t,e,i)=>ED(t,typeof e!="symbol"?e+"":e,i);class ND{constructor(e){Kr(this,"name","elrond"),Kr(this,"client"),Kr(this,"httpProviders"),Kr(this,"events"),Kr(this,"namespace"),Kr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=Pr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var AD=Object.defineProperty,_D=(t,e,i)=>e in t?AD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Fr=(t,e,i)=>_D(t,typeof e!="symbol"?e+"":e,i);class CD{constructor(e){Fr(this,"name","multiversx"),Fr(this,"client"),Fr(this,"httpProviders"),Fr(this,"events"),Fr(this,"namespace"),Fr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=Pr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var SD=Object.defineProperty,PD=(t,e,i)=>e in t?SD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Gr=(t,e,i)=>PD(t,typeof e!="symbol"?e+"":e,i);class TD{constructor(e){Gr(this,"name","near"),Gr(this,"client"),Gr(this,"httpProviders"),Gr(this,"events"),Gr(this,"namespace"),Gr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||mi(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace);return typeof s>"u"?void 0:new Ye(new tt(s,we("disableProviderPing")))}}var MD=Object.defineProperty,OD=(t,e,i)=>e in t?MD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Yr=(t,e,i)=>OD(t,typeof e!="symbol"?e+"":e,i);class xD{constructor(e){Yr(this,"name","tezos"),Yr(this,"client"),Yr(this,"httpProviders"),Yr(this,"events"),Yr(this,"namespace"),Yr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||mi(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{e[i]=this.createHttpProvider(i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace);return typeof s>"u"?void 0:new Ye(new tt(s))}}var kD=Object.defineProperty,DD=(t,e,i)=>e in t?kD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Qr=(t,e,i)=>DD(t,typeof e!="symbol"?e+"":e,i);class jD{constructor(e){Qr(this,"name",fn),Qr(this,"client"),Qr(this,"httpProviders"),Qr(this,"events"),Qr(this,"namespace"),Qr(this,"chainId"),this.namespace=e.namespace,this.events=we("events"),this.client=we("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Ti.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){var e,i;const s={};return(i=(e=this.namespace)==null?void 0:e.accounts)==null||i.forEach(r=>{const n=Tn(r);s[`${n.namespace}:${n.reference}`]=this.createHttpProvider(r)}),s}getHttpProvider(e){const i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||mi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,we("disableProviderPing")))}}var RD=Object.defineProperty,UD=Object.defineProperties,LD=Object.getOwnPropertyDescriptors,rg=Object.getOwnPropertySymbols,zD=Object.prototype.hasOwnProperty,$D=Object.prototype.propertyIsEnumerable,Rh=(t,e,i)=>e in t?RD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,La=(t,e)=>{for(var i in e||(e={}))zD.call(e,i)&&Rh(t,i,e[i]);if(rg)for(var i of rg(e))$D.call(e,i)&&Rh(t,i,e[i]);return t},xl=(t,e)=>UD(t,LD(e)),Di=(t,e,i)=>Rh(t,typeof e!="symbol"?e+"":e,i);class Du{constructor(e){Di(this,"client"),Di(this,"namespaces"),Di(this,"optionalNamespaces"),Di(this,"sessionProperties"),Di(this,"events",new Hn),Di(this,"rpcProviders",{}),Di(this,"session"),Di(this,"providerOpts"),Di(this,"logger"),Di(this,"uri"),Di(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Vn(ys({level:(e==null?void 0:e.logger)||Op})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const i=new Du(e);return await i.initialize(),i}async request(e,i,s){const[r,n]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:La({},e),chainId:`${r}:${n}`,topic:this.session.topic,expiry:s})}sendAsync(e,i,s,r){const n=new Date().getTime();this.request(e,s,r).then(o=>i(null,Ws(n,o))).catch(o=>i(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Me("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,i){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:s,response:r}=await this.client.authenticate(e,i);s&&(this.uri=s,this.events.emit("display_uri",s));const n=await r();if(this.session=n.session,this.session){const o=eg(this.session.namespaces);this.namespaces=Tl(this.namespaces,o),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}removeListener(e,i){this.events.removeListener(e,i)}off(e,i){this.events.off(e,i)}get isWalletConnect(){return!0}async pair(e){const{uri:i,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});i&&(this.uri=i,this.events.emit("display_uri",i));const r=await s();this.session=r;const n=eg(r.namespaces);return this.namespaces=Tl(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,i){try{if(!this.session)return;const[s,r]=this.validateChain(e),n=this.getProvider(s);n.name===fn?n.setDefaultChain(`${s}:${r}`,i):n.setDefaultChain(r,i)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(mr(i)){for(const s of i)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await rS.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Op,relayUrl:this.providerOpts.relayUrl||nS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(i=>Co(i)))];Ol("client",this.client),Ol("events",this.events),Ol("disableProviderPing",this.disableProviderPing),e.forEach(i=>{if(!this.session)return;const s=Jk(i,this.session),r=wy(s),n=Tl(this.namespaces,this.optionalNamespaces),o=xl(La({},n[i]),{accounts:s,chains:r});switch(i){case"eip155":this.rpcProviders[i]=new cD({namespace:o});break;case"algorand":this.rpcProviders[i]=new wD({namespace:o});break;case"solana":this.rpcProviders[i]=new uD({namespace:o});break;case"cosmos":this.rpcProviders[i]=new gD({namespace:o});break;case"polkadot":this.rpcProviders[i]=new iD({namespace:o});break;case"cip34":this.rpcProviders[i]=new bD({namespace:o});break;case"elrond":this.rpcProviders[i]=new ND({namespace:o});break;case"multiversx":this.rpcProviders[i]=new CD({namespace:o});break;case"near":this.rpcProviders[i]=new TD({namespace:o});break;case"tezos":this.rpcProviders[i]=new xD({namespace:o});break;default:this.rpcProviders[fn]?this.rpcProviders[fn].updateNamespace(o):this.rpcProviders[fn]=new jD({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:i}=e,{event:s}=i;if(s.name==="accountsChanged"){const r=s.data;r&&mr(r)&&this.events.emit("accountsChanged",r.map(Xk))}else if(s.name==="chainChanged"){const r=i.chainId,n=i.event.data,o=Co(r),a=Ml(r)!==Ml(n)?`${o}:${Ml(n)}`:r;this.onChainChanged(a)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:i})=>{var s;const{namespaces:r}=i,n=(s=this.client)==null?void 0:s.session.get(e);this.session=xl(La({},n),{namespaces:r}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:i})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",xl(La({},Me("USER_DISCONNECTED")),{data:e.topic}))}),this.on(Ti.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[fn]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var i;this.getProvider(e).updateNamespace((i=this.session)==null?void 0:i.namespaces[e])})}setNamespaces(e){const{namespaces:i,optionalNamespaces:s,sessionProperties:r}=e;i&&Object.keys(i).length&&(this.namespaces=i),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=r,this.persist("namespaces",i),this.persist("optionalNamespaces",s)}validateChain(e){const[i,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,s];if(i&&!Object.keys(this.namespaces||{}).map(o=>Co(o)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&s)return[i,s];const r=Co(Object.keys(this.namespaces)[0]),n=this.rpcProviders[r].getDefaultChain();return[r,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,i=!1){if(!this.namespaces)return;const[s,r]=this.validateChain(e);r&&(i||this.getProvider(s).setDefaultChain(r),this.namespaces[s]?this.namespaces[s].defaultChain=r:this.namespaces[`${s}:${r}`]?this.namespaces[`${s}:${r}`].defaultChain=r:this.namespaces[`${s}:${r}`]={defaultChain:r},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",r))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,i){this.client.core.storage.setItem(`${xp}/${e}`,i)}async getFromStore(e){return await this.client.core.storage.getItem(`${xp}/${e}`)}}const qD=Du,vy={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return(t==null?void 0:t.filter(i=>i.chainNamespace===e))||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]}};var BD=20,HD=1,Qn=1e6,VD=1e6,WD=-7,KD=21,FD=!1,wa="[big.js] ",Tr=wa+"Invalid ",tl=Tr+"decimal places",GD=Tr+"rounding mode",by=wa+"Division by zero",Pe={},es=void 0,YD=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Iy(){function t(e){var i=this;if(!(i instanceof t))return e===es?Iy():new t(e);if(e instanceof t)i.s=e.s,i.e=e.e,i.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(Tr+"value");e=e===0&&1/e<0?"-0":String(e)}QD(i,e)}i.constructor=t}return t.prototype=Pe,t.DP=BD,t.RM=HD,t.NE=WD,t.PE=KD,t.strict=FD,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function QD(t,e){var i,s,r;if(!YD.test(e))throw Error(Tr+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(i=e.indexOf("."))>-1&&(e=e.replace(".","")),(s=e.search(/e/i))>0?(i<0&&(i=s),i+=+e.slice(s+1),e=e.substring(0,s)):i<0&&(i=e.length),r=e.length,s=0;s<r&&e.charAt(s)=="0";)++s;if(s==r)t.c=[t.e=0];else{for(;r>0&&e.charAt(--r)=="0";);for(t.e=i-s-1,t.c=[],i=0;s<=r;)t.c[i++]=+e.charAt(s++)}return t}function Mr(t,e,i,s){var r=t.c;if(i===es&&(i=t.constructor.RM),i!==0&&i!==1&&i!==2&&i!==3)throw Error(GD);if(e<1)s=i===3&&(s||!!r[0])||e===0&&(i===1&&r[0]>=5||i===2&&(r[0]>5||r[0]===5&&(s||r[1]!==es))),r.length=1,s?(t.e=t.e-e+1,r[0]=1):r[0]=t.e=0;else if(e<r.length){if(s=i===1&&r[e]>=5||i===2&&(r[e]>5||r[e]===5&&(s||r[e+1]!==es||r[e-1]&1))||i===3&&(s||!!r[0]),r.length=e,s){for(;++r[--e]>9;)if(r[e]=0,e===0){++t.e,r.unshift(1);break}}for(e=r.length;!r[--e];)r.pop()}return t}function Or(t,e,i){var s=t.e,r=t.c.join(""),n=r.length;if(e)r=r.charAt(0)+(n>1?"."+r.slice(1):"")+(s<0?"e":"e+")+s;else if(s<0){for(;++s;)r="0"+r;r="0."+r}else if(s>0)if(++s>n)for(s-=n;s--;)r+="0";else s<n&&(r=r.slice(0,s)+"."+r.slice(s));else n>1&&(r=r.charAt(0)+"."+r.slice(1));return t.s<0&&i?"-"+r:r}Pe.abs=function(){var t=new this.constructor(this);return t.s=1,t};Pe.cmp=function(t){var e,i=this,s=i.c,r=(t=new i.constructor(t)).c,n=i.s,o=t.s,a=i.e,l=t.e;if(!s[0]||!r[0])return s[0]?n:r[0]?-o:0;if(n!=o)return n;if(e=n<0,a!=l)return a>l^e?1:-1;for(o=(a=s.length)<(l=r.length)?a:l,n=-1;++n<o;)if(s[n]!=r[n])return s[n]>r[n]^e?1:-1;return a==l?0:a>l^e?1:-1};Pe.div=function(t){var e=this,i=e.constructor,s=e.c,r=(t=new i(t)).c,n=e.s==t.s?1:-1,o=i.DP;if(o!==~~o||o<0||o>Qn)throw Error(tl);if(!r[0])throw Error(by);if(!s[0])return t.s=n,t.c=[t.e=0],t;var a,l,c,h,u,d=r.slice(),p=a=r.length,g=s.length,f=s.slice(0,a),w=f.length,m=t,y=m.c=[],v=0,I=o+(m.e=e.e-t.e)+1;for(m.s=n,n=I<0?0:I,d.unshift(0);w++<a;)f.push(0);do{for(c=0;c<10;c++){if(a!=(w=f.length))h=a>w?1:-1;else for(u=-1,h=0;++u<a;)if(r[u]!=f[u]){h=r[u]>f[u]?1:-1;break}if(h<0){for(l=w==a?r:d;w;){if(f[--w]<l[w]){for(u=w;u&&!f[--u];)f[u]=9;--f[u],f[w]+=10}f[w]-=l[w]}for(;!f[0];)f.shift()}else break}y[v++]=h?c:++c,f[0]&&h?f[w]=s[p]||0:f=[s[p]]}while((p++<g||f[0]!==es)&&n--);return!y[0]&&v!=1&&(y.shift(),m.e--,I--),v>I&&Mr(m,I,i.RM,f[0]!==es),m};Pe.eq=function(t){return this.cmp(t)===0};Pe.gt=function(t){return this.cmp(t)>0};Pe.gte=function(t){return this.cmp(t)>-1};Pe.lt=function(t){return this.cmp(t)<0};Pe.lte=function(t){return this.cmp(t)<1};Pe.minus=Pe.sub=function(t){var e,i,s,r,n=this,o=n.constructor,a=n.s,l=(t=new o(t)).s;if(a!=l)return t.s=-l,n.plus(t);var c=n.c.slice(),h=n.e,u=t.c,d=t.e;if(!c[0]||!u[0])return u[0]?t.s=-l:c[0]?t=new o(n):t.s=1,t;if(a=h-d){for((r=a<0)?(a=-a,s=c):(d=h,s=u),s.reverse(),l=a;l--;)s.push(0);s.reverse()}else for(i=((r=c.length<u.length)?c:u).length,a=l=0;l<i;l++)if(c[l]!=u[l]){r=c[l]<u[l];break}if(r&&(s=c,c=u,u=s,t.s=-t.s),(l=(i=u.length)-(e=c.length))>0)for(;l--;)c[e++]=0;for(l=e;i>a;){if(c[--i]<u[i]){for(e=i;e&&!c[--e];)c[e]=9;--c[e],c[i]+=10}c[i]-=u[i]}for(;c[--l]===0;)c.pop();for(;c[0]===0;)c.shift(),--d;return c[0]||(t.s=1,c=[d=0]),t.c=c,t.e=d,t};Pe.mod=function(t){var e,i=this,s=i.constructor,r=i.s,n=(t=new s(t)).s;if(!t.c[0])throw Error(by);return i.s=t.s=1,e=t.cmp(i)==1,i.s=r,t.s=n,e?new s(i):(r=s.DP,n=s.RM,s.DP=s.RM=0,i=i.div(t),s.DP=r,s.RM=n,this.minus(i.times(t)))};Pe.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};Pe.plus=Pe.add=function(t){var e,i,s,r=this,n=r.constructor;if(t=new n(t),r.s!=t.s)return t.s=-t.s,r.minus(t);var o=r.e,a=r.c,l=t.e,c=t.c;if(!a[0]||!c[0])return c[0]||(a[0]?t=new n(r):t.s=r.s),t;if(a=a.slice(),e=o-l){for(e>0?(l=o,s=c):(e=-e,s=a),s.reverse();e--;)s.push(0);s.reverse()}for(a.length-c.length<0&&(s=c,c=a,a=s),e=c.length,i=0;e;a[e]%=10)i=(a[--e]=a[e]+c[e]+i)/10|0;for(i&&(a.unshift(i),++l),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=l,t};Pe.pow=function(t){var e=this,i=new e.constructor("1"),s=i,r=t<0;if(t!==~~t||t<-1e6||t>VD)throw Error(Tr+"exponent");for(r&&(t=-t);t&1&&(s=s.times(e)),t>>=1,!!t;)e=e.times(e);return r?i.div(s):s};Pe.prec=function(t,e){if(t!==~~t||t<1||t>Qn)throw Error(Tr+"precision");return Mr(new this.constructor(this),t,e)};Pe.round=function(t,e){if(t===es)t=0;else if(t!==~~t||t<-1e6||t>Qn)throw Error(tl);return Mr(new this.constructor(this),t+this.e+1,e)};Pe.sqrt=function(){var t,e,i,s=this,r=s.constructor,n=s.s,o=s.e,a=new r("0.5");if(!s.c[0])return new r(s);if(n<0)throw Error(wa+"No square root");n=Math.sqrt(+Or(s,!0,!0)),n===0||n===1/0?(e=s.c.join(""),e.length+o&1||(e+="0"),n=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),t=new r((n==1/0?"5e":(n=n.toExponential()).slice(0,n.indexOf("e")+1))+o)):t=new r(n+""),o=t.e+(r.DP+=4);do i=t,t=a.times(i.plus(s.div(i)));while(i.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return Mr(t,(r.DP-=4)+t.e+1,r.RM)};Pe.times=Pe.mul=function(t){var e,i=this,s=i.constructor,r=i.c,n=(t=new s(t)).c,o=r.length,a=n.length,l=i.e,c=t.e;if(t.s=i.s==t.s?1:-1,!r[0]||!n[0])return t.c=[t.e=0],t;for(t.e=l+c,o<a&&(e=r,r=n,n=e,c=o,o=a,a=c),e=new Array(c=o+a);c--;)e[c]=0;for(l=a;l--;){for(a=0,c=o+l;c>l;)a=e[c]+n[l]*r[c-l-1]+a,e[c--]=a%10,a=a/10|0;e[c]=a}for(a?++t.e:e.shift(),l=e.length;!e[--l];)e.pop();return t.c=e,t};Pe.toExponential=function(t,e){var i=this,s=i.c[0];if(t!==es){if(t!==~~t||t<0||t>Qn)throw Error(tl);for(i=Mr(new i.constructor(i),++t,e);i.c.length<t;)i.c.push(0)}return Or(i,!0,!!s)};Pe.toFixed=function(t,e){var i=this,s=i.c[0];if(t!==es){if(t!==~~t||t<0||t>Qn)throw Error(tl);for(i=Mr(new i.constructor(i),t+i.e+1,e),t=t+i.e+1;i.c.length<t;)i.c.push(0)}return Or(i,!1,!!s)};Pe[Symbol.for("nodejs.util.inspect.custom")]=Pe.toJSON=Pe.toString=function(){var t=this,e=t.constructor;return Or(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};Pe.toNumber=function(){var t=+Or(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(wa+"Imprecise conversion");return t};Pe.toPrecision=function(t,e){var i=this,s=i.constructor,r=i.c[0];if(t!==es){if(t!==~~t||t<1||t>Qn)throw Error(Tr+"precision");for(i=Mr(new s(i),t,e);i.c.length<t;)i.c.push(0)}return Or(i,t<=i.e||i.e<=s.NE||i.e>=s.PE,!!r)};Pe.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(wa+"valueOf disallowed");return Or(t,t.e<=e.NE||t.e>=e.PE,!0)};var po=Iy();const za={bigNumber(t){return t?new po(t):new po(0)},multiply(t,e){if(t===void 0||e===void 0)return new po(0);const i=new po(t),s=new po(e);return i.times(s)},formatNumberToLocalString(t,e=2){return t===void 0?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e})},parseLocalStringToNumber(t){return t===void 0?0:parseFloat(t.replace(/,/gu,""))}},ZD=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],JD=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],XD=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Y={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"ID_AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],HTTP_STATUS_CODES:{SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network"},e2={getERC20Abi:t=>Y.USDT_CONTRACT_ADDRESSES.includes(t)?XD:ZD,getSwapAbi:()=>JD},Is={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[i,s,r]=e;if(!i||!s||!r)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:i,chainId:s,address:r}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[i,s]=e;if(!i||!s)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:i,chainId:s}}},re={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache"};function kl(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const ee={setItem(t,e){So()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(So())return localStorage.getItem(t)||void 0},removeItem(t){So()&&localStorage.removeItem(t)},clear(){So()&&localStorage.clear()}};function So(){return typeof window<"u"&&typeof localStorage<"u"}function Us(t,e){return e==="light"?{"--w3m-accent":(t==null?void 0:t["--w3m-accent"])||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":(t==null?void 0:t["--w3m-accent"])||"hsla(230, 100%, 67%, 1)","--w3m-background":"#121313"}}const t2=Symbol(),ng=Object.getPrototypeOf,Uh=new WeakMap,i2=t=>t&&(Uh.has(t)?Uh.get(t):ng(t)===Object.prototype||ng(t)===Array.prototype),s2=t=>i2(t)&&t[t2]||null,og=(t,e=!0)=>{Uh.set(t,e)},Pc={},Dl=t=>typeof t=="object"&&t!==null,Ps=new WeakMap,Po=new WeakSet,r2=(t=Object.is,e=(c,h)=>new Proxy(c,h),i=c=>Dl(c)&&!Po.has(c)&&(Array.isArray(c)||!(Symbol.iterator in c))&&!(c instanceof WeakMap)&&!(c instanceof WeakSet)&&!(c instanceof Error)&&!(c instanceof Number)&&!(c instanceof Date)&&!(c instanceof String)&&!(c instanceof RegExp)&&!(c instanceof ArrayBuffer),s=c=>{switch(c.status){case"fulfilled":return c.value;case"rejected":throw c.reason;default:throw c}},r=new WeakMap,n=(c,h,u=s)=>{const d=r.get(c);if((d==null?void 0:d[0])===h)return d[1];const p=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c));return og(p,!0),r.set(c,[h,p]),Reflect.ownKeys(c).forEach(g=>{if(Object.getOwnPropertyDescriptor(p,g))return;const f=Reflect.get(c,g),{enumerable:w}=Reflect.getOwnPropertyDescriptor(c,g),m={value:f,enumerable:w,configurable:!0};if(Po.has(f))og(f,!1);else if(f instanceof Promise)delete m.value,m.get=()=>u(f);else if(Ps.has(f)){const[y,v]=Ps.get(f);m.value=n(y,v(),u)}Object.defineProperty(p,g,m)}),Object.preventExtensions(p)},o=new WeakMap,a=[1,1],l=c=>{if(!Dl(c))throw new Error("object required");const h=o.get(c);if(h)return h;let u=a[0];const d=new Set,p=(_,A=++a[0])=>{u!==A&&(u=A,d.forEach(M=>M(_,A)))};let g=a[1];const f=(_=++a[1])=>(g!==_&&!d.size&&(g=_,m.forEach(([A])=>{const M=A[1](_);M>u&&(u=M)})),u),w=_=>(A,M)=>{const k=[...A];k[1]=[_,...k[1]],p(k,M)},m=new Map,y=(_,A)=>{if((Pc?"production":void 0)!=="production"&&m.has(_))throw new Error("prop listener already exists");if(d.size){const M=A[3](w(_));m.set(_,[A,M])}else m.set(_,[A])},v=_=>{var A;const M=m.get(_);M&&(m.delete(_),(A=M[1])==null||A.call(M))},I=_=>(d.add(_),d.size===1&&m.forEach(([A,M],k)=>{if((Pc?"production":void 0)!=="production"&&M)throw new Error("remove already exists");const B=A[3](w(k));m.set(k,[A,B])}),()=>{d.delete(_),d.size===0&&m.forEach(([A,M],k)=>{M&&(M(),m.set(k,[A]))})}),S=Array.isArray(c)?[]:Object.create(Object.getPrototypeOf(c)),T=e(S,{deleteProperty(_,A){const M=Reflect.get(_,A);v(A);const k=Reflect.deleteProperty(_,A);return k&&p(["delete",[A],M]),k},set(_,A,M,k){const B=Reflect.has(_,A),$=Reflect.get(_,A,k);if(B&&(t($,M)||o.has(M)&&t($,o.get(M))))return!0;v(A),Dl(M)&&(M=s2(M)||M);let q=M;if(M instanceof Promise)M.then(L=>{M.status="fulfilled",M.value=L,p(["resolve",[A],L])}).catch(L=>{M.status="rejected",M.reason=L,p(["reject",[A],L])});else{!Ps.has(M)&&i(M)&&(q=l(M));const L=!Po.has(q)&&Ps.get(q);L&&y(A,L)}return Reflect.set(_,A,q,k),p(["set",[A],M,$]),!0}});o.set(c,T);const P=[S,f,n,I];return Ps.set(T,P),Reflect.ownKeys(c).forEach(_=>{const A=Object.getOwnPropertyDescriptor(c,_);"value"in A&&(T[_]=c[_],delete A.value,delete A.writable),Object.defineProperty(S,_,A)}),T})=>[l,Ps,Po,t,e,i,s,r,n,o,a],[n2]=r2();function Je(t={}){return n2(t)}function Ft(t,e,i){const s=Ps.get(t);(Pc?"production":void 0)!=="production"&&!s&&console.warn("Please use proxy object");let r;const n=[],o=s[3];let a=!1;const l=o(c=>{n.push(c),r||(r=Promise.resolve().then(()=>{r=void 0,a&&e(n.splice(0))}))});return a=!0,()=>{a=!1,l()}}function Yo(t,e){const i=Ps.get(t);(Pc?"production":void 0)!=="production"&&!i&&console.warn("Please use proxy object");const[s,r,n]=i;return n(s,r(),e)}function wr(t){return Po.add(t),t}function vi(t,e,i,s){let r=t[e];return Ft(t,()=>{const n=t[e];Object.is(r,n)||i(r=n)})}function o2(t){const e=Je({data:Array.from([]),has(i){return this.data.some(s=>s[0]===i)},set(i,s){const r=this.data.find(n=>n[0]===i);return r?r[1]=s:this.data.push([i,s]),this},get(i){var s;return(s=this.data.find(r=>r[0]===i))==null?void 0:s[1]},delete(i){const s=this.data.findIndex(r=>r[0]===i);return s===-1?!1:(this.data.splice(s,1),!0)},clear(){this.data.splice(0)},get size(){return this.data.length},toJSON(){return new Map(this.data)},forEach(i){this.data.forEach(s=>{i(s[1],s[0],this)})},keys(){return this.data.map(i=>i[0]).values()},values(){return this.data.map(i=>i[1]).values()},entries(){return new Map(this.data).entries()},get[Symbol.toStringTag](){return"Map"},[Symbol.iterator](){return this.entries()}});return Object.defineProperties(e,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(e),e}const jl=(typeof N.process<"u"&&typeof N.process.env<"u"?N.process.env.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",ni={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:jl,SECURE_SITE_DASHBOARD:`${jl}/dashboard`,SECURE_SITE_FAVICON:`${jl}/images/favicon.png`,RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],WC_COINBASE_PAY_SDK_CHAINS:["ethereum","arbitrum","polygon","berachain","avalanche-c-chain","optimism","celo","base"],WC_COINBASE_PAY_SDK_FALLBACK_CHAIN:"ethereum",WC_COINBASE_PAY_SDK_CHAIN_NAME_MAP:{Ethereum:"ethereum","Arbitrum One":"arbitrum",Polygon:"polygon",Berachain:"berachain",Avalanche:"avalanche-c-chain","OP Mainnet":"optimism",Celo:"celo",Base:"base"},WC_COINBASE_ONRAMP_APP_ID:"bf18c88d-495a-463b-b249-0b9d3656cf5e",SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],BALANCE_SUPPORTED_CHAINS:["eip155","solana"],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:["eip155"],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:["eip155","solana"],ACTIVITY_ENABLED_CHAIN_NAMESPACES:["eip155","solana"],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in a new browser tab"},DEFAULT_FEATURES:{swaps:!0,onramp:!0,receive:!0,send:!0,email:!0,emailShowWallets:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],history:!0,analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0},DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"}},G={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=G.getActiveNamespace(),e=G.getActiveCaipNetworkId(),i=e?e.split(":")[1]:void 0,s=i?isNaN(Number(i))?i:Number(i):void 0;return{namespace:t,caipNetworkId:e,chainId:s}},setWalletConnectDeepLink({name:t,href:e}){try{ee.setItem(re.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=ee.getItem(re.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{ee.removeItem(re.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{ee.setItem(re.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{ee.setItem(re.ACTIVE_CAIP_NETWORK_ID,t),G.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return ee.getItem(re.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{ee.removeItem(re.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=kl(t);ee.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=G.getRecentWallets();e.find(i=>i.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),ee.setItem(re.RECENT_WALLETS,JSON.stringify(e)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=ee.getItem(re.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},setConnectedConnectorId(t,e){try{const i=kl(t);ee.setItem(i,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return ee.getItem(re.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=kl(t);return ee.getItem(e)}catch{console.info("Unable to get connected connector id in namespace ",t)}},setConnectedSocialProvider(t){try{ee.setItem(re.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return ee.getItem(re.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{ee.removeItem(re.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return ee.getItem(re.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var t;const e=ee.getItem(re.ACTIVE_CAIP_NETWORK_ID);return(t=e==null?void 0:e.split(":"))==null?void 0:t[1]},setConnectionStatus(t){try{ee.setItem(re.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return ee.getItem(re.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=ee.getItem(re.CONNECTED_NAMESPACES);return t!=null&&t.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));ee.setItem(re.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=G.getConnectedNamespaces();e.includes(t)||(e.push(t),G.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=G.getConnectedNamespaces(),i=e.indexOf(t);i>-1&&(e.splice(i,1),G.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return ee.getItem(re.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{ee.setItem(re.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{ee.removeItem(re.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=ee.getItem(re.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=G.getBalanceCache();ee.setItem(re.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const e=G.getBalanceCache()[t];if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.portfolio))return e.balance;G.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=G.getBalanceCache();e[t.caipAddress]=t,ee.setItem(re.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=ee.getItem(re.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=G.getBalanceCache();ee.setItem(re.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const e=G.getNativeBalanceCache()[t];if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.nativeBalance))return e;console.info("Discarding cache for address",t),G.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=G.getNativeBalanceCache();e[t.caipAddress]=t,ee.setItem(re.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=ee.getItem(re.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const e=G.getEnsCache()[t];if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.ens))return e.ens;G.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=G.getEnsCache();e[t.address]=t,ee.setItem(re.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=G.getEnsCache();ee.setItem(re.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=ee.getItem(re.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const e=G.getIdentityCache()[t];if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.identity))return e.identity;G.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=G.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},ee.setItem(re.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=G.getIdentityCache();ee.setItem(re.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},clearAddressCache(){try{ee.removeItem(re.PORTFOLIO_CACHE),ee.removeItem(re.NATIVE_BALANCE_CACHE),ee.removeItem(re.ENS_CACHE),ee.removeItem(re.IDENTITY_CACHE)}catch{console.info("Unable to clear address cache")}}},ie={isMobile(){var t;return this.isClient()?!!((t=window==null?void 0:window.matchMedia("(pointer:coarse)"))!=null&&t.matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t==null?void 0:t.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return ie.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=ni.TEN_SEC_MS:!0},isAllowedRetry(t,e=ni.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},getPairingExpiry(){return Date.now()+ni.FOUR_MINUTES_MS},getNetworkId(t){return t==null?void 0:t.split(":")[1]},getPlainAddress(t){return t==null?void 0:t.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let i;return(...s)=>{function r(){t(...s)}i&&clearTimeout(i),i=setTimeout(r,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e){if(ie.isHttpUrl(t))return this.formatUniversalUrl(t,e);let i=t;i.includes("://")||(i=t.replaceAll("/","").replaceAll(":",""),i=`${i}://`),i.endsWith("/")||(i=`${i}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const s=encodeURIComponent(e);return{redirect:`${i}wc?uri=${s}`,href:i}},formatUniversalUrl(t,e){if(!ie.isHttpUrl(t))return this.formatNativeUrl(t,e);let i=t;i.endsWith("/")||(i=`${i}/`);const s=encodeURIComponent(e);return{redirect:`${i}wc?uri=${s}`,href:i}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?G.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,i){window==null||window.open(t,this.getOpenTargetForPlatform(e),i||"noreferrer noopener")},returnOpenHref(t,e,i){return window==null?void 0:window.open(t,this.getOpenTargetForPlatform(e),i||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},async preloadImage(t){const e=new Promise((i,s)=>{const r=new Image;r.onload=i,r.onerror=s,r.crossOrigin="anonymous",r.src=t});return Promise.race([e,ie.wait(2e3)])},formatBalance(t,e){let i="0.000";if(typeof t=="string"){const s=Number(t);if(s){const r=Math.floor(s*1e3)/1e3;r&&(i=r.toString())}}return`${i}${e?` ${e}`:""}`},formatBalance2(t,e){var i;let s;if(t==="0")s="0";else if(typeof t=="string"){const r=Number(t);r&&(s=(i=r.toString().match(/^-?\d+(?:\.\d{0,3})?/u))==null?void 0:i[0])}return{value:s??"0",rest:s==="0"?"000":"",symbol:e}},getApiUrl(){return Y.W3M_API_URL},getBlockchainApiUrl(){return Y.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return Y.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){var e,i;return typeof t=="string"?t:typeof((i=(e=t==null?void 0:t.issues)==null?void 0:e[0])==null?void 0:i.message)=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const i={};return e&&t&&(t.forEach((s,r)=>{i[s]=r}),e.sort((s,r)=>{const n=i[s.id],o=i[r.id];return n!==void 0&&o!==void 0?n-o:n!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const i of t)e+=i.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[i,s]=e.split(".");return{dollars:i,pennies:s}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);default:return!1}},uniqueBy(t,e){const i=new Set;return t.filter(s=>{const r=s[e];return i.has(r)?!1:(i.add(r),!0)})},generateSdkVersion(t,e,i){const s=t.length===0?ni.ADAPTER_TYPES.UNIVERSAL:t.map(r=>r.adapterType).join(",");return`${e}-${s}-${i}`},createAccount(t,e,i,s,r){return{namespace:t,address:e,type:i,publicKey:s,path:r}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),i=e[0];return e.filter(Boolean).length===3&&i in Y.CHAIN_NAME_MAP},isMac(){const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,i="state=";if(new URL(t).host==="auth.magic.link"){const s="provider_authorization_url=",r=t.substring(t.indexOf(s)+s.length),n=this.injectIntoUrl(decodeURIComponent(r),i,e);return t.replace(r,encodeURIComponent(n))}return this.injectIntoUrl(t,i,e)},injectIntoUrl(t,e,i){const s=t.indexOf(e);if(s===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const r=t.indexOf("&",s),n=e.length,o=r!==-1?r:t.length,a=t.substring(0,s+n),l=t.substring(s+n,o),c=t.substring(r),h=l+i;return a+h+c}};async function go(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class il{constructor({baseUrl:e,clientId:i}){this.baseUrl=e,this.clientId=i}async get({headers:e,signal:i,cache:s,...r}){const n=this.createUrl(r);return(await go(n,{method:"GET",headers:e,signal:i,cache:s})).json()}async getBlob({headers:e,signal:i,...s}){const r=this.createUrl(s);return(await go(r,{method:"GET",headers:e,signal:i})).blob()}async post({body:e,headers:i,signal:s,...r}){const n=this.createUrl(r);return(await go(n,{method:"POST",headers:i,body:e?JSON.stringify(e):void 0,signal:s})).json()}async put({body:e,headers:i,signal:s,...r}){const n=this.createUrl(r);return(await go(n,{method:"PUT",headers:i,body:e?JSON.stringify(e):void 0,signal:s})).json()}async delete({body:e,headers:i,signal:s,...r}){const n=this.createUrl(r);return(await go(n,{method:"DELETE",headers:i,body:e?JSON.stringify(e):void 0,signal:s})).json()}createUrl({path:e,params:i}){const s=new URL(e,this.baseUrl);return i&&Object.entries(i).forEach(([r,n])=>{n&&s.searchParams.append(r,n)}),this.clientId&&s.searchParams.append("clientId",this.clientId),s}}const a2={handleSolanaDeeplinkRedirect(t){if(b.state.activeChain===Y.CHAIN.SOLANA){const e=window.location.href,i=encodeURIComponent(e);if(t==="Phantom"&&!("phantom"in window)){const s=e.startsWith("https")?"https":"http",r=e.split("/")[2],n=encodeURIComponent(`${s}://${r}`);window.location.href=`https://phantom.app/ul/browse/${i}?ref=${n}`}t==="Coinbase Wallet"&&!("coinbaseSolana"in window)&&(window.location.href=`https://go.cb-w.com/dapp?cb_url=${i}`)}}},oi=Je({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),$i={state:oi,subscribeNetworkImages(t){return Ft(oi.networkImages,()=>t(oi.networkImages))},subscribeKey(t,e){return vi(oi,t,e)},subscribe(t){return Ft(oi,()=>t(oi))},setWalletImage(t,e){oi.walletImages[t]=e},setNetworkImage(t,e){oi.networkImages[t]=e},setChainImage(t,e){oi.chainImages[t]=e},setConnectorImage(t,e){oi.connectorImages={...oi.connectorImages,[t]:e}},setTokenImage(t,e){oi.tokenImages[t]=e},setCurrencyImage(t,e){oi.currencyImages[t]=e}},c2={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00"},Rl=Je({networkImagePromises:{}}),Ey={async fetchWalletImage(t){if(t)return await se._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){return t?this.getNetworkImageById(t)||(Rl.networkImagePromises[t]||(Rl.networkImagePromises[t]=se._fetchNetworkImage(t)),await Rl.networkImagePromises[t],this.getNetworkImageById(t)):void 0},getWalletImageById(t){if(t)return $i.state.walletImages[t]},getWalletImage(t){if(t!=null&&t.image_url)return t==null?void 0:t.image_url;if(t!=null&&t.image_id)return $i.state.walletImages[t.image_id]},getNetworkImage(t){var e,i,s;if((e=t==null?void 0:t.assets)!=null&&e.imageUrl)return(i=t==null?void 0:t.assets)==null?void 0:i.imageUrl;if((s=t==null?void 0:t.assets)!=null&&s.imageId)return $i.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return $i.state.networkImages[t]},getConnectorImage(t){if(t!=null&&t.imageUrl)return t.imageUrl;if(t!=null&&t.imageId)return $i.state.connectorImages[t.imageId]},getChainImage(t){return $i.state.networkImages[c2[t]]}},l2={getFeatureValue(t,e){const i=e==null?void 0:e[t];return i===void 0?ni.DEFAULT_FEATURES[t]:i},filterSocialsByPlatform(t){if(!t||!t.length)return t;if(ie.isTelegram()){if(ie.isIos())return t.filter(e=>e!=="google");if(ie.isMac())return t.filter(e=>e!=="x");if(ie.isAndroid())return t.filter(e=>!["facebook","x"].includes(e))}return t}},J=Je({features:ni.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:ni.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0}),D={state:J,subscribeKey(t,e){return vi(J,t,e)},setOptions(t){Object.assign(J,t)},setFeatures(t){if(!t)return;J.features||(J.features=ni.DEFAULT_FEATURES);const e={...J.features,...t};J.features=e,J.features.socials&&(J.features.socials=l2.filterSocialsByPlatform(J.features.socials))},setProjectId(t){J.projectId=t},setCustomRpcUrls(t){J.customRpcUrls=t},setAllWallets(t){J.allWallets=t},setIncludeWalletIds(t){J.includeWalletIds=t},setExcludeWalletIds(t){J.excludeWalletIds=t},setFeaturedWalletIds(t){J.featuredWalletIds=t},setTokens(t){J.tokens=t},setTermsConditionsUrl(t){J.termsConditionsUrl=t},setPrivacyPolicyUrl(t){J.privacyPolicyUrl=t},setCustomWallets(t){J.customWallets=t},setIsSiweEnabled(t){J.isSiweEnabled=t},setIsUniversalProvider(t){J.isUniversalProvider=t},setSdkVersion(t){J.sdkVersion=t},setMetadata(t){J.metadata=t},setDisableAppend(t){J.disableAppend=t},setEIP6963Enabled(t){J.enableEIP6963=t},setDebug(t){J.debug=t},setEnableWalletConnect(t){J.enableWalletConnect=t},setEnableWalletGuide(t){J.enableWalletGuide=t},setEnableAuthLogger(t){J.enableAuthLogger=t},setEnableWallets(t){J.enableWallets=t},setHasMultipleAddresses(t){J.hasMultipleAddresses=t},setSIWX(t){J.siwx=t},setConnectMethodsOrder(t){J.features={...J.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){J.features={...J.features,walletFeaturesOrder:t}},setSocialsOrder(t){J.features={...J.features,socials:t}},setCollapseWallets(t){J.features={...J.features,collapseWallets:t}},setEnableEmbedded(t){J.enableEmbedded=t},setAllowUnsupportedChain(t){J.allowUnsupportedChain=t},setManualWCControl(t){J.manualWCControl=t},setEnableNetworkSwitch(t){J.enableNetworkSwitch=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,i])=>{i&&(J.defaultAccountTypes[e]=i)})},setUniversalProviderConfigOverride(t){J.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return J.universalProviderConfigOverride},getSnapshot(){return Yo(J)}},Es=Je({message:"",variant:"info",open:!1}),ac={state:Es,subscribeKey(t,e){return vi(Es,t,e)},open(t,e){const{debug:i}=D.state,{shortMessage:s,longMessage:r}=t;i&&(Es.message=s,Es.variant=e,Es.open=!0),r&&console.error(typeof r=="function"?r():r)},close(){Es.open=!1,Es.message="",Es.variant="info"}},h2=ie.getAnalyticsUrl(),u2=new il({baseUrl:h2,clientId:null}),d2=["MODAL_CREATED"],os=Je({timestamp:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"}}),ze={state:os,subscribe(t){return Ft(os,()=>t(os))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:i}=D.state;return{projectId:t,st:e,sv:i||"html-wagmi-4.2.2"}},async _sendAnalyticsEvent(t){try{const e=Z.state.address;if(d2.includes(t.data.event)||typeof window>"u")return;await u2.post({path:"/e",params:ze.getSdkProperties(),body:{eventId:ie.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:e}}}),os.reportedErrors.FORBIDDEN=!1}catch(e){e instanceof Error&&e.cause instanceof Response&&e.cause.status===Y.HTTP_STATUS_CODES.FORBIDDEN&&!os.reportedErrors.FORBIDDEN&&(ac.open({shortMessage:"Invalid App Configuration",longMessage:`Origin ${So()?window.origin:"uknown"} not found on Allowlist - update configuration on cloud.reown.com`},"error"),os.reportedErrors.FORBIDDEN=!0)}},sendEvent(t){var e;os.timestamp=Date.now(),os.data=t,(e=D.state.features)!=null&&e.analytics&&ze._sendAnalyticsEvent(os)}},p2=ie.getApiUrl(),Ut=new il({baseUrl:p2,clientId:null}),g2="40",ag="4",f2=20,_e=Je({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1}),se={state:_e,subscribeKey(t,e){return vi(_e,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:i}=D.state;return{projectId:t,st:e||"appkit",sv:i||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return D.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${Ut.baseUrl}/getWalletImage/${t}`,i=await Ut.getBlob({path:e,params:se._getSdkProperties()});$i.setWalletImage(t,URL.createObjectURL(i))},async _fetchNetworkImage(t){const e=`${Ut.baseUrl}/public/getAssetImage/${t}`,i=await Ut.getBlob({path:e,params:se._getSdkProperties()});$i.setNetworkImage(t,URL.createObjectURL(i))},async _fetchConnectorImage(t){const e=`${Ut.baseUrl}/public/getAssetImage/${t}`,i=await Ut.getBlob({path:e,params:se._getSdkProperties()});$i.setConnectorImage(t,URL.createObjectURL(i))},async _fetchCurrencyImage(t){const e=`${Ut.baseUrl}/public/getCurrencyImage/${t}`,i=await Ut.getBlob({path:e,params:se._getSdkProperties()});$i.setCurrencyImage(t,URL.createObjectURL(i))},async _fetchTokenImage(t){const e=`${Ut.baseUrl}/public/getTokenImage/${t}`,i=await Ut.getBlob({path:e,params:se._getSdkProperties()});$i.setTokenImage(t,URL.createObjectURL(i))},async fetchNetworkImages(){const t=b.getAllRequestedCaipNetworks(),e=t==null?void 0:t.map(({assets:i})=>i==null?void 0:i.imageId).filter(Boolean).filter(i=>!Ey.getNetworkImageById(i));e&&await Promise.allSettled(e.map(i=>se._fetchNetworkImage(i)))},async fetchConnectorImages(){const{connectors:t}=te.state,e=t.map(({imageId:i})=>i).filter(Boolean);await Promise.allSettled(e.map(i=>se._fetchConnectorImage(i)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>se._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>se._fetchTokenImage(e)))},async fetchFeaturedWallets(){const{featuredWalletIds:t}=D.state;if(t!=null&&t.length){const{data:e}=await Ut.get({path:"/getWallets",params:{...se._getSdkProperties(),page:"1",entries:t!=null&&t.length?String(t.length):ag,include:t==null?void 0:t.join(",")}});e.sort((s,r)=>t.indexOf(s.id)-t.indexOf(r.id));const i=e.map(s=>s.image_id).filter(Boolean);await Promise.allSettled(i.map(s=>se._fetchWalletImage(s))),_e.featured=e,_e.allFeatured=e}},async fetchRecommendedWallets(){try{_e.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:i}=D.state,s=[...e??[],...i??[]].filter(Boolean),r=b.getRequestedCaipNetworkIds().join(","),{data:n,count:o}=await Ut.get({path:"/getWallets",params:{...se._getSdkProperties(),page:"1",chains:r,entries:ag,include:t==null?void 0:t.join(","),exclude:s==null?void 0:s.join(",")}}),a=G.getRecentWallets(),l=n.map(h=>h.image_id).filter(Boolean),c=a.map(h=>h.image_id).filter(Boolean);await Promise.allSettled([...l,...c].map(h=>se._fetchWalletImage(h))),_e.recommended=n,_e.allRecommended=n,_e.count=o??0}catch{}finally{_e.isFetchingRecommendedWallets=!1}},async fetchWallets({page:t}){const{includeWalletIds:e,excludeWalletIds:i,featuredWalletIds:s}=D.state,r=b.getRequestedCaipNetworkIds().join(","),n=[..._e.recommended.map(({id:c})=>c),...i??[],...s??[]].filter(Boolean),{data:o,count:a}=await Ut.get({path:"/getWallets",params:{...se._getSdkProperties(),page:String(t),entries:g2,chains:r,include:e==null?void 0:e.join(","),exclude:n.join(",")}}),l=o.slice(0,f2).map(c=>c.image_id).filter(Boolean);await Promise.allSettled(l.map(c=>se._fetchWalletImage(c))),_e.wallets=ie.uniqueBy([..._e.wallets,...se._filterOutExtensions(o)],"id"),_e.count=a>_e.count?a:_e.count,_e.page=t},async initializeExcludedWallets({ids:t}){const e=b.getRequestedCaipNetworkIds().join(","),{data:i}=await Ut.get({path:"/getWallets",params:{...se._getSdkProperties(),page:"1",entries:String(t.length),chains:e,include:t==null?void 0:t.join(",")}});i&&i.forEach(s=>{s!=null&&s.rdns&&_e.excludedWallets.push({rdns:s.rdns,name:s.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:i,excludeWalletIds:s}=D.state;_e.search=[];const r=b.getRequestedCaipNetworkIds().join(","),{data:n}=await Ut.get({path:"/getWallets",params:{...se._getSdkProperties(),page:"1",entries:"100",search:t==null?void 0:t.trim(),badge_type:e,chains:r,include:i==null?void 0:i.join(","),exclude:s==null?void 0:s.join(",")}});ze.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const o=n.map(a=>a.image_id).filter(Boolean);await Promise.allSettled([...o.map(a=>se._fetchWalletImage(a)),ie.wait(300)]),_e.search=se._filterOutExtensions(n)},initPromise(t,e){return _e.promises[t]||(_e.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:i=!0,fetchNetworkImages:s=!0}={}){const r=[t&&se.initPromise("connectorImages",se.fetchConnectorImages),e&&se.initPromise("featuredWallets",se.fetchFeaturedWallets),i&&se.initPromise("recommendedWallets",se.fetchRecommendedWallets),s&&se.initPromise("networkImages",se.fetchNetworkImages)].filter(Boolean);return Promise.allSettled(r)},prefetchAnalyticsConfig(){var t;(t=D.state.features)!=null&&t.analytics&&se.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await Ut.get({path:"/getAnalyticsConfig",params:se._getSdkProperties()});D.setFeatures({analytics:t})}catch{D.setFeatures({analytics:!1})}},setFilterByNamespace(t){if(!t){_e.featured=_e.allFeatured,_e.recommended=_e.allRecommended;return}const e=b.getRequestedCaipNetworkIds().join(",");_e.featured=_e.allFeatured.filter(i=>{var s;return(s=i.chains)==null?void 0:s.some(r=>e.includes(r))}),_e.recommended=_e.allRecommended.filter(i=>{var s;return(s=i.chains)==null?void 0:s.some(r=>e.includes(r))})}},be=Je({view:"Connect",history:["Connect"],transactionStack:[]}),Se={state:be,subscribeKey(t,e){return vi(be,t,e)},pushTransactionStack(t){be.transactionStack.push(t)},popTransactionStack(t){var e,i;const s=be.transactionStack.pop();if(s)if(t)this.goBack(),(e=s==null?void 0:s.onCancel)==null||e.call(s);else{if(s.goBack)this.goBack();else if(s.replace){const r=be.history.indexOf("ConnectingSiwe");r>0?this.goBackToIndex(r-1):(ct.close(),be.history=[])}else s.view&&this.reset(s.view);(i=s==null?void 0:s.onSuccess)==null||i.call(s)}},push(t,e){t!==be.view&&(be.view=t,be.history.push(t),be.data=e)},reset(t,e){be.view=t,be.history=[t],be.data=e},replace(t,e){be.history.at(-1)===t||(be.view=t,be.history[be.history.length-1]=t,be.data=e)},goBack(){var t;const e=!b.state.activeCaipAddress&&this.state.view==="ConnectingFarcaster";if(be.history.length>1&&!be.history.includes("UnsupportedChain")){be.history.pop();const[i]=be.history.slice(-1);i&&(be.view=i)}else ct.close();(t=be.data)!=null&&t.wallet&&(be.data.wallet=void 0),setTimeout(()=>{var i,s,r;if(e){Z.setFarcasterUrl(void 0,b.state.activeChain);const n=te.getAuthConnector();(i=n==null?void 0:n.provider)==null||i.reload();const o=Yo(D.state);(r=(s=n==null?void 0:n.provider)==null?void 0:s.syncDappData)==null||r.call(s,{metadata:o.metadata,sdkVersion:o.sdkVersion,projectId:o.projectId,sdkType:o.sdkType})}},100)},goBackToIndex(t){if(be.history.length>1){be.history=be.history.slice(0,t+1);const[e]=be.history.slice(-1);e&&(be.view=e)}}},as=Je({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),Wt={state:as,subscribe(t){return Ft(as,()=>t(as))},setThemeMode(t){as.themeMode=t;try{const e=te.getAuthConnector();if(e){const i=Wt.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:i,w3mThemeVariables:Us(i,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){as.themeVariables={...as.themeVariables,...t};try{const e=te.getAuthConnector();if(e){const i=Wt.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:i,w3mThemeVariables:Us(as.themeVariables,as.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return Yo(as)}},Ny={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0},Ce=Je({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:{...Ny}}),te={state:Ce,subscribe(t){return Ft(Ce,()=>{t(Ce)})},subscribeKey(t,e){return vi(Ce,t,e)},initialize(t){t.forEach(e=>{const i=G.getConnectedConnectorId(e);i&&this.setConnectorId(i,e)})},setActiveConnector(t){t&&(Ce.activeConnector=wr(t))},setConnectors(t){t.filter(e=>!Ce.allConnectors.some(i=>i.id===e.id&&this.getConnectorName(i.name)===this.getConnectorName(e.name)&&i.chain===e.chain)).forEach(e=>{e.type!=="MULTI_CHAIN"&&Ce.allConnectors.push(wr(e))}),Ce.connectors=this.mergeMultiChainConnectors(Ce.allConnectors)},removeAdapter(t){Ce.allConnectors=Ce.allConnectors.filter(e=>e.chain!==t),Ce.connectors=this.mergeMultiChainConnectors(Ce.allConnectors)},mergeMultiChainConnectors(t){const e=this.generateConnectorMapByName(t),i=[];return e.forEach(s=>{const r=s[0],n=(r==null?void 0:r.id)===Y.CONNECTOR_ID.AUTH;s.length>1&&r?i.push({name:r.name,imageUrl:r.imageUrl,imageId:r.imageId,connectors:[...s],type:n?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(r==null?void 0:r.id)||""}):r&&i.push(r)}),i},generateConnectorMapByName(t){const e=new Map;return t.forEach(i=>{const{name:s}=i,r=this.getConnectorName(s);if(!r)return;const n=e.get(r)||[];n.find(o=>o.chain===i.chain)||n.push(i),e.set(r,n)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(i=>{e.find(s=>s.chain===i.chain)||e.push(i)}),e},addConnector(t){var e,i,s;if(t.id===Y.CONNECTOR_ID.AUTH){const r=t,n=Yo(D.state),o=Wt.getSnapshot().themeMode,a=Wt.getSnapshot().themeVariables;(i=(e=r==null?void 0:r.provider)==null?void 0:e.syncDappData)==null||i.call(e,{metadata:n.metadata,sdkVersion:n.sdkVersion,projectId:n.projectId,sdkType:n.sdkType}),(s=r==null?void 0:r.provider)==null||s.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:Us(a,o)}),this.setConnectors([t])}else this.setConnectors([t])},getAuthConnector(t){var e;const i=t||b.state.activeChain,s=Ce.connectors.find(r=>r.id===Y.CONNECTOR_ID.AUTH);if(s)return(e=s==null?void 0:s.connectors)!=null&&e.length?s.connectors.find(r=>r.chain===i):s},getAnnouncedConnectorRdns(){return Ce.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>{var e;return(e=t.info)==null?void 0:e.rdns})},getConnectorById(t){return Ce.allConnectors.find(e=>e.id===t)},getConnector(t,e){return Ce.allConnectors.filter(i=>i.chain===b.state.activeChain).find(i=>{var s;return i.explorerId===t||((s=i.info)==null?void 0:s.rdns)===e})},syncIfAuthConnector(t){var e,i;if(t.id!=="ID_AUTH")return;const s=t,r=Yo(D.state),n=Wt.getSnapshot().themeMode,o=Wt.getSnapshot().themeVariables;(i=(e=s==null?void 0:s.provider)==null?void 0:e.syncDappData)==null||i.call(e,{metadata:r.metadata,sdkVersion:r.sdkVersion,sdkType:r.sdkType,projectId:r.projectId}),s.provider.syncTheme({themeMode:n,themeVariables:o,w3mThemeVariables:Us(o,n)})},getConnectorsByNamespace(t){const e=Ce.allConnectors.filter(i=>i.chain===t);return this.mergeMultiChainConnectors(e)},selectWalletConnector(t){const e=te.getConnector(t.id,t.rdns);b.state.activeChain===Y.CHAIN.SOLANA&&a2.handleSolanaDeeplinkRedirect((e==null?void 0:e.name)||t.name||""),e?Se.push("ConnectingExternal",{connector:e}):Se.push("ConnectingWalletConnect",{wallet:t})},getConnectors(t){return t?this.getConnectorsByNamespace(t):this.mergeMultiChainConnectors(Ce.allConnectors)},setFilterByNamespace(t){Ce.filterByNamespace=t,Ce.connectors=this.getConnectors(t),se.setFilterByNamespace(t)},setConnectorId(t,e){t&&(Ce.activeConnectorIds={...Ce.activeConnectorIds,[e]:t},G.setConnectedConnectorId(e,t))},removeConnectorId(t){Ce.activeConnectorIds={...Ce.activeConnectorIds,[t]:void 0},G.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return Ce.activeConnectorIds[t]},isConnected(t){return t?!!Ce.activeConnectorIds[t]:Object.values(Ce.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){Ce.activeConnectorIds={...Ny}}};function $a(t,e){return te.getConnectorId(t)===e}function m2(t){const e=Array.from(b.state.chains.keys());let i=[];return t?(i.push([t,b.state.chains.get(t)]),$a(t,Y.CONNECTOR_ID.WALLET_CONNECT)?e.forEach(s=>{s!==t&&$a(s,Y.CONNECTOR_ID.WALLET_CONNECT)&&i.push([s,b.state.chains.get(s)])}):$a(t,Y.CONNECTOR_ID.AUTH)&&e.forEach(s=>{s!==t&&$a(s,Y.CONNECTOR_ID.AUTH)&&i.push([s,b.state.chains.get(s)])})):i=Array.from(b.state.chains.entries()),i}var w2=Object.defineProperty,y2=(t,e,i)=>e in t?w2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,cg=(t,e,i)=>y2(t,typeof e!="symbol"?e+"":e,i);let v2=class extends yi{constructor(t){super(),this.opts=t,cg(this,"protocol","wc"),cg(this,"version",2)}};var b2=Object.defineProperty,I2=(t,e,i)=>e in t?b2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,E2=(t,e,i)=>I2(t,e+"",i);let N2=class extends yi{constructor(t,e){super(),this.core=t,this.logger=e,E2(this,"records",new Map)}},A2=class{constructor(t,e){this.logger=t,this.core=e}},_2=class extends yi{constructor(t,e){super(),this.relayer=t,this.logger=e}},C2=class extends yi{constructor(t){super()}},S2=class{constructor(t,e,i,s){this.core=t,this.logger=e,this.name=i}},P2=class extends yi{constructor(t,e){super(),this.relayer=t,this.logger=e}},T2=class extends yi{constructor(t,e){super(),this.core=t,this.logger=e}},M2=class{constructor(t,e,i){this.core=t,this.logger=e,this.store=i}},O2=class{constructor(t,e){this.projectId=t,this.logger=e}},x2=class{constructor(t,e,i){this.core=t,this.logger=e,this.telemetryEnabled=i}};var k2=Object.defineProperty,D2=(t,e,i)=>e in t?k2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,lg=(t,e,i)=>D2(t,typeof e!="symbol"?e+"":e,i);let j2=class{constructor(t){this.opts=t,lg(this,"protocol","wc"),lg(this,"version",2)}},R2=class{constructor(t){this.client=t}};typeof N.process<"u"&&typeof N.process.env<"u"&&N.process.env.NEXT_PUBLIC_SECURE_SITE_SDK_URL;typeof N.process<"u"&&typeof N.process.env<"u"&&N.process.env.NEXT_PUBLIC_DEFAULT_LOG_LEVEL;typeof N.process<"u"&&typeof N.process.env<"u"&&N.process.env.NEXT_PUBLIC_SECURE_SITE_SDK_VERSION;const Ts={SAFE_RPC_METHODS:["eth_accounts","eth_blockNumber","eth_call","eth_chainId","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getAccount","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockReceipts","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_maxPriorityFeePerGas","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_sendRawTransaction","eth_syncing","eth_uninstallFilter","wallet_getCapabilities","wallet_getCallsStatus","eth_getUserOperationReceipt","eth_estimateUserOperationGas","eth_getUserOperationByHash","eth_supportedEntryPoints","wallet_getAssets"],NOT_SAFE_RPC_METHODS:["personal_sign","eth_signTypedData_v4","eth_sendTransaction","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction","wallet_sendCalls","wallet_grantPermissions","wallet_revokePermissions","eth_sendUserOperation"],GET_CHAIN_ID:"eth_chainId",RPC_METHOD_NOT_ALLOWED_MESSAGE:"Requested RPC call is not allowed",RPC_METHOD_NOT_ALLOWED_UI_MESSAGE:"Action not allowed",ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},ir=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),lt=Je({...ir}),Ot={state:lt,subscribeKey(t,e){return vi(lt,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=ie.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){lt.message=ir.message,lt.variant=ir.variant,lt.svg=ir.svg,lt.open=ir.open,lt.autoClose=ir.autoClose},_showMessage({message:t,svg:e,variant:i="success",autoClose:s=ir.autoClose}){lt.open?(lt.open=!1,setTimeout(()=>{lt.message=t,lt.variant=i,lt.svg=e,lt.open=!0,lt.autoClose=s},150)):(lt.message=t,lt.variant=i,lt.svg=e,lt.open=!0,lt.autoClose=s)}},jo={getSIWX(){return D.state.siwx},async initializeIfEnabled(){var t;const e=D.state.siwx,i=b.getActiveCaipAddress();if(!(e&&i))return;const[s,r,n]=i.split(":");if(b.checkIfSupportedNetwork(s))try{if((await e.getSessions(`${s}:${r}`,n)).length)return;await ct.open({view:"SIWXSignMessage"})}catch(o){console.error("SIWXUtil:initializeIfEnabled",o),ze.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await((t=Le._getClient())==null?void 0:t.disconnect().catch(console.error)),Se.reset("Connect"),Ot.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){const t=D.state.siwx,e=ie.getPlainAddress(b.getActiveCaipAddress()),i=b.getActiveCaipNetwork(),s=Le._getClient();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!i)throw new Error("No ActiveCaipNetwork or client found");if(!s)throw new Error("No ConnectionController client found");try{const r=await t.createMessage({chainId:i.caipNetworkId,accountAddress:e}),n=r.toString();te.getConnectorId(i.chainNamespace)===Y.CONNECTOR_ID.AUTH&&Se.pushTransactionStack({view:null,goBack:!1,replace:!0});const o=await s.signMessage(n);await t.addSession({data:r,message:n,signature:o}),ct.close(),ze.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(r){const n=this.getSIWXEventProperties();(!ct.state.open||Se.state.view==="ApproveTransaction")&&await ct.open({view:"SIWXSignMessage"}),n.isSmartAccount?Ot.showError("This application might not support Smart Accounts"):Ot.showError("Signature declined"),ze.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:n}),console.error("SWIXUtil:requestSignMessage",r)}},async cancelSignMessage(){var t;try{const e=this.getSIWX();(t=e==null?void 0:e.getRequired)!=null&&t.call(e)?await Le.disconnect():ct.close(),Se.reset("Connect"),ze.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getSessions(){const t=D.state.siwx,e=ie.getPlainAddress(b.getActiveCaipAddress()),i=b.getActiveCaipNetwork();return t&&e&&i?t.getSessions(i.caipNetworkId,e):[]},async isSIWXCloseDisabled(){var t;const e=this.getSIWX();if(e){const i=Se.state.view==="ApproveTransaction",s=Se.state.view==="SIWXSignMessage";if(i||s)return((t=e.getRequired)==null?void 0:t.call(e))&&(await this.getSessions()).length===0}return!1},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:i}){var s,r,n;const o=jo.getSIWX(),a=new Set(e.map(h=>h.split(":")[0]));if(!o||a.size!==1||!a.has("eip155"))return!1;const l=await o.createMessage({chainId:((s=b.getActiveCaipNetwork())==null?void 0:s.caipNetworkId)||"",accountAddress:""}),c=await t.authenticate({nonce:l.nonce,domain:l.domain,uri:l.uri,exp:l.expirationTime,iat:l.issuedAt,nbf:l.notBefore,requestId:l.requestId,version:l.version,resources:l.resources,statement:l.statement,chainId:l.chainId,methods:i,chains:[l.chainId,...e.filter(h=>h!==l.chainId)]});if(Ot.showLoading("Authenticating...",{autoClose:!1}),Z.setConnectedWalletInfo({...c.session.peer.metadata,name:c.session.peer.metadata.name,icon:(r=c.session.peer.metadata.icons)==null?void 0:r[0],type:"WALLET_CONNECT"},Array.from(a)[0]),(n=c==null?void 0:c.auths)!=null&&n.length){const h=c.auths.map(u=>{const d=t.client.formatAuthMessage({request:u.p,iss:u.p.iss});return{data:{...u.p,accountAddress:u.p.iss.split(":").slice(-1).join(""),chainId:u.p.iss.split(":").slice(2,4).join(":"),uri:u.p.aud,version:u.p.version||l.version,expirationTime:u.p.exp,issuedAt:u.p.iat,notBefore:u.p.nbf},message:d,signature:u.s.s,cacao:u}});try{await o.setSessions(h),ze.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:jo.getSIWXEventProperties()})}catch(u){throw console.error("SIWX:universalProviderAuth - failed to set sessions",u),ze.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:jo.getSIWXEventProperties()}),await t.disconnect().catch(console.error),u}finally{Ot.hide()}}return!0},getSIWXEventProperties(){var t;return{network:((t=b.state.activeCaipNetwork)==null?void 0:t.caipNetworkId)||"",isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}},Re=Je({transactions:[],coinbaseTransactions:{},transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),U2={state:Re,subscribe(t){return Ft(Re,()=>t(Re))},setLastNetworkInView(t){Re.lastNetworkInView=t},async fetchTransactions(t,e){var i;if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Re.loading=!0;try{const s=await X.fetchTransactions({account:t,cursor:Re.next,onramp:e,cache:e==="coinbase"?"no-cache":void 0,chainId:(i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId}),r=this.filterSpamTransactions(s.data),n=this.filterByConnectedChain(r),o=[...Re.transactions,...n];Re.loading=!1,e==="coinbase"?Re.coinbaseTransactions=this.groupTransactionsByYearAndMonth(Re.coinbaseTransactions,s.data):(Re.transactions=o,Re.transactionsByYear=this.groupTransactionsByYearAndMonth(Re.transactionsByYear,n)),Re.empty=o.length===0,Re.next=s.next?s.next:void 0}catch{ze.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:D.state.projectId,cursor:Re.next,isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT}}),Ot.showError("Failed to fetch transactions"),Re.loading=!1,Re.empty=!0,Re.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const i=t;return e.forEach(s=>{const r=new Date(s.metadata.minedAt).getFullYear(),n=new Date(s.metadata.minedAt).getMonth(),o=i[r]??{},a=(o[n]??[]).filter(l=>l.id!==s.id);i[r]={...o,[n]:[...a,s].sort((l,c)=>new Date(c.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),i},filterSpamTransactions(t){return t.filter(e=>!e.transfers.every(i=>{var s;return((s=i.nft_info)==null?void 0:s.flags.is_spam)===!0}))},filterByConnectedChain(t){var e;const i=(e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId;return t.filter(s=>s.metadata.chain===i)},clearCursor(){Re.next=void 0},resetTransactions(){Re.transactions=[],Re.transactionsByYear={},Re.lastNetworkInView=void 0,Re.loading=!1,Re.empty=!1,Re.next=void 0}},Be=Je({wcError:!1,buffering:!1,status:"disconnected"});let Zr;const Le={state:Be,subscribeKey(t,e){return vi(Be,t,e)},_getClient(){return Be._client},setClient(t){Be._client=wr(t)},async connectWalletConnect(){var t,e,i,s;if(ie.isTelegram()||ie.isSafari()&&ie.isIos()){if(Zr){await Zr,Zr=void 0;return}if(!ie.isPairingExpired(Be==null?void 0:Be.wcPairingExpiry)){const r=Be.wcUri;Be.wcUri=r;return}Zr=(e=(t=this._getClient())==null?void 0:t.connectWalletConnect)==null?void 0:e.call(t).catch(()=>{}),this.state.status="connecting",await Zr,Zr=void 0,Be.wcPairingExpiry=void 0,this.state.status="connected"}else await((s=(i=this._getClient())==null?void 0:i.connectWalletConnect)==null?void 0:s.call(i))},async connectExternal(t,e,i=!0){var s,r;await((r=(s=this._getClient())==null?void 0:s.connectExternal)==null?void 0:r.call(s,t)),i&&b.setActiveNamespace(e)},async reconnectExternal(t){var e,i;await((i=(e=this._getClient())==null?void 0:e.reconnectExternal)==null?void 0:i.call(e,t));const s=t.chain||b.state.activeChain;s&&te.setConnectorId(t.id,s)},async setPreferredAccountType(t){var e;ct.setLoading(!0,b.state.activeChain);const i=te.getAuthConnector();i&&(await(i==null?void 0:i.provider.setPreferredAccount(t)),await this.reconnectExternal(i),ct.setLoading(!1,b.state.activeChain),ze.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)||""}}))},async signMessage(t){var e;return(e=this._getClient())==null?void 0:e.signMessage(t)},parseUnits(t,e){var i;return(i=this._getClient())==null?void 0:i.parseUnits(t,e)},formatUnits(t,e){var i;return(i=this._getClient())==null?void 0:i.formatUnits(t,e)},async sendTransaction(t){var e;return(e=this._getClient())==null?void 0:e.sendTransaction(t)},async getCapabilities(t){var e;return(e=this._getClient())==null?void 0:e.getCapabilities(t)},async grantPermissions(t){var e;return(e=this._getClient())==null?void 0:e.grantPermissions(t)},async walletGetAssets(t){var e;return((e=this._getClient())==null?void 0:e.walletGetAssets(t))??{}},async estimateGas(t){var e;return(e=this._getClient())==null?void 0:e.estimateGas(t)},async writeContract(t){var e;return(e=this._getClient())==null?void 0:e.writeContract(t)},async getEnsAddress(t){var e;return(e=this._getClient())==null?void 0:e.getEnsAddress(t)},async getEnsAvatar(t){var e;return(e=this._getClient())==null?void 0:e.getEnsAvatar(t)},checkInstalled(t){var e,i;return((i=(e=this._getClient())==null?void 0:e.checkInstalled)==null?void 0:i.call(e,t))||!1},resetWcConnection(){Be.wcUri=void 0,Be.wcPairingExpiry=void 0,Be.wcLinking=void 0,Be.recentWallet=void 0,Be.status="disconnected",U2.resetTransactions(),G.deleteWalletConnectDeepLink()},resetUri(){Be.wcUri=void 0,Be.wcPairingExpiry=void 0},finalizeWcConnection(){var t,e;const{wcLinking:i,recentWallet:s}=Le.state;i&&G.setWalletConnectDeepLink(i),s&&G.setAppKitRecent(s),ze.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:i?"mobile":"qrcode",name:((e=(t=Se.state.data)==null?void 0:t.wallet)==null?void 0:e.name)||"Unknown"}})},setWcBasic(t){Be.wcBasic=t},setUri(t){Be.wcUri=t,Be.wcPairingExpiry=ie.getPairingExpiry()},setWcLinking(t){Be.wcLinking=t},setWcError(t){Be.wcError=t,Be.buffering=!1},setRecentWallet(t){Be.recentWallet=t},setBuffering(t){Be.buffering=t},setStatus(t){Be.status=t},async disconnect(t){try{ct.setLoading(!0,t),await jo.clearSessions(),await b.disconnect(t),ct.setLoading(!1,t),te.setFilterByNamespace(void 0)}catch{throw new Error("Failed to disconnect")}}},fo=Je({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),fs={state:fo,subscribe(t){return Ft(fo,()=>t(fo))},set(t){Object.assign(fo,{...fo,...t})}},Ul={createBalance(t,e){const i={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:i.name,symbol:i.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:i.value,price:i.price,quantity:{decimals:i.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:i.decimals})},iconUrl:i.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return fb(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const i=e[1],s=parseInt(i,10);return isNaN(s)?"0x0":`0x${s.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(i=>this.isValidAsset(i)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}},hg={async getMyTokensWithBalance(t){const e=Z.state.address,i=b.state.activeCaipNetwork;if(!e||!i)return[];if(i.chainNamespace==="eip155"){const r=await this.getEIP155Balances(e,i);if(r)return this.filterLowQualityTokens(r)}const s=await X.getBalance(e,i.caipNetworkId,t);return this.filterLowQualityTokens(s.balances)},async getEIP155Balances(t,e){var i,s;try{const r=Ul.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),n=await Le.getCapabilities(t);if(!((s=(i=n==null?void 0:n[r])==null?void 0:i.assetDiscovery)!=null&&s.supported))return null;const o=await Le.walletGetAssets({account:t,chainFilter:[r]});return Ul.isWalletGetAssetsResponse(o)?(o[r]||[]).map(a=>Ul.createBalance(a,e.caipNetworkId)):null}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},mapBalancesToSwapTokens(t){return(t==null?void 0:t.map(e=>({...e,address:e!=null&&e.address?e.address:b.getActiveNetworkTokenAddress(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]}},ue=Je({tokenBalances:[],loading:!1}),ug={state:ue,subscribe(t){return Ft(ue,()=>t(ue))},subscribeKey(t,e){return vi(ue,t,e)},setToken(t){t&&(ue.token=wr(t))},setTokenAmount(t){ue.sendTokenAmount=t},setReceiverAddress(t){ue.receiverAddress=t},setReceiverProfileImageUrl(t){ue.receiverProfileImageUrl=t},setReceiverProfileName(t){ue.receiverProfileName=t},setGasPrice(t){ue.gasPrice=t},setGasPriceInUsd(t){ue.gasPriceInUSD=t},setNetworkBalanceInUsd(t){ue.networkBalanceInUSD=t},setLoading(t){ue.loading=t},sendToken(){var t;switch((t=b.state.activeCaipNetwork)==null?void 0:t.chainNamespace){case"eip155":this.sendEvmToken();return;case"solana":this.sendSolanaToken();return;default:throw new Error("Unsupported chain")}},sendEvmToken(){var t,e,i,s,r;(t=this.state.token)!=null&&t.address&&this.state.sendTokenAmount&&this.state.receiverAddress?(ze.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT,token:this.state.token.address,amount:this.state.sendTokenAmount,network:((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)||""}}),this.sendERC20Token({receiverAddress:this.state.receiverAddress,tokenAddress:this.state.token.address,sendTokenAmount:this.state.sendTokenAmount,decimals:this.state.token.quantity.decimals})):this.state.receiverAddress&&this.state.sendTokenAmount&&this.state.gasPrice&&(i=this.state.token)!=null&&i.quantity.decimals&&(ze.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT,token:(s=this.state.token)==null?void 0:s.symbol,amount:this.state.sendTokenAmount,network:((r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||""}}),this.sendNativeToken({receiverAddress:this.state.receiverAddress,sendTokenAmount:this.state.sendTokenAmount,gasPrice:this.state.gasPrice,decimals:this.state.token.quantity.decimals}))},async fetchTokenBalance(t){var e,i;ue.loading=!0;const s=(e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId,r=(i=b.state.activeCaipNetwork)==null?void 0:i.chainNamespace,n=b.state.activeCaipAddress,o=n?ie.getPlainAddress(n):void 0;if(ue.lastRetry&&!ie.isAllowedRetry(ue.lastRetry,30*ni.ONE_SEC_MS))return ue.loading=!1,[];try{if(o&&s&&r){const a=await hg.getMyTokensWithBalance();return ue.tokenBalances=a,ue.lastRetry=void 0,a}}catch(a){ue.lastRetry=Date.now(),t==null||t(a),Ot.showError("Token Balance Unavailable")}finally{ue.loading=!1}return[]},fetchNetworkBalance(){if(ue.tokenBalances.length===0)return;const t=hg.mapBalancesToSwapTokens(ue.tokenBalances);if(!t)return;const e=t.find(i=>i.address===b.getActiveNetworkTokenAddress());e&&(ue.networkBalanceInUSD=e?za.multiply(e.quantity.numeric,e.price).toString():"0")},isInsufficientNetworkTokenForGas(t,e){const i=e||"0";return za.bigNumber(t).eq(0)?!0:za.bigNumber(za.bigNumber(i)).gt(t)},hasInsufficientGasFunds(){let t=!0;return Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT?t=!1:ue.networkBalanceInUSD&&(t=this.isInsufficientNetworkTokenForGas(ue.networkBalanceInUSD,ue.gasPriceInUSD)),t},async sendNativeToken(t){var e,i,s,r;Se.pushTransactionStack({view:"Account",goBack:!1});const n=t.receiverAddress,o=Z.state.address,a=Le.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),l="0x";try{await Le.sendTransaction({chainNamespace:"eip155",to:n,address:o,data:l,value:a??BigInt(0),gasPrice:t.gasPrice}),Ot.showSuccess("Transaction started"),ze.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT,token:((e=this.state.token)==null?void 0:e.symbol)||"",amount:t.sendTokenAmount,network:((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}}),this.resetSend()}catch(c){console.error("SendController:sendERC20Token - failed to send native token",c);const h=c instanceof Error?c.message:"Unknown error";ze.sendEvent({type:"track",event:"SEND_ERROR",properties:{message:h,isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT,token:((s=this.state.token)==null?void 0:s.symbol)||"",amount:t.sendTokenAmount,network:((r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||""}}),Ot.showError("Something went wrong")}},async sendERC20Token(t){var e,i;Se.pushTransactionStack({view:"Account",goBack:!1});const s=Le.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals));try{if(Z.state.address&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const r=ie.getPlainAddress(t.tokenAddress);await Le.writeContract({fromAddress:Z.state.address,tokenAddress:r,args:[t.receiverAddress,s??BigInt(0)],method:"transfer",abi:e2.getERC20Abi(r),chainNamespace:"eip155"}),Ot.showSuccess("Transaction started"),this.resetSend()}}catch(r){console.error("SendController:sendERC20Token - failed to send erc20 token",r);const n=r instanceof Error?r.message:"Unknown error";ze.sendEvent({type:"track",event:"SEND_ERROR",properties:{message:n,isSmartAccount:Z.state.preferredAccountType===Ts.ACCOUNT_TYPES.SMART_ACCOUNT,token:((e=this.state.token)==null?void 0:e.symbol)||"",amount:t.sendTokenAmount,network:((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}}),Ot.showError("Something went wrong")}},sendSolanaToken(){if(!this.state.sendTokenAmount||!this.state.receiverAddress){Ot.showError("Please enter a valid amount and receiver address");return}Se.pushTransactionStack({view:"Account",goBack:!1}),Le.sendTransaction({chainNamespace:"solana",to:this.state.receiverAddress,value:this.state.sendTokenAmount}).then(()=>{this.resetSend(),Z.fetchTokenBalance()}).catch(t=>{Ot.showError("Failed to send transaction. Please try again."),console.error("SendController:sendToken - failed to send solana transaction",t)})},resetSend(){ue.token=void 0,ue.sendTokenAmount=void 0,ue.receiverAddress=void 0,ue.receiverProfileImageUrl=void 0,ue.receiverProfileName=void 0,ue.loading=!1,ue.tokenBalances=[]}},Ll={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[],user:void 0},qa={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},z=Je({chains:o2(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{networkControllerClient:void 0,connectionControllerClient:void 0},isSwitchingNamespace:!1}),b={state:z,subscribe(t){return Ft(z,()=>{t(z)})},subscribeKey(t,e){return vi(z,t,e)},subscribeChainProp(t,e,i){let s;return Ft(z.chains,()=>{var r;const n=i||z.activeChain;if(n){const o=(r=z.chains.get(n))==null?void 0:r[t];s!==o&&(s=o,e(o))}})},initialize(t,e,i){const{chainId:s,namespace:r}=G.getActiveNetworkProps(),n=e==null?void 0:e.find(l=>l.id.toString()===(s==null?void 0:s.toString())),o=t.find(l=>(l==null?void 0:l.namespace)===r)||(t==null?void 0:t[0]),a=new Set([...(e==null?void 0:e.map(l=>l.chainNamespace))??[]]);((t==null?void 0:t.length)===0||!o)&&(z.noAdapters=!0),z.noAdapters||(z.activeChain=o==null?void 0:o.namespace,z.activeCaipNetwork=n,this.setChainNetworkData(o==null?void 0:o.namespace,{caipNetwork:n}),z.activeChain&&fs.set({activeChain:o==null?void 0:o.namespace})),a.forEach(l=>{const c=e==null?void 0:e.filter(h=>h.chainNamespace===l);b.state.chains.set(l,{namespace:l,networkState:Je({...qa,caipNetwork:c==null?void 0:c[0]}),accountState:Je(Ll),caipNetworks:c??[],...i}),this.setRequestedCaipNetworks(c??[],l)})},removeAdapter(t){var e,i;if(z.activeChain===t){const s=Array.from(z.chains.entries()).find(([r])=>r!==t);if(s){const r=(i=(e=s[1])==null?void 0:e.caipNetworks)==null?void 0:i[0];r&&this.setActiveCaipNetwork(r)}}z.chains.delete(t)},addAdapter(t,{networkControllerClient:e,connectionControllerClient:i},s){z.chains.set(t.namespace,{namespace:t.namespace,networkState:{...qa,caipNetwork:s[0]},accountState:Ll,caipNetworks:s,connectionControllerClient:i,networkControllerClient:e}),this.setRequestedCaipNetworks((s==null?void 0:s.filter(r=>r.chainNamespace===t.namespace))??[],t.namespace)},addNetwork(t){var e;const i=z.chains.get(t.chainNamespace);if(i){const s=[...i.caipNetworks||[]];(e=i.caipNetworks)!=null&&e.find(r=>r.id===t.id)||s.push(t),z.chains.set(t.chainNamespace,{...i,caipNetworks:s}),this.setRequestedCaipNetworks(s,t.chainNamespace)}},removeNetwork(t,e){var i,s,r;const n=z.chains.get(t);if(n){const o=((i=z.activeCaipNetwork)==null?void 0:i.id)===e,a=[...((s=n.caipNetworks)==null?void 0:s.filter(l=>l.id!==e))||[]];o&&(r=n==null?void 0:n.caipNetworks)!=null&&r[0]&&this.setActiveCaipNetwork(n.caipNetworks[0]),z.chains.set(t,{...n,caipNetworks:a}),this.setRequestedCaipNetworks(a||[],t)}},setAdapterNetworkState(t,e){const i=z.chains.get(t);i&&(i.networkState={...i.networkState||qa,...e},z.chains.set(t,i))},setChainAccountData(t,e,i=!0){if(!t)throw new Error("Chain is required to update chain account data");const s=z.chains.get(t);if(s){const r={...s.accountState||Ll,...e};z.chains.set(t,{...s,accountState:r}),(z.chains.size===1||z.activeChain===t)&&(e.caipAddress&&(z.activeCaipAddress=e.caipAddress),Z.replaceState(r))}},setChainNetworkData(t,e){if(!t)return;const i=z.chains.get(t);if(i){const s={...i.networkState||qa,...e};z.chains.set(t,{...i,networkState:s})}},setAccountProp(t,e,i,s=!0){this.setChainAccountData(i,{[t]:e},s),t==="status"&&e==="disconnected"&&i&&te.removeConnectorId(i)},setActiveNamespace(t){var e,i;z.activeChain=t;const s=t?z.chains.get(t):void 0,r=(e=s==null?void 0:s.networkState)==null?void 0:e.caipNetwork;r!=null&&r.id&&t&&(z.activeCaipAddress=(i=s==null?void 0:s.accountState)==null?void 0:i.caipAddress,z.activeCaipNetwork=r,this.setChainNetworkData(t,{caipNetwork:r}),G.setActiveCaipNetworkId(r==null?void 0:r.caipNetworkId),fs.set({activeChain:t,selectedNetworkId:r==null?void 0:r.caipNetworkId}))},setActiveCaipNetwork(t){var e,i,s;if(!t)return;z.activeChain!==t.chainNamespace&&this.setIsSwitchingNamespace(!0);const r=z.chains.get(t.chainNamespace);z.activeChain=t.chainNamespace,z.activeCaipNetwork=t,this.setChainNetworkData(t.chainNamespace,{caipNetwork:t}),(e=r==null?void 0:r.accountState)!=null&&e.address?z.activeCaipAddress=`${t.chainNamespace}:${t.id}:${(i=r==null?void 0:r.accountState)==null?void 0:i.address}`:z.activeCaipAddress=void 0,this.setAccountProp("caipAddress",z.activeCaipAddress,t.chainNamespace),r&&Z.replaceState(r.accountState),ug.resetSend(),fs.set({activeChain:z.activeChain,selectedNetworkId:(s=z.activeCaipNetwork)==null?void 0:s.caipNetworkId}),G.setActiveCaipNetworkId(t.caipNetworkId),!this.checkIfSupportedNetwork(t.chainNamespace)&&D.state.enableNetworkSwitch&&!D.state.allowUnsupportedChain&&!Le.state.wcBasic&&this.showUnsupportedChainUI()},addCaipNetwork(t){var e;if(!t)return;const i=z.chains.get(t.chainNamespace);i&&((e=i==null?void 0:i.caipNetworks)==null||e.push(t))},async switchActiveNamespace(t){var e;if(!t)return;const i=t!==b.state.activeChain,s=(e=b.getNetworkData(t))==null?void 0:e.caipNetwork,r=b.getCaipNetworkByNamespace(t,s==null?void 0:s.id);i&&r&&await b.switchActiveNetwork(r)},async switchActiveNetwork(t){var e;const i=b.state.chains.get(b.state.activeChain);!((e=i==null?void 0:i.caipNetworks)!=null&&e.some(r=>{var n;return r.id===((n=z.activeCaipNetwork)==null?void 0:n.id)}))&&Se.goBack();const s=this.getNetworkControllerClient(t.chainNamespace);s&&(await s.switchCaipNetwork(t),ze.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}}))},getNetworkControllerClient(t){const e=t||z.activeChain,i=z.chains.get(e);if(!i)throw new Error("Chain adapter not found");if(!i.networkControllerClient)throw new Error("NetworkController client not set");return i.networkControllerClient},getConnectionControllerClient(t){const e=t||z.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const i=z.chains.get(e);if(!(i!=null&&i.connectionControllerClient))throw new Error("ConnectionController client not set");return i.connectionControllerClient},getAccountProp(t,e){var i;let s=z.activeChain;if(e&&(s=e),!s)return;const r=(i=z.chains.get(s))==null?void 0:i.accountState;if(r)return r[t]},getNetworkProp(t,e){var i;const s=(i=z.chains.get(e))==null?void 0:i.networkState;if(s)return s[t]},getRequestedCaipNetworks(t){const e=z.chains.get(t),{approvedCaipNetworkIds:i=[],requestedCaipNetworks:s=[]}=(e==null?void 0:e.networkState)||{};return ie.sortRequestedNetworks(i,s)},getAllRequestedCaipNetworks(){const t=[];return z.chains.forEach(e=>{const i=this.getRequestedCaipNetworks(e.namespace);t.push(...i)}),t},setRequestedCaipNetworks(t,e){this.setAdapterNetworkState(e,{requestedCaipNetworks:t})},getAllApprovedCaipNetworkIds(){const t=[];return z.chains.forEach(e=>{const i=this.getApprovedCaipNetworkIds(e.namespace);t.push(...i)}),t},getActiveCaipNetwork(){return z.activeCaipNetwork},getActiveCaipAddress(){return z.activeCaipAddress},getApprovedCaipNetworkIds(t){var e;const i=z.chains.get(t);return((e=i==null?void 0:i.networkState)==null?void 0:e.approvedCaipNetworkIds)||[]},async setApprovedCaipNetworksData(t){const e=this.getNetworkControllerClient(),i=await(e==null?void 0:e.getApprovedCaipNetworksData());this.setAdapterNetworkState(t,{approvedCaipNetworkIds:i==null?void 0:i.approvedCaipNetworkIds,supportsAllNetworks:i==null?void 0:i.supportsAllNetworks})},checkIfSupportedNetwork(t,e){const i=e||z.activeCaipNetwork,s=this.getRequestedCaipNetworks(t);return s.length?s==null?void 0:s.some(r=>r.id===(i==null?void 0:i.id)):!0},checkIfSupportedChainId(t){if(!z.activeChain)return!0;const e=this.getRequestedCaipNetworks(z.activeChain);return e==null?void 0:e.some(i=>i.id===t)},setSmartAccountEnabledNetworks(t,e){this.setAdapterNetworkState(e,{smartAccountEnabledNetworks:t})},checkIfSmartAccountEnabled(){var t;const e=vy.caipNetworkIdToNumber((t=z.activeCaipNetwork)==null?void 0:t.caipNetworkId),i=z.activeChain;if(!i||!e)return!1;const s=this.getNetworkProp("smartAccountEnabledNetworks",i);return!!(s!=null&&s.includes(Number(e)))},getActiveNetworkTokenAddress(){var t,e;const i=((t=z.activeCaipNetwork)==null?void 0:t.chainNamespace)||"eip155",s=((e=z.activeCaipNetwork)==null?void 0:e.id)||1,r=ni.NATIVE_TOKEN_ADDRESS[i];return`${i}:${s}:${r}`},showUnsupportedChainUI(){ct.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=z.activeCaipNetwork;return!!(t!=null&&t.chainNamespace&&ni.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){this.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]})},resetAccount(t){const e=t;if(!e)throw new Error("Chain is required to set account prop");z.activeCaipAddress=void 0,this.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:void 0,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,allAccounts:[],user:void 0,status:"disconnected"}),te.removeConnectorId(e)},async disconnect(t){const e=m2(t);try{ug.resetSend();const i=await Promise.allSettled(e.map(async([r,n])=>{var o;try{const{caipAddress:a}=this.getAccountData(r)||{};a&&(o=n.connectionControllerClient)!=null&&o.disconnect&&await n.connectionControllerClient.disconnect(r),this.resetAccount(r),this.resetNetwork(r)}catch(a){throw new Error(`Failed to disconnect chain ${r}: ${a.message}`)}}));Le.resetWcConnection();const s=i.filter(r=>r.status==="rejected");if(s.length>0)throw new Error(s.map(r=>r.reason.message).join(", "));G.deleteConnectedSocialProvider(),t?te.removeConnectorId(t):te.resetConnectorIds(),ze.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:t||"all"}})}catch(i){console.error(i.message||"Failed to disconnect chains"),ze.sendEvent({type:"track",event:"DISCONNECT_ERROR",properties:{message:i.message||"Failed to disconnect chains"}})}},setIsSwitchingNamespace(t){z.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){var t,e;const i=[];let s;if(z.chains.forEach(r=>{Y.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(n=>n===r.namespace)&&r.namespace&&i.push(r.namespace)}),i.length>0){const r=i[0];return s=r?(e=(t=z.chains.get(r))==null?void 0:t.caipNetworks)==null?void 0:e[0]:void 0,s}},getAccountData(t){var e;return t?(e=b.state.chains.get(t))==null?void 0:e.accountState:Z.state},getNetworkData(t){var e;const i=t||z.activeChain;if(i)return(e=b.state.chains.get(i))==null?void 0:e.networkState},getCaipNetworkByNamespace(t,e){var i,s,r;if(!t)return;const n=b.state.chains.get(t);return((i=n==null?void 0:n.caipNetworks)==null?void 0:i.find(a=>a.id===e))||((s=n==null?void 0:n.networkState)==null?void 0:s.caipNetwork)||((r=n==null?void 0:n.caipNetworks)==null?void 0:r[0])},getRequestedCaipNetworkIds(){const t=te.state.filterByNamespace;return(t?[z.chains.get(t)]:Array.from(z.chains.values())).flatMap(e=>(e==null?void 0:e.caipNetworks)||[]).map(e=>e.caipNetworkId)}},L2={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},Ay=ie.getBlockchainApiUrl(),ai=Je({clientId:null,api:new il({baseUrl:Ay,clientId:null}),supportedChains:{http:[],ws:[]}}),X={state:ai,async get(t){const{st:e,sv:i}=X.getSdkProperties(),s=D.state.projectId,r={...t.params||{},st:e,sv:i,projectId:s};return ai.api.get({...t,params:r})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=D.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{ai.supportedChains.http.length||await X.getSupportedNetworks()}catch{return!1}return ai.supportedChains.http.includes(t)},async getSupportedNetworks(){const t=await X.get({path:"v1/supported-chains"});return ai.supportedChains=t,t},async fetchIdentity({address:t,caipNetworkId:e}){if(!await X.isNetworkSupported(e))return{avatar:"",name:""};const i=G.getIdentityFromCacheForAddress(t);if(i)return i;const s=await X.get({path:`/v1/identity/${t}`,params:{sender:b.state.activeCaipAddress?ie.getPlainAddress(b.state.activeCaipAddress):void 0}});return G.updateIdentityCache({address:t,identity:s,timestamp:Date.now()}),s},async fetchTransactions({account:t,cursor:e,onramp:i,signal:s,cache:r,chainId:n}){var o;return await X.isNetworkSupported((o=b.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?X.get({path:`/v1/account/${t}/history`,params:{cursor:e,onramp:i,chainId:n},signal:s,cache:r}):{data:[],next:void 0}},async fetchSwapQuote({amount:t,userAddress:e,from:i,to:s,gasPrice:r}){var n;return await X.isNetworkSupported((n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?X.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:i,to:s,gasPrice:r}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){var e;return await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)?X.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async fetchTokenPrice({addresses:t}){var e;return await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)?ai.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:D.state.projectId},headers:{"Content-Type":"application/json"}}):{fungibles:[]}},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){var i;return await X.isNetworkSupported((i=b.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?X.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){var e;const{st:i,sv:s}=X.getSdkProperties();if(!await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))throw new Error("Network not supported for Gas Price");return X.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:i,sv:s}})},async generateSwapCalldata({amount:t,from:e,to:i,userAddress:s,disableEstimate:r}){var n;if(!await X.isNetworkSupported((n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId))throw new Error("Network not supported for Swaps");return ai.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:ni.CONVERT_SLIPPAGE_TOLERANCE},projectId:D.state.projectId,from:e,to:i,userAddress:s,disableEstimate:r}})},async generateApproveCalldata({from:t,to:e,userAddress:i}){var s;const{st:r,sv:n}=X.getSdkProperties();if(!await X.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId))throw new Error("Network not supported for Swaps");return X.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:i,from:t,to:e,st:r,sv:n}})},async getBalance(t,e,i){var s;const{st:r,sv:n}=X.getSdkProperties();if(!await X.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId))return Ot.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=G.getBalanceCacheForCaipAddress(o);if(a)return a;const l=await X.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:i,st:r,sv:n}});return G.updateBalanceCache({caipAddress:o,balance:l,timestamp:Date.now()}),l},async lookupEnsName(t){var e;return await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)?X.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){var e;return await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)?X.get({path:`/v1/profile/reverse/${t}`,params:{sender:Z.state.address,apiVersion:"2"}}):[]},async getEnsNameSuggestions(t){var e;return await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)?X.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:i,signature:s}){var r;return await X.isNetworkSupported((r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?ai.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:i,signature:s},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:i,purchaseAmount:s,paymentAmount:r}){var n;return await X.isNetworkSupported((n=b.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?(await ai.api.post({path:"/v1/generators/onrampurl",params:{projectId:D.state.projectId},body:{destinationWallets:t,defaultNetwork:i,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:s,presetFiatAmount:r}})).url:""},async getOnrampOptions(){var t;if(!await X.isNetworkSupported((t=b.state.activeCaipNetwork)==null?void 0:t.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await X.get({path:"/v1/onramp/options"})}catch{return L2}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:i,network:s}){var r;try{return await X.isNetworkSupported((r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?await ai.api.post({path:"/v1/onramp/quote",params:{projectId:D.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:i,network:s}}):null}catch{return{coinbaseFee:{amount:i,currency:e.id},networkFee:{amount:i,currency:e.id},paymentSubtotal:{amount:i,currency:e.id},paymentTotal:{amount:i,currency:e.id},purchaseAmount:{amount:i,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){var e;return await X.isNetworkSupported((e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId)?X.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,i){var s;return await X.isNetworkSupported((s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?ai.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:D.state.projectId},body:{pci:e,signature:i}}):{success:!1}},setClientId(t){ai.clientId=t,ai.api=new il({baseUrl:Ay,clientId:t})}},Ki=Je({currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[]}),Z={state:Ki,replaceState(t){t&&Object.assign(Ki,wr(t))},subscribe(t){return b.subscribeChainProp("accountState",e=>{if(e)return t(e)})},subscribeKey(t,e,i){let s;return b.subscribeChainProp("accountState",r=>{if(r){const n=r[t];s!==n&&(s=n,e(n))}},i)},setStatus(t,e){b.setAccountProp("status",t,e)},getCaipAddress(t){return b.getAccountProp("caipAddress",t)},setCaipAddress(t,e){const i=t?ie.getPlainAddress(t):void 0;e===b.state.activeChain&&(b.state.activeCaipAddress=t),b.setAccountProp("caipAddress",t,e),b.setAccountProp("address",i,e)},setBalance(t,e,i){b.setAccountProp("balance",t,i),b.setAccountProp("balanceSymbol",e,i)},setProfileName(t,e){b.setAccountProp("profileName",t,e)},setProfileImage(t,e){b.setAccountProp("profileImage",t,e)},setUser(t,e){b.setAccountProp("user",t,e)},setAddressExplorerUrl(t,e){b.setAccountProp("addressExplorerUrl",t,e)},setSmartAccountDeployed(t,e){b.setAccountProp("smartAccountDeployed",t,e)},setCurrentTab(t){b.setAccountProp("currentTab",t,b.state.activeChain)},setTokenBalance(t,e){t&&b.setAccountProp("tokenBalance",t,e)},setShouldUpdateToAddress(t,e){b.setAccountProp("shouldUpdateToAddress",t,e)},setAllAccounts(t,e){b.setAccountProp("allAccounts",t,e)},addAddressLabel(t,e,i){const s=b.getAccountProp("addressLabels",i)||new Map;s.set(t,e),b.setAccountProp("addressLabels",s,i)},removeAddressLabel(t,e){const i=b.getAccountProp("addressLabels",e)||new Map;i.delete(t),b.setAccountProp("addressLabels",i,e)},setConnectedWalletInfo(t,e){b.setAccountProp("connectedWalletInfo",t,e,!1)},setPreferredAccountType(t,e){b.setAccountProp("preferredAccountType",t,e)},setSocialProvider(t,e){t&&b.setAccountProp("socialProvider",t,e)},setSocialWindow(t,e){b.setAccountProp("socialWindow",t?wr(t):void 0,e)},setFarcasterUrl(t,e){b.setAccountProp("farcasterUrl",t,e)},async fetchTokenBalance(t){var e,i;Ki.balanceLoading=!0;const s=(e=b.state.activeCaipNetwork)==null?void 0:e.caipNetworkId,r=(i=b.state.activeCaipNetwork)==null?void 0:i.chainNamespace,n=b.state.activeCaipAddress,o=n?ie.getPlainAddress(n):void 0;if(Ki.lastRetry&&!ie.isAllowedRetry(Ki.lastRetry,30*ni.ONE_SEC_MS))return Ki.balanceLoading=!1,[];try{if(o&&s&&r){const a=(await X.getBalance(o,s)).balances.filter(l=>l.quantity.decimals!=="0");return this.setTokenBalance(a,r),Ki.lastRetry=void 0,Ki.balanceLoading=!1,a}}catch(a){Ki.lastRetry=Date.now(),t==null||t(a),Ot.showError("Token Balance Unavailable")}finally{Ki.balanceLoading=!1}return[]},resetAccount(t){b.resetAccount(t)}},Qt=Je({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),ct={state:Qt,subscribe(t){return Ft(Qt,()=>t(Qt))},subscribeKey(t,e){return vi(Qt,t,e)},async open(t){var e;const i=Z.state.status==="connected";Le.state.wcBasic?se.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1}):await se.prefetch({fetchConnectorImages:!i,fetchFeaturedWallets:!i,fetchRecommendedWallets:!i}),t!=null&&t.namespace?(await b.switchActiveNamespace(t.namespace),ct.setLoading(!0,t.namespace)):ct.setLoading(!0),te.setFilterByNamespace(t==null?void 0:t.namespace);const s=(e=b.getAccountData(t==null?void 0:t.namespace))==null?void 0:e.caipAddress;b.state.noAdapters&&!s?ie.isMobile()?Se.reset("AllWallets"):Se.reset("ConnectingWalletConnectBasic"):t!=null&&t.view?Se.reset(t.view):s?Se.reset("Account"):Se.reset("Connect"),Qt.open=!0,fs.set({open:!0}),ze.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!s}})},close(){const t=D.state.enableEmbedded,e=!!b.state.activeCaipAddress;Qt.open&&ze.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),Qt.open=!1,ct.clearLoading(),t?e?Se.replace("Account"):Se.push("Connect"):fs.set({open:!1}),Le.resetUri()},setLoading(t,e){e&&Qt.loadingNamespaceMap.set(e,t),Qt.loading=t,fs.set({loading:t})},clearLoading(){Qt.loadingNamespaceMap.clear(),Qt.loading=!1},shake(){Qt.shake||(Qt.shake=!0,setTimeout(()=>{Qt.shake=!1},500))}},dg=2147483648,z2={convertEVMChainIdToCoinType(t){if(t>=dg)throw new Error("Invalid chainId");return(dg|t)>>>0}},Ii=Je({suggestions:[],loading:!1}),_y={state:Ii,subscribe(t){return Ft(Ii,()=>t(Ii))},subscribeKey(t,e){return vi(Ii,t,e)},async resolveName(t){var e,i;try{return await X.lookupEnsName(t)}catch(s){const r=s;throw new Error(((i=(e=r==null?void 0:r.reasons)==null?void 0:e[0])==null?void 0:i.description)||"Error resolving name")}},async isNameRegistered(t){try{return await X.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{Ii.loading=!0,Ii.suggestions=[];const e=await X.getEnsNameSuggestions(t);return Ii.suggestions=e.suggestions.map(i=>({...i,name:i.name}))||[],Ii.suggestions}catch(e){const i=this.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(i)}finally{Ii.loading=!1}},async getNamesForAddress(t){try{if(!b.state.activeCaipNetwork)return[];const e=G.getEnsFromCacheForAddress(t);if(e)return e;const i=await X.reverseLookupEnsName({address:t});return G.updateEnsCache({address:t,ens:i,timestamp:Date.now()}),i}catch(e){const i=this.parseEnsApiError(e,"Error fetching names for address");throw new Error(i)}},async registerName(t){const e=b.state.activeCaipNetwork;if(!e)throw new Error("Network not found");const i=Z.state.address,s=te.getAuthConnector();if(!i||!s)throw new Error("Address or auth connector not found");Ii.loading=!0;try{const r=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});Se.pushTransactionStack({view:"RegisterAccountNameSuccess",goBack:!1,replace:!0,onCancel(){Ii.loading=!1}});const n=await Le.signMessage(r),o=e.id;if(!o)throw new Error("Network not found");const a=z2.convertEVMChainIdToCoinType(Number(o));await X.registerEnsName({coinType:a,address:i,signature:n,message:r}),Z.setProfileName(t,e.chainNamespace),Se.replace("RegisterAccountNameSuccess")}catch(r){const n=this.parseEnsApiError(r,`Error registering name ${t}`);throw Se.replace("RegisterAccountName"),new Error(n)}finally{Ii.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){var i,s;const r=t;return((s=(i=r==null?void 0:r.reasons)==null?void 0:i[0])==null?void 0:s.description)||e}};function $2(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function yt(t,...e){try{return $2(t(...e))}catch(i){return Promise.reject(i)}}function q2(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function B2(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function cc(t){if(q2(t))return String(t);if(B2(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return cc(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Lh="base64:";function H2(t){return typeof t=="string"?t:Lh+K2(t)}function V2(t){return typeof t!="string"||!t.startsWith(Lh)?t:W2(t.slice(Lh.length))}function W2(t){return globalThis.Buffer?N.Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function K2(t){return globalThis.Buffer?N.Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function ei(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function F2(...t){return ei(t.join(":"))}function Ba(t){return t=ei(t),t?t+":":""}function G2(t,e){if(e===void 0)return!0;let i=0,s=t.indexOf(":");for(;s>-1;)i++,s=t.indexOf(":",s+1);return i<=e}function Y2(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const Q2="memory",Z2=()=>{const t=new Map;return{name:Q2,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,i){t.set(e,i)},setItemRaw(e,i){t.set(e,i)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function J2(t={}){const e={mounts:{"":t.driver||Z2()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=c=>{for(const h of e.mountpoints)if(c.startsWith(h))return{base:h,relativeKey:c.slice(h.length),driver:e.mounts[h]};return{base:"",relativeKey:c,driver:e.mounts[""]}},s=(c,h)=>e.mountpoints.filter(u=>u.startsWith(c)||h&&c.startsWith(u)).map(u=>({relativeBase:c.length>u.length?c.slice(u.length):void 0,mountpoint:u,driver:e.mounts[u]})),r=(c,h)=>{if(e.watching){h=ei(h);for(const u of e.watchListeners)u(c,h)}},n=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await pg(e.mounts[c],r,c)}},o=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},a=(c,h,u)=>{const d=new Map,p=g=>{let f=d.get(g.base);return f||(f={driver:g.driver,base:g.base,items:[]},d.set(g.base,f)),f};for(const g of c){const f=typeof g=="string",w=ei(f?g:g.key),m=f?void 0:g.value,y=f||!g.options?h:{...h,...g.options},v=i(w);p(v).items.push({key:w,value:m,relativeKey:v.relativeKey,options:y})}return Promise.all([...d.values()].map(g=>u(g))).then(g=>g.flat())},l={hasItem(c,h={}){c=ei(c);const{relativeKey:u,driver:d}=i(c);return yt(d.hasItem,u,h)},getItem(c,h={}){c=ei(c);const{relativeKey:u,driver:d}=i(c);return yt(d.getItem,u,h).then(p=>Ds(p))},getItems(c,h={}){return a(c,h,u=>u.driver.getItems?yt(u.driver.getItems,u.items.map(d=>({key:d.relativeKey,options:d.options})),h).then(d=>d.map(p=>({key:F2(u.base,p.key),value:Ds(p.value)}))):Promise.all(u.items.map(d=>yt(u.driver.getItem,d.relativeKey,d.options).then(p=>({key:d.key,value:Ds(p)})))))},getItemRaw(c,h={}){c=ei(c);const{relativeKey:u,driver:d}=i(c);return d.getItemRaw?yt(d.getItemRaw,u,h):yt(d.getItem,u,h).then(p=>V2(p))},async setItem(c,h,u={}){if(h===void 0)return l.removeItem(c);c=ei(c);const{relativeKey:d,driver:p}=i(c);p.setItem&&(await yt(p.setItem,d,cc(h),u),p.watch||r("update",c))},async setItems(c,h){await a(c,h,async u=>{if(u.driver.setItems)return yt(u.driver.setItems,u.items.map(d=>({key:d.relativeKey,value:cc(d.value),options:d.options})),h);u.driver.setItem&&await Promise.all(u.items.map(d=>yt(u.driver.setItem,d.relativeKey,cc(d.value),d.options)))})},async setItemRaw(c,h,u={}){if(h===void 0)return l.removeItem(c,u);c=ei(c);const{relativeKey:d,driver:p}=i(c);if(p.setItemRaw)await yt(p.setItemRaw,d,h,u);else if(p.setItem)await yt(p.setItem,d,H2(h),u);else return;p.watch||r("update",c)},async removeItem(c,h={}){typeof h=="boolean"&&(h={removeMeta:h}),c=ei(c);const{relativeKey:u,driver:d}=i(c);d.removeItem&&(await yt(d.removeItem,u,h),(h.removeMeta||h.removeMata)&&await yt(d.removeItem,u+"$",h),d.watch||r("remove",c))},async getMeta(c,h={}){typeof h=="boolean"&&(h={nativeOnly:h}),c=ei(c);const{relativeKey:u,driver:d}=i(c),p=Object.create(null);if(d.getMeta&&Object.assign(p,await yt(d.getMeta,u,h)),!h.nativeOnly){const g=await yt(d.getItem,u+"$",h).then(f=>Ds(f));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(p,g))}return p},setMeta(c,h,u={}){return this.setItem(c+"$",h,u)},removeMeta(c,h={}){return this.removeItem(c+"$",h)},async getKeys(c,h={}){var u;c=Ba(c);const d=s(c,!0);let p=[];const g=[];let f=!0;for(const m of d){(u=m.driver.flags)!=null&&u.maxDepth||(f=!1);const y=await yt(m.driver.getKeys,m.relativeBase,h);for(const v of y){const I=m.mountpoint+ei(v);p.some(S=>I.startsWith(S))||g.push(I)}p=[m.mountpoint,...p.filter(v=>!v.startsWith(m.mountpoint))]}const w=h.maxDepth!==void 0&&!f;return g.filter(m=>(!w||G2(m,h.maxDepth))&&Y2(m,c))},async clear(c,h={}){c=Ba(c),await Promise.all(s(c,!1).map(async u=>{if(u.driver.clear)return yt(u.driver.clear,u.relativeBase,h);if(u.driver.removeItem){const d=await u.driver.getKeys(u.relativeBase||"",h);return Promise.all(d.map(p=>u.driver.removeItem(p,h)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>gg(c)))},async watch(c){return await n(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(h=>h!==c),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(c,h){if(c=Ba(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((u,d)=>d.length-u.length)),e.mounts[c]=h,e.watching&&Promise.resolve(pg(h,r,c)).then(u=>{e.unwatch[c]=u}).catch(console.error),l},async unmount(c,h=!0){var u,d;c=Ba(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&((d=(u=e.unwatch)[c])==null||d.call(u),delete e.unwatch[c]),h&&await gg(e.mounts[c]),e.mountpoints=e.mountpoints.filter(p=>p!==c),delete e.mounts[c])},getMount(c=""){c=ei(c)+":";const h=i(c);return{driver:h.driver,base:h.base}},getMounts(c="",h={}){return c=ei(c),s(c,h.parents).map(u=>({driver:u.driver,base:u.mountpoint}))},keys:(c,h={})=>l.getKeys(c,h),get:(c,h={})=>l.getItem(c,h),set:(c,h,u={})=>l.setItem(c,h,u),has:(c,h={})=>l.hasItem(c,h),del:(c,h={})=>l.removeItem(c,h),remove:(c,h={})=>l.removeItem(c,h)};return l}function pg(t,e,i){return t.watch?t.watch((s,r)=>e(s,i+r)):()=>{}}async function gg(t){typeof t.dispose=="function"&&await yt(t.dispose)}const X2="idb-keyval";var ej=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",i=r=>e+r;let s;return t.dbName&&t.storeName&&(s=Im(t.dbName,t.storeName)),{name:X2,options:t,async hasItem(r){return!(typeof await vc(i(r),s)>"u")},async getItem(r){return await vc(i(r),s)??null},setItem(r,n){return Em(i(r),n,s)},removeItem(r){return Nm(i(r),s)},getKeys(){return Am(s)},clear(){return _m(s)}}};const tj="WALLET_CONNECT_V2_INDEXED_DB",ij="keyvaluestorage";let sj=class{constructor(){this.indexedDb=J2({driver:ej({dbName:tj,storeName:ij})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const e=await this.indexedDb.getItem(t);if(e!==null)return e}async setItem(t,e){await this.indexedDb.setItem(t,Ar(e))}async removeItem(t){await this.indexedDb.removeItem(t)}};var zl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof N.global<"u"?N.global:typeof self<"u"?self:{},lc={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},t.prototype.setItem=function(i,s){this[i]=String(s)},t.prototype.removeItem=function(i){delete this[i]},t.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(s){i[s]=void 0,delete i[s]})},t.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof zl<"u"&&zl.localStorage?lc.exports=zl.localStorage:typeof window<"u"&&window.localStorage?lc.exports=window.localStorage:lc.exports=new e})();function rj(t){var e;return[t[0],ws((e=t[1])!=null?e:"")]}let nj=class{constructor(){this.localStorage=lc.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(rj)}async getItem(t){const e=this.localStorage.getItem(t);if(e!==null)return ws(e)}async setItem(t,e){this.localStorage.setItem(t,Ar(e))}async removeItem(t){this.localStorage.removeItem(t)}};const oj="wc_storage_version",fg=1,aj=async(t,e,i)=>{const s=oj,r=await e.getItem(s);if(r&&r>=fg){i(e);return}const n=await t.getKeys();if(!n.length){i(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const l=a.toLowerCase();if(l.includes("wc@")||l.includes("walletconnect")||l.includes("wc_")||l.includes("wallet_connect")){const c=await t.getItem(a);await e.setItem(a,c),o.push(a)}}await e.setItem(s,fg),i(e),cj(t,o)},cj=async(t,e)=>{e.length&&e.forEach(async i=>{await t.removeItem(i)})};let lj=class{constructor(){this.initialized=!1,this.setInitialized=e=>{this.storage=e,this.initialized=!0};const t=new nj;this.storage=t;try{const e=new sj;aj(t,e,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,e){return await this.initialize(),this.storage.setItem(t,e)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const e=setInterval(()=>{this.initialized&&(clearInterval(e),t())},20)})}};function Qo(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function mg(t){return Qo(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Cy="2.23.2";let Ha={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:i})=>e?`${t??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${Cy}`};class yr extends Error{constructor(e,i={}){var s;const r=(()=>{var l;return i.cause instanceof yr?i.cause.details:(l=i.cause)!=null&&l.message?i.cause.message:i.details})(),n=i.cause instanceof yr&&i.cause.docsPath||i.docsPath,o=(s=Ha.getDocsUrl)==null?void 0:s.call(Ha,{...i,docsPath:n}),a=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...o?[`Docs: ${o}`]:[],...r?[`Details: ${r}`]:[],...Ha.version?[`Version: ${Ha.version}`]:[]].join(`
`);super(a,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=n,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=Cy}walk(e){return Sy(this,e)}}function Sy(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Sy(t.cause,e):e?null:t}class Py extends yr{constructor({size:e,targetSize:i,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${i}).`,{name:"SizeExceedsPaddingSizeError"})}}function Zn(t,{dir:e,size:i=32}={}){return typeof t=="string"?hj(t,{dir:e,size:i}):uj(t,{dir:e,size:i})}function hj(t,{dir:e,size:i=32}={}){if(i===null)return t;const s=t.replace("0x","");if(s.length>i*2)throw new Py({size:Math.ceil(s.length/2),targetSize:i,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function uj(t,{dir:e,size:i=32}={}){if(i===null)return t;if(t.length>i)throw new Py({size:t.length,targetSize:i,type:"bytes"});const s=new Uint8Array(i);for(let r=0;r<i;r++){const n=e==="right";s[n?r:i-r-1]=t[n?r:t.length-r-1]}return s}class dj extends yr{constructor({max:e,min:i,signed:s,size:r,value:n}){super(`Number "${n}" is not in safe ${r?`${r*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${i} to ${e})`:`(above ${i})`}`,{name:"IntegerOutOfRangeError"})}}class pj extends yr{constructor({givenSize:e,maxSize:i}){super(`Size cannot exceed ${i} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Jn(t,{size:e}){if(mg(t)>e)throw new pj({givenSize:mg(t),maxSize:e})}function zh(t,e={}){const{signed:i}=e;e.size&&Jn(t,{size:e.size});const s=BigInt(t);if(!i)return s;const r=(t.length-2)/2,n=(1n<<BigInt(r)*8n-1n)-1n;return s<=n?s:s-BigInt(`0x${"f".padStart(r*2,"f")}`)-1n}function gj(t,e={}){return Number(zh(t,e))}const fj=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function $h(t,e={}){return typeof t=="number"||typeof t=="bigint"?My(t,e):typeof t=="string"?yj(t,e):typeof t=="boolean"?mj(t,e):Ty(t,e)}function mj(t,e={}){const i=`0x${Number(t)}`;return typeof e.size=="number"?(Jn(i,{size:e.size}),Zn(i,{size:e.size})):i}function Ty(t,e={}){let i="";for(let r=0;r<t.length;r++)i+=fj[t[r]];const s=`0x${i}`;return typeof e.size=="number"?(Jn(s,{size:e.size}),Zn(s,{dir:"right",size:e.size})):s}function My(t,e={}){const{signed:i,size:s}=e,r=BigInt(t);let n;s?i?n=(1n<<BigInt(s)*8n-1n)-1n:n=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&i?-n-1n:0;if(n&&r>n||r<o){const l=typeof t=="bigint"?"n":"";throw new dj({max:n?`${n}${l}`:void 0,min:`${o}${l}`,signed:i,size:s,value:`${t}${l}`})}const a=`0x${(i&&r<0?(1n<<BigInt(s*8))+BigInt(r):r).toString(16)}`;return s?Zn(a,{size:s}):a}const wj=new TextEncoder;function yj(t,e={}){const i=wj.encode(t);return Ty(i,e)}const vj=new TextEncoder;function bj(t,e={}){return typeof t=="number"||typeof t=="bigint"?Ej(t,e):typeof t=="boolean"?Ij(t,e):Qo(t)?Oy(t,e):xy(t,e)}function Ij(t,e={}){const i=new Uint8Array(1);return i[0]=Number(t),typeof e.size=="number"?(Jn(i,{size:e.size}),Zn(i,{size:e.size})):i}const cs={zero:48,nine:57,A:65,F:70,a:97,f:102};function wg(t){if(t>=cs.zero&&t<=cs.nine)return t-cs.zero;if(t>=cs.A&&t<=cs.F)return t-(cs.A-10);if(t>=cs.a&&t<=cs.f)return t-(cs.a-10)}function Oy(t,e={}){let i=t;e.size&&(Jn(i,{size:e.size}),i=Zn(i,{dir:"right",size:e.size}));let s=i.slice(2);s.length%2&&(s=`0${s}`);const r=s.length/2,n=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const l=wg(s.charCodeAt(a++)),c=wg(s.charCodeAt(a++));if(l===void 0||c===void 0)throw new yr(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);n[o]=l*16+c}return n}function Ej(t,e){const i=My(t,e);return Oy(i)}function xy(t,e={}){const i=vj.encode(t);return typeof e.size=="number"?(Jn(i,{size:e.size}),Zn(i,{dir:"right",size:e.size})):i}function Tc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Nj(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function sl(t,...e){if(!Nj(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Gq(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Tc(t.outputLen),Tc(t.blockLen)}function yg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Aj(t,e){sl(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Va=BigInt(2**32-1),vg=BigInt(32);function _j(t,e=!1){return e?{h:Number(t&Va),l:Number(t>>vg&Va)}:{h:Number(t>>vg&Va)|0,l:Number(t&Va)|0}}function Cj(t,e=!1){let i=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let r=0;r<t.length;r++){const{h:n,l:o}=_j(t[r],e);[i[r],s[r]]=[n,o]}return[i,s]}const Sj=(t,e,i)=>t<<i|e>>>32-i,Pj=(t,e,i)=>e<<i|t>>>32-i,Tj=(t,e,i)=>e<<i-32|t>>>64-i,Mj=(t,e,i)=>t<<i-32|e>>>64-i,Jr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Oj(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Yq(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Qq(t,e){return t<<32-e|t>>>e}const bg=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function xj(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Ig(t){for(let e=0;e<t.length;e++)t[e]=xj(t[e])}function kj(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function ky(t){return typeof t=="string"&&(t=kj(t)),sl(t),t}function Zq(...t){let e=0;for(let s=0;s<t.length;s++){const r=t[s];sl(r),e+=r.length}const i=new Uint8Array(e);for(let s=0,r=0;s<t.length;s++){const n=t[s];i.set(n,r),r+=n.length}return i}class Dj{clone(){return this._cloneInto()}}function jj(t){const e=s=>t().update(ky(s)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function Jq(t=32){if(Jr&&typeof Jr.getRandomValues=="function")return Jr.getRandomValues(new Uint8Array(t));if(Jr&&typeof Jr.randomBytes=="function")return Jr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Dy=[],jy=[],Ry=[],Rj=BigInt(0),mo=BigInt(1),Uj=BigInt(2),Lj=BigInt(7),zj=BigInt(256),$j=BigInt(113);for(let t=0,e=mo,i=1,s=0;t<24;t++){[i,s]=[s,(2*i+3*s)%5],Dy.push(2*(5*s+i)),jy.push((t+1)*(t+2)/2%64);let r=Rj;for(let n=0;n<7;n++)e=(e<<mo^(e>>Lj)*$j)%zj,e&Uj&&(r^=mo<<(mo<<BigInt(n))-mo);Ry.push(r)}const[qj,Bj]=Cj(Ry,!0),Eg=(t,e,i)=>i>32?Tj(t,e,i):Sj(t,e,i),Ng=(t,e,i)=>i>32?Mj(t,e,i):Pj(t,e,i);function Hj(t,e=24){const i=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=i[l],h=i[l+1],u=Eg(c,h,1)^i[a],d=Ng(c,h,1)^i[a+1];for(let p=0;p<50;p+=10)t[o+p]^=u,t[o+p+1]^=d}let r=t[2],n=t[3];for(let o=0;o<24;o++){const a=jy[o],l=Eg(r,n,a),c=Ng(r,n,a),h=Dy[o];r=t[h],n=t[h+1],t[h]=l,t[h+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=qj[s],t[1]^=Bj[s]}i.fill(0)}class ju extends Dj{constructor(e,i,s,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=s,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Tc(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Oj(this.state)}keccak(){bg||Ig(this.state32),Hj(this.state32,this.rounds),bg||Ig(this.state32),this.posOut=0,this.pos=0}update(e){yg(this);const{blockLen:i,state:s}=this;e=ky(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(i-this.pos,r-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:s,blockLen:r}=this;e[s]^=i,i&128&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){yg(this,!1),sl(e),this.finish();const i=this.state,{blockLen:s}=this;for(let r=0,n=e.length;r<n;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,n-r);e.set(i.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Tc(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Aj(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:s,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new ju(i,s,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Vj=(t,e,i)=>jj(()=>new ju(e,t,i)),Wj=Vj(1,136,256/8);function Uy(t,e){const i=e||"hex",s=Wj(Qo(t,{strict:!1})?bj(t):t);return i==="bytes"?s:$h(s)}class Kj extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const i=super.get(e);return super.has(e)&&i!==void 0&&(this.delete(e),super.set(e,i)),i}set(e,i){if(super.set(e,i),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const $l=new Kj(8192);function Fj(t,e){if($l.has(`${t}.${e}`))return $l.get(`${t}.${e}`);const i=t.substring(2).toLowerCase(),s=Uy(xy(i),"bytes"),r=i.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(s[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const n=`0x${r.join("")}`;return $l.set(`${t}.${e}`,n),n}function Gj(t){const e=Uy(`0x${t.substring(4)}`).substring(26);return Fj(`0x${e}`)}async function Yj({hash:t,signature:e}){const i=Qo(t)?t:$h(t),{secp256k1:s}=await Bo(async()=>{const{secp256k1:r}=await import("./secp256k1-C56YnRUb-DCBSmDbq.js");return{secp256k1:r}},__vite__mapDeps([10,1,2,5,6,7,8,9]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:a,s:l,v:c,yParity:h}=e,u=Number(h??c),d=Ag(u);return new s.Signature(zh(a),zh(l)).addRecoveryBit(d)}const r=Qo(e)?e:$h(e),n=gj(`0x${r.slice(130)}`),o=Ag(n);return s.Signature.fromCompact(r.substring(2,130)).addRecoveryBit(o)})().recoverPublicKey(i.substring(2)).toHex(!1)}`}function Ag(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function Qj({hash:t,signature:e}){return Gj(await Yj({hash:t,signature:e}))}function Zj(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let c=0;c<e.length;c++)e[c]=255;for(let c=0;c<t.length;c++){const h=t.charAt(c),u=h.charCodeAt(0);if(e[u]!==255)throw new TypeError(h+" is ambiguous");e[u]=c}const i=t.length,s=t.charAt(0),r=Math.log(i)/Math.log(256),n=Math.log(256)/Math.log(i);function o(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let h=0,u=0,d=0;const p=c.length;for(;d!==p&&c[d]===0;)d++,h++;const g=(p-d)*n+1>>>0,f=new Uint8Array(g);for(;d!==p;){let y=c[d],v=0;for(let I=g-1;(y!==0||v<u)&&I!==-1;I--,v++)y+=256*f[I]>>>0,f[I]=y%i>>>0,y=y/i>>>0;if(y!==0)throw new Error("Non-zero carry");u=v,d++}let w=g-u;for(;w!==g&&f[w]===0;)w++;let m=s.repeat(h);for(;w<g;++w)m+=t.charAt(f[w]);return m}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let h=0,u=0,d=0;for(;c[h]===s;)u++,h++;const p=(c.length-h)*r+1>>>0,g=new Uint8Array(p);for(;h<c.length;){const y=c.charCodeAt(h);if(y>255)return;let v=e[y];if(v===255)return;let I=0;for(let S=p-1;(v!==0||I<d)&&S!==-1;S--,I++)v+=i*g[S]>>>0,g[S]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=I,h++}let f=p-d;for(;f!==p&&g[f]===0;)f++;const w=new Uint8Array(u+(p-f));let m=u;for(;f!==p;)w[m++]=g[f++];return w}function l(c){const h=a(c);if(h)return h;throw new Error("Non-base"+i+" character")}return{encode:o,decodeUnsafe:a,decode:l}}var Jj="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Ly=Zj(Jj),Xj=":";function Mn(t){const[e,i]=t.split(Xj);return{namespace:e,reference:i}}function zy(t,e){return t.includes(":")?[t]:e.chains||[]}const eR="ReactNative",fi={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},tR="js";function Mc(){return typeof N.process<"u"&&typeof N.process.versions<"u"&&typeof N.process.versions.node<"u"}function Gs(){return!Vs()&&!!qc()&&navigator.product===eR}function iR(){return Gs()&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Platform)<"u"&&(N.global==null?void 0:N.global.Platform.OS)==="android"}function sR(){return Gs()&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Platform)<"u"&&(N.global==null?void 0:N.global.Platform.OS)==="ios"}function ya(){return!Mc()&&!!qc()&&!!Vs()}function va(){return Gs()?fi.reactNative:Mc()?fi.node:ya()?fi.browser:fi.unknown}function _g(){var t;try{return Gs()&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Application)<"u"?(t=N.global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function rR(t,e){const i=new URLSearchParams(t);for(const s of Object.keys(e).sort())if(e.hasOwnProperty(s)){const r=e[s];r!==void 0&&i.set(s,r)}return i.toString()}function $y(){return vm()||{name:"",description:"",url:"",icons:[""]}}function nR(){if(va()===fi.reactNative&&typeof N.global<"u"&&typeof(N.global==null?void 0:N.global.Platform)<"u"){const{OS:i,Version:s}=N.global.Platform;return[i,s].join("-")}const t=Tm();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function oR(){var t;const e=va();return e===fi.browser?[e,((t=bm())==null?void 0:t.host)||"unknown"].join(":"):e}function qy(t,e,i){const s=nR(),r=oR();return[[t,e].join("-"),[tR,i].join("-"),s,r].join("/")}function aR({protocol:t,version:e,relayUrl:i,sdkVersion:s,auth:r,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:l}){const c=i.split("?"),h=qy(t,e,s),u={auth:r,ua:h,projectId:n,useOnCloseEvent:o,packageName:l||void 0,bundleId:a||void 0},d=rR(c[1]||"",u);return c[0]+"?"+d}function hr(t,e){return t.filter(i=>e.includes(i)).length===t.length}function qh(t){return Object.fromEntries(t.entries())}function Bh(t){return new Map(Object.entries(t))}function sr(t=E.FIVE_MINUTES,e){const i=E.toMiliseconds(t||E.FIVE_MINUTES);let s,r,n,o;return{resolve:a=>{n&&s&&(clearTimeout(n),s(a),o=Promise.resolve(a))},reject:a=>{n&&r&&(clearTimeout(n),r(a))},done:()=>new Promise((a,l)=>{if(o)return a(o);n=setTimeout(()=>{const c=new Error(e);o=Promise.reject(c),l(c)},i),s=a,r=l})}}function Ls(t,e,i){return new Promise(async(s,r)=>{const n=setTimeout(()=>r(new Error(i)),e);try{const o=await t;s(o)}catch(o){r(o)}clearTimeout(n)})}function By(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function cR(t){return By("topic",t)}function lR(t){return By("id",t)}function Hy(t){const[e,i]=t.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")s.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))s.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return s}function ut(t,e){return E.fromMiliseconds(Date.now()+E.toMiliseconds(t))}function Ms(t){return Date.now()>=E.toMiliseconds(t)}function Ee(t,e){return`${t}${e?`:${e}`:""}`}function hc(t=[],e=[]){return[...new Set([...t,...e])]}async function hR({id:t,topic:e,wcDeepLink:i}){var s;try{if(!i)return;const r=typeof i=="string"?JSON.parse(i):i,n=r==null?void 0:r.href;if(typeof n!="string")return;const o=uR(n,t,e),a=va();if(a===fi.browser){if(!((s=Vs())!=null&&s.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}dR(o)}else a===fi.reactNative&&typeof(N.global==null?void 0:N.global.Linking)<"u"&&await N.global.Linking.openURL(o)}catch(r){console.error(r)}}function uR(t,e,i){const s=`requestId=${e}&sessionTopic=${i}`;t.endsWith("/")&&(t=t.slice(0,-1));let r=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";r=`${r}${n}${mR(s,!0)}`}else r=`${r}/wc?${s}`;return r}function dR(t){let e="_self";fR()?e="_top":(gR()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function pR(t,e){let i="";try{if(ya()&&(i=localStorage.getItem(e),i))return i;i=await t.getItem(e)}catch(s){console.error(s)}return i}function Cg(t,e){if(!t.includes(e))return null;const i=t.split(/([&,?,=])/),s=i.indexOf(e);return i[s+2]}function Sg(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ru(){return typeof N.process<"u"&&N.process.env.IS_VITEST==="true"}function gR(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function fR(){try{return window.self!==window.top}catch{return!1}}function mR(t,e=!1){const i=N.Buffer.from(t).toString("base64");return e?i.replace(/[=]/g,""):i}function Vy(t){return N.Buffer.from(t,"base64").toString("utf-8")}function wR(t){return new Promise(e=>setTimeout(e,t))}function Zo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function yR(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function rl(t,...e){if(!yR(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Uu(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Zo(t.outputLen),Zo(t.blockLen)}function Un(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Wy(t,e){rl(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Wa=BigInt(2**32-1),Pg=BigInt(32);function vR(t,e=!1){return e?{h:Number(t&Wa),l:Number(t>>Pg&Wa)}:{h:Number(t>>Pg&Wa)|0,l:Number(t&Wa)|0}}function bR(t,e=!1){let i=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let r=0;r<t.length;r++){const{h:n,l:o}=vR(t[r],e);[i[r],s[r]]=[n,o]}return[i,s]}const IR=(t,e,i)=>t<<i|e>>>32-i,ER=(t,e,i)=>e<<i|t>>>32-i,NR=(t,e,i)=>e<<i-32|t>>>64-i,AR=(t,e,i)=>t<<i-32|e>>>64-i,Xr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function _R(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ql(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Fi(t,e){return t<<32-e|t>>>e}const Tg=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function CR(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Mg(t){for(let e=0;e<t.length;e++)t[e]=CR(t[e])}function SR(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Ln(t){return typeof t=="string"&&(t=SR(t)),rl(t),t}let Lu=class{clone(){return this._cloneInto()}};function Ky(t){const e=s=>t().update(Ln(s)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function ba(t=32){if(Xr&&typeof Xr.getRandomValues=="function")return Xr.getRandomValues(new Uint8Array(t));if(Xr&&typeof Xr.randomBytes=="function")return Xr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const Fy=[],Gy=[],Yy=[],PR=BigInt(0),wo=BigInt(1),TR=BigInt(2),MR=BigInt(7),OR=BigInt(256),xR=BigInt(113);for(let t=0,e=wo,i=1,s=0;t<24;t++){[i,s]=[s,(2*i+3*s)%5],Fy.push(2*(5*s+i)),Gy.push((t+1)*(t+2)/2%64);let r=PR;for(let n=0;n<7;n++)e=(e<<wo^(e>>MR)*xR)%OR,e&TR&&(r^=wo<<(wo<<BigInt(n))-wo);Yy.push(r)}const[kR,DR]=bR(Yy,!0),Og=(t,e,i)=>i>32?NR(t,e,i):IR(t,e,i),xg=(t,e,i)=>i>32?AR(t,e,i):ER(t,e,i);function jR(t,e=24){const i=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,l=(o+2)%10,c=i[l],h=i[l+1],u=Og(c,h,1)^i[a],d=xg(c,h,1)^i[a+1];for(let p=0;p<50;p+=10)t[o+p]^=u,t[o+p+1]^=d}let r=t[2],n=t[3];for(let o=0;o<24;o++){const a=Gy[o],l=Og(r,n,a),c=xg(r,n,a),h=Fy[o];r=t[h],n=t[h+1],t[h]=l,t[h+1]=c}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=kR[s],t[1]^=DR[s]}i.fill(0)}let RR=class Qy extends Lu{constructor(e,i,s,r=!1,n=24){if(super(),this.blockLen=e,this.suffix=i,this.outputLen=s,this.enableXOF=r,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Zo(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=_R(this.state)}keccak(){Tg||Mg(this.state32),jR(this.state32,this.rounds),Tg||Mg(this.state32),this.posOut=0,this.pos=0}update(e){Un(this);const{blockLen:i,state:s}=this;e=Ln(e);const r=e.length;for(let n=0;n<r;){const o=Math.min(i-this.pos,r-n);for(let a=0;a<o;a++)s[this.pos++]^=e[n++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:s,blockLen:r}=this;e[s]^=i,i&128&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Un(this,!1),rl(e),this.finish();const i=this.state,{blockLen:s}=this;for(let r=0,n=e.length;r<n;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,n-r);e.set(i.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Zo(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Wy(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:i,suffix:s,outputLen:r,rounds:n,enableXOF:o}=this;return e||(e=new Qy(i,s,r,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}};const UR=(t,e,i)=>Ky(()=>new RR(e,t,i)),LR=UR(1,136,256/8),zR="https://rpc.walletconnect.org/v1";function Zy(t){const e=`Ethereum Signed Message:
${t.length}`,i=new TextEncoder().encode(e+t);return"0x"+N.Buffer.from(LR(i)).toString("hex")}async function $R(t,e,i,s,r,n){switch(i.t){case"eip191":return await qR(t,e,i.s);case"eip1271":return await BR(t,e,i.s,s,r,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${i.t}`)}}async function qR(t,e,i){return(await Qj({hash:Zy(e),signature:i})).toLowerCase()===t.toLowerCase()}async function BR(t,e,i,s,r,n){const o=Mn(s);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${s}`);try{const a="0x1626ba7e",l="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",h=i.substring(2),u=Zy(e).substring(2),d=a+u+l+c+h,p=await fetch(`${n||zR}/?chainId=${s}&projectId=${r}`,{method:"POST",body:JSON.stringify({id:HR(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:g}=await p.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function HR(){return Date.now()+Math.floor(Math.random()*1e3)}function VR(t){const e=atob(t),i=new Uint8Array(e.length);for(let o=0;o<e.length;o++)i[o]=e.charCodeAt(o);const s=i[0];if(s===0)throw new Error("No signatures found");const r=1+s*64;if(i.length<r)throw new Error("Transaction data too short for claimed signature count");if(i.length<100)throw new Error("Transaction too short");const n=N.Buffer.from(t,"base64").slice(1,65);return Ly.encode(n)}var WR=Object.defineProperty,KR=Object.defineProperties,FR=Object.getOwnPropertyDescriptors,kg=Object.getOwnPropertySymbols,GR=Object.prototype.hasOwnProperty,YR=Object.prototype.propertyIsEnumerable,Dg=(t,e,i)=>e in t?WR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,QR=(t,e)=>{for(var i in e||(e={}))GR.call(e,i)&&Dg(t,i,e[i]);if(kg)for(var i of kg(e))YR.call(e,i)&&Dg(t,i,e[i]);return t},ZR=(t,e)=>KR(t,FR(e));const JR="did:pkh:",zu=t=>t==null?void 0:t.split(":"),XR=t=>{const e=t&&zu(t);if(e)return t.includes(JR)?e[3]:e[1]},Hh=t=>{const e=t&&zu(t);if(e)return e[2]+":"+e[3]},Oc=t=>{const e=t&&zu(t);if(e)return e.pop()};async function jg(t){const{cacao:e,projectId:i}=t,{s,p:r}=e,n=Jy(r,r.iss),o=Oc(r.iss);return await $R(o,n,s,Hh(r.iss),i)}const Jy=(t,e)=>{const i=`${t.domain} wants you to sign in with your Ethereum account:`,s=Oc(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${XR(e)}`,l=`Nonce: ${t.nonce}`,c=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,u=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(f=>`
- ${f}`).join("")}`:void 0,g=uc(t.resources);if(g){const f=Jo(g);r=cU(r,f)}return[i,s,"",r,"",n,o,a,l,c,h,u,d,p].filter(f=>f!=null).join(`
`)};function eU(t){return N.Buffer.from(JSON.stringify(t)).toString("base64")}function tU(t){return JSON.parse(N.Buffer.from(t,"base64").toString("utf-8"))}function vr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(i=>{const s=t.att[i];if(Array.isArray(s))throw new Error(`Resource must be an object: ${i}`);if(typeof s!="object")throw new Error(`Resource must be an object: ${i}`);if(!Object.keys(s).length)throw new Error(`Resource object is empty: ${i}`);Object.keys(s).forEach(r=>{const n=s[r];if(!Array.isArray(n))throw new Error(`Ability limits ${r} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${r} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${r}) must be an array of objects, found: ${o}`)})})})}function iU(t,e,i,s={}){return i==null||i.sort((r,n)=>r.localeCompare(n)),{att:{[t]:sU(e,i,s)}}}function sU(t,e,i={}){e=e==null?void 0:e.sort((r,n)=>r.localeCompare(n));const s=e.map(r=>({[`${t}/${r}`]:[i]}));return Object.assign({},...s)}function Xy(t){return vr(t),`urn:recap:${eU(t).replace(/=/g,"")}`}function Jo(t){const e=tU(t.replace("urn:recap:",""));return vr(e),e}function rU(t,e,i){const s=iU(t,e,i);return Xy(s)}function nU(t){return t&&t.includes("urn:recap:")}function oU(t,e){const i=Jo(t),s=Jo(e),r=aU(i,s);return Xy(r)}function aU(t,e){vr(t),vr(e);const i=Object.keys(t.att).concat(Object.keys(e.att)).sort((r,n)=>r.localeCompare(n)),s={att:{}};return i.forEach(r=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[r])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[r])||{})).sort((a,l)=>a.localeCompare(l)).forEach(a=>{var l,c;s.att[r]=ZR(QR({},s.att[r]),{[a]:((l=t.att[r])==null?void 0:l[a])||((c=e.att[r])==null?void 0:c[a])})})}),s}function cU(t="",e){vr(e);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(i))return t;const s=[];let r=0;Object.keys(e.att).forEach(a=>{const l=Object.keys(e.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));l.sort((u,d)=>u.action.localeCompare(d.action));const c={};l.forEach(u=>{c[u.ability]||(c[u.ability]=[]),c[u.ability].push(u.action)});const h=Object.keys(c).map(u=>(r++,`(${r}) '${u}': '${c[u].join("', '")}' for '${a}'.`));s.push(h.join(", ").replace(".,","."))});const n=s.join(" "),o=`${i}${n}`;return`${t?t+" ":""}${o}`}function Rg(t){var e;const i=Jo(t);vr(i);const s=(e=i.att)==null?void 0:e.eip155;return s?Object.keys(s).map(r=>r.split("/")[1]):[]}function Ug(t){const e=Jo(t);vr(e);const i=[];return Object.values(e.att).forEach(s=>{Object.values(s).forEach(r=>{var n;(n=r==null?void 0:r[0])!=null&&n.chains&&i.push(r[0].chains)})}),[...new Set(i.flat())]}function uc(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return nU(e)?e:void 0}function Bl(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ev(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function di(t,...e){if(!ev(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Lg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function lU(t,e){di(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function zg(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}const qs=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),hU=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),uU=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!uU)throw new Error("Non little-endian hardware is not supported");function dU(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Vh(t){if(typeof t=="string")t=dU(t);else if(ev(t))t=Wh(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function pU(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function gU(t,e){if(t.length!==e.length)return!1;let i=0;for(let s=0;s<t.length;s++)i|=t[s]^e[s];return i===0}const fU=(t,e)=>{function i(s,...r){if(di(s),t.nonceLength!==void 0){const c=r[0];if(!c)throw new Error("nonce / iv required");t.varSizeNonce?di(c):di(c,t.nonceLength)}const n=t.tagLength;n&&r[1]!==void 0&&di(r[1]);const o=e(s,...r),a=(c,h)=>{if(h!==void 0){if(c!==2)throw new Error("cipher output not supported");di(h)}};let l=!1;return{encrypt(c,h){if(l)throw new Error("cannot encrypt() twice with same key + nonce");return l=!0,di(c),a(o.encrypt.length,h),o.encrypt(c,h)},decrypt(c,h){if(di(c),n&&c.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,h),o.decrypt(c,h)}}}return Object.assign(i,t),i};function $g(t,e,i=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(i&&!mU(e))throw new Error("invalid output, must be aligned");return e}function qg(t,e,i,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,s);const r=BigInt(32),n=BigInt(4294967295),o=Number(i>>r&n),a=Number(i&n);t.setUint32(e+4,o,s),t.setUint32(e+0,a,s)}function mU(t){return t.byteOffset%4===0}function Wh(t){return Uint8Array.from(t)}function zn(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const tv=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),wU=tv("expand 16-byte k"),yU=tv("expand 32-byte k"),vU=qs(wU),bU=qs(yU);function ge(t,e){return t<<e|t>>>32-e}function Kh(t){return t.byteOffset%4===0}const Ka=64,IU=16,iv=2**32-1,Bg=new Uint32Array;function EU(t,e,i,s,r,n,o,a){const l=r.length,c=new Uint8Array(Ka),h=qs(c),u=Kh(r)&&Kh(n),d=u?qs(r):Bg,p=u?qs(n):Bg;for(let g=0;g<l;o++){if(t(e,i,s,h,o,a),o>=iv)throw new Error("arx: counter overflow");const f=Math.min(Ka,l-g);if(u&&f===Ka){const w=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let m=0,y;m<IU;m++)y=w+m,p[y]=d[y]^h[m];g+=Ka;continue}for(let w=0,m;w<f;w++)m=g+w,n[m]=r[m]^c[w];g+=f}}function NU(t,e){const{allowShortKeys:i,extendNonceFn:s,counterLength:r,counterRight:n,rounds:o}=pU({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Bl(r),Bl(o),zg(n),zg(i),(a,l,c,h,u=0)=>{di(a),di(l),di(c);const d=c.length;if(h===void 0&&(h=new Uint8Array(d)),di(h),Bl(u),u<0||u>=iv)throw new Error("arx: counter overflow");if(h.length<d)throw new Error(`arx: output (${h.length}) is shorter than data (${d})`);const p=[];let g=a.length,f,w;if(g===32)p.push(f=Wh(a)),w=bU;else if(g===16&&i)f=new Uint8Array(32),f.set(a),f.set(a,16),w=vU,p.push(f);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Kh(l)||p.push(l=Wh(l));const m=qs(f);if(s){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");s(w,m,qs(l.subarray(0,16)),m),l=l.subarray(16)}const y=16-r;if(y!==l.length)throw new Error(`arx: nonce must be ${y} or 16 bytes`);if(y!==12){const I=new Uint8Array(12);I.set(l,n?0:12-l.length),l=I,p.push(l)}const v=qs(l);return EU(t,w,m,v,c,h,u,o),zn(...p),h}}const Ct=(t,e)=>t[e++]&255|(t[e++]&255)<<8;let AU=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=Vh(t),di(t,32);const e=Ct(t,0),i=Ct(t,2),s=Ct(t,4),r=Ct(t,6),n=Ct(t,8),o=Ct(t,10),a=Ct(t,12),l=Ct(t,14);this.r[0]=e&8191,this.r[1]=(e>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|r<<9)&8191,this.r[4]=(r>>>4|n<<12)&255,this.r[5]=n>>>1&8190,this.r[6]=(n>>>14|o<<2)&8191,this.r[7]=(o>>>11|a<<5)&8065,this.r[8]=(a>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let c=0;c<8;c++)this.pad[c]=Ct(t,16+2*c)}process(t,e,i=!1){const s=i?0:2048,{h:r,r:n}=this,o=n[0],a=n[1],l=n[2],c=n[3],h=n[4],u=n[5],d=n[6],p=n[7],g=n[8],f=n[9],w=Ct(t,e+0),m=Ct(t,e+2),y=Ct(t,e+4),v=Ct(t,e+6),I=Ct(t,e+8),S=Ct(t,e+10),T=Ct(t,e+12),P=Ct(t,e+14);let _=r[0]+(w&8191),A=r[1]+((w>>>13|m<<3)&8191),M=r[2]+((m>>>10|y<<6)&8191),k=r[3]+((y>>>7|v<<9)&8191),B=r[4]+((v>>>4|I<<12)&8191),$=r[5]+(I>>>1&8191),q=r[6]+((I>>>14|S<<2)&8191),L=r[7]+((S>>>11|T<<5)&8191),H=r[8]+((T>>>8|P<<8)&8191),V=r[9]+(P>>>5|s),C=0,U=C+_*o+A*(5*f)+M*(5*g)+k*(5*p)+B*(5*d);C=U>>>13,U&=8191,U+=$*(5*u)+q*(5*h)+L*(5*c)+H*(5*l)+V*(5*a),C+=U>>>13,U&=8191;let W=C+_*a+A*o+M*(5*f)+k*(5*g)+B*(5*p);C=W>>>13,W&=8191,W+=$*(5*d)+q*(5*u)+L*(5*h)+H*(5*c)+V*(5*l),C+=W>>>13,W&=8191;let Q=C+_*l+A*a+M*o+k*(5*f)+B*(5*g);C=Q>>>13,Q&=8191,Q+=$*(5*p)+q*(5*d)+L*(5*u)+H*(5*h)+V*(5*c),C+=Q>>>13,Q&=8191;let F=C+_*c+A*l+M*a+k*o+B*(5*f);C=F>>>13,F&=8191,F+=$*(5*g)+q*(5*p)+L*(5*d)+H*(5*u)+V*(5*h),C+=F>>>13,F&=8191;let ne=C+_*h+A*c+M*l+k*a+B*o;C=ne>>>13,ne&=8191,ne+=$*(5*f)+q*(5*g)+L*(5*p)+H*(5*d)+V*(5*u),C+=ne>>>13,ne&=8191;let ve=C+_*u+A*h+M*c+k*l+B*a;C=ve>>>13,ve&=8191,ve+=$*o+q*(5*f)+L*(5*g)+H*(5*p)+V*(5*d),C+=ve>>>13,ve&=8191;let De=C+_*d+A*u+M*h+k*c+B*l;C=De>>>13,De&=8191,De+=$*a+q*o+L*(5*f)+H*(5*g)+V*(5*p),C+=De>>>13,De&=8191;let Xe=C+_*p+A*d+M*u+k*h+B*c;C=Xe>>>13,Xe&=8191,Xe+=$*l+q*a+L*o+H*(5*f)+V*(5*g),C+=Xe>>>13,Xe&=8191;let Ke=C+_*g+A*p+M*d+k*u+B*h;C=Ke>>>13,Ke&=8191,Ke+=$*c+q*l+L*a+H*o+V*(5*f),C+=Ke>>>13,Ke&=8191;let Fe=C+_*f+A*g+M*p+k*d+B*u;C=Fe>>>13,Fe&=8191,Fe+=$*h+q*c+L*l+H*a+V*o,C+=Fe>>>13,Fe&=8191,C=(C<<2)+C|0,C=C+U|0,U=C&8191,C=C>>>13,W+=C,r[0]=U,r[1]=W,r[2]=Q,r[3]=F,r[4]=ne,r[5]=ve,r[6]=De,r[7]=Xe,r[8]=Ke,r[9]=Fe}finalize(){const{h:t,pad:e}=this,i=new Uint16Array(10);let s=t[1]>>>13;t[1]&=8191;for(let o=2;o<10;o++)t[o]+=s,s=t[o]>>>13,t[o]&=8191;t[0]+=s*5,s=t[0]>>>13,t[0]&=8191,t[1]+=s,s=t[1]>>>13,t[1]&=8191,t[2]+=s,i[0]=t[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=t[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let r=(s^1)-1;for(let o=0;o<10;o++)i[o]&=r;r=~r;for(let o=0;o<10;o++)t[o]=t[o]&r|i[o];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let n=t[0]+e[0];t[0]=n&65535;for(let o=1;o<8;o++)n=(t[o]+e[o]|0)+(n>>>16)|0,t[o]=n&65535;zn(i)}update(t){Lg(this);const{buffer:e,blockLen:i}=this;t=Vh(t);const s=t.length;for(let r=0;r<s;){const n=Math.min(i-this.pos,s-r);if(n===i){for(;i<=s-r;r+=i)this.process(t,r);continue}e.set(t.subarray(r,r+n),this.pos),this.pos+=n,r+=n,this.pos===i&&(this.process(e,0,!1),this.pos=0)}return this}destroy(){zn(this.h,this.r,this.buffer,this.pad)}digestInto(t){Lg(this),lU(t,this),this.finished=!0;const{buffer:e,h:i}=this;let{pos:s}=this;if(s){for(e[s++]=1;s<16;s++)e[s]=0;this.process(e,0,!0)}this.finalize();let r=0;for(let n=0;n<8;n++)t[r++]=i[n]>>>0,t[r++]=i[n]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const i=t.slice(0,e);return this.destroy(),i}};function _U(t){const e=(s,r)=>t(r).update(Vh(s)).digest(),i=t(new Uint8Array(32));return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=s=>t(s),e}const CU=_U(t=>new AU(t));function SU(t,e,i,s,r,n=20){let o=t[0],a=t[1],l=t[2],c=t[3],h=e[0],u=e[1],d=e[2],p=e[3],g=e[4],f=e[5],w=e[6],m=e[7],y=r,v=i[0],I=i[1],S=i[2],T=o,P=a,_=l,A=c,M=h,k=u,B=d,$=p,q=g,L=f,H=w,V=m,C=y,U=v,W=I,Q=S;for(let ne=0;ne<n;ne+=2)T=T+M|0,C=ge(C^T,16),q=q+C|0,M=ge(M^q,12),T=T+M|0,C=ge(C^T,8),q=q+C|0,M=ge(M^q,7),P=P+k|0,U=ge(U^P,16),L=L+U|0,k=ge(k^L,12),P=P+k|0,U=ge(U^P,8),L=L+U|0,k=ge(k^L,7),_=_+B|0,W=ge(W^_,16),H=H+W|0,B=ge(B^H,12),_=_+B|0,W=ge(W^_,8),H=H+W|0,B=ge(B^H,7),A=A+$|0,Q=ge(Q^A,16),V=V+Q|0,$=ge($^V,12),A=A+$|0,Q=ge(Q^A,8),V=V+Q|0,$=ge($^V,7),T=T+k|0,Q=ge(Q^T,16),H=H+Q|0,k=ge(k^H,12),T=T+k|0,Q=ge(Q^T,8),H=H+Q|0,k=ge(k^H,7),P=P+B|0,C=ge(C^P,16),V=V+C|0,B=ge(B^V,12),P=P+B|0,C=ge(C^P,8),V=V+C|0,B=ge(B^V,7),_=_+$|0,U=ge(U^_,16),q=q+U|0,$=ge($^q,12),_=_+$|0,U=ge(U^_,8),q=q+U|0,$=ge($^q,7),A=A+M|0,W=ge(W^A,16),L=L+W|0,M=ge(M^L,12),A=A+M|0,W=ge(W^A,8),L=L+W|0,M=ge(M^L,7);let F=0;s[F++]=o+T|0,s[F++]=a+P|0,s[F++]=l+_|0,s[F++]=c+A|0,s[F++]=h+M|0,s[F++]=u+k|0,s[F++]=d+B|0,s[F++]=p+$|0,s[F++]=g+q|0,s[F++]=f+L|0,s[F++]=w+H|0,s[F++]=m+V|0,s[F++]=y+C|0,s[F++]=v+U|0,s[F++]=I+W|0,s[F++]=S+Q|0}const PU=NU(SU,{counterRight:!1,counterLength:4,allowShortKeys:!1}),TU=new Uint8Array(16),Hg=(t,e)=>{t.update(e);const i=e.length%16;i&&t.update(TU.subarray(i))},MU=new Uint8Array(32);function Vg(t,e,i,s,r){const n=t(e,i,MU),o=CU.create(n);r&&Hg(o,r),Hg(o,s);const a=new Uint8Array(16),l=hU(a);qg(l,0,BigInt(r?r.length:0),!0),qg(l,8,BigInt(s.length),!0),o.update(a);const c=o.digest();return zn(n,a),c}const OU=t=>(e,i,s)=>({encrypt(r,n){const o=r.length;n=$g(o+16,n,!1),n.set(r);const a=n.subarray(0,-16);t(e,i,a,a,1);const l=Vg(t,e,i,a,s);return n.set(l,o),zn(l),n},decrypt(r,n){n=$g(r.length-16,n,!1);const o=r.subarray(0,-16),a=r.subarray(-16),l=Vg(t,e,i,o,s);if(!gU(a,l))throw new Error("invalid tag");return n.set(r.subarray(0,-16)),t(e,i,n,n,1),zn(l),n}}),sv=fU({blockSize:64,nonceLength:12,tagLength:16},OU(PU));let rv=class extends Lu{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Uu(t);const i=Ln(e);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,r=new Uint8Array(s);r.set(i.length>s?t.create().update(i).digest():i);for(let n=0;n<r.length;n++)r[n]^=54;this.iHash.update(r),this.oHash=t.create();for(let n=0;n<r.length;n++)r[n]^=106;this.oHash.update(r),r.fill(0)}update(t){return Un(this),this.iHash.update(t),this}digestInto(t){Un(this),rl(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:i,finished:s,destroyed:r,blockLen:n,outputLen:o}=this;return t=t,t.finished=s,t.destroyed=r,t.blockLen=n,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=i._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const $u=(t,e,i)=>new rv(t,e).update(i).digest();$u.create=(t,e)=>new rv(t,e);function xU(t,e,i){return Uu(t),i===void 0&&(i=new Uint8Array(t.outputLen)),$u(t,Ln(i),Ln(e))}const Hl=new Uint8Array([0]),Wg=new Uint8Array;function kU(t,e,i,s=32){if(Uu(t),Zo(s),s>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const r=Math.ceil(s/t.outputLen);i===void 0&&(i=Wg);const n=new Uint8Array(r*t.outputLen),o=$u.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<r;c++)Hl[0]=c+1,a.update(c===0?Wg:l).update(i).update(Hl).digestInto(l),n.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),Hl.fill(0),n.slice(0,s)}const DU=(t,e,i,s,r)=>kU(t,xU(t,e,i),s,r);function jU(t,e,i,s){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,s);const r=BigInt(32),n=BigInt(4294967295),o=Number(i>>r&n),a=Number(i&n),l=s?4:0,c=s?0:4;t.setUint32(e+l,o,s),t.setUint32(e+c,a,s)}function RU(t,e,i){return t&e^~t&i}function UU(t,e,i){return t&e^t&i^e&i}class LU extends Lu{constructor(e,i,s,r){super(),this.blockLen=e,this.outputLen=i,this.padOffset=s,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ql(this.buffer)}update(e){Un(this);const{view:i,buffer:s,blockLen:r}=this;e=Ln(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(r-this.pos,n-o);if(a===r){const l=ql(e);for(;r<=n-o;o+=r)this.process(l,o);continue}s.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(i,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Un(this),Wy(e,this),this.finished=!0;const{buffer:i,view:s,blockLen:r,isLE:n}=this;let{pos:o}=this;i[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(s,0),o=0);for(let u=o;u<r;u++)i[u]=0;jU(s,r-8,BigInt(this.length*8),n),this.process(s,0);const a=ql(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<c;u++)a.setUint32(4*u,h[u],n)}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const s=e.slice(0,i);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:i,buffer:s,length:r,finished:n,destroyed:o,pos:a}=this;return e.length=r,e.pos=a,e.finished=n,e.destroyed=o,r%i&&e.buffer.set(s),e}}const zU=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ns=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),As=new Uint32Array(64);let $U=class extends LU{constructor(){super(64,32,8,!1),this.A=Ns[0]|0,this.B=Ns[1]|0,this.C=Ns[2]|0,this.D=Ns[3]|0,this.E=Ns[4]|0,this.F=Ns[5]|0,this.G=Ns[6]|0,this.H=Ns[7]|0}get(){const{A:t,B:e,C:i,D:s,E:r,F:n,G:o,H:a}=this;return[t,e,i,s,r,n,o,a]}set(t,e,i,s,r,n,o,a){this.A=t|0,this.B=e|0,this.C=i|0,this.D=s|0,this.E=r|0,this.F=n|0,this.G=o|0,this.H=a|0}process(t,e){for(let h=0;h<16;h++,e+=4)As[h]=t.getUint32(e,!1);for(let h=16;h<64;h++){const u=As[h-15],d=As[h-2],p=Fi(u,7)^Fi(u,18)^u>>>3,g=Fi(d,17)^Fi(d,19)^d>>>10;As[h]=g+As[h-7]+p+As[h-16]|0}let{A:i,B:s,C:r,D:n,E:o,F:a,G:l,H:c}=this;for(let h=0;h<64;h++){const u=Fi(o,6)^Fi(o,11)^Fi(o,25),d=c+u+RU(o,a,l)+zU[h]+As[h]|0,p=(Fi(i,2)^Fi(i,13)^Fi(i,22))+UU(i,s,r)|0;c=l,l=a,a=o,o=n+d|0,n=r,r=s,s=i,i=d+p|0}i=i+this.A|0,s=s+this.B|0,r=r+this.C|0,n=n+this.D|0,o=o+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(i,s,r,n,o,a,l,c)}roundClean(){As.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const nl=Ky(()=>new $U);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nv=BigInt(0);function qu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ov(t){if(!qu(t))throw new Error("Uint8Array expected")}const qU=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function BU(t){ov(t);let e="";for(let i=0;i<t.length;i++)e+=qU[t[i]];return e}function HU(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?nv:BigInt("0x"+t)}const ls={_0:48,_9:57,A:65,F:70,a:97,f:102};function Kg(t){if(t>=ls._0&&t<=ls._9)return t-ls._0;if(t>=ls.A&&t<=ls.F)return t-(ls.A-10);if(t>=ls.a&&t<=ls.f)return t-(ls.a-10)}function av(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,i=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const s=new Uint8Array(i);for(let r=0,n=0;r<i;r++,n+=2){const o=Kg(t.charCodeAt(n)),a=Kg(t.charCodeAt(n+1));if(o===void 0||a===void 0){const l=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+n)}s[r]=o*16+a}return s}function Fg(t){return ov(t),HU(BU(Uint8Array.from(t).reverse()))}function VU(t,e){return av(t.toString(16).padStart(e*2,"0"))}function WU(t,e){return VU(t,e).reverse()}function Gg(t,e,i){let s;if(typeof e=="string")try{s=av(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(qu(e))s=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=s.length;if(typeof i=="number"&&r!==i)throw new Error(t+" of length "+i+" expected, got "+r);return s}const Vl=t=>typeof t=="bigint"&&nv<=t;function KU(t,e,i){return Vl(t)&&Vl(e)&&Vl(i)&&e<=t&&t<i}function Yg(t,e,i,s){if(!KU(e,i,s))throw new Error("expected valid "+t+": "+i+" <= n < "+s+", got "+e)}const FU={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||qu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function GU(t,e,i={}){const s=(r,n,o)=>{const a=FU[n];if(typeof a!="function")throw new Error("invalid validator function");const l=t[r];if(!(o&&l===void 0)&&!a(l,t))throw new Error("param "+String(r)+" is invalid. Expected "+n+", got "+l)};for(const[r,n]of Object.entries(e))s(r,n,!1);for(const[r,n]of Object.entries(i))s(r,n,!0);return t}const _n=BigInt(0),Fa=BigInt(1);function cv(t,e){const i=t%e;return i>=_n?i:e+i}function YU(t,e,i){if(e<_n)throw new Error("invalid exponent, negatives unsupported");if(i<=_n)throw new Error("invalid modulus");if(i===Fa)return _n;let s=Fa;for(;e>_n;)e&Fa&&(s=s*t%i),t=t*t%i,e>>=Fa;return s}function zi(t,e,i){let s=t;for(;e-- >_n;)s*=s,s%=i;return s}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const en=BigInt(0),Wl=BigInt(1);function QU(t){return GU(t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...t})}function ZU(t){const e=QU(t),{P:i}=e,s=y=>cv(y,i),r=e.montgomeryBits,n=Math.ceil(r/8),o=e.nByteLength,a=e.adjustScalarBytes||(y=>y),l=e.powPminus2||(y=>YU(y,i-BigInt(2),i));function c(y,v,I){const S=s(y*(v-I));return v=s(v-S),I=s(I+S),[v,I]}const h=(e.a-BigInt(2))/BigInt(4);function u(y,v){Yg("u",y,en,i),Yg("scalar",v,en,i);const I=v,S=y;let T=Wl,P=en,_=y,A=Wl,M=en,k;for(let $=BigInt(r-1);$>=en;$--){const q=I>>$&Wl;M^=q,k=c(M,T,_),T=k[0],_=k[1],k=c(M,P,A),P=k[0],A=k[1],M=q;const L=T+P,H=s(L*L),V=T-P,C=s(V*V),U=H-C,W=_+A,Q=_-A,F=s(Q*L),ne=s(W*V),ve=F+ne,De=F-ne;_=s(ve*ve),A=s(S*s(De*De)),T=s(H*C),P=s(U*(H+s(h*U)))}k=c(M,T,_),T=k[0],_=k[1],k=c(M,P,A),P=k[0],A=k[1];const B=l(P);return s(T*B)}function d(y){return WU(s(y),n)}function p(y){const v=Gg("u coordinate",y,n);return o===32&&(v[31]&=127),Fg(v)}function g(y){const v=Gg("scalar",y),I=v.length;if(I!==n&&I!==o){let S=""+n+" or "+o;throw new Error("invalid scalar, expected "+S+" bytes, got "+I)}return Fg(a(v))}function f(y,v){const I=p(v),S=g(y),T=u(I,S);if(T===en)throw new Error("invalid private or public key received");return d(T)}const w=d(e.Gu);function m(y){return f(y,w)}return{scalarMult:f,scalarMultBase:m,getSharedSecret:(y,v)=>f(y,v),getPublicKey:y=>m(y),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:w}}const Fh=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const JU=BigInt(1),Qg=BigInt(2),XU=BigInt(3),eL=BigInt(5);BigInt(8);function tL(t){const e=BigInt(10),i=BigInt(20),s=BigInt(40),r=BigInt(80),n=Fh,o=t*t%n*t%n,a=zi(o,Qg,n)*o%n,l=zi(a,JU,n)*t%n,c=zi(l,eL,n)*l%n,h=zi(c,e,n)*c%n,u=zi(h,i,n)*h%n,d=zi(u,s,n)*u%n,p=zi(d,r,n)*d%n,g=zi(p,r,n)*d%n,f=zi(g,e,n)*c%n;return{pow_p_5_8:zi(f,Qg,n)*t%n,b2:o}}function iL(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Gh=ZU({P:Fh,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=Fh,{pow_p_5_8:i,b2:s}=tL(t);return cv(zi(i,XU,e)*s,e)},adjustScalarBytes:iL,randomBytes:ba}),lv="base10",Ht="base16",zs="base64pad",yo="base64url",Ia="utf8",hv=0,ms=1,Ea=2,sL=0,Zg=1,Ro=12,Bu=32;function rL(){const t=Gh.utils.randomPrivateKey(),e=Gh.getPublicKey(t);return{privateKey:Ne(t,Ht),publicKey:Ne(e,Ht)}}function Yh(){const t=ba(Bu);return Ne(t,Ht)}function nL(t,e){const i=Gh.getSharedSecret(Ge(t,Ht),Ge(e,Ht)),s=DU(nl,i,void 0,void 0,Bu);return Ne(s,Ht)}function dc(t){const e=nl(Ge(t,Ht));return Ne(e,Ht)}function Ji(t){const e=nl(Ge(t,Ia));return Ne(e,Ht)}function uv(t){return Ge(`${t}`,lv)}function br(t){return Number(Ne(t,lv))}function oL(t){const e=uv(typeof t.type<"u"?t.type:hv);if(br(e)===ms&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof t.senderPublicKey<"u"?Ge(t.senderPublicKey,Ht):void 0,s=typeof t.iv<"u"?Ge(t.iv,Ht):ba(Ro),r=Ge(t.symKey,Ht),n=sv(r,s).encrypt(Ge(t.message,Ia));return dv({type:e,sealed:n,iv:s,senderPublicKey:i,encoding:t.encoding})}function aL(t){const e=Ge(t.symKey,Ht),{sealed:i,iv:s}=Xo(t),r=sv(e,s).decrypt(i);if(r===null)throw new Error("Failed to decrypt");return Ne(r,Ia)}function cL(t,e){const i=uv(Ea),s=ba(Ro),r=Ge(t,Ia);return dv({type:i,sealed:r,iv:s,encoding:e})}function lL(t,e){const{sealed:i}=Xo({encoded:t,encoding:e});return Ne(i,Ia)}function dv(t){const{encoding:e=zs}=t;if(br(t.type)===Ea)return Ne(Pn([t.type,t.sealed]),e);if(br(t.type)===ms){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Ne(Pn([t.type,t.senderPublicKey,t.iv,t.sealed]),e)}return Ne(Pn([t.type,t.iv,t.sealed]),e)}function Xo(t){const{encoded:e,encoding:i=zs}=t,s=Ge(e,i),r=s.slice(sL,Zg),n=Zg;if(br(r)===ms){const c=n+Bu,h=c+Ro,u=s.slice(n,c),d=s.slice(c,h),p=s.slice(h);return{type:r,sealed:p,iv:d,senderPublicKey:u}}if(br(r)===Ea){const c=s.slice(n),h=ba(Ro);return{type:r,sealed:c,iv:h}}const o=n+Ro,a=s.slice(n,o),l=s.slice(o);return{type:r,sealed:l,iv:a}}function hL(t,e){const i=Xo({encoded:t,encoding:e==null?void 0:e.encoding});return pv({type:br(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?Ne(i.senderPublicKey,Ht):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function pv(t){const e=(t==null?void 0:t.type)||hv;if(e===ms){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Jg(t){return t.type===ms&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Xg(t){return t.type===Ea}function uL(t){return new Ym.ec("p256").keyFromPublic({x:N.Buffer.from(t.x,"base64").toString("hex"),y:N.Buffer.from(t.y,"base64").toString("hex")},"hex")}function dL(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");const i=e.length%4;return i>0&&(e+="=".repeat(4-i)),e}function pL(t){return N.Buffer.from(dL(t),"base64")}function gL(t,e){const[i,s,r]=t.split("."),n=pL(r);if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32).toString("hex"),a=n.slice(32,64).toString("hex"),l=`${i}.${s}`,c=nl(l),h=uL(e),u=Ne(c,Ht);if(!h.verify(u,{r:o,s:a}))throw new Error("Invalid signature");return kn(t).payload}const fL="irn";function xc(t){return(t==null?void 0:t.relay)||{protocol:fL}}function To(t){const e=Cm[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function mL(t,e="-"){const i={},s="relay"+e;return Object.keys(t).forEach(r=>{if(r.startsWith(s)){const n=r.replace(s,""),o=t[r];i[n]=o}}),i}function ef(t){if(!t.includes("wc:")){const c=Vy(t);c!=null&&c.includes("wc:")&&(t=c)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),i=t.indexOf("?")!==-1?t.indexOf("?"):void 0,s=t.substring(0,e),r=t.substring(e+1,i).split("@"),n=typeof i<"u"?t.substring(i):"",o=new URLSearchParams(n),a={};o.forEach((c,h)=>{a[h]=c});const l=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:s,topic:wL(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:mL(a),methods:l,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function wL(t){return t.startsWith("//")?t.substring(2):t}function yL(t,e="-"){const i="relay",s={};return Object.keys(t).forEach(r=>{const n=r,o=i+e+n;t[n]&&(s[o]=t[n])}),s}function tf(t){const e=new URLSearchParams,i=yL(t.relay);Object.keys(i).sort().forEach(r=>{e.set(r,i[r])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const s=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${s}`}function Ga(t,e,i){return`${t}?wc_ev=${i}&topic=${e}`}function Xn(t){const e=[];return t.forEach(i=>{const[s,r]=i.split(":");e.push(`${s}:${r}`)}),e}function vL(t){const e=[];return Object.values(t).forEach(i=>{e.push(...Xn(i.accounts))}),e}function bL(t,e){const i=[];return Object.values(t).forEach(s=>{Xn(s.accounts).includes(e)&&i.push(...s.methods)}),i}function IL(t,e){const i=[];return Object.values(t).forEach(s=>{Xn(s.accounts).includes(e)&&i.push(...s.events)}),i}function Hu(t){return t.includes(":")}function Mo(t){return Hu(t)?t.split(":")[0]:t}function EL(t){const e={};return t==null||t.forEach(i=>{var s;const[r,n]=i.split(":");e[r]||(e[r]={accounts:[],chains:[],events:[],methods:[]}),e[r].accounts.push(i),(s=e[r].chains)==null||s.push(`${r}:${n}`)}),e}function sf(t,e){e=e.map(s=>s.replace("did:pkh:",""));const i=EL(e);for(const[s,r]of Object.entries(i))r.methods?r.methods=hc(r.methods,t):r.methods=t,r.events=["chainChanged","accountsChanged"];return i}const NL={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},AL={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function R(t,e){const{message:i,code:s}=AL[t];return{message:e?`${i} ${e}`:i,code:s}}function Oe(t,e){const{message:i,code:s}=NL[t];return{message:e?`${i} ${e}`:i,code:s}}function Ir(t,e){return!!Array.isArray(t)}function ea(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function qt(t){return typeof t>"u"}function at(t,e){return e&&qt(t)?!0:typeof t=="string"&&!!t.trim().length}function Vu(t,e){return typeof t=="number"&&!isNaN(t)}function _L(t,e){const{requiredNamespaces:i}=e,s=Object.keys(t.namespaces),r=Object.keys(i);let n=!0;return hr(r,s)?(s.forEach(o=>{const{accounts:a,methods:l,events:c}=t.namespaces[o],h=Xn(a),u=i[o];(!hr(zy(o,u),h)||!hr(u.methods,l)||!hr(u.events,c))&&(n=!1)}),n):!1}function kc(t){return at(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function CL(t){if(at(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const i=e[0]+":"+e[1];return!!e[2]&&kc(i)}}return!1}function SL(t){function e(i){try{return typeof new URL(i)<"u"}catch{return!1}}try{if(at(t,!1)){if(e(t))return!0;const i=Vy(t);return e(i)}}catch{}return!1}function PL(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function TL(t){return t==null?void 0:t.topic}function ML(t,e){let i=null;return at(t==null?void 0:t.publicKey,!1)||(i=R("MISSING_OR_INVALID",`${e} controller public key should be a string`)),i}function rf(t){let e=!0;return Ir(t)?t.length&&(e=t.every(i=>at(i,!1))):e=!1,e}function OL(t,e,i){let s=null;return Ir(e)&&e.length?e.forEach(r=>{s||kc(r)||(s=Oe("UNSUPPORTED_CHAINS",`${i}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):kc(t)||(s=Oe("UNSUPPORTED_CHAINS",`${i}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function xL(t,e,i){let s=null;return Object.entries(t).forEach(([r,n])=>{if(s)return;const o=OL(r,zy(r,n),`${e} ${i}`);o&&(s=o)}),s}function kL(t,e){let i=null;return Ir(t)?t.forEach(s=>{i||CL(s)||(i=Oe("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):i=Oe("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function DL(t,e){let i=null;return Object.values(t).forEach(s=>{if(i)return;const r=kL(s==null?void 0:s.accounts,`${e} namespace`);r&&(i=r)}),i}function jL(t,e){let i=null;return rf(t==null?void 0:t.methods)?rf(t==null?void 0:t.events)||(i=Oe("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):i=Oe("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),i}function gv(t,e){let i=null;return Object.values(t).forEach(s=>{if(i)return;const r=jL(s,`${e}, namespace`);r&&(i=r)}),i}function RL(t,e,i){let s=null;if(t&&ea(t)){const r=gv(t,e);r&&(s=r);const n=xL(t,e,i);n&&(s=n)}else s=R("MISSING_OR_INVALID",`${e}, ${i} should be an object with data`);return s}function Kl(t,e){let i=null;if(t&&ea(t)){const s=gv(t,e);s&&(i=s);const r=DL(t,e);r&&(i=r)}else i=R("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return i}function fv(t){return at(t.protocol,!0)}function UL(t,e){let i=!1;return t?t&&Ir(t)&&t.length&&t.forEach(s=>{i=fv(s)}):i=!0,i}function LL(t){return typeof t=="number"}function ii(t){return typeof t<"u"&&typeof t!==null}function zL(t){return!(!t||typeof t!="object"||!t.code||!Vu(t.code)||!t.message||!at(t.message,!1))}function $L(t){return!(qt(t)||!at(t.method,!1))}function qL(t){return!(qt(t)||qt(t.result)&&qt(t.error)||!Vu(t.id)||!at(t.jsonrpc,!1))}function BL(t){return!(qt(t)||!at(t.name,!1))}function nf(t,e){return!(!kc(e)||!vL(t).includes(e))}function HL(t,e,i){return at(i,!1)?bL(t,e).includes(i):!1}function VL(t,e,i){return at(i,!1)?IL(t,e).includes(i):!1}function of(t,e,i){let s=null;const r=WL(t),n=KL(e),o=Object.keys(r),a=Object.keys(n),l=af(Object.keys(t)),c=af(Object.keys(e)),h=l.filter(u=>!c.includes(u));return h.length&&(s=R("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),hr(o,a)||(s=R("NON_CONFORMING_NAMESPACES",`${i} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||s)return;const d=Xn(e[u].accounts);d.includes(u)||(s=R("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${d.toString()}`))}),o.forEach(u=>{s||(hr(r[u].methods,n[u].methods)?hr(r[u].events,n[u].events)||(s=R("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${u}`)):s=R("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${u}`))}),s}function WL(t){const e={};return Object.keys(t).forEach(i=>{var s;i.includes(":")?e[i]=t[i]:(s=t[i].chains)==null||s.forEach(r=>{e[r]={methods:t[i].methods,events:t[i].events}})}),e}function af(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function KL(t){const e={};return Object.keys(t).forEach(i=>{if(i.includes(":"))e[i]=t[i];else{const s=Xn(t[i].accounts);s==null||s.forEach(r=>{e[r]={accounts:t[i].accounts.filter(n=>n.includes(`${r}:`)),methods:t[i].methods,events:t[i].events}})}}),e}function FL(t,e){return Vu(t)&&t<=e.max&&t>=e.min}function cf(){const t=va();return new Promise(e=>{switch(t){case fi.browser:e(GL());break;case fi.reactNative:e(YL());break;case fi.node:e(QL());break;default:e(!0)}})}function GL(){return ya()&&(navigator==null?void 0:navigator.onLine)}async function YL(){if(Gs()&&typeof N.global<"u"&&N.global!=null&&N.global.NetInfo){const t=await(N.global==null?void 0:N.global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function QL(){return!0}function ZL(t){switch(va()){case fi.browser:JL(t);break;case fi.reactNative:XL(t);break}}function JL(t){!Gs()&&ya()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function XL(t){var e;Gs()&&typeof N.global<"u"&&N.global!=null&&N.global.NetInfo&&((e=N.global)==null||e.NetInfo.addEventListener(i=>t(i==null?void 0:i.isConnected)))}const Fl={};class vo{static get(e){return Fl[e]}static set(e,i){Fl[e]=i}static delete(e){delete Fl[e]}}const mv="wc",wv=2,Qh="core",is=`${mv}@2:${Qh}:`,e5={logger:"error"},t5={database:":memory:"},i5="crypto",lf="client_ed25519_seed",s5=E.ONE_DAY,r5="keychain",n5="0.3",o5="messages",a5="0.3",hf=E.SIX_HOURS,c5="publisher",yv="irn",l5="error",vv="wss://relay.walletconnect.org",h5="relayer",It={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},u5="_subscription",Ei={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},d5=.1,Zh="2.19.1",We={link_mode:"link_mode",relay:"relay"},pc={inbound:"inbound",outbound:"outbound"},p5="0.3",g5="WALLETCONNECT_CLIENT_ID",uf="WALLETCONNECT_LINK_MODE_APPS",hi={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},f5="subscription",m5="0.3",w5="pairing",y5="0.3",bo={wc_pairingDelete:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:E.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:E.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:E.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:E.ONE_DAY,prompt:!1,tag:0},res:{ttl:E.ONE_DAY,prompt:!1,tag:0}}},or={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ji={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},v5="history",b5="0.3",I5="expirer",Ci={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},E5="0.3",N5="verify-api",A5="https://verify.walletconnect.com",bv="https://verify.walletconnect.org",Uo=bv,_5=`${Uo}/v3`,C5=[A5,bv],S5="echo",P5="https://echo.walletconnect.com",Zi={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},us={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ri={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Js={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Xs={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Io={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},T5=.1,M5="event-client",O5=86400,x5="https://pulse.walletconnect.org/batch";function k5(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var r=0;r<t.length;r++){var n=t.charAt(r),o=n.charCodeAt(0);if(i[o]!==255)throw new TypeError(n+" is ambiguous");i[o]=r}var a=t.length,l=t.charAt(0),c=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function u(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var f=0,w=0,m=0,y=g.length;m!==y&&g[m]===0;)m++,f++;for(var v=(y-m)*h+1>>>0,I=new Uint8Array(v);m!==y;){for(var S=g[m],T=0,P=v-1;(S!==0||T<w)&&P!==-1;P--,T++)S+=256*I[P]>>>0,I[P]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");w=T,m++}for(var _=v-w;_!==v&&I[_]===0;)_++;for(var A=l.repeat(f);_<v;++_)A+=t.charAt(I[_]);return A}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var f=0;if(g[f]!==" "){for(var w=0,m=0;g[f]===l;)w++,f++;for(var y=(g.length-f)*c+1>>>0,v=new Uint8Array(y);g[f];){var I=i[g.charCodeAt(f)];if(I===255)return;for(var S=0,T=y-1;(I!==0||S<m)&&T!==-1;T--,S++)I+=a*v[T]>>>0,v[T]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");m=S,f++}if(g[f]!==" "){for(var P=y-m;P!==y&&v[P]===0;)P++;for(var _=new Uint8Array(w+(y-P)),A=w;P!==y;)_[A++]=v[P++];return _}}}function p(g){var f=d(g);if(f)return f;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:d,decode:p}}var D5=k5,j5=D5;const Iv=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},R5=t=>new TextEncoder().encode(t),U5=t=>new TextDecoder().decode(t);class L5{constructor(e,i,s){this.name=e,this.prefix=i,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class z5{constructor(e,i,s){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ev(this,e)}}class $5{constructor(e){this.decoders=e}or(e){return Ev(this,e)}decode(e){const i=e[0],s=this.decoders[i];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ev=(t,e)=>new $5({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class q5{constructor(e,i,s,r){this.name=e,this.prefix=i,this.baseEncode=s,this.baseDecode=r,this.encoder=new L5(e,i,s),this.decoder=new z5(e,i,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ol=({name:t,prefix:e,encode:i,decode:s})=>new q5(t,e,i,s),Na=({prefix:t,name:e,alphabet:i})=>{const{encode:s,decode:r}=j5(i,e);return ol({prefix:t,name:e,encode:s,decode:n=>Iv(r(n))})},B5=(t,e,i,s)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*i/8|0);let a=0,l=0,c=0;for(let h=0;h<n;++h){const u=r[t[h]];if(u===void 0)throw new SyntaxError(`Non-${s} character`);l=l<<i|u,a+=i,a>=8&&(a-=8,o[c++]=255&l>>a)}if(a>=i||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return o},H5=(t,e,i)=>{const s=e[e.length-1]==="=",r=(1<<i)-1;let n="",o=0,a=0;for(let l=0;l<t.length;++l)for(a=a<<8|t[l],o+=8;o>i;)o-=i,n+=e[r&a>>o];if(o&&(n+=e[r&a<<i-o]),s)for(;n.length*i&7;)n+="=";return n},jt=({name:t,prefix:e,bitsPerChar:i,alphabet:s})=>ol({prefix:e,name:t,encode(r){return H5(r,s,i)},decode(r){return B5(r,s,i,t)}}),V5=ol({prefix:"\0",name:"identity",encode:t=>U5(t),decode:t=>R5(t)});var W5=Object.freeze({__proto__:null,identity:V5});const K5=jt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var F5=Object.freeze({__proto__:null,base2:K5});const G5=jt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Y5=Object.freeze({__proto__:null,base8:G5});const Q5=Na({prefix:"9",name:"base10",alphabet:"0123456789"});var Z5=Object.freeze({__proto__:null,base10:Q5});const J5=jt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),X5=jt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var e3=Object.freeze({__proto__:null,base16:J5,base16upper:X5});const t3=jt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),i3=jt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),s3=jt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),r3=jt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),n3=jt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),o3=jt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),a3=jt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),c3=jt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),l3=jt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var h3=Object.freeze({__proto__:null,base32:t3,base32upper:i3,base32pad:s3,base32padupper:r3,base32hex:n3,base32hexupper:o3,base32hexpad:a3,base32hexpadupper:c3,base32z:l3});const u3=Na({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),d3=Na({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var p3=Object.freeze({__proto__:null,base36:u3,base36upper:d3});const g3=Na({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),f3=Na({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var m3=Object.freeze({__proto__:null,base58btc:g3,base58flickr:f3});const w3=jt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),y3=jt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),v3=jt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b3=jt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var I3=Object.freeze({__proto__:null,base64:w3,base64pad:y3,base64url:v3,base64urlpad:b3});const Nv=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),E3=Nv.reduce((t,e,i)=>(t[i]=e,t),[]),N3=Nv.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function A3(t){return t.reduce((e,i)=>(e+=E3[i],e),"")}function _3(t){const e=[];for(const i of t){const s=N3[i.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(s)}return new Uint8Array(e)}const C3=ol({prefix:"🚀",name:"base256emoji",encode:A3,decode:_3});var S3=Object.freeze({__proto__:null,base256emoji:C3}),P3=Av,df=128,T3=-128,M3=Math.pow(2,31);function Av(t,e,i){e=e||[],i=i||0;for(var s=i;t>=M3;)e[i++]=t&255|df,t/=128;for(;t&T3;)e[i++]=t&255|df,t>>>=7;return e[i]=t|0,Av.bytes=i-s+1,e}var O3=Jh,x3=128,pf=127;function Jh(t,s){var i=0,s=s||0,r=0,n=s,o,a=t.length;do{if(n>=a)throw Jh.bytes=0,new RangeError("Could not decode varint");o=t[n++],i+=r<28?(o&pf)<<r:(o&pf)*Math.pow(2,r),r+=7}while(o>=x3);return Jh.bytes=n-s,i}var k3=Math.pow(2,7),D3=Math.pow(2,14),j3=Math.pow(2,21),R3=Math.pow(2,28),U3=Math.pow(2,35),L3=Math.pow(2,42),z3=Math.pow(2,49),$3=Math.pow(2,56),q3=Math.pow(2,63),B3=function(t){return t<k3?1:t<D3?2:t<j3?3:t<R3?4:t<U3?5:t<L3?6:t<z3?7:t<$3?8:t<q3?9:10},H3={encode:P3,decode:O3,encodingLength:B3},_v=H3;const gf=(t,e,i=0)=>(_v.encode(t,e,i),e),ff=t=>_v.encodingLength(t),Xh=(t,e)=>{const i=e.byteLength,s=ff(t),r=s+ff(i),n=new Uint8Array(r+i);return gf(t,n,0),gf(i,n,s),n.set(e,r),new V3(t,i,e,n)};class V3{constructor(e,i,s,r){this.code=e,this.size=i,this.digest=s,this.bytes=r}}const Cv=({name:t,code:e,encode:i})=>new W3(t,e,i);class W3{constructor(e,i,s){this.name=e,this.code=i,this.encode=s}digest(e){if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?Xh(this.code,i):i.then(s=>Xh(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Sv=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),K3=Cv({name:"sha2-256",code:18,encode:Sv("SHA-256")}),F3=Cv({name:"sha2-512",code:19,encode:Sv("SHA-512")});var G3=Object.freeze({__proto__:null,sha256:K3,sha512:F3});const Pv=0,Y3="identity",Tv=Iv,Q3=t=>Xh(Pv,Tv(t)),Z3={code:Pv,name:Y3,encode:Tv,digest:Q3};var J3=Object.freeze({__proto__:null,identity:Z3});new TextEncoder,new TextDecoder;const mf={...W5,...F5,...Y5,...Z5,...e3,...h3,...p3,...m3,...I3,...S3};({...G3,...J3});function X3(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function Mv(t,e,i,s){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:s}}}const wf=Mv("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Gl=Mv("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=X3(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),e4={utf8:wf,"utf-8":wf,hex:mf.base16,latin1:Gl,ascii:Gl,binary:Gl,...mf};function t4(t,e="utf8"){const i=e4[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):i.decoder.decode(`${i.prefix}${t}`)}var i4=Object.defineProperty,s4=(t,e,i)=>e in t?i4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Gi=(t,e,i)=>s4(t,typeof e!="symbol"?e+"":e,i);class r4{constructor(e,i){this.core=e,this.logger=i,Gi(this,"keychain",new Map),Gi(this,"name",r5),Gi(this,"version",n5),Gi(this,"initialized",!1),Gi(this,"storagePrefix",is),Gi(this,"init",async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}}),Gi(this,"has",s=>(this.isInitialized(),this.keychain.has(s))),Gi(this,"set",async(s,r)=>{this.isInitialized(),this.keychain.set(s,r),await this.persist()}),Gi(this,"get",s=>{this.isInitialized();const r=this.keychain.get(s);if(typeof r>"u"){const{message:n}=R("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(n)}return r}),Gi(this,"del",async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()}),this.core=e,this.logger=Ae(i,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,qh(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Bh(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}var n4=Object.defineProperty,o4=(t,e,i)=>e in t?n4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,St=(t,e,i)=>o4(t,typeof e!="symbol"?e+"":e,i);class a4{constructor(e,i,s){this.core=e,this.logger=i,St(this,"name",i5),St(this,"keychain"),St(this,"randomSessionIdentifier",Yh()),St(this,"initialized",!1),St(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),St(this,"hasKeys",r=>(this.isInitialized(),this.keychain.has(r))),St(this,"getClientId",async()=>{this.isInitialized();const r=await this.getClientSeed(),n=bc(r);return Sm(n.publicKey)}),St(this,"generateKeyPair",()=>{this.isInitialized();const r=rL();return this.setPrivateKey(r.publicKey,r.privateKey)}),St(this,"signJWT",async r=>{this.isInitialized();const n=await this.getClientSeed(),o=bc(n),a=this.randomSessionIdentifier;return await Pm(a,r,s5,o)}),St(this,"generateSharedKey",(r,n,o)=>{this.isInitialized();const a=this.getPrivateKey(r),l=nL(a,n);return this.setSymKey(l,o)}),St(this,"setSymKey",async(r,n)=>{this.isInitialized();const o=n||dc(r);return await this.keychain.set(o,r),o}),St(this,"deleteKeyPair",async r=>{this.isInitialized(),await this.keychain.del(r)}),St(this,"deleteSymKey",async r=>{this.isInitialized(),await this.keychain.del(r)}),St(this,"encode",async(r,n,o)=>{this.isInitialized();const a=pv(o),l=Ar(n);if(Xg(a))return cL(l,o==null?void 0:o.encoding);if(Jg(a)){const d=a.senderPublicKey,p=a.receiverPublicKey;r=await this.generateSharedKey(d,p)}const c=this.getSymKey(r),{type:h,senderPublicKey:u}=a;return oL({type:h,symKey:c,message:l,senderPublicKey:u,encoding:o==null?void 0:o.encoding})}),St(this,"decode",async(r,n,o)=>{this.isInitialized();const a=hL(n,o);if(Xg(a)){const l=lL(n,o==null?void 0:o.encoding);return ws(l)}if(Jg(a)){const l=a.receiverPublicKey,c=a.senderPublicKey;r=await this.generateSharedKey(l,c)}try{const l=this.getSymKey(r),c=aL({symKey:l,encoded:n,encoding:o==null?void 0:o.encoding});return ws(c)}catch(l){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${await this.getClientId()}'`),this.logger.error(l)}}),St(this,"getPayloadType",(r,n=zs)=>{const o=Xo({encoded:r,encoding:n});return br(o.type)}),St(this,"getPayloadSenderPublicKey",(r,n=zs)=>{const o=Xo({encoded:r,encoding:n});return o.senderPublicKey?Ne(o.senderPublicKey,Ht):void 0}),this.core=e,this.logger=Ae(i,this.name),this.keychain=s||new r4(this.core,this.logger)}get context(){return qe(this.logger)}async setPrivateKey(e,i){return await this.keychain.set(e,i),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(lf)}catch{e=Yh(),await this.keychain.set(lf,e)}return t4(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}var c4=Object.defineProperty,l4=Object.defineProperties,h4=Object.getOwnPropertyDescriptors,yf=Object.getOwnPropertySymbols,u4=Object.prototype.hasOwnProperty,d4=Object.prototype.propertyIsEnumerable,eu=(t,e,i)=>e in t?c4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,p4=(t,e)=>{for(var i in e||(e={}))u4.call(e,i)&&eu(t,i,e[i]);if(yf)for(var i of yf(e))d4.call(e,i)&&eu(t,i,e[i]);return t},g4=(t,e)=>l4(t,h4(e)),ci=(t,e,i)=>eu(t,typeof e!="symbol"?e+"":e,i);class f4 extends A2{constructor(e,i){super(e,i),this.logger=e,this.core=i,ci(this,"messages",new Map),ci(this,"messagesWithoutClientAck",new Map),ci(this,"name",o5),ci(this,"version",a5),ci(this,"initialized",!1),ci(this,"storagePrefix",is),ci(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s);const r=await this.getRelayerMessagesWithoutClientAck();typeof r<"u"&&(this.messagesWithoutClientAck=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}}),ci(this,"set",async(s,r,n)=>{this.isInitialized();const o=Ji(r);let a=this.messages.get(s);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=r,this.messages.set(s,a),n===pc.inbound){const l=this.messagesWithoutClientAck.get(s)||{};this.messagesWithoutClientAck.set(s,g4(p4({},l),{[o]:r}))}return await this.persist(),o}),ci(this,"get",s=>{this.isInitialized();let r=this.messages.get(s);return typeof r>"u"&&(r={}),r}),ci(this,"getWithoutAck",s=>{this.isInitialized();const r={};for(const n of s){const o=this.messagesWithoutClientAck.get(n)||{};r[n]=Object.values(o)}return r}),ci(this,"has",(s,r)=>{this.isInitialized();const n=this.get(s),o=Ji(r);return typeof n[o]<"u"}),ci(this,"ack",async(s,r)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(s);if(typeof n>"u")return;const o=Ji(r);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(s):this.messagesWithoutClientAck.set(s,n),await this.persist()}),ci(this,"del",async s=>{this.isInitialized(),this.messages.delete(s),this.messagesWithoutClientAck.delete(s),await this.persist()}),this.logger=Ae(e,this.name),this.core=i}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,qh(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,qh(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Bh(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Bh(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}var m4=Object.defineProperty,w4=Object.defineProperties,y4=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,v4=Object.prototype.hasOwnProperty,b4=Object.prototype.propertyIsEnumerable,tu=(t,e,i)=>e in t?m4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ya=(t,e)=>{for(var i in e||(e={}))v4.call(e,i)&&tu(t,i,e[i]);if(vf)for(var i of vf(e))b4.call(e,i)&&tu(t,i,e[i]);return t},Yl=(t,e)=>w4(t,y4(e)),Ui=(t,e,i)=>tu(t,typeof e!="symbol"?e+"":e,i);class I4 extends _2{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,Ui(this,"events",new xt.EventEmitter),Ui(this,"name",c5),Ui(this,"queue",new Map),Ui(this,"publishTimeout",E.toMiliseconds(E.ONE_MINUTE)),Ui(this,"initialPublishTimeout",E.toMiliseconds(E.ONE_SECOND*15)),Ui(this,"needsTransportRestart",!1),Ui(this,"publish",async(s,r,n)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:r,opts:n}});const a=(n==null?void 0:n.ttl)||hf,l=xc(n),c=(n==null?void 0:n.prompt)||!1,h=(n==null?void 0:n.tag)||0,u=(n==null?void 0:n.id)||pi().toString(),d={topic:s,message:r,opts:{ttl:a,relay:l,prompt:c,tag:h,id:u,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}},p=`Failed to publish payload, please try again. id:${u} tag:${h}`;try{const g=new Promise(async f=>{const w=({id:y})=>{d.opts.id===y&&(this.removeRequestFromQueue(y),this.relayer.events.removeListener(It.publish,w),f(d))};this.relayer.events.on(It.publish,w);const m=Ls(new Promise((y,v)=>{this.rpcPublish({topic:s,message:r,ttl:a,prompt:c,tag:h,id:u,attestation:n==null?void 0:n.attestation,tvf:n==null?void 0:n.tvf}).then(y).catch(I=>{this.logger.warn(I,I==null?void 0:I.message),v(I)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${h}`);try{await m,this.events.removeListener(It.publish,w)}catch(y){this.queue.set(u,Yl(Ya({},d),{attempt:1})),this.logger.warn(y,y==null?void 0:y.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:s,message:r,opts:n}}),await Ls(g,this.publishTimeout,p)}catch(g){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(g),(o=n==null?void 0:n.internal)!=null&&o.throwOnFailedPublish)throw g}finally{this.queue.delete(u)}}),Ui(this,"on",(s,r)=>{this.events.on(s,r)}),Ui(this,"once",(s,r)=>{this.events.once(s,r)}),Ui(this,"off",(s,r)=>{this.events.off(s,r)}),Ui(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),this.relayer=e,this.logger=Ae(i,this.name),this.registerEventListeners()}get context(){return qe(this.logger)}async rpcPublish(e){var i,s,r,n;const{topic:o,message:a,ttl:l=hf,prompt:c,tag:h,id:u,attestation:d,tvf:p}=e,g={method:To(xc().protocol).publish,params:Ya({topic:o,message:a,ttl:l,prompt:c,tag:h,attestation:d},p),id:u};qt((i=g.params)==null?void 0:i.prompt)&&((s=g.params)==null||delete s.prompt),qt((r=g.params)==null?void 0:r.tag)&&((n=g.params)==null||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g});const f=await this.relayer.request(g);return this.relayer.events.emit(It.publish,e),this.logger.debug("Successfully Published Payload"),f}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,i)=>{const s=e.attempt+1;this.queue.set(i,Yl(Ya({},e),{attempt:s}));const{topic:r,message:n,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${s}`),await this.rpcPublish(Yl(Ya({},e),{topic:r,message:n,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(qi.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(It.connection_stalled);return}this.checkQueue()}),this.relayer.on(It.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var E4=Object.defineProperty,N4=(t,e,i)=>e in t?E4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,tn=(t,e,i)=>N4(t,typeof e!="symbol"?e+"":e,i);class A4{constructor(){tn(this,"map",new Map),tn(this,"set",(e,i)=>{const s=this.get(e);this.exists(e,i)||this.map.set(e,[...s,i])}),tn(this,"get",e=>this.map.get(e)||[]),tn(this,"exists",(e,i)=>this.get(e).includes(i)),tn(this,"delete",(e,i)=>{if(typeof i>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,i))return;const r=s.filter(n=>n!==i);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),tn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var _4=Object.defineProperty,C4=Object.defineProperties,S4=Object.getOwnPropertyDescriptors,bf=Object.getOwnPropertySymbols,P4=Object.prototype.hasOwnProperty,T4=Object.prototype.propertyIsEnumerable,iu=(t,e,i)=>e in t?_4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Eo=(t,e)=>{for(var i in e||(e={}))P4.call(e,i)&&iu(t,i,e[i]);if(bf)for(var i of bf(e))T4.call(e,i)&&iu(t,i,e[i]);return t},Ql=(t,e)=>C4(t,S4(e)),xe=(t,e,i)=>iu(t,typeof e!="symbol"?e+"":e,i);class M4 extends P2{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,xe(this,"subscriptions",new Map),xe(this,"topicMap",new A4),xe(this,"events",new xt.EventEmitter),xe(this,"name",f5),xe(this,"version",m5),xe(this,"pending",new Map),xe(this,"cached",[]),xe(this,"initialized",!1),xe(this,"storagePrefix",is),xe(this,"subscribeTimeout",E.toMiliseconds(E.ONE_MINUTE)),xe(this,"initialSubscribeTimeout",E.toMiliseconds(E.ONE_SECOND*15)),xe(this,"clientId"),xe(this,"batchSubscribeTopicsLimit",500),xe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),xe(this,"subscribe",async(s,r)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}});try{const n=xc(r),o={topic:s,relay:n,transportType:r==null?void 0:r.transportType};this.pending.set(s,o);const a=await this.rpcSubscribe(s,n,r);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:r}})),a}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}}),xe(this,"unsubscribe",async(s,r)=>{this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(s,r.id,r):await this.unsubscribeByTopic(s,r)}),xe(this,"isSubscribed",s=>new Promise(r=>{r(this.topicMap.topics.includes(s))})),xe(this,"isKnownTopic",s=>new Promise(r=>{r(this.topicMap.topics.includes(s)||this.pending.has(s)||this.cached.some(n=>n.topic===s))})),xe(this,"on",(s,r)=>{this.events.on(s,r)}),xe(this,"once",(s,r)=>{this.events.once(s,r)}),xe(this,"off",(s,r)=>{this.events.off(s,r)}),xe(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),xe(this,"start",async()=>{await this.onConnect()}),xe(this,"stop",async()=>{await this.onDisconnect()}),xe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),xe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const s=[];this.pending.forEach(r=>{s.push(r)}),await this.batchSubscribe(s)}),xe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(qi.pulse,async()=>{await this.checkPending()}),this.events.on(hi.created,async s=>{const r=hi.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()}),this.events.on(hi.deleted,async s=>{const r=hi.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:s}),await this.persist()})}),this.relayer=e,this.logger=Ae(i,this.name),this.clientId=""}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,i){let s=!1;try{s=this.getSubscription(e).topic===i}catch{}return s}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,i){const s=this.topicMap.get(e);await Promise.all(s.map(async r=>await this.unsubscribeById(e,r,i)))}async unsubscribeById(e,i,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:s}});try{const r=xc(s);await this.restartToComplete({topic:e,id:i,relay:r}),await this.rpcUnsubscribe(e,i,r);const n=Oe("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,i,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:s}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,i,s){var r;(!s||(s==null?void 0:s.transportType)===We.relay)&&await this.restartToComplete({topic:e,id:e,relay:i});const n={method:To(i.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const o=(r=s==null?void 0:s.internal)==null?void 0:r.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((s==null?void 0:s.transportType)===We.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(h=>this.logger.warn(h))},E.toMiliseconds(E.ONE_SECOND)),a;const l=new Promise(async h=>{const u=d=>{d.topic===e&&(this.events.removeListener(hi.created,u),h(d.id))};this.events.on(hi.created,u);try{const d=await Ls(new Promise((p,g)=>{this.relayer.request(n).catch(f=>{this.logger.warn(f,f==null?void 0:f.message),g(f)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(hi.created,u),h(d)}catch{}}),c=await Ls(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!c&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return c?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(It.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const i=e[0].relay,s={method:To(i.protocol).batchSubscribe,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Ls(new Promise(r=>{this.relayer.request(s).catch(n=>this.logger.warn(n)).then(r)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(It.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const i=e[0].relay,s={method:To(i.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});let r;try{r=await await Ls(new Promise((n,o)=>{this.relayer.request(s).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(It.connection_stalled)}return r}rpcUnsubscribe(e,i,s){const r={method:To(s.protocol).unsubscribe,params:{topic:e,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,i){this.setSubscription(e,Ql(Eo({},i),{id:e})),this.pending.delete(i.topic)}onBatchSubscribe(e){e.length&&e.forEach(i=>{this.setSubscription(i.id,Eo({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(e,i,s){this.events.removeAllListeners(i),this.hasSubscription(i,e)&&this.deleteSubscription(i,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,i){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:i}),this.addSubscription(e,i)}addSubscription(e,i){this.subscriptions.set(e,Eo({},i)),this.topicMap.set(i.topic,e),this.events.emit(hi.created,i)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const i=this.subscriptions.get(e);if(!i){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return i}deleteSubscription(e,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:i});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(hi.deleted,Ql(Eo({},s),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(hi.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let s=0;s<i;s++){const r=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}}this.events.emit(hi.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async i=>Ql(Eo({},i),{id:await this.getSubscriptionId(i.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const i=await this.rpcBatchFetchMessages(e);i&&i.messages&&(await wR(E.toMiliseconds(E.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(i.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Ji(e+await this.getClientId())}}var O4=Object.defineProperty,If=Object.getOwnPropertySymbols,x4=Object.prototype.hasOwnProperty,k4=Object.prototype.propertyIsEnumerable,su=(t,e,i)=>e in t?O4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ef=(t,e)=>{for(var i in e||(e={}))x4.call(e,i)&&su(t,i,e[i]);if(If)for(var i of If(e))k4.call(e,i)&&su(t,i,e[i]);return t},fe=(t,e,i)=>su(t,typeof e!="symbol"?e+"":e,i);class D4 extends C2{constructor(e){super(e),fe(this,"protocol","wc"),fe(this,"version",2),fe(this,"core"),fe(this,"logger"),fe(this,"events",new xt.EventEmitter),fe(this,"provider"),fe(this,"messages"),fe(this,"subscriber"),fe(this,"publisher"),fe(this,"name",h5),fe(this,"transportExplicitlyClosed",!1),fe(this,"initialized",!1),fe(this,"connectionAttemptInProgress",!1),fe(this,"relayUrl"),fe(this,"projectId"),fe(this,"packageName"),fe(this,"bundleId"),fe(this,"hasExperiencedNetworkDisruption",!1),fe(this,"pingTimeout"),fe(this,"heartBeatTimeout",E.toMiliseconds(E.THIRTY_SECONDS+E.FIVE_SECONDS)),fe(this,"reconnectTimeout"),fe(this,"connectPromise"),fe(this,"reconnectInProgress",!1),fe(this,"requestsInFlight",[]),fe(this,"connectTimeout",E.toMiliseconds(E.ONE_SECOND*15)),fe(this,"request",async i=>{var s,r;this.logger.debug("Publishing Request Payload");const n=i.id||pi().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:i.method,topic:(s=i.params)==null?void 0:s.topic},"relayer.request - publishing...");const o=`${n}:${((r=i.params)==null?void 0:r.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),fe(this,"resetPingTimeout",()=>{Mc()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,s,r,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(r=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null?void 0:r.terminate)==null||n.call(r)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),fe(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),fe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(It.connect)}),fe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),fe(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(It.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),fe(this,"registerProviderListeners",()=>{this.provider.on(Ei.payload,this.onPayloadHandler),this.provider.on(Ei.connect,this.onConnectHandler),this.provider.on(Ei.disconnect,this.onDisconnectHandler),this.provider.on(Ei.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ae(e.logger,this.name):Vn(ys({level:e.logger||l5})),this.messages=new f4(this.logger,e.core),this.subscriber=new M4(this,this.logger),this.publisher=new I4(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||vv,this.projectId=e.projectId,iR()?this.packageName=_g():sR()&&(this.bundleId=_g()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,e==null?void 0:e.message)}}get context(){return qe(this.logger)}get connected(){var e,i,s;return((s=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null?void 0:s.readyState)===1||!1}get connecting(){var e,i,s;return((s=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null?void 0:s.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,i,s){this.isInitialized(),await this.publisher.publish(e,i,s),await this.recordMessageEvent({topic:e,message:i,publishedAt:Date.now(),transportType:We.relay},pc.outbound)}async subscribe(e,i){var s,r,n;this.isInitialized(),(!(i!=null&&i.transportType)||(i==null?void 0:i.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish)>"u"?!0:(r=i==null?void 0:i.internal)==null?void 0:r.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",l;const c=h=>{h.topic===e&&(this.subscriber.off(hi.created,c),l())};return await Promise.all([new Promise(h=>{l=h,this.subscriber.on(hi.created,c)}),new Promise(async(h,u)=>{a=await this.subscriber.subscribe(e,Ef({internal:{throwOnFailedPublish:o}},i)).catch(d=>{o&&u(d)})||a,h()})]),a}async unsubscribe(e,i){this.isInitialized(),await this.subscriber.unsubscribe(e,i)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Ls(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(i,s)=>{await this.connect(e).then(i).catch(s).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await cf())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const i=e.sort((s,r)=>s.publishedAt-r.publishedAt);this.logger.debug(`Batch of ${i.length} message events sorted`);for(const s of i)try{await this.onMessageEvent(s)}catch(r){this.logger.warn(r,"Error while processing batch message event: "+(r==null?void 0:r.message))}this.logger.trace(`Batch of ${i.length} message events processed`)}async onLinkMessageEvent(e,i){const{topic:s}=e;if(!i.sessionExists){const r=ut(E.FIVE_MINUTES),n={topic:s,expiry:r,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(s,n)}this.events.emit(It.message,e),await this.recordMessageEvent(e,pc.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let i=1;for(;i<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${i}...`),await this.createProvider(),await new Promise(async(s,r)=>{const n=()=>{r(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ei.disconnect,n),await Ls(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{r(o)}).finally(()=>{this.provider.off(Ei.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const l=()=>{a(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Ei.disconnect,l),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Ei.disconnect,l)})}),this.hasExperiencedNetworkDisruption=!1,s()})}catch(s){await this.subscriber.stop();const r=s;this.logger.warn({},r.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${i}`);break}await new Promise(s=>setTimeout(s,E.toMiliseconds(i*1))),i++}}startPingTimeout(){var e,i,s,r,n;if(Mc())try{(i=(e=this.provider)==null?void 0:e.connection)!=null&&i.socket&&((n=(r=(s=this.provider)==null?void 0:s.connection)==null?void 0:r.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ye(new Mw(aR({sdkVersion:Zh,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,i){const{topic:s,message:r}=e;await this.messages.set(s,r,i)}async shouldIgnoreMessageEvent(e){const{topic:i,message:s}=e;if(!s||s.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isKnownTopic(i))return this.logger.warn(`Ignoring message for unknown topic ${i}`),!0;const r=this.messages.has(i,s);return r&&this.logger.warn(`Ignoring duplicate message: ${s}`),r}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Wn(e)){if(!e.method.endsWith(u5))return;const i=e.params,{topic:s,message:r,publishedAt:n,attestation:o}=i.data,a={topic:s,message:r,publishedAt:n,transportType:We.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ef({type:"event",event:i.id},a)),this.events.emit(i.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Nr(e)&&this.events.emit(It.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,pc.inbound),this.events.emit(It.message,e))}async acknowledgePayload(e){const i=Ws(e.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(Ei.payload,this.onPayloadHandler),this.provider.off(Ei.connect,this.onConnectHandler),this.provider.off(Ei.disconnect,this.onDisconnectHandler),this.provider.off(Ei.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await cf();ZL(async i=>{e!==i&&(e=i,i?await this.transportOpen().catch(s=>this.logger.error(s,s==null?void 0:s.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(It.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},E.toMiliseconds(d5)))))}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}}function j4(){}function Nf(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function Af(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function _f(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const R4="[object RegExp]",U4="[object String]",L4="[object Number]",z4="[object Boolean]",Cf="[object Arguments]",$4="[object Symbol]",q4="[object Date]",B4="[object Map]",H4="[object Set]",V4="[object Array]",W4="[object Function]",K4="[object ArrayBuffer]",Zl="[object Object]",F4="[object Error]",G4="[object DataView]",Y4="[object Uint8Array]",Q4="[object Uint8ClampedArray]",Z4="[object Uint16Array]",J4="[object Uint32Array]",X4="[object BigUint64Array]",ez="[object Int8Array]",tz="[object Int16Array]",iz="[object Int32Array]",sz="[object BigInt64Array]",rz="[object Float32Array]",nz="[object Float64Array]";function oz(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function az(t,e,i){return Oo(t,e,void 0,void 0,void 0,void 0,i)}function Oo(t,e,i,s,r,n,o){const a=o(t,e,i,s,r,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Lo(t,e,n,o)}return Lo(t,e,n,o)}function Lo(t,e,i,s){if(Object.is(t,e))return!0;let r=_f(t),n=_f(e);if(r===Cf&&(r=Zl),n===Cf&&(n=Zl),r!==n)return!1;switch(r){case U4:return t.toString()===e.toString();case L4:{const l=t.valueOf(),c=e.valueOf();return oz(l,c)}case z4:case q4:case $4:return Object.is(t.valueOf(),e.valueOf());case R4:return t.source===e.source&&t.flags===e.flags;case W4:return t===e}i=i??new Map;const o=i.get(t),a=i.get(e);if(o!=null&&a!=null)return o===e;i.set(t,e),i.set(e,t);try{switch(r){case B4:{if(t.size!==e.size)return!1;for(const[l,c]of t.entries())if(!e.has(l)||!Oo(c,e.get(l),l,t,e,i,s))return!1;return!0}case H4:{if(t.size!==e.size)return!1;const l=Array.from(t.values()),c=Array.from(e.values());for(let h=0;h<l.length;h++){const u=l[h],d=c.findIndex(p=>Oo(u,p,void 0,t,e,i,s));if(d===-1)return!1;c.splice(d,1)}return!0}case V4:case Y4:case Q4:case Z4:case J4:case X4:case ez:case tz:case iz:case sz:case rz:case nz:{if(typeof N.Buffer<"u"&&N.Buffer.isBuffer(t)!==N.Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let l=0;l<t.length;l++)if(!Oo(t[l],e[l],l,t,e,i,s))return!1;return!0}case K4:return t.byteLength!==e.byteLength?!1:Lo(new Uint8Array(t),new Uint8Array(e),i,s);case G4:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Lo(new Uint8Array(t),new Uint8Array(e),i,s);case F4:return t.name===e.name&&t.message===e.message;case Zl:{if(!(Lo(t.constructor,e.constructor,i,s)||Nf(t)&&Nf(e)))return!1;const l=[...Object.keys(t),...Af(t)],c=[...Object.keys(e),...Af(e)];if(l.length!==c.length)return!1;for(let h=0;h<l.length;h++){const u=l[h],d=t[u];if(!Object.hasOwn(e,u))return!1;const p=e[u];if(!Oo(d,p,u,t,e,i,s))return!1}return!0}default:return!1}}finally{i.delete(t),i.delete(e)}}function cz(t,e){return az(t,e,j4)}var lz=Object.defineProperty,Sf=Object.getOwnPropertySymbols,hz=Object.prototype.hasOwnProperty,uz=Object.prototype.propertyIsEnumerable,ru=(t,e,i)=>e in t?lz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Pf=(t,e)=>{for(var i in e||(e={}))hz.call(e,i)&&ru(t,i,e[i]);if(Sf)for(var i of Sf(e))uz.call(e,i)&&ru(t,i,e[i]);return t},Zt=(t,e,i)=>ru(t,typeof e!="symbol"?e+"":e,i);class xr extends S2{constructor(e,i,s,r=is,n=void 0){super(e,i,s,r),this.core=e,this.logger=i,this.name=s,Zt(this,"map",new Map),Zt(this,"version",p5),Zt(this,"cached",[]),Zt(this,"initialized",!1),Zt(this,"getKey"),Zt(this,"storagePrefix",is),Zt(this,"recentlyDeleted",[]),Zt(this,"recentlyDeletedLimit",200),Zt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!qt(o)?this.map.set(this.getKey(o),o):PL(o)?this.map.set(o.id,o):TL(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Zt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Zt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Zt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(l=>cz(a[l],o[l]))):this.values)),Zt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const l=Pf(Pf({},this.getData(o)),a);this.map.set(o,l),await this.persist()}),Zt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ae(i,this.name),this.storagePrefix=r,this.getKey=n}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const i=this.map.get(e);if(!i){if(this.recentlyDeleted.includes(e)){const{message:r}=R("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}var dz=Object.defineProperty,pz=(t,e,i)=>e in t?dz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,le=(t,e,i)=>pz(t,typeof e!="symbol"?e+"":e,i);class gz{constructor(e,i){this.core=e,this.logger=i,le(this,"name",w5),le(this,"version",y5),le(this,"events",new Hn),le(this,"pairings"),le(this,"initialized",!1),le(this,"storagePrefix",is),le(this,"ignoredPayloadTypes",[ms]),le(this,"registeredMethods",[]),le(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),le(this,"register",({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]}),le(this,"create",async s=>{this.isInitialized();const r=Yh(),n=await this.core.crypto.setSymKey(r),o=ut(E.FIVE_MINUTES),a={protocol:yv},l={topic:n,expiry:o,relay:a,active:!1,methods:s==null?void 0:s.methods},c=tf({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:r,relay:a,expiryTimestamp:o,methods:s==null?void 0:s.methods});return this.events.emit(or.create,l),this.core.expirer.set(n,o),await this.pairings.set(n,l),await this.core.relayer.subscribe(n,{transportType:s==null?void 0:s.transportType}),{topic:n,uri:c}}),le(this,"pair",async s=>{this.isInitialized();const r=this.core.eventClient.createEvent({properties:{topic:s==null?void 0:s.uri,trace:[Zi.pairing_started]}});this.isValidPair(s,r);const{topic:n,symKey:o,relay:a,expiryTimestamp:l,methods:c}=ef(s.uri);r.props.properties.topic=n,r.addTrace(Zi.pairing_uri_validation_success),r.addTrace(Zi.pairing_uri_not_expired);let h;if(this.pairings.keys.includes(n)){if(h=this.pairings.get(n),r.addTrace(Zi.existing_pairing),h.active)throw r.setError(us.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);r.addTrace(Zi.pairing_not_expired)}const u=l||ut(E.FIVE_MINUTES),d={topic:n,relay:a,expiry:u,active:!1,methods:c};this.core.expirer.set(n,u),await this.pairings.set(n,d),r.addTrace(Zi.store_new_pairing),s.activatePairing&&await this.activate({topic:n}),this.events.emit(or.create,d),r.addTrace(Zi.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),r.addTrace(Zi.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError(us.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(p){throw r.setError(us.subscribe_pairing_topic_failure),p}return r.addTrace(Zi.subscribe_pairing_topic_success),d}),le(this,"activate",async({topic:s})=>{this.isInitialized();const r=ut(E.FIVE_MINUTES);this.core.expirer.set(s,r),await this.pairings.update(s,{active:!0,expiry:r})}),le(this,"ping",async s=>{this.isInitialized(),await this.isValidPing(s),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:r}=s;if(this.pairings.keys.includes(r)){const n=await this.sendRequest(r,"wc_pairingPing",{}),{done:o,resolve:a,reject:l}=sr();this.events.once(Ee("pairing_ping",n),({error:c})=>{c?l(c):a()}),await o()}}),le(this,"updateExpiry",async({topic:s,expiry:r})=>{this.isInitialized(),await this.pairings.update(s,{expiry:r})}),le(this,"updateMetadata",async({topic:s,metadata:r})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:r})}),le(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),le(this,"disconnect",async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:r}=s;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",Oe("USER_DISCONNECTED")),await this.deletePairing(r))}),le(this,"formatUriFromPairing",s=>{this.isInitialized();const{topic:r,relay:n,expiry:o,methods:a}=s,l=this.core.crypto.keychain.get(r);return tf({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:l,relay:n,expiryTimestamp:o,methods:a})}),le(this,"sendRequest",async(s,r,n)=>{const o=Kt(r,n),a=await this.core.crypto.encode(s,o),l=bo[r].req;return this.core.history.set(s,o),this.core.relayer.publish(s,a,l),o.id}),le(this,"sendResult",async(s,r,n)=>{const o=Ws(s,n),a=await this.core.crypto.encode(r,o),l=(await this.core.history.get(r,s)).request.method,c=bo[l].res;await this.core.relayer.publish(r,a,c),await this.core.history.resolve(o)}),le(this,"sendError",async(s,r,n)=>{const o=na(s,n),a=await this.core.crypto.encode(r,o),l=(await this.core.history.get(r,s)).request.method,c=bo[l]?bo[l].res:bo.unregistered_method.res;await this.core.relayer.publish(r,a,c),await this.core.history.resolve(o)}),le(this,"deletePairing",async(s,r)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Oe("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),r?Promise.resolve():this.core.expirer.del(s)])}),le(this,"cleanup",async()=>{const s=this.pairings.getAll().filter(r=>Ms(r.expiry));await Promise.all(s.map(r=>this.deletePairing(r.topic)))}),le(this,"onRelayEventRequest",async s=>{const{topic:r,payload:n}=s;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(r,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(r,n);default:return await this.onUnknownRpcMethodRequest(r,n)}}),le(this,"onRelayEventResponse",async s=>{const{topic:r,payload:n}=s,o=(await this.core.history.get(r,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(r,n);default:return this.onUnknownRpcMethodResponse(o)}}),le(this,"onPairingPingRequest",async(s,r)=>{const{id:n}=r;try{this.isValidPing({topic:s}),await this.sendResult(n,s,!0),this.events.emit(or.ping,{id:n,topic:s})}catch(o){await this.sendError(n,s,o),this.logger.error(o)}}),le(this,"onPairingPingResponse",(s,r)=>{const{id:n}=r;setTimeout(()=>{vt(r)?this.events.emit(Ee("pairing_ping",n),{}):it(r)&&this.events.emit(Ee("pairing_ping",n),{error:r.error})},500)}),le(this,"onPairingDeleteRequest",async(s,r)=>{const{id:n}=r;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(or.delete,{id:n,topic:s})}catch(o){await this.sendError(n,s,o),this.logger.error(o)}}),le(this,"onUnknownRpcMethodRequest",async(s,r)=>{const{id:n,method:o}=r;try{if(this.registeredMethods.includes(o))return;const a=Oe("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,s,a),this.logger.error(a)}catch(a){await this.sendError(n,s,a),this.logger.error(a)}}),le(this,"onUnknownRpcMethodResponse",s=>{this.registeredMethods.includes(s)||this.logger.error(Oe("WC_METHOD_UNSUPPORTED",s))}),le(this,"isValidPair",(s,r)=>{var n;if(!ii(s)){const{message:a}=R("MISSING_OR_INVALID",`pair() params: ${s}`);throw r.setError(us.malformed_pairing_uri),new Error(a)}if(!SL(s.uri)){const{message:a}=R("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw r.setError(us.malformed_pairing_uri),new Error(a)}const o=ef(s==null?void 0:s.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=R("MISSING_OR_INVALID","pair() uri#relay-protocol");throw r.setError(us.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=R("MISSING_OR_INVALID","pair() uri#symKey");throw r.setError(us.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&E.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){r.setError(us.pairing_expired);const{message:a}=R("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),le(this,"isValidPing",async s=>{if(!ii(s)){const{message:n}=R("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(n)}const{topic:r}=s;await this.isValidPairingTopic(r)}),le(this,"isValidDisconnect",async s=>{if(!ii(s)){const{message:n}=R("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(n)}const{topic:r}=s;await this.isValidPairingTopic(r)}),le(this,"isValidPairingTopic",async s=>{if(!at(s,!1)){const{message:r}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(r)}if(!this.pairings.keys.includes(s)){const{message:r}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(r)}if(Ms(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:r}=R("EXPIRED",`pairing topic: ${s}`);throw new Error(r)}}),this.core=e,this.logger=Ae(i,this.name),this.pairings=new xr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return qe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(It.message,async e=>{const{topic:i,message:s,transportType:r}=e;if(this.pairings.keys.includes(i)&&r!==We.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))try{const n=await this.core.crypto.decode(i,s);Wn(n)?(this.core.history.set(i,n),await this.onRelayEventRequest({topic:i,payload:n})):Nr(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:i,payload:n}),this.core.history.delete(i,n.id)),await this.core.relayer.messages.ack(i,s)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(Ci.expired,async e=>{const{topic:i}=Hy(e.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(or.expire,{topic:i}))})}}var fz=Object.defineProperty,mz=(t,e,i)=>e in t?fz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Pt=(t,e,i)=>mz(t,typeof e!="symbol"?e+"":e,i);class wz extends N2{constructor(e,i){super(e,i),this.core=e,this.logger=i,Pt(this,"records",new Map),Pt(this,"events",new xt.EventEmitter),Pt(this,"name",v5),Pt(this,"version",b5),Pt(this,"cached",[]),Pt(this,"initialized",!1),Pt(this,"storagePrefix",is),Pt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Pt(this,"set",(s,r,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:r,chainId:n}),this.records.has(r.id))return;const o={id:r.id,topic:s,request:{method:r.method,params:r.params||null},chainId:n,expiry:ut(E.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ji.created,o)}),Pt(this,"resolve",async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const r=await this.getRecord(s.id);typeof r.response>"u"&&(r.response=it(s)?{error:s.error}:{result:s.result},this.records.set(r.id,r),this.persist(),this.events.emit(ji.updated,r))}),Pt(this,"get",async(s,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:r}),await this.getRecord(r))),Pt(this,"delete",(s,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(n=>{if(n.topic===s){if(typeof r<"u"&&n.id!==r)return;this.records.delete(n.id),this.events.emit(ji.deleted,n)}}),this.persist()}),Pt(this,"exists",async(s,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===s:!1)),Pt(this,"on",(s,r)=>{this.events.on(s,r)}),Pt(this,"once",(s,r)=>{this.events.once(s,r)}),Pt(this,"off",(s,r)=>{this.events.off(s,r)}),Pt(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),this.logger=Ae(i,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const s={topic:i.topic,request:Kt(i.request.method,i.request.params,i.id),chainId:i.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const i=this.records.get(e);if(!i){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ji.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ji.created,e=>{const i=ji.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.events.on(ji.updated,e=>{const i=ji.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.events.on(ji.deleted,e=>{const i=ji.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.core.heartbeat.on(qi.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(i=>{E.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.records.delete(i.id),this.events.emit(ji.deleted,i,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yz=Object.defineProperty,vz=(t,e,i)=>e in t?yz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Lt=(t,e,i)=>vz(t,typeof e!="symbol"?e+"":e,i);class bz extends T2{constructor(e,i){super(e,i),this.core=e,this.logger=i,Lt(this,"expirations",new Map),Lt(this,"events",new xt.EventEmitter),Lt(this,"name",I5),Lt(this,"version",E5),Lt(this,"cached",[]),Lt(this,"initialized",!1),Lt(this,"storagePrefix",is),Lt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Lt(this,"has",s=>{try{const r=this.formatTarget(s);return typeof this.getExpiration(r)<"u"}catch{return!1}}),Lt(this,"set",(s,r)=>{this.isInitialized();const n=this.formatTarget(s),o={target:n,expiry:r};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(Ci.created,{target:n,expiration:o})}),Lt(this,"get",s=>{this.isInitialized();const r=this.formatTarget(s);return this.getExpiration(r)}),Lt(this,"del",s=>{if(this.isInitialized(),this.has(s)){const r=this.formatTarget(s),n=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Ci.deleted,{target:r,expiration:n})}}),Lt(this,"on",(s,r)=>{this.events.on(s,r)}),Lt(this,"once",(s,r)=>{this.events.once(s,r)}),Lt(this,"off",(s,r)=>{this.events.off(s,r)}),Lt(this,"removeListener",(s,r)=>{this.events.removeListener(s,r)}),this.logger=Ae(i,this.name)}get context(){return qe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return cR(e);if(typeof e=="number")return lR(e);const{message:i}=R("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(i)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ci.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:i}=R("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const i=this.expirations.get(e);if(!i){const{message:s}=R("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(s),new Error(s)}return i}checkExpiry(e,i){const{expiry:s}=i;E.toMiliseconds(s)-Date.now()<=0&&this.expire(e,i)}expire(e,i){this.expirations.delete(e),this.events.emit(Ci.expired,{target:e,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,i)=>this.checkExpiry(i,e))}registerEventListeners(){this.core.heartbeat.on(qi.pulse,()=>this.checkExpirations()),this.events.on(Ci.created,e=>{const i=Ci.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(Ci.expired,e=>{const i=Ci.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(Ci.deleted,e=>{const i=Ci.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Iz=Object.defineProperty,Ez=(t,e,i)=>e in t?Iz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,nt=(t,e,i)=>Ez(t,typeof e!="symbol"?e+"":e,i);class Nz extends M2{constructor(e,i,s){super(e,i,s),this.core=e,this.logger=i,this.store=s,nt(this,"name",N5),nt(this,"abortController"),nt(this,"isDevEnv"),nt(this,"verifyUrlV3",_5),nt(this,"storagePrefix",is),nt(this,"version",wv),nt(this,"publicKey"),nt(this,"fetchPromise"),nt(this,"init",async()=>{var r;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&E.toMiliseconds((r=this.publicKey)==null?void 0:r.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),nt(this,"register",async r=>{if(!ya()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=r,l=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const c=Vs(),h=this.startAbortTimer(E.ONE_SECOND*5),u=await new Promise((d,p)=>{const g=()=>{window.removeEventListener("message",w),c.body.removeChild(f),p("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const f=c.createElement("iframe");f.src=l,f.style.display="none",f.addEventListener("error",g,{signal:this.abortController.signal});const w=m=>{if(m.data&&typeof m.data=="string")try{const y=JSON.parse(m.data);if(y.type==="verify_attestation"){if(kn(y.attestation).payload.id!==o)return;clearInterval(h),c.body.removeChild(f),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",w),d(y.attestation===null?"":y.attestation)}}catch(y){this.logger.warn(y)}};c.body.appendChild(f),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",u),u}catch(c){this.logger.warn(c)}return""}),nt(this,"resolve",async r=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=r;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(kn(n).payload.id!==a)return;const c=await this.isValidJwtAttestation(n);if(c){if(!c.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return c}}if(!o)return;const l=this.getVerifyUrl(r==null?void 0:r.verifyUrl);return this.fetchAttestation(o,l)}),nt(this,"fetchAttestation",async(r,n)=>{this.logger.debug(`resolving attestation: ${r} from url: ${n}`);const o=this.startAbortTimer(E.ONE_SECOND*5),a=await fetch(`${n}/attestation/${r}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),nt(this,"getVerifyUrl",r=>{let n=r||Uo;return C5.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Uo}`),n=Uo),n}),nt(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const r=this.startAbortTimer(E.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(r),await n.json()}catch(r){this.logger.warn(r)}}),nt(this,"persistPublicKey",async r=>{this.logger.debug("persisting public key to local storage",r),await this.store.setItem(this.storeKey,r),this.publicKey=r}),nt(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),nt(this,"isValidJwtAttestation",async r=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(r,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(r,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),nt(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),nt(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const r=await this.fetchPromise;return this.fetchPromise=void 0,r}),nt(this,"validateAttestation",(r,n)=>{const o=gL(r,n.publicKey),a={hasExpired:E.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ae(i,this.name),this.abortController=new AbortController,this.isDevEnv=Ru(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return qe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),E.toMiliseconds(e))}}var Az=Object.defineProperty,_z=(t,e,i)=>e in t?Az(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Tf=(t,e,i)=>_z(t,typeof e!="symbol"?e+"":e,i);class Cz extends O2{constructor(e,i){super(e,i),this.projectId=e,this.logger=i,Tf(this,"context",S5),Tf(this,"registerDeviceToken",async s=>{const{clientId:r,token:n,notificationType:o,enableEncrypted:a=!1}=s,l=`${P5}/${this.projectId}/clients`;await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:r,type:o,token:n,always_raw:a})})}),this.logger=Ae(i,this.context)}}var Sz=Object.defineProperty,Mf=Object.getOwnPropertySymbols,Pz=Object.prototype.hasOwnProperty,Tz=Object.prototype.propertyIsEnumerable,nu=(t,e,i)=>e in t?Sz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,No=(t,e)=>{for(var i in e||(e={}))Pz.call(e,i)&&nu(t,i,e[i]);if(Mf)for(var i of Mf(e))Tz.call(e,i)&&nu(t,i,e[i]);return t},ft=(t,e,i)=>nu(t,typeof e!="symbol"?e+"":e,i);class Mz extends x2{constructor(e,i,s=!0){super(e,i,s),this.core=e,this.logger=i,ft(this,"context",M5),ft(this,"storagePrefix",is),ft(this,"storageVersion",T5),ft(this,"events",new Map),ft(this,"shouldPersist",!1),ft(this,"init",async()=>{if(!Ru())try{const r={eventId:Sg(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:qy(this.core.relayer.protocol,this.core.relayer.version,Zh)}}};await this.sendEvent([r])}catch(r){this.logger.warn(r)}}),ft(this,"createEvent",r=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:l}}=r,c=Sg(),h=this.core.projectId||"",u=Date.now(),d=No({eventId:c,timestamp:u,props:{event:n,type:o,properties:{topic:a,trace:l}},bundleId:h,domain:this.getAppDomain()},this.setMethods(c));return this.telemetryEnabled&&(this.events.set(c,d),this.shouldPersist=!0),d}),ft(this,"getEvent",r=>{const{eventId:n,topic:o}=r;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(l=>l.props.properties.topic===o);if(a)return No(No({},a),this.setMethods(a.eventId))}),ft(this,"deleteEvent",r=>{const{eventId:n}=r;this.events.delete(n),this.shouldPersist=!0}),ft(this,"setEventListeners",()=>{this.core.heartbeat.on(qi.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(r=>{E.fromMiliseconds(Date.now())-E.fromMiliseconds(r.timestamp)>O5&&(this.events.delete(r.eventId),this.shouldPersist=!0)})})}),ft(this,"setMethods",r=>({addTrace:n=>this.addTrace(r,n),setError:n=>this.setError(r,n)})),ft(this,"addTrace",(r,n)=>{const o=this.events.get(r);o&&(o.props.properties.trace.push(n),this.events.set(r,o),this.shouldPersist=!0)}),ft(this,"setError",(r,n)=>{const o=this.events.get(r);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(r,o),this.shouldPersist=!0)}),ft(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ft(this,"restore",async()=>{try{const r=await this.core.storage.getItem(this.storageKey)||[];if(!r.length)return;r.forEach(n=>{this.events.set(n.eventId,No(No({},n),this.setMethods(n.eventId)))})}catch(r){this.logger.warn(r)}}),ft(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const r=[];for(const[n,o]of this.events)o.props.type&&r.push(o);if(r.length!==0)try{if((await this.sendEvent(r)).ok)for(const n of r)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),ft(this,"sendEvent",async r=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${x5}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Zh}${n}`,{method:"POST",body:JSON.stringify(r)})}),ft(this,"getAppDomain",()=>$y().url),this.logger=Ae(i,this.context),this.telemetryEnabled=s,s?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Oz=Object.defineProperty,Of=Object.getOwnPropertySymbols,xz=Object.prototype.hasOwnProperty,kz=Object.prototype.propertyIsEnumerable,ou=(t,e,i)=>e in t?Oz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,xf=(t,e)=>{for(var i in e||(e={}))xz.call(e,i)&&ou(t,i,e[i]);if(Of)for(var i of Of(e))kz.call(e,i)&&ou(t,i,e[i]);return t},Ue=(t,e,i)=>ou(t,typeof e!="symbol"?e+"":e,i);let Dz=class Ov extends v2{constructor(e){var i;super(e),Ue(this,"protocol",mv),Ue(this,"version",wv),Ue(this,"name",Qh),Ue(this,"relayUrl"),Ue(this,"projectId"),Ue(this,"customStoragePrefix"),Ue(this,"events",new xt.EventEmitter),Ue(this,"logger"),Ue(this,"heartbeat"),Ue(this,"relayer"),Ue(this,"crypto"),Ue(this,"storage"),Ue(this,"history"),Ue(this,"expirer"),Ue(this,"pairing"),Ue(this,"verify"),Ue(this,"echoClient"),Ue(this,"linkModeSupportedApps"),Ue(this,"eventClient"),Ue(this,"initialized",!1),Ue(this,"logChunkController"),Ue(this,"on",(o,a)=>this.events.on(o,a)),Ue(this,"once",(o,a)=>this.events.once(o,a)),Ue(this,"off",(o,a)=>this.events.off(o,a)),Ue(this,"removeListener",(o,a)=>this.events.removeListener(o,a)),Ue(this,"dispatchEnvelope",({topic:o,message:a,sessionExists:l})=>{if(!o||!a)return;const c={topic:o,message:a,publishedAt:Date.now(),transportType:We.link_mode};this.relayer.onLinkMessageEvent(c,{sessionExists:l})}),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||vv,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=ys({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:e5.logger,name:Qh}),{logger:r,chunkLoggerController:n}=yu({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=n,(i=this.logChunkController)!=null&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var o,a;(o=this.logChunkController)!=null&&o.downloadLogsBlobInBrowser&&((a=this.logChunkController)==null||a.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ae(r,this.name),this.heartbeat=new Dm,this.crypto=new a4(this,this.logger,e==null?void 0:e.keychain),this.history=new wz(this,this.logger),this.expirer=new bz(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new lj(xf(xf({},t5),e==null?void 0:e.storageOptions)),this.relayer=new D4({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new gz(this,this.logger),this.verify=new Nz(this,this.logger,this.storage),this.echoClient=new Cz(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Mz(this,this.logger,e==null?void 0:e.telemetryEnabled)}static async init(e){const i=new Ov(e);await i.initialize();const s=await i.crypto.getClientId();return await i.storage.setItem(g5,s),i}get context(){return qe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(uf,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(uf)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}};const jz=Dz,xv="wc",kv=2,Dv="client",Wu=`${xv}@${kv}:${Dv}:`,Jl={name:Dv,logger:"error"},kf="WALLETCONNECT_DEEPLINK_CHOICE",Rz="proposal",Df="Proposal expired",Uz="session",sn=E.SEVEN_DAYS,Lz="engine",mt={wc_sessionPropose:{req:{ttl:E.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1104},res:{ttl:E.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1106},res:{ttl:E.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:E.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:E.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1112},res:{ttl:E.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:E.ONE_DAY,prompt:!1,tag:1114},res:{ttl:E.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:E.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:E.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:E.FIVE_MINUTES,prompt:!1,tag:1119}}},Xl={min:E.FIVE_MINUTES,max:E.SEVEN_DAYS},Yi={idle:"IDLE",active:"ACTIVE"},jf={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},zz="request",$z=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],qz="wc",Bz="auth",Hz="authKeys",Vz="pairingTopics",Wz="requests",al=`${qz}@${1.5}:${Bz}:`,gc=`${al}:PUB_KEY`;var Kz=Object.defineProperty,Fz=Object.defineProperties,Gz=Object.getOwnPropertyDescriptors,Rf=Object.getOwnPropertySymbols,Yz=Object.prototype.hasOwnProperty,Qz=Object.prototype.propertyIsEnumerable,au=(t,e,i)=>e in t?Kz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ke=(t,e)=>{for(var i in e||(e={}))Yz.call(e,i)&&au(t,i,e[i]);if(Rf)for(var i of Rf(e))Qz.call(e,i)&&au(t,i,e[i]);return t},Vt=(t,e)=>Fz(t,Gz(e)),O=(t,e,i)=>au(t,typeof e!="symbol"?e+"":e,i);class Zz extends R2{constructor(e){super(e),O(this,"name",Lz),O(this,"events",new Hn),O(this,"initialized",!1),O(this,"requestQueue",{state:Yi.idle,queue:[]}),O(this,"sessionRequestQueue",{state:Yi.idle,queue:[]}),O(this,"requestQueueDelay",E.ONE_SECOND),O(this,"expectedPairingMethodMap",new Map),O(this,"recentlyDeletedMap",new Map),O(this,"recentlyDeletedLimit",200),O(this,"relayMessageCache",[]),O(this,"pendingSessions",new Map),O(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(mt)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},E.toMiliseconds(this.requestQueueDelay)))}),O(this,"connect",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const s=Vt(ke({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:l,relays:c}=s;let h=r,u,d=!1;try{if(h){const T=this.client.core.pairing.pairings.get(h);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${h}) failed`),T}if(!h||!d){const{topic:T,uri:P}=await this.client.core.pairing.create();h=T,u=P}if(!h){const{message:T}=R("NO_MATCHING_KEY",`connect() pairing topic: ${h}`);throw new Error(T)}const p=await this.client.core.crypto.generateKeyPair(),g=mt.wc_sessionPropose.req.ttl||E.FIVE_MINUTES,f=ut(g),w=Vt(ke(ke({requiredNamespaces:n,optionalNamespaces:o,relays:c??[{protocol:yv}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:f,pairingTopic:h},a&&{sessionProperties:a}),l&&{scopedProperties:l}),{id:$t()}),m=Ee("session_connect",w.id),{reject:y,resolve:v,done:I}=sr(g,Df),S=({id:T})=>{T===w.id&&(this.client.events.off("proposal_expire",S),this.pendingSessions.delete(w.id),this.events.emit(m,{error:{message:Df,code:0}}))};return this.client.events.on("proposal_expire",S),this.events.once(m,({error:T,session:P})=>{this.client.events.off("proposal_expire",S),T?y(T):P&&v(P)}),await this.sendRequest({topic:h,method:"wc_sessionPropose",params:w,throwOnFailedPublish:!0,clientRpcId:w.id}),await this.setProposal(w.id,w),{uri:u,approval:I}}),O(this,"pair",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(i)}catch(s){throw this.client.logger.error("pair() failed"),s}}),O(this,"approve",async i=>{var s,r,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(s=i==null?void 0:i.id)==null?void 0:s.toString(),trace:[Ri.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(A){throw o.setError(Js.no_internet_connection),A}try{await this.isValidProposalId(i==null?void 0:i.id)}catch(A){throw this.client.logger.error(`approve() -> proposal.get(${i==null?void 0:i.id}) failed`),o.setError(Js.proposal_not_found),A}try{await this.isValidApprove(i)}catch(A){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Js.session_approve_namespace_validation_failure),A}const{id:a,relayProtocol:l,namespaces:c,sessionProperties:h,scopedProperties:u,sessionConfig:d}=i,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:f,requiredNamespaces:w,optionalNamespaces:m}=p;let y=(r=this.client.core.eventClient)==null?void 0:r.getEvent({topic:g});y||(y=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Ri.session_approve_started,properties:{topic:g,trace:[Ri.session_approve_started,Ri.session_namespaces_validation_success]}}));const v=await this.client.core.crypto.generateKeyPair(),I=f.publicKey,S=await this.client.core.crypto.generateSharedKey(v,I),T=ke(ke(ke({relay:{protocol:l??"irn"},namespaces:c,controller:{publicKey:v,metadata:this.client.metadata},expiry:ut(sn)},h&&{sessionProperties:h}),u&&{scopedProperties:u}),d&&{sessionConfig:d}),P=We.relay;y.addTrace(Ri.subscribing_session_topic);try{await this.client.core.relayer.subscribe(S,{transportType:P})}catch(A){throw y.setError(Js.subscribe_session_topic_failure),A}y.addTrace(Ri.subscribe_session_topic_success);const _=Vt(ke({},T),{topic:S,requiredNamespaces:w,optionalNamespaces:m,pairingTopic:g,acknowledged:!1,self:T.controller,peer:{publicKey:f.publicKey,metadata:f.metadata},controller:v,transportType:We.relay});await this.client.session.set(S,_),y.addTrace(Ri.store_session);try{y.addTrace(Ri.publishing_session_settle),await this.sendRequest({topic:S,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0}).catch(A=>{throw y==null||y.setError(Js.session_settle_publish_failure),A}),y.addTrace(Ri.session_settle_publish_success),y.addTrace(Ri.publishing_session_approve),await this.sendResult({id:a,topic:g,result:{relay:{protocol:l??"irn"},responderPublicKey:v},throwOnFailedPublish:!0}).catch(A=>{throw y==null||y.setError(Js.session_approve_publish_failure),A}),y.addTrace(Ri.session_approve_publish_success)}catch(A){throw this.client.logger.error(A),this.client.session.delete(S,Oe("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(S),A}return this.client.core.eventClient.deleteEvent({eventId:y.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:f.metadata}),await this.client.proposal.delete(a,Oe("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(S,ut(sn)),{topic:S,acknowledged:()=>Promise.resolve(this.client.session.get(S))}}),O(this,"reject",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(i)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:s,reason:r}=i;let n;try{n=this.client.proposal.get(s).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${s}) failed`),o}n&&(await this.sendError({id:s,topic:n,error:r,rpcOpts:mt.wc_sessionPropose.reject}),await this.client.proposal.delete(s,Oe("USER_DISCONNECTED")))}),O(this,"update",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(i)}catch(u){throw this.client.logger.error("update() -> isValidUpdate() failed"),u}const{topic:s,namespaces:r}=i,{done:n,resolve:o,reject:a}=sr(),l=$t(),c=pi().toString(),h=this.client.session.get(s).namespaces;return this.events.once(Ee("session_update",l),({error:u})=>{u?a(u):o()}),await this.client.session.update(s,{namespaces:r}),await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:l,relayRpcId:c}).catch(u=>{this.client.logger.error(u),this.client.session.update(s,{namespaces:h}),a(u)}),{acknowledged:n}}),O(this,"extend",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(i)}catch(l){throw this.client.logger.error("extend() -> isValidExtend() failed"),l}const{topic:s}=i,r=$t(),{done:n,resolve:o,reject:a}=sr();return this.events.once(Ee("session_extend",r),({error:l})=>{l?a(l):o()}),await this.setExpiry(s,ut(sn)),this.sendRequest({topic:s,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(l=>{a(l)}),{acknowledged:n}}),O(this,"request",async i=>{this.isInitialized();try{await this.isValidRequest(i)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:s,request:r,topic:n,expiry:o=mt.wc_sessionRequest.req.ttl}=i,a=this.client.session.get(n);(a==null?void 0:a.transportType)===We.relay&&await this.confirmOnlineStateOrThrow();const l=$t(),c=pi().toString(),{done:h,resolve:u,reject:d}=sr(o,"Request expired. Please try again.");this.events.once(Ee("session_request",l),({error:m,result:y})=>{m?d(m):u(y)});const p="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:l,relayRpcId:c,topic:n,method:p,params:{request:Vt(ke({},r),{expiryTimestamp:ut(o)}),chainId:s},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:s,id:l}),await h();const f={request:Vt(ke({},r),{expiryTimestamp:ut(o)}),chainId:s},w=this.shouldSetTVF(p,f);return await Promise.all([new Promise(async m=>{await this.sendRequest(ke({clientRpcId:l,relayRpcId:c,topic:n,method:p,params:f,expiry:o,throwOnFailedPublish:!0},w&&{tvf:this.getTVFParams(l,f)})).catch(y=>d(y)),this.client.events.emit("session_request_sent",{topic:n,request:r,chainId:s,id:l}),m()}),new Promise(async m=>{var y;if(!((y=a.sessionConfig)!=null&&y.disableDeepLink)){const v=await pR(this.client.core.storage,kf);await hR({id:l,topic:n,wcDeepLink:v})}m()}),h()]).then(m=>m[2])}),O(this,"respond",async i=>{this.isInitialized(),await this.isValidRespond(i);const{topic:s,response:r}=i,{id:n}=r,o=this.client.session.get(s);o.transportType===We.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);vt(r)?await this.sendResult({id:n,topic:s,result:r.result,throwOnFailedPublish:!0,appLink:a}):it(r)&&await this.sendError({id:n,topic:s,error:r.error,appLink:a}),this.cleanupAfterResponse(i)}),O(this,"ping",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(i)}catch(r){throw this.client.logger.error("ping() -> isValidPing() failed"),r}const{topic:s}=i;if(this.client.session.keys.includes(s)){const r=$t(),n=pi().toString(),{done:o,resolve:a,reject:l}=sr();this.events.once(Ee("session_ping",r),({error:c})=>{c?l(c):a()}),await Promise.all([this.sendRequest({topic:s,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:r,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(s)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:s}))}),O(this,"emit",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(i);const{topic:s,event:r,chainId:n}=i,o=pi().toString(),a=$t();await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:r,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),O(this,"disconnect",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(i);const{topic:s}=i;if(this.client.session.keys.includes(s))await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Oe("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:s,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(s))await this.client.core.pairing.disconnect({topic:s});else{const{message:r}=R("MISMATCHED_TOPIC",`Session or pairing topic not found: ${s}`);throw new Error(r)}}),O(this,"find",i=>(this.isInitialized(),this.client.session.getAll().filter(s=>_L(s,i)))),O(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),O(this,"authenticate",async(i,s)=>{var r;this.isInitialized(),this.isValidAuthenticate(i);const n=s&&this.client.core.linkModeSupportedApps.includes(s)&&((r=this.client.metadata.redirect)==null?void 0:r.linkMode),o=n?We.link_mode:We.relay;o===We.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:l="",uri:c,domain:h,nonce:u,type:d,exp:p,nbf:g,methods:f=[],expiry:w}=i,m=[...i.resources||[]],{topic:y,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:y,uri:v}});const I=await this.client.core.crypto.generateKeyPair(),S=dc(I);if(await Promise.all([this.client.auth.authKeys.set(gc,{responseTopic:S,publicKey:I}),this.client.auth.pairingTopics.set(S,{topic:S,pairingTopic:y})]),await this.client.core.relayer.subscribe(S,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${y}`),f.length>0){const{namespace:U}=Mn(a[0]);let W=rU(U,"request",f);uc(m)&&(W=oU(W,m.pop())),m.push(W)}const T=w&&w>mt.wc_sessionAuthenticate.req.ttl?w:mt.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:d??"caip122",chains:a,statement:l,aud:c,domain:h,version:"1",nonce:u,iat:new Date().toISOString(),exp:p,nbf:g,resources:m},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:ut(T)},_={eip155:{chains:a,methods:[...new Set(["personal_sign",...f])],events:["chainChanged","accountsChanged"]}},A={requiredNamespaces:{},optionalNamespaces:_,relays:[{protocol:"irn"}],pairingTopic:y,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:ut(mt.wc_sessionPropose.req.ttl),id:$t()},{done:M,resolve:k,reject:B}=sr(T,"Request expired"),$=$t(),q=Ee("session_connect",A.id),L=Ee("session_request",$),H=async({error:U,session:W})=>{this.events.off(L,V),U?B(U):W&&k({session:W})},V=async U=>{var W,Q,F;if(await this.deletePendingAuthRequest($,{message:"fulfilled",code:0}),U.error){const ss=Oe("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return U.error.code===ss.code?void 0:(this.events.off(q,H),B(U.error.message))}await this.deleteProposal(A.id),this.events.off(q,H);const{cacaos:ne,responder:ve}=U.result,De=[],Xe=[];for(const ss of ne){await jg({cacao:ss,projectId:this.client.core.projectId})||(this.client.logger.error(ss,"Signature verification failed"),B(Oe("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Ys}=ss,Dr=uc(Ys.resources),Ca=[Hh(Ys.iss)],eo=Oc(Ys.iss);if(Dr){const to=Rg(Dr),sb=Ug(Dr);De.push(...to),Ca.push(...sb)}for(const to of Ca)Xe.push(`${to}:${eo}`)}const Ke=await this.client.core.crypto.generateSharedKey(I,ve.publicKey);let Fe;De.length>0&&(Fe={topic:Ke,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:ve,controller:ve.publicKey,expiry:ut(sn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:y,namespaces:sf([...new Set(De)],[...new Set(Xe)]),transportType:o},await this.client.core.relayer.subscribe(Ke,{transportType:o}),await this.client.session.set(Ke,Fe),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:ve.metadata}),Fe=this.client.session.get(Ke)),(W=this.client.metadata.redirect)!=null&&W.linkMode&&(Q=ve.metadata.redirect)!=null&&Q.linkMode&&(F=ve.metadata.redirect)!=null&&F.universal&&s&&(this.client.core.addLinkModeSupportedApp(ve.metadata.redirect.universal),this.client.session.update(Ke,{transportType:We.link_mode})),k({auths:ne,session:Fe})};this.events.once(q,H),this.events.once(L,V);let C;try{if(n){const U=Kt("wc_sessionAuthenticate",P,$);this.client.core.history.set(y,U);const W=await this.client.core.crypto.encode("",U,{type:Ea,encoding:yo});C=Ga(s,y,W)}else await Promise.all([this.sendRequest({topic:y,method:"wc_sessionAuthenticate",params:P,expiry:i.expiry,throwOnFailedPublish:!0,clientRpcId:$}),this.sendRequest({topic:y,method:"wc_sessionPropose",params:A,expiry:mt.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:A.id})])}catch(U){throw this.events.off(q,H),this.events.off(L,V),U}return await this.setProposal(A.id,A),await this.setAuthRequest($,{request:Vt(ke({},P),{verifyContext:{}}),pairingTopic:y,transportType:o}),{uri:C??v,response:M}}),O(this,"approveSessionAuthenticate",async i=>{const{id:s,auths:r}=i,n=this.client.core.eventClient.createEvent({properties:{topic:s.toString(),trace:[Xs.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw n.setError(Io.no_internet_connection),w}const o=this.getPendingAuthRequest(s);if(!o)throw n.setError(Io.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${s}`);const a=o.transportType||We.relay;a===We.relay&&await this.confirmOnlineStateOrThrow();const l=o.requester.publicKey,c=await this.client.core.crypto.generateKeyPair(),h=dc(l),u={type:ms,receiverPublicKey:l,senderPublicKey:c},d=[],p=[];for(const w of r){if(!await jg({cacao:w,projectId:this.client.core.projectId})){n.setError(Io.invalid_cacao);const S=Oe("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:s,topic:h,error:S,encodeOpts:u}),new Error(S.message)}n.addTrace(Xs.cacaos_verified);const{p:m}=w,y=uc(m.resources),v=[Hh(m.iss)],I=Oc(m.iss);if(y){const S=Rg(y),T=Ug(y);d.push(...S),v.push(...T)}for(const S of v)p.push(`${S}:${I}`)}const g=await this.client.core.crypto.generateSharedKey(c,l);n.addTrace(Xs.create_authenticated_session_topic);let f;if((d==null?void 0:d.length)>0){f={topic:g,acknowledged:!0,self:{publicKey:c,metadata:this.client.metadata},peer:{publicKey:l,metadata:o.requester.metadata},controller:l,expiry:ut(sn),authentication:r,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:sf([...new Set(d)],[...new Set(p)]),transportType:a},n.addTrace(Xs.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(w){throw n.setError(Io.subscribe_authenticated_session_topic_failure),w}n.addTrace(Xs.subscribe_authenticated_session_topic_success),await this.client.session.set(g,f),n.addTrace(Xs.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Xs.publishing_authenticated_session_approve);try{await this.sendResult({topic:h,id:s,result:{cacaos:r,responder:{publicKey:c,metadata:this.client.metadata}},encodeOpts:u,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw n.setError(Io.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(s,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:f}}),O(this,"rejectSessionAuthenticate",async i=>{this.isInitialized();const{id:s,reason:r}=i,n=this.getPendingAuthRequest(s);if(!n)throw new Error(`Could not find pending auth request with id ${s}`);n.transportType===We.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),l=dc(o),c={type:ms,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:s,topic:l,error:r,encodeOpts:c,rpcOpts:mt.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(s,{message:"rejected",code:0}),await this.client.proposal.delete(s,Oe("USER_DISCONNECTED"))}),O(this,"formatAuthMessage",i=>{this.isInitialized();const{request:s,iss:r}=i;return Jy(s,r)}),O(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const i=this.relayMessageCache.shift();i&&await this.onRelayMessage(i)}catch(i){this.client.logger.error(i)}},50)}),O(this,"cleanupDuplicatePairings",async i=>{if(i.pairingTopic)try{const s=this.client.core.pairing.pairings.get(i.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===i.peer.metadata.url&&n.topic&&n.topic!==s.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}}),O(this,"deleteSession",async i=>{var s;const{topic:r,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=i,{self:l}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,Oe("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(l.publicKey)&&await this.client.core.crypto.deleteKeyPair(l.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r),this.client.core.storage.removeItem(kf).catch(c=>this.client.logger.warn(c)),this.getPendingSessionRequests().forEach(c=>{c.topic===r&&this.deletePendingSessionRequest(c.id,Oe("USER_DISCONNECTED"))}),r===((s=this.sessionRequestQueue.queue[0])==null?void 0:s.topic)&&(this.sessionRequestQueue.state=Yi.idle),o&&this.client.events.emit("session_delete",{id:a,topic:r})}),O(this,"deleteProposal",async(i,s)=>{if(s)try{const r=this.client.proposal.get(i),n=this.client.core.eventClient.getEvent({topic:r.pairingTopic});n==null||n.setError(Js.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(i,Oe("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"proposal")}),O(this,"deletePendingSessionRequest",async(i,s,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,s),r?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==i),r&&(this.sessionRequestQueue.state=Yi.idle,this.client.events.emit("session_request_expire",{id:i}))}),O(this,"deletePendingAuthRequest",async(i,s,r=!1)=>{await Promise.all([this.client.auth.requests.delete(i,s),r?Promise.resolve():this.client.core.expirer.del(i)])}),O(this,"setExpiry",async(i,s)=>{this.client.session.keys.includes(i)&&(this.client.core.expirer.set(i,s),await this.client.session.update(i,{expiry:s}))}),O(this,"setProposal",async(i,s)=>{this.client.core.expirer.set(i,ut(mt.wc_sessionPropose.req.ttl)),await this.client.proposal.set(i,s)}),O(this,"setAuthRequest",async(i,s)=>{const{request:r,pairingTopic:n,transportType:o=We.relay}=s;this.client.core.expirer.set(i,r.expiryTimestamp),await this.client.auth.requests.set(i,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:i,pairingTopic:n,verifyContext:r.verifyContext,transportType:o})}),O(this,"setPendingSessionRequest",async i=>{const{id:s,topic:r,params:n,verifyContext:o}=i,a=n.request.expiryTimestamp||ut(mt.wc_sessionRequest.req.ttl);this.client.core.expirer.set(s,a),await this.client.pendingRequest.set(s,{id:s,topic:r,params:n,verifyContext:o})}),O(this,"sendRequest",async i=>{const{topic:s,method:r,params:n,expiry:o,relayRpcId:a,clientRpcId:l,throwOnFailedPublish:c,appLink:h,tvf:u}=i,d=Kt(r,n,l);let p;const g=!!h;try{const m=g?yo:zs;p=await this.client.core.crypto.encode(s,d,{encoding:m})}catch(m){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${s} failed`),m}let f;if($z.includes(r)){const m=Ji(JSON.stringify(d)),y=Ji(p);f=await this.client.core.verify.register({id:y,decryptedId:m})}const w=mt[r].req;if(w.attestation=f,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(s,d),g){const m=Ga(h,s,p);await N.global.Linking.openURL(m,this.client.name)}else{const m=mt[r].req;o&&(m.ttl=o),a&&(m.id=a),m.tvf=Vt(ke({},u),{correlationId:d.id}),c?(m.internal=Vt(ke({},m.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,p,m)):this.client.core.relayer.publish(s,p,m).catch(y=>this.client.logger.error(y))}return d.id}),O(this,"sendResult",async i=>{const{id:s,topic:r,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:l}=i,c=Ws(s,n);let h;const u=l&&typeof(N.global==null?void 0:N.global.Linking)<"u";try{const g=u?yo:zs;h=await this.client.core.crypto.encode(r,c,Vt(ke({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${r} failed`),g}let d,p;try{d=await this.client.core.history.get(r,s);const g=d.request;try{this.shouldSetTVF(g.method,g.params)&&(p=this.getTVFParams(s,g.params,n))}catch(f){this.client.logger.warn("sendResult() -> getTVFParams() failed",f)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${r}, ${s}) failed`),g}if(u){const g=Ga(l,r,h);await N.global.Linking.openURL(g,this.client.name)}else{const g=d.request.method,f=mt[g].res;f.tvf=Vt(ke({},p),{correlationId:s}),o?(f.internal=Vt(ke({},f.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,h,f)):this.client.core.relayer.publish(r,h,f).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(c)}),O(this,"sendError",async i=>{const{id:s,topic:r,error:n,encodeOpts:o,rpcOpts:a,appLink:l}=i,c=na(s,n);let h;const u=l&&typeof(N.global==null?void 0:N.global.Linking)<"u";try{const p=u?yo:zs;h=await this.client.core.crypto.encode(r,c,Vt(ke({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${r} failed`),p}let d;try{d=await this.client.core.history.get(r,s)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${r}, ${s}) failed`),p}if(u){const p=Ga(l,r,h);await N.global.Linking.openURL(p,this.client.name)}else{const p=d.request.method,g=a||mt[p].res;this.client.core.relayer.publish(r,h,g)}await this.client.core.history.resolve(c)}),O(this,"cleanup",async()=>{const i=[],s=[];this.client.session.getAll().forEach(r=>{let n=!1;Ms(r.expiry)&&(n=!0),this.client.core.crypto.keychain.has(r.topic)||(n=!0),n&&i.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{Ms(r.expiryTimestamp)&&s.push(r.id)}),await Promise.all([...i.map(r=>this.deleteSession({topic:r})),...s.map(r=>this.deleteProposal(r))])}),O(this,"onProviderMessageEvent",async i=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(i):await this.onRelayMessage(i)}),O(this,"onRelayEventRequest",async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()}),O(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Yi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Yi.active;const i=this.requestQueue.queue.shift();if(i)try{await this.processRequest(i)}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=Yi.idle}),O(this,"processRequest",async i=>{const{topic:s,payload:r,attestation:n,transportType:o,encryptedId:a}=i,l=r.method;if(!this.shouldIgnorePairingRequest({topic:s,requestMethod:l}))switch(l){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:s,payload:r,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(s,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(s,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(s,r);case"wc_sessionPing":return await this.onSessionPingRequest(s,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(s,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:s,payload:r,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(s,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:s,payload:r,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${l}`)}}),O(this,"onRelayEventResponse",async i=>{const{topic:s,payload:r,transportType:n}=i,o=(await this.client.core.history.get(s,r.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(s,r,n);case"wc_sessionSettle":return this.onSessionSettleResponse(s,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,r);case"wc_sessionExtend":return this.onSessionExtendResponse(s,r);case"wc_sessionPing":return this.onSessionPingResponse(s,r);case"wc_sessionRequest":return this.onSessionRequestResponse(s,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(s,r);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),O(this,"onRelayEventUnknownPayload",i=>{const{topic:s}=i,{message:r}=R("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)}),O(this,"shouldIgnorePairingRequest",i=>{const{topic:s,requestMethod:r}=i,n=this.expectedPairingMethodMap.get(s);return!n||n.includes(r)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),O(this,"onSessionProposeRequest",async i=>{const{topic:s,payload:r,attestation:n,encryptedId:o}=i,{params:a,id:l}=r;try{const c=this.client.core.eventClient.getEvent({topic:s});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),c==null||c.setError(us.proposal_listener_not_found)),this.isValidConnect(ke({},r.params));const h=a.expiryTimestamp||ut(mt.wc_sessionPropose.req.ttl),u=ke({id:l,pairingTopic:s,expiryTimestamp:h},a);await this.setProposal(l,u);const d=await this.getVerifyContext({attestationId:n,hash:Ji(JSON.stringify(r)),encryptedId:o,metadata:u.proposer.metadata});c==null||c.addTrace(Zi.emit_session_proposal),this.client.events.emit("session_proposal",{id:l,params:u,verifyContext:d})}catch(c){await this.sendError({id:l,topic:s,error:c,rpcOpts:mt.wc_sessionPropose.autoReject}),this.client.logger.error(c)}}),O(this,"onSessionProposeResponse",async(i,s,r)=>{const{id:n}=s;if(vt(s)){const{result:o}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const l=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:l});const c=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:c});const h=await this.client.core.crypto.generateSharedKey(l,c);this.pendingSessions.set(n,{sessionTopic:h,pairingTopic:i,proposalId:n,publicKey:l});const u=await this.client.core.relayer.subscribe(h,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:u}),await this.client.core.pairing.activate({topic:i})}else if(it(s)){await this.client.proposal.delete(n,Oe("USER_DISCONNECTED"));const o=Ee("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:s.error})}}),O(this,"onSessionSettleRequest",async(i,s)=>{const{id:r,params:n}=s;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:l,namespaces:c,sessionProperties:h,scopedProperties:u,sessionConfig:d}=s.params,p=[...this.pendingSessions.values()].find(w=>w.sessionTopic===i);if(!p)return this.client.logger.error(`Pending session not found for topic ${i}`);const g=this.client.proposal.get(p.proposalId),f=Vt(ke(ke(ke({topic:i,relay:o,expiry:l,namespaces:c,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},h&&{sessionProperties:h}),u&&{scopedProperties:u}),d&&{sessionConfig:d}),{transportType:We.relay});await this.client.session.set(f.topic,f),await this.setExpiry(f.topic,f.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:f.peer.metadata}),this.client.events.emit("session_connect",{session:f}),this.events.emit(Ee("session_connect",p.proposalId),{session:f}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(f),await this.sendResult({id:s.id,topic:i,result:!0,throwOnFailedPublish:!0})}catch(o){await this.sendError({id:r,topic:i,error:o}),this.client.logger.error(o)}}),O(this,"onSessionSettleResponse",async(i,s)=>{const{id:r}=s;vt(s)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(Ee("session_approve",r),{})):it(s)&&(await this.client.session.delete(i,Oe("USER_DISCONNECTED")),this.events.emit(Ee("session_approve",r),{error:s.error}))}),O(this,"onSessionUpdateRequest",async(i,s)=>{const{params:r,id:n}=s;try{const o=`${i}_session_update`,a=vo.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:i,error:Oe("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ke({topic:i},r));try{vo.set(o,n),await this.client.session.update(i,{namespaces:r.namespaces}),await this.sendResult({id:n,topic:i,result:!0,throwOnFailedPublish:!0})}catch(l){throw vo.delete(o),l}this.client.events.emit("session_update",{id:n,topic:i,params:r})}catch(o){await this.sendError({id:n,topic:i,error:o}),this.client.logger.error(o)}}),O(this,"isRequestOutOfSync",(i,s)=>s.toString().slice(0,-3)<i.toString().slice(0,-3)),O(this,"onSessionUpdateResponse",(i,s)=>{const{id:r}=s,n=Ee("session_update",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(s)?this.events.emit(Ee("session_update",r),{}):it(s)&&this.events.emit(Ee("session_update",r),{error:s.error})}),O(this,"onSessionExtendRequest",async(i,s)=>{const{id:r}=s;try{this.isValidExtend({topic:i}),await this.setExpiry(i,ut(sn)),await this.sendResult({id:r,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:r,topic:i})}catch(n){await this.sendError({id:r,topic:i,error:n}),this.client.logger.error(n)}}),O(this,"onSessionExtendResponse",(i,s)=>{const{id:r}=s,n=Ee("session_extend",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(s)?this.events.emit(Ee("session_extend",r),{}):it(s)&&this.events.emit(Ee("session_extend",r),{error:s.error})}),O(this,"onSessionPingRequest",async(i,s)=>{const{id:r}=s;try{this.isValidPing({topic:i}),await this.sendResult({id:r,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:i})}catch(n){await this.sendError({id:r,topic:i,error:n}),this.client.logger.error(n)}}),O(this,"onSessionPingResponse",(i,s)=>{const{id:r}=s,n=Ee("session_ping",r);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);vt(s)?this.events.emit(Ee("session_ping",r),{}):it(s)&&this.events.emit(Ee("session_ping",r),{error:s.error})},500)}),O(this,"onSessionDeleteRequest",async(i,s)=>{const{id:r}=s;try{this.isValidDisconnect({topic:i,reason:s.params}),Promise.all([new Promise(n=>{this.client.core.relayer.once(It.publish,async()=>{n(await this.deleteSession({topic:i,id:r}))})}),this.sendResult({id:r,topic:i,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:i,error:Oe("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),O(this,"onSessionRequest",async i=>{var s,r,n;const{topic:o,payload:a,attestation:l,encryptedId:c,transportType:h}=i,{id:u,params:d}=a;try{await this.isValidRequest(ke({topic:o},d));const p=this.client.session.get(o),g=await this.getVerifyContext({attestationId:l,hash:Ji(JSON.stringify(Kt("wc_sessionRequest",d,u))),encryptedId:c,metadata:p.peer.metadata,transportType:h}),f={id:u,topic:o,params:d,verifyContext:g};await this.setPendingSessionRequest(f),h===We.link_mode&&(s=p.peer.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp((r=p.peer.metadata.redirect)==null?void 0:r.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(f):(this.addSessionRequestToSessionRequestQueue(f),this.processSessionRequestQueue())}catch(p){await this.sendError({id:u,topic:o,error:p}),this.client.logger.error(p)}}),O(this,"onSessionRequestResponse",(i,s)=>{const{id:r}=s,n=Ee("session_request",r);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);vt(s)?this.events.emit(Ee("session_request",r),{result:s.result}):it(s)&&this.events.emit(Ee("session_request",r),{error:s.error})}),O(this,"onSessionEventRequest",async(i,s)=>{const{id:r,params:n}=s;try{const o=`${i}_session_event_${n.event.name}`,a=vo.get(o);if(a&&this.isRequestOutOfSync(a,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(ke({topic:i},n)),this.client.events.emit("session_event",{id:r,topic:i,params:n}),vo.set(o,r)}catch(o){await this.sendError({id:r,topic:i,error:o}),this.client.logger.error(o)}}),O(this,"onSessionAuthenticateResponse",(i,s)=>{const{id:r}=s;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:i,payload:s}),vt(s)?this.events.emit(Ee("session_request",r),{result:s.result}):it(s)&&this.events.emit(Ee("session_request",r),{error:s.error})}),O(this,"onSessionAuthenticateRequest",async i=>{var s;const{topic:r,payload:n,attestation:o,encryptedId:a,transportType:l}=i;try{const{requester:c,authPayload:h,expiryTimestamp:u}=n.params,d=await this.getVerifyContext({attestationId:o,hash:Ji(JSON.stringify(n)),encryptedId:a,metadata:c.metadata,transportType:l}),p={requester:c,pairingTopic:r,id:n.id,authPayload:h,verifyContext:d,expiryTimestamp:u};await this.setAuthRequest(n.id,{request:p,pairingTopic:r,transportType:l}),l===We.link_mode&&(s=c.metadata.redirect)!=null&&s.universal&&this.client.core.addLinkModeSupportedApp(c.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:n.params,id:n.id,verifyContext:d})}catch(c){this.client.logger.error(c);const h=n.params.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(n.params.requester.metadata,l),p={type:ms,receiverPublicKey:h,senderPublicKey:u};await this.sendError({id:n.id,topic:r,error:c,encodeOpts:p,rpcOpts:mt.wc_sessionAuthenticate.autoReject,appLink:d})}}),O(this,"addSessionRequestToSessionRequestQueue",i=>{this.sessionRequestQueue.queue.push(i)}),O(this,"cleanupAfterResponse",i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Yi.idle,this.processSessionRequestQueue()},E.toMiliseconds(this.requestQueueDelay))}),O(this,"cleanupPendingSentRequestsForTopic",({topic:i,error:s})=>{const r=this.client.core.history.pending;r.length>0&&r.filter(n=>n.topic===i&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=Ee("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Ee("session_request",n.request.id),{error:s})})}),O(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Yi.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Yi.active,this.emitSessionRequest(i)}catch(s){this.client.logger.error(s)}}),O(this,"emitSessionRequest",i=>{this.client.events.emit("session_request",i)}),O(this,"onPairingCreated",i=>{if(i.methods&&this.expectedPairingMethodMap.set(i.topic,i.methods),i.active)return;const s=this.client.proposal.getAll().find(r=>r.pairingTopic===i.topic);s&&this.onSessionProposeRequest({topic:i.topic,payload:Kt("wc_sessionPropose",Vt(ke({},s),{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties,scopedProperties:s.scopedProperties}),s.id)})}),O(this,"isValidConnect",async i=>{if(!ii(i)){const{message:c}=R("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(c)}const{pairingTopic:s,requiredNamespaces:r,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:l}=i;if(qt(s)||await this.isValidPairingTopic(s),!UL(l)){const{message:c}=R("MISSING_OR_INVALID",`connect() relays: ${l}`);throw new Error(c)}if(!qt(r)&&ea(r)!==0&&this.validateNamespaces(r,"requiredNamespaces"),!qt(n)&&ea(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),qt(o)||this.validateSessionProps(o,"sessionProperties"),!qt(a)){this.validateSessionProps(a,"scopedProperties");const c=Object.keys(r||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(h=>c.includes(h)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(c)}`)}}),O(this,"validateNamespaces",(i,s)=>{const r=RL(i,"connect()",s);if(r)throw new Error(r.message)}),O(this,"isValidApprove",async i=>{if(!ii(i))throw new Error(R("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:s,namespaces:r,relayProtocol:n,sessionProperties:o,scopedProperties:a}=i;this.checkRecentlyDeleted(s),await this.isValidProposalId(s);const l=this.client.proposal.get(s),c=Kl(r,"approve()");if(c)throw new Error(c.message);const h=of(l.requiredNamespaces,r,"approve()");if(h)throw new Error(h.message);if(!at(n,!0)){const{message:u}=R("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(u)}if(qt(o)||this.validateSessionProps(o,"sessionProperties"),!qt(a)){this.validateSessionProps(a,"scopedProperties");const u=new Set(Object.keys(r));if(!Object.keys(a).every(d=>u.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(u).join(", ")}`)}}),O(this,"isValidReject",async i=>{if(!ii(i)){const{message:n}=R("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(n)}const{id:s,reason:r}=i;if(this.checkRecentlyDeleted(s),await this.isValidProposalId(s),!zL(r)){const{message:n}=R("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(n)}}),O(this,"isValidSessionSettleRequest",i=>{if(!ii(i)){const{message:c}=R("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(c)}const{relay:s,controller:r,namespaces:n,expiry:o}=i;if(!fv(s)){const{message:c}=R("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(c)}const a=ML(r,"onSessionSettleRequest()");if(a)throw new Error(a.message);const l=Kl(n,"onSessionSettleRequest()");if(l)throw new Error(l.message);if(Ms(o)){const{message:c}=R("EXPIRED","onSessionSettleRequest()");throw new Error(c)}}),O(this,"isValidUpdate",async i=>{if(!ii(i)){const{message:l}=R("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(l)}const{topic:s,namespaces:r}=i;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);const n=this.client.session.get(s),o=Kl(r,"update()");if(o)throw new Error(o.message);const a=of(n.requiredNamespaces,r,"update()");if(a)throw new Error(a.message)}),O(this,"isValidExtend",async i=>{if(!ii(i)){const{message:r}=R("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(r)}const{topic:s}=i;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s)}),O(this,"isValidRequest",async i=>{if(!ii(i)){const{message:l}=R("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(l)}const{topic:s,request:r,chainId:n,expiry:o}=i;this.checkRecentlyDeleted(s),await this.isValidSessionTopic(s);const{namespaces:a}=this.client.session.get(s);if(!nf(a,n)){const{message:l}=R("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(l)}if(!$L(r)){const{message:l}=R("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(l)}if(!HL(a,n,r.method)){const{message:l}=R("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(l)}if(o&&!FL(o,Xl)){const{message:l}=R("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Xl.min} and ${Xl.max}`);throw new Error(l)}}),O(this,"isValidRespond",async i=>{var s;if(!ii(i)){const{message:o}=R("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(o)}const{topic:r,response:n}=i;try{await this.isValidSessionTopic(r)}catch(o){throw(s=i==null?void 0:i.response)!=null&&s.id&&this.cleanupAfterResponse(i),o}if(!qL(n)){const{message:o}=R("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),O(this,"isValidPing",async i=>{if(!ii(i)){const{message:r}=R("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidSessionOrPairingTopic(s)}),O(this,"isValidEmit",async i=>{if(!ii(i)){const{message:a}=R("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(a)}const{topic:s,event:r,chainId:n}=i;await this.isValidSessionTopic(s);const{namespaces:o}=this.client.session.get(s);if(!nf(o,n)){const{message:a}=R("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!BL(r)){const{message:a}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}if(!VL(o,n,r.name)){const{message:a}=R("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}}),O(this,"isValidDisconnect",async i=>{if(!ii(i)){const{message:r}=R("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(r)}const{topic:s}=i;await this.isValidSessionOrPairingTopic(s)}),O(this,"isValidAuthenticate",i=>{const{chains:s,uri:r,domain:n,nonce:o}=i;if(!Array.isArray(s)||s.length===0)throw new Error("chains is required and must be a non-empty array");if(!at(r,!1))throw new Error("uri is required parameter");if(!at(n,!1))throw new Error("domain is required parameter");if(!at(o,!1))throw new Error("nonce is required parameter");if([...new Set(s.map(l=>Mn(l).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Mn(s[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),O(this,"getVerifyContext",async i=>{const{attestationId:s,hash:r,encryptedId:n,metadata:o,transportType:a}=i,l={verified:{verifyUrl:o.verifyUrl||Uo,validation:"UNKNOWN",origin:o.url||""}};try{if(a===We.link_mode){const h=this.getAppLinkIfEnabled(o,a);return l.verified.validation=h&&new URL(h).origin===new URL(o.url).origin?"VALID":"INVALID",l}const c=await this.client.core.verify.resolve({attestationId:s,hash:r,encryptedId:n,verifyUrl:o.verifyUrl});c&&(l.verified.origin=c.origin,l.verified.isScam=c.isScam,l.verified.validation=c.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(c){this.client.logger.warn(c)}return this.client.logger.debug(`Verify context: ${JSON.stringify(l)}`),l}),O(this,"validateSessionProps",(i,s)=>{Object.values(i).forEach((r,n)=>{if(r==null){const{message:o}=R("MISSING_OR_INVALID",`${s} must contain an existing value for each key. Received: ${r} for key ${Object.keys(i)[n]}`);throw new Error(o)}})}),O(this,"getPendingAuthRequest",i=>{const s=this.client.auth.requests.get(i);return typeof s=="object"?s:void 0}),O(this,"addToRecentlyDeleted",(i,s)=>{if(this.recentlyDeletedMap.set(i,s),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let r=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(r++>=n)break;this.recentlyDeletedMap.delete(o)}}}),O(this,"checkRecentlyDeleted",i=>{const s=this.recentlyDeletedMap.get(i);if(s){const{message:r}=R("MISSING_OR_INVALID",`Record was recently deleted - ${s}: ${i}`);throw new Error(r)}}),O(this,"isLinkModeEnabled",(i,s)=>{var r,n,o,a,l,c,h,u,d;return!i||s!==We.link_mode?!1:((n=(r=this.client.metadata)==null?void 0:r.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((c=(l=this.client.metadata)==null?void 0:l.redirect)==null?void 0:c.universal)!==""&&((h=i==null?void 0:i.redirect)==null?void 0:h.universal)!==void 0&&((u=i==null?void 0:i.redirect)==null?void 0:u.universal)!==""&&((d=i==null?void 0:i.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(i.redirect.universal)&&typeof(N.global==null?void 0:N.global.Linking)<"u"}),O(this,"getAppLinkIfEnabled",(i,s)=>{var r;return this.isLinkModeEnabled(i,s)?(r=i==null?void 0:i.redirect)==null?void 0:r.universal:void 0}),O(this,"handleLinkModeMessage",({url:i})=>{if(!i||!i.includes("wc_ev")||!i.includes("topic"))return;const s=Cg(i,"topic")||"",r=decodeURIComponent(Cg(i,"wc_ev")||""),n=this.client.session.keys.includes(s);n&&this.client.session.update(s,{transportType:We.link_mode}),this.client.core.dispatchEnvelope({topic:s,message:r,sessionExists:n})}),O(this,"registerLinkModeListeners",async()=>{var i;if(Ru()||Gs()&&(i=this.client.metadata.redirect)!=null&&i.linkMode){const s=N.global==null?void 0:N.global.Linking;if(typeof s<"u"){s.addEventListener("url",this.handleLinkModeMessage,this.client.name);const r=await s.getInitialURL();r&&setTimeout(()=>{this.handleLinkModeMessage({url:r})},50)}}}),O(this,"shouldSetTVF",(i,s)=>{if(!s||i!=="wc_sessionRequest")return!1;const{request:r}=s;return Object.keys(jf).includes(r.method)}),O(this,"getTVFParams",(i,s,r)=>{var n,o;try{const a=s.request.method,l=this.extractTxHashesFromResult(a,r);return Vt(ke({correlationId:i,rpcMethods:[a],chainId:s.chainId},this.isValidContractData(s.request.params)&&{contractAddresses:[(o=(n=s.request.params)==null?void 0:n[0])==null?void 0:o.to]}),{txHashes:l})}catch(a){this.client.logger.warn("Error getting TVF params",a)}return{}}),O(this,"isValidContractData",i=>{var s;if(!i)return!1;try{const r=(i==null?void 0:i.data)||((s=i==null?void 0:i[0])==null?void 0:s.data);if(!r.startsWith("0x"))return!1;const n=r.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),O(this,"extractTxHashesFromResult",(i,s)=>{try{const r=jf[i];if(typeof s=="string")return[s];const n=s[r.key];if(Ir(n))return i==="solana_signAllTransactions"?n.map(o=>VR(o)):n;if(typeof n=="string")return[n]}catch(r){this.client.logger.warn("Error extracting tx hashes from result",r)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,i=this.client.core.relayer.messages.getWithoutAck(e);for(const[s,r]of Object.entries(i))for(const n of r)try{await this.onProviderMessageEvent({topic:s,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${s}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=R("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(It.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:i,message:s,attestation:r,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(gc)?this.client.auth.authKeys.get(gc):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(i,s,{receiverPublicKey:o,encoding:n===We.link_mode?yo:zs});Wn(a)?(this.client.core.history.set(i,a),await this.onRelayEventRequest({topic:i,payload:a,attestation:r,transportType:n,encryptedId:Ji(s)})):Nr(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a,transportType:n}),this.client.core.history.delete(i,a.id)):await this.onRelayEventUnknownPayload({topic:i,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(i,s)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Ci.expired,async e=>{const{topic:i,id:s}=Hy(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,R("EXPIRED"),!0);if(s&&this.client.auth.requests.keys.includes(s))return await this.deletePendingAuthRequest(s,R("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession({topic:i,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:i})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(or.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(or.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!at(e,!1)){const{message:i}=R("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:i}=R("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(i)}if(Ms(this.client.core.pairing.pairings.get(e).expiry)){const{message:i}=R("EXPIRED",`pairing topic: ${e}`);throw new Error(i)}}async isValidSessionTopic(e){if(!at(e,!1)){const{message:i}=R("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(i)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:i}=R("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(i)}if(Ms(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:i}=R("EXPIRED",`session topic: ${e}`);throw new Error(i)}if(!this.client.core.crypto.keychain.has(e)){const{message:i}=R("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(i)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(at(e,!1)){const{message:i}=R("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(i)}else{const{message:i}=R("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(i)}}async isValidProposalId(e){if(!LL(e)){const{message:i}=R("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(i)}if(!this.client.proposal.keys.includes(e)){const{message:i}=R("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(i)}if(Ms(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:i}=R("EXPIRED",`proposal id: ${e}`);throw new Error(i)}}}class Jz extends xr{constructor(e,i){super(e,i,Rz,Wu),this.core=e,this.logger=i}}let Xz=class extends xr{constructor(t,e){super(t,e,Uz,Wu),this.core=t,this.logger=e}};class e$ extends xr{constructor(e,i){super(e,i,zz,Wu,s=>s.id),this.core=e,this.logger=i}}class t$ extends xr{constructor(e,i){super(e,i,Hz,al,()=>gc),this.core=e,this.logger=i}}class i$ extends xr{constructor(e,i){super(e,i,Vz,al),this.core=e,this.logger=i}}class s$ extends xr{constructor(e,i){super(e,i,Wz,al,s=>s.id),this.core=e,this.logger=i}}var r$=Object.defineProperty,n$=(t,e,i)=>e in t?r$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,eh=(t,e,i)=>n$(t,typeof e!="symbol"?e+"":e,i);class o${constructor(e,i){this.core=e,this.logger=i,eh(this,"authKeys"),eh(this,"pairingTopics"),eh(this,"requests"),this.authKeys=new t$(this.core,this.logger),this.pairingTopics=new i$(this.core,this.logger),this.requests=new s$(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var a$=Object.defineProperty,c$=(t,e,i)=>e in t?a$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,he=(t,e,i)=>c$(t,typeof e!="symbol"?e+"":e,i);let l$=class jv extends j2{constructor(e){super(e),he(this,"protocol",xv),he(this,"version",kv),he(this,"name",Jl.name),he(this,"metadata"),he(this,"core"),he(this,"logger"),he(this,"events",new xt.EventEmitter),he(this,"engine"),he(this,"session"),he(this,"proposal"),he(this,"pendingRequest"),he(this,"auth"),he(this,"signConfig"),he(this,"on",(s,r)=>this.events.on(s,r)),he(this,"once",(s,r)=>this.events.once(s,r)),he(this,"off",(s,r)=>this.events.off(s,r)),he(this,"removeListener",(s,r)=>this.events.removeListener(s,r)),he(this,"removeAllListeners",s=>this.events.removeAllListeners(s)),he(this,"connect",async s=>{try{return await this.engine.connect(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"pair",async s=>{try{return await this.engine.pair(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"approve",async s=>{try{return await this.engine.approve(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"reject",async s=>{try{return await this.engine.reject(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"update",async s=>{try{return await this.engine.update(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"extend",async s=>{try{return await this.engine.extend(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"request",async s=>{try{return await this.engine.request(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"respond",async s=>{try{return await this.engine.respond(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"ping",async s=>{try{return await this.engine.ping(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"emit",async s=>{try{return await this.engine.emit(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"disconnect",async s=>{try{return await this.engine.disconnect(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"find",s=>{try{return this.engine.find(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}}),he(this,"authenticate",async(s,r)=>{try{return await this.engine.authenticate(s,r)}catch(n){throw this.logger.error(n.message),n}}),he(this,"formatAuthMessage",s=>{try{return this.engine.formatAuthMessage(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"approveSessionAuthenticate",async s=>{try{return await this.engine.approveSessionAuthenticate(s)}catch(r){throw this.logger.error(r.message),r}}),he(this,"rejectSessionAuthenticate",async s=>{try{return await this.engine.rejectSessionAuthenticate(s)}catch(r){throw this.logger.error(r.message),r}}),this.name=(e==null?void 0:e.name)||Jl.name,this.metadata=(e==null?void 0:e.metadata)||$y(),this.signConfig=e==null?void 0:e.signConfig;const i=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Vn(ys({level:(e==null?void 0:e.logger)||Jl.logger}));this.core=(e==null?void 0:e.core)||new jz(e),this.logger=Ae(i,this.name),this.session=new Xz(this.core,this.logger),this.proposal=new Jz(this.core,this.logger),this.pendingRequest=new e$(this.core,this.logger),this.engine=new Zz(this),this.auth=new o$(this.core,this.logger)}static async init(e){const i=new jv(e);return await i.initialize(),i}get context(){return qe(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},E.toMiliseconds(E.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Uf="error",h$="wss://relay.walletconnect.org",u$="wc",d$="universal_provider",Qa=`${u$}@2:${d$}:`,Rv="https://rpc.walletconnect.org/v1/",bn="generic",p$=`${Rv}bundler`,Mi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function g$(){}function Ku(t){return t==null||typeof t!="object"&&typeof t!="function"}function Fu(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function f$(t){if(Ku(t))return t;if(Array.isArray(t)||Fu(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),i=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new i(t);if(t instanceof RegExp){const s=new i(t);return s.lastIndex=t.lastIndex,s}if(t instanceof DataView)return new i(t.buffer.slice(0));if(t instanceof Error){const s=new i(t.message);return s.stack=t.stack,s.name=t.name,s.cause=t.cause,s}if(typeof File<"u"&&t instanceof File)return new i([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const s=Object.create(e);return Object.assign(s,t)}return t}function Lf(t){return typeof t=="object"&&t!==null}function Uv(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Lv(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const m$="[object RegExp]",zv="[object String]",$v="[object Number]",qv="[object Boolean]",Bv="[object Arguments]",w$="[object Symbol]",y$="[object Date]",v$="[object Map]",b$="[object Set]",I$="[object Array]",E$="[object ArrayBuffer]",N$="[object Object]",A$="[object DataView]",_$="[object Uint8Array]",C$="[object Uint8ClampedArray]",S$="[object Uint16Array]",P$="[object Uint32Array]",T$="[object Int8Array]",M$="[object Int16Array]",O$="[object Int32Array]",x$="[object Float32Array]",k$="[object Float64Array]";function D$(t,e){return Cn(t,void 0,t,new Map,e)}function Cn(t,e,i,s=new Map,r=void 0){const n=r==null?void 0:r(t,e,i,s);if(n!=null)return n;if(Ku(t))return t;if(s.has(t))return s.get(t);if(Array.isArray(t)){const o=new Array(t.length);s.set(t,o);for(let a=0;a<t.length;a++)o[a]=Cn(t[a],a,i,s,r);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;s.set(t,o);for(const[a,l]of t)o.set(a,Cn(l,a,i,s,r));return o}if(t instanceof Set){const o=new Set;s.set(t,o);for(const a of t)o.add(Cn(a,void 0,i,s,r));return o}if(typeof N.Buffer<"u"&&N.Buffer.isBuffer(t))return t.subarray();if(Fu(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);s.set(t,o);for(let a=0;a<t.length;a++)o[a]=Cn(t[a],a,i,s,r);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return s.set(t,o),ar(o,t,i,s,r),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return s.set(t,o),ar(o,t,i,s,r),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return s.set(t,o),ar(o,t,i,s,r),o}if(t instanceof Error){const o=new t.constructor;return s.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,ar(o,t,i,s,r),o}if(typeof t=="object"&&j$(t)){const o=Object.create(Object.getPrototypeOf(t));return s.set(t,o),ar(o,t,i,s,r),o}return t}function ar(t,e,i=t,s,r){const n=[...Object.keys(e),...Uv(e)];for(let o=0;o<n.length;o++){const a=n[o],l=Object.getOwnPropertyDescriptor(t,a);(l==null||l.writable)&&(t[a]=Cn(e[a],a,i,s,r))}}function j$(t){switch(Lv(t)){case Bv:case I$:case E$:case A$:case qv:case y$:case x$:case k$:case T$:case M$:case O$:case v$:case $v:case N$:case m$:case b$:case zv:case w$:case _$:case C$:case S$:case P$:return!0;default:return!1}}function R$(t,e){return D$(t,(i,s,r,n)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case $v:case zv:case qv:{const o=new t.constructor(t==null?void 0:t.valueOf());return ar(o,t),o}case Bv:{const o={};return ar(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function zf(t){return R$(t)}function $f(t){return t!==null&&typeof t=="object"&&Lv(t)==="[object Arguments]"}function U$(t){return Fu(t)}function L$(t){var e;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const s=t[Symbol.toStringTag];return s==null||!((e=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&e.writable)?!1:t.toString()===`[object ${s}]`}let i=t;for(;Object.getPrototypeOf(i)!==null;)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(t)===i}function z$(t,...e){const i=e.slice(0,-1),s=e[e.length-1];let r=t;for(let n=0;n<i.length;n++){const o=i[n];r=cu(r,o,s,new Map)}return r}function cu(t,e,i,s){if(Ku(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(s.has(e))return f$(s.get(e));if(s.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const r=[...Object.keys(e),...Uv(e)];for(let n=0;n<r.length;n++){const o=r[n];let a=e[o],l=t[o];if($f(a)&&(a={...a}),$f(l)&&(l={...l}),typeof N.Buffer<"u"&&N.Buffer.isBuffer(a)&&(a=zf(a)),Array.isArray(a))if(typeof l=="object"&&l!=null){const h=[],u=Reflect.ownKeys(l);for(let d=0;d<u.length;d++){const p=u[d];h[p]=l[p]}l=h}else l=[];const c=i(l,a,o,t,e,s);c!=null?t[o]=c:Array.isArray(a)||Lf(l)&&Lf(a)?t[o]=cu(l,a,i,s):l==null&&L$(a)?t[o]=cu({},a,i,s):l==null&&U$(a)?t[o]=zf(a):(l===void 0||a!==void 0)&&(t[o]=a)}return t}function $$(t,...e){return z$(t,...e,g$)}var q$=Object.defineProperty,B$=Object.defineProperties,H$=Object.getOwnPropertyDescriptors,qf=Object.getOwnPropertySymbols,V$=Object.prototype.hasOwnProperty,W$=Object.prototype.propertyIsEnumerable,Bf=(t,e,i)=>e in t?q$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Za=(t,e)=>{for(var i in e||(e={}))V$.call(e,i)&&Bf(t,i,e[i]);if(qf)for(var i of qf(e))W$.call(e,i)&&Bf(t,i,e[i]);return t},K$=(t,e)=>B$(t,H$(e));function wi(t,e,i){var s;const r=Mn(t);return((s=e.rpcMap)==null?void 0:s[r.reference])||`${Rv}?chainId=${r.namespace}:${r.reference}&projectId=${i}`}function kr(t){return t.includes(":")?t.split(":")[1]:t}function Hv(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function F$(t,e){const i=Object.keys(e.namespaces).filter(r=>r.includes(t));if(!i.length)return[];const s=[];return i.forEach(r=>{const n=e.namespaces[r].accounts;s.push(...n)}),s}function th(t={},e={}){const i=Hf(t),s=Hf(e);return $$(i,s)}function Hf(t){var e,i,s,r;const n={};if(!ea(t))return n;for(const[o,a]of Object.entries(t)){const l=Hu(o)?[o]:a.chains,c=a.methods||[],h=a.events||[],u=a.rpcMap||{},d=Mo(o);n[d]=K$(Za(Za({},n[d]),a),{chains:hc(l,(e=n[d])==null?void 0:e.chains),methods:hc(c,(i=n[d])==null?void 0:i.methods),events:hc(h,(s=n[d])==null?void 0:s.events),rpcMap:Za(Za({},u),(r=n[d])==null?void 0:r.rpcMap)})}return n}function G$(t){return t.includes(":")?t.split(":")[2]:t}function Vf(t){const e={};for(const[i,s]of Object.entries(t)){const r=s.methods||[],n=s.events||[],o=s.accounts||[],a=Hu(i)?[i]:s.chains?s.chains:Hv(s.accounts);e[i]={chains:a,methods:r,events:n,accounts:o}}return e}function ih(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}const Vv={},ye=t=>Vv[t],sh=(t,e)=>{Vv[t]=e};var Y$=Object.defineProperty,Q$=(t,e,i)=>e in t?Y$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,rn=(t,e,i)=>Q$(t,typeof e!="symbol"?e+"":e,i);class Z${constructor(e){rn(this,"name","polkadot"),rn(this,"client"),rn(this,"httpProviders"),rn(this,"events"),rn(this,"namespace"),rn(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=kr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var J$=Object.defineProperty,X$=Object.defineProperties,e8=Object.getOwnPropertyDescriptors,Wf=Object.getOwnPropertySymbols,t8=Object.prototype.hasOwnProperty,i8=Object.prototype.propertyIsEnumerable,lu=(t,e,i)=>e in t?J$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Kf=(t,e)=>{for(var i in e||(e={}))t8.call(e,i)&&lu(t,i,e[i]);if(Wf)for(var i of Wf(e))i8.call(e,i)&&lu(t,i,e[i]);return t},Ff=(t,e)=>X$(t,e8(e)),nn=(t,e,i)=>lu(t,typeof e!="symbol"?e+"":e,i);class s8{constructor(e){nn(this,"name","eip155"),nn(this,"client"),nn(this,"chainId"),nn(this,"namespace"),nn(this,"httpProviders"),nn(this,"events"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(parseInt(e),i),this.chainId=parseInt(e),this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,i){const s=i||wi(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=parseInt(kr(i));e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}async handleSwitchChain(e){var i,s;let r=e.request.params?(i=e.request.params[0])==null?void 0:i.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;const n=parseInt(r,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var i,s,r;const n=(s=(i=e.request)==null?void 0:i.params)==null?void 0:s[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const o=this.client.session.get(e.topic),a=((r=o==null?void 0:o.sessionProperties)==null?void 0:r.capabilities)||{};if(a!=null&&a[n])return a==null?void 0:a[n];const l=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Ff(Kf({},o.sessionProperties||{}),{capabilities:Ff(Kf({},a||{}),{[n]:l})})})}catch(c){console.warn("Failed to update session with capabilities",c)}return l}async getCallStatus(e){var i,s;const r=this.client.session.get(e.topic),n=(i=r.sessionProperties)==null?void 0:i.bundler_name;if(n){const a=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from bundler",l,a)}}const o=(s=r.sessionProperties)==null?void 0:s.bundler_url;if(o)try{return await this.getUserOperationReceipt(o,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,i){var s;const r=new URL(e),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Kt("eth_getUserOperationReceipt",[(s=i.request.params)==null?void 0:s[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,i){return`${p$}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${i}`}}var r8=Object.defineProperty,n8=(t,e,i)=>e in t?r8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,on=(t,e,i)=>n8(t,typeof e!="symbol"?e+"":e,i);class o8{constructor(e){on(this,"name","solana"),on(this,"client"),on(this,"httpProviders"),on(this,"events"),on(this,"namespace"),on(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=kr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var a8=Object.defineProperty,c8=(t,e,i)=>e in t?a8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,an=(t,e,i)=>c8(t,typeof e!="symbol"?e+"":e,i);class l8{constructor(e){an(this,"name","cosmos"),an(this,"client"),an(this,"httpProviders"),an(this,"events"),an(this,"namespace"),an(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=kr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var h8=Object.defineProperty,u8=(t,e,i)=>e in t?h8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,cn=(t,e,i)=>u8(t,typeof e!="symbol"?e+"":e,i);class d8{constructor(e){cn(this,"name","algorand"),cn(this,"client"),cn(this,"httpProviders"),cn(this,"events"),cn(this,"namespace"),cn(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){if(!this.httpProviders[e]){const s=i||wi(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new Ye(new tt(s,ye("disableProviderPing")))}}var p8=Object.defineProperty,g8=(t,e,i)=>e in t?p8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ln=(t,e,i)=>g8(t,typeof e!="symbol"?e+"":e,i);class f8{constructor(e){ln(this,"name","cip34"),ln(this,"client"),ln(this,"httpProviders"),ln(this,"events"),ln(this,"namespace"),ln(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{const s=this.getCardanoRPCUrl(i),r=kr(i);e[r]=this.createHttpProvider(r,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}getCardanoRPCUrl(e){const i=this.namespace.rpcMap;if(i)return i[e]}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var m8=Object.defineProperty,w8=(t,e,i)=>e in t?m8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,hn=(t,e,i)=>w8(t,typeof e!="symbol"?e+"":e,i);class y8{constructor(e){hn(this,"name","elrond"),hn(this,"client"),hn(this,"httpProviders"),hn(this,"events"),hn(this,"namespace"),hn(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=kr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var v8=Object.defineProperty,b8=(t,e,i)=>e in t?v8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,un=(t,e,i)=>b8(t,typeof e!="symbol"?e+"":e,i);class I8{constructor(e){un(this,"name","multiversx"),un(this,"client"),un(this,"httpProviders"),un(this,"events"),un(this,"namespace"),un(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;const r=kr(i);e[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var E8=Object.defineProperty,N8=(t,e,i)=>e in t?E8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,dn=(t,e,i)=>N8(t,typeof e!="symbol"?e+"":e,i);class A8{constructor(e){dn(this,"name","near"),dn(this,"client"),dn(this,"httpProviders"),dn(this,"events"),dn(this,"namespace"),dn(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||wi(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{var s;e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[i])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace);return typeof s>"u"?void 0:new Ye(new tt(s,ye("disableProviderPing")))}}var _8=Object.defineProperty,C8=(t,e,i)=>e in t?_8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,pn=(t,e,i)=>C8(t,typeof e!="symbol"?e+"":e,i);class S8{constructor(e){pn(this,"name","tezos"),pn(this,"client"),pn(this,"httpProviders"),pn(this,"events"),pn(this,"namespace"),pn(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,i){if(this.chainId=e,!this.httpProviders[e]){const s=i||wi(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(i=>{e[i]=this.createHttpProvider(i)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace);return typeof s>"u"?void 0:new Ye(new tt(s))}}var P8=Object.defineProperty,T8=(t,e,i)=>e in t?P8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,gn=(t,e,i)=>T8(t,typeof e!="symbol"?e+"":e,i);class M8{constructor(e){gn(this,"name",bn),gn(this,"client"),gn(this,"httpProviders"),gn(this,"events"),gn(this,"namespace"),gn(this,"chainId"),this.namespace=e.namespace,this.events=ye("events"),this.client=ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,i){this.httpProviders[e]||this.setHttpProvider(e,i),this.chainId=e,this.events.emit(Mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){var e,i;const s={};return(i=(e=this.namespace)==null?void 0:e.accounts)==null||i.forEach(r=>{const n=Mn(r);s[`${n.namespace}:${n.reference}`]=this.createHttpProvider(r)}),s}getHttpProvider(e){const i=this.httpProviders[e];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,i){const s=this.createHttpProvider(e,i);s&&(this.httpProviders[e]=s)}createHttpProvider(e,i){const s=i||wi(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ye(new tt(s,ye("disableProviderPing")))}}var O8=Object.defineProperty,x8=Object.defineProperties,k8=Object.getOwnPropertyDescriptors,Gf=Object.getOwnPropertySymbols,D8=Object.prototype.hasOwnProperty,j8=Object.prototype.propertyIsEnumerable,hu=(t,e,i)=>e in t?O8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ja=(t,e)=>{for(var i in e||(e={}))D8.call(e,i)&&hu(t,i,e[i]);if(Gf)for(var i of Gf(e))j8.call(e,i)&&hu(t,i,e[i]);return t},rh=(t,e)=>x8(t,k8(e)),Ni=(t,e,i)=>hu(t,typeof e!="symbol"?e+"":e,i);let R8=class Wv{constructor(e){Ni(this,"client"),Ni(this,"namespaces"),Ni(this,"optionalNamespaces"),Ni(this,"sessionProperties"),Ni(this,"scopedProperties"),Ni(this,"events",new Hn),Ni(this,"rpcProviders",{}),Ni(this,"session"),Ni(this,"providerOpts"),Ni(this,"logger"),Ni(this,"uri"),Ni(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Vn(ys({level:(e==null?void 0:e.logger)||Uf})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const i=new Wv(e);return await i.initialize(),i}async request(e,i,s){const[r,n]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:Ja({},e),chainId:`${r}:${n}`,topic:this.session.topic,expiry:s})}sendAsync(e,i,s,r){const n=new Date().getTime();this.request(e,s,r).then(o=>i(null,Ws(n,o))).catch(o=>i(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Oe("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,i){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:s,response:r}=await this.client.authenticate(e,i);s&&(this.uri=s,this.events.emit("display_uri",s));const n=await r();if(this.session=n.session,this.session){const o=Vf(this.session.namespaces);this.namespaces=th(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}removeListener(e,i){this.events.removeListener(e,i)}off(e,i){this.events.off(e,i)}get isWalletConnect(){return!0}async pair(e){const{uri:i,approval:s}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});i&&(this.uri=i,this.events.emit("display_uri",i));const r=await s();this.session=r;const n=Vf(r.namespaces);return this.namespaces=th(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,i){try{if(!this.session)return;const[s,r]=this.validateChain(e),n=this.getProvider(s);n.name===bn?n.setDefaultChain(`${s}:${r}`,i):n.setDefaultChain(r,i)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(Ir(i)){for(const s of i)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,i;if(this.client=this.providerOpts.client||await l$.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Uf,relayUrl:this.providerOpts.relayUrl||h$,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(s){throw this.logger.error("Failed to get session",s),new Error(`The provided session: ${(i=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:i.topic} doesn't exist in the Sign client`)}else{const s=this.client.session.getAll();this.session=s[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(i=>Mo(i)))];sh("client",this.client),sh("events",this.events),sh("disableProviderPing",this.disableProviderPing),e.forEach(i=>{if(!this.session)return;const s=F$(i,this.session),r=Hv(s),n=th(this.namespaces,this.optionalNamespaces),o=rh(Ja({},n[i]),{accounts:s,chains:r});switch(i){case"eip155":this.rpcProviders[i]=new s8({namespace:o});break;case"algorand":this.rpcProviders[i]=new d8({namespace:o});break;case"solana":this.rpcProviders[i]=new o8({namespace:o});break;case"cosmos":this.rpcProviders[i]=new l8({namespace:o});break;case"polkadot":this.rpcProviders[i]=new Z$({namespace:o});break;case"cip34":this.rpcProviders[i]=new f8({namespace:o});break;case"elrond":this.rpcProviders[i]=new y8({namespace:o});break;case"multiversx":this.rpcProviders[i]=new I8({namespace:o});break;case"near":this.rpcProviders[i]=new A8({namespace:o});break;case"tezos":this.rpcProviders[i]=new S8({namespace:o});break;default:this.rpcProviders[bn]?this.rpcProviders[bn].updateNamespace(o):this.rpcProviders[bn]=new M8({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var i;const{topic:s}=e;s===((i=this.session)==null?void 0:i.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var i;const{params:s,topic:r}=e;if(r!==((i=this.session)==null?void 0:i.topic))return;const{event:n}=s;if(n.name==="accountsChanged"){const o=n.data;o&&Ir(o)&&this.events.emit("accountsChanged",o.map(G$))}else if(n.name==="chainChanged"){const o=s.chainId,a=s.event.data,l=Mo(o),c=ih(o)!==ih(a)?`${l}:${ih(a)}`:o;this.onChainChanged(c)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:i})=>{var s,r;if(e!==((s=this.session)==null?void 0:s.topic))return;const{namespaces:n}=i,o=(r=this.client)==null?void 0:r.session.get(e);this.session=rh(Ja({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:i})}),this.client.on("session_delete",async e=>{var i;e.topic===((i=this.session)==null?void 0:i.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",rh(Ja({},Oe("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Mi.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[bn]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var i;this.getProvider(e).updateNamespace((i=this.session)==null?void 0:i.namespaces[e])})}setNamespaces(e){const{namespaces:i,optionalNamespaces:s,sessionProperties:r,scopedProperties:n}=e;i&&Object.keys(i).length&&(this.namespaces=i),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=r,this.scopedProperties=n}validateChain(e){const[i,s]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,s];if(i&&!Object.keys(this.namespaces||{}).map(o=>Mo(o)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&s)return[i,s];const r=Mo(Object.keys(this.namespaces)[0]),n=this.rpcProviders[r].getDefaultChain();return[r,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e,i=!1){if(!this.namespaces)return;const[s,r]=this.validateChain(e);r&&(i||this.getProvider(s).setDefaultChain(r),this.namespaces[s]?this.namespaces[s].defaultChain=r:this.namespaces[`${s}:${r}`]?this.namespaces[`${s}:${r}`].defaultChain=r:this.namespaces[`${s}:${r}`]={defaultChain:r},this.events.emit("chainChanged",r),await this.persist("namespaces",this.namespaces))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,i){var s;const r=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.setItem(`${Qa}/${e}${r}`,i)}async getFromStore(e){var i;const s=((i=this.session)==null?void 0:i.topic)||"";return await this.client.core.storage.getItem(`${Qa}/${e}${s}`)}async deleteFromStore(e){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.removeItem(`${Qa}/${e}${s}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const i=await this.client.core.storage.getKeys();for(const s of i)s.startsWith(Qa)&&await this.client.core.storage.removeItem(s)}catch(i){this.logger.warn("Failed to cleanup storage",i)}}};const _s={EIP155:"eip155",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED"},Dc={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[Y.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[Y.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[Y.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[Y.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[Y.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[Y.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[Y.CONNECTOR_ID.INJECTED]:"Browser Wallet",[Y.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[Y.CONNECTOR_ID.COINBASE]:"Coinbase",[Y.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[Y.CONNECTOR_ID.LEDGER]:"Ledger",[Y.CONNECTOR_ID.SAFE]:"Safe"}},Kv={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([i,s])=>{e[`${_s.EIP155}:${i}`]=s}),e},isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())}},Xa={UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"INVALID_APP_CONFIGURATION"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:"Network Not Found",longMessage:"Network not found - please make sure it is included in 'networks' array in createAppKit function"},INVALID_APP_CONFIGURATION:{shortMessage:"Invalid App Configuration",longMessage:()=>`Origin ${U8()?window.origin:"unknown"} not found on Allowlist - update configuration on cloud.reown.com`},SOCIALS_TIMEOUT:{shortMessage:"Invalid App Configuration",longMessage:()=>"There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com"},JWT_TOKEN_NOT_VALID:{shortMessage:"Session Expired",longMessage:"Invalid session found on UniversalProvider - please check your time settings and connect again"},INVALID_PROJECT_ID:{shortMessage:"Invalid App Configuration",longMessage:"Invalid Project ID - update configuration"},PROJECT_ID_NOT_CONFIGURED:{shortMessage:"Project ID Not Configured",longMessage:"Project ID Not Configured - update configuration on cloud.reown.com"}}};function U8(){return typeof window<"u"}const L8={createLogger(t,e="error"){const i=ys({level:e}),{logger:s}=yu({opts:i});return s.error=(...r)=>{for(const n of r)if(n instanceof Error){t(n,...r);return}t(void 0,...r)},s}},z8="rpc.walletconnect.org";function $8(t,e){const i=new URL("https://rpc.walletconnect.org/v1/");return i.searchParams.set("chainId",t),i.searchParams.set("projectId",e),i.toString()}const nh=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],In={extendRpcUrlWithProjectId(t,e){let i=!1;try{i=new URL(t).host===z8}catch{i=!1}if(i){const s=new URL(t);return s.searchParams.has("projectId")||s.searchParams.set("projectId",e),s.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:Y.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${Y.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,i){var s,r,n;const o=(n=(r=(s=t.rpcUrls)==null?void 0:s.default)==null?void 0:r.http)==null?void 0:n[0];return nh.includes(e)?$8(e,i):o||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:i,customRpcUrls:s}){var r,n,o,a,l;const c=this.getChainNamespace(t),h=this.getCaipNetworkId(t),u=(r=t.rpcUrls.default.http)==null?void 0:r[0],d=this.getDefaultRpcUrl(t,h,i),p=((a=(o=(n=t==null?void 0:t.rpcUrls)==null?void 0:n.chainDefault)==null?void 0:o.http)==null?void 0:a[0])||u,g=((l=s==null?void 0:s[h])==null?void 0:l.map(m=>m.url))||[],f=[...g,d],w=[...g];return p&&!w.includes(p)&&w.push(p),{...t,chainNamespace:c,caipNetworkId:h,assets:{imageId:Dc.NetworkImageIds[t.id],imageUrl:e==null?void 0:e[t.id]},rpcUrls:{...t.rpcUrls,default:{http:f},chainDefault:{http:w}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:i,customRpcUrls:s}){return t.map(r=>In.extendCaipNetwork(r,{customNetworkImageUrls:e,customRpcUrls:s,projectId:i}))},getViemTransport(t,e,i){const s=[];if(i==null||i.forEach(r=>{s.push(ll(r.url,r.config))}),nh.includes(t.caipNetworkId)){const r=this.getDefaultRpcUrl(t,t.caipNetworkId,e);s.push(ll(r,{fetchOptions:{headers:{"Content-Type":"text/plain"}}}))}return id(s)},extendWagmiTransports(t,e,i){if(nh.includes(t.caipNetworkId)){const s=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return id([i,ll(s)])}return i},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:Y.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){var e;const i=G.getActiveCaipNetworkId(),s=b.getAllRequestedCaipNetworks(),r=Array.from(((e=b.state.chains)==null?void 0:e.keys())||[]),n=i==null?void 0:i.split(":")[0],o=n?r.includes(n):!1,a=s==null?void 0:s.find(l=>l.caipNetworkId===i);return o&&!a&&i?this.getUnsupportedNetwork(i):a||t||(s==null?void 0:s[0])}},jc={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0},Jt=Je({providers:{...jc},providerIds:{...jc}}),Ze={state:Jt,subscribeKey(t,e){return vi(Jt,t,e)},subscribe(t){return Ft(Jt,()=>{t(Jt)})},subscribeProviders(t){return Ft(Jt.providers,()=>t(Jt.providers))},setProvider(t,e){e&&(Jt.providers[t]=wr(e))},getProvider(t){return Jt.providers[t]},setProviderId(t,e){e&&(Jt.providerIds[t]=e)},getProviderId(t){if(t)return Jt.providerIds[t]},reset(){Jt.providers={...jc},Jt.providerIds={...jc}},resetChain(t){Jt.providers[t]=void 0,Jt.providerIds[t]=void 0}},q8={SECURE_SITE_ORIGIN:(typeof N.process<"u"&&typeof N.process.env<"u"?N.process.env.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120,ModalHeight:150,ViewTransition:150}},uu={filterOutDuplicatesByRDNS(t){const e=D.state.enableEIP6963?te.state.connectors:[],i=G.getRecentWallets(),s=e.map(o=>{var a;return(a=o.info)==null?void 0:a.rdns}).filter(Boolean),r=i.map(o=>o.rdns).filter(Boolean),n=s.concat(r);if(n.includes("io.metamask.mobile")&&ie.isMobile()){const o=n.indexOf("io.metamask.mobile");n[o]="io.metamask"}return t.filter(o=>!n.includes(String(o==null?void 0:o.rdns)))},filterOutDuplicatesByIds(t){const e=te.state.connectors.filter(o=>o.type==="ANNOUNCED"||o.type==="INJECTED"),i=G.getRecentWallets(),s=e.map(o=>o.explorerId),r=i.map(o=>o.id),n=s.concat(r);return t.filter(o=>!n.includes(o==null?void 0:o.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=te.state,i=e.filter(s=>s.type==="ANNOUNCED").reduce((s,r)=>{var n;return(n=r.info)!=null&&n.rdns&&(s[r.info.rdns]=!0),s},{});return t.map(s=>({...s,installed:!!s.rdns&&!!i[s.rdns??""]})).sort((s,r)=>Number(r.installed)-Number(s.installed))},getConnectOrderMethod(t,e){var i;const s=(t==null?void 0:t.connectMethodsOrder)||((i=D.state.features)==null?void 0:i.connectMethodsOrder),r=e||te.state.connectors;if(s)return s;const{injected:n,announced:o}=fc.getConnectorsByType(r,se.state.recommended,se.state.featured),a=n.filter(fc.showConnector),l=o.filter(fc.showConnector);return a.length||l.length?["wallet","email","social"]:q8.DEFAULT_CONNECT_METHOD_ORDER}},fc={getConnectorsByType(t,e,i){const{customWallets:s}=D.state,r=G.getRecentWallets(),n=uu.filterOutDuplicateWallets(e),o=uu.filterOutDuplicateWallets(i),a=t.filter(u=>u.type==="MULTI_CHAIN"),l=t.filter(u=>u.type==="ANNOUNCED"),c=t.filter(u=>u.type==="INJECTED"),h=t.filter(u=>u.type==="EXTERNAL");return{custom:s,recent:r,external:h,multiChain:a,announced:l,injected:c,recommended:n,featured:o}},showConnector(t){var e;const i=(e=t.info)==null?void 0:e.rdns,s=!!i&&se.state.excludedWallets.some(n=>n.rdns===i),r=!!t.name&&se.state.excludedWallets.some(n=>Kv.isLowerCaseMatch(n.name,t.name));return!(t.type==="INJECTED"&&(!ie.isMobile()&&t.name==="Browser Wallet"||!i&&!Le.checkInstalled()||s||r)||t.type==="ANNOUNCED"&&(s||r))},getIsConnectedWithWC(){return Array.from(b.state.chains.values()).some(t=>te.getConnectorId(t.namespace)===Y.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:i,recent:s,announced:r,injected:n,multiChain:o,external:a,overriddenConnectors:l=(c=>(c=D.state.features)==null?void 0:c.connectorTypeOrder)()??[]}){const c=fc.getIsConnectedWithWC(),h=[{type:"walletConnect",isEnabled:D.state.enableWalletConnect&&!c},{type:"recent",isEnabled:s.length>0},{type:"injected",isEnabled:[...n,...r,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:i&&i.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(g=>g.isEnabled),u=new Set(h.map(g=>g.type)),d=l.filter(g=>u.has(g)).map(g=>({type:g,isEnabled:!0})),p=h.filter(({type:g})=>!d.some(({type:f})=>f===g));return Array.from(new Set([...d,...p].map(({type:g})=>g)))}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const mc=globalThis,Gu=mc.ShadowRoot&&(mc.ShadyCSS===void 0||mc.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Yu=Symbol(),Yf=new WeakMap;let Fv=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==Yu)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(Gu&&t===void 0){const i=e!==void 0&&e.length===1;i&&(t=Yf.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&Yf.set(e,t))}return t}toString(){return this.cssText}};const Ai=t=>new Fv(typeof t=="string"?t:t+"",void 0,Yu),On=(t,...e)=>{const i=t.length===1?t[0]:e.reduce((s,r,n)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+t[n+1],t[0]);return new Fv(i,t,Yu)},B8=(t,e)=>{if(Gu)t.adoptedStyleSheets=e.map(i=>i instanceof CSSStyleSheet?i:i.styleSheet);else for(const i of e){const s=document.createElement("style"),r=mc.litNonce;r!==void 0&&s.setAttribute("nonce",r),s.textContent=i.cssText,t.appendChild(s)}},Qf=Gu?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let i="";for(const s of e.cssRules)i+=s.cssText;return Ai(i)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:H8,defineProperty:V8,getOwnPropertyDescriptor:W8,getOwnPropertyNames:K8,getOwnPropertySymbols:F8,getPrototypeOf:G8}=Object,$n=globalThis,Zf=$n.trustedTypes,Y8=Zf?Zf.emptyScript:"",Jf=$n.reactiveElementPolyfillSupport,zo=(t,e)=>t,du={toAttribute(t,e){switch(e){case Boolean:t=t?Y8:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=t!==null;break;case Number:i=t===null?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch{i=null}}return i}},Gv=(t,e)=>!H8(t,e),Xf={attribute:!0,type:String,converter:du,reflect:!1,useDefault:!1,hasChanged:Gv};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),$n.litPropertyMetadata??($n.litPropertyMetadata=new WeakMap);let En=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Xf){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(t,i,e);s!==void 0&&V8(this.prototype,t,s)}}static getPropertyDescriptor(t,e,i){const{get:s,set:r}=W8(this.prototype,t)??{get(){return this[e]},set(n){this[e]=n}};return{get:s,set(n){const o=s==null?void 0:s.call(this);r==null||r.call(this,n),this.requestUpdate(t,o,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Xf}static _$Ei(){if(this.hasOwnProperty(zo("elementProperties")))return;const t=G8(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(zo("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(zo("properties"))){const e=this.properties,i=[...K8(e),...F8(e)];for(const s of i)this.createProperty(s,e[s])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[i,s]of e)this.elementProperties.set(i,s)}this._$Eh=new Map;for(const[e,i]of this.elementProperties){const s=this._$Eu(e,i);s!==void 0&&this._$Eh.set(s,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const s of i)e.unshift(Qf(s))}else t!==void 0&&e.push(Qf(t));return e}static _$Eu(t,e){const i=e.attribute;return i===!1?void 0:typeof i=="string"?i:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return B8(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostConnected)==null?void 0:i.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var i;return(i=e.hostDisconnected)==null?void 0:i.call(e)})}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$ET(t,e){var i;const s=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,s);if(r!==void 0&&s.reflect===!0){const n=(((i=s.converter)==null?void 0:i.toAttribute)!==void 0?s.converter:du).toAttribute(e,s.type);this._$Em=t,n==null?this.removeAttribute(r):this.setAttribute(r,n),this._$Em=null}}_$AK(t,e){var i,s;const r=this.constructor,n=r._$Eh.get(t);if(n!==void 0&&this._$Em!==n){const o=r.getPropertyOptions(n),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:du;this._$Em=n,this[n]=a.fromAttribute(e,o.type)??((s=this._$Ej)==null?void 0:s.get(n))??null,this._$Em=null}}requestUpdate(t,e,i){var s;if(t!==void 0){const r=this.constructor,n=this[t];if(i??(i=r.getPropertyOptions(t)),!((i.hasChanged??Gv)(n,e)||i.useDefault&&i.reflect&&n===((s=this._$Ej)==null?void 0:s.get(t))&&!this.hasAttribute(r._$Eu(t,i))))return;this.C(t,e,i)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,e,{useDefault:i,reflect:s,wrapped:r},n){i&&!(this._$Ej??(this._$Ej=new Map)).has(t)&&(this._$Ej.set(t,n??e??this[t]),r!==!0||n!==void 0)||(this._$AL.has(t)||(this.hasUpdated||i||(e=void 0),this._$AL.set(t,e)),s===!0&&this._$Em!==t&&(this._$Eq??(this._$Eq=new Set)).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[r,n]of this._$Ep)this[r]=n;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[r,n]of s){const{wrapped:o}=n,a=this[r];o!==!0||this._$AL.has(r)||a===void 0||this.C(r,void 0,n,a)}}let e=!1;const i=this._$AL;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),(t=this._$EO)==null||t.forEach(s=>{var r;return(r=s.hostUpdate)==null?void 0:r.call(s)}),this.update(i)):this._$EM()}catch(s){throw e=!1,this._$EM(),s}e&&this._$AE(i)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(i=>{var s;return(s=i.hostUpdated)==null?void 0:s.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(t){}firstUpdated(t){}};En.elementStyles=[],En.shadowRootOptions={mode:"open"},En[zo("elementProperties")]=new Map,En[zo("finalized")]=new Map,Jf==null||Jf({ReactiveElement:En}),($n.reactiveElementVersions??($n.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Rc=globalThis,Uc=Rc.trustedTypes,em=Uc?Uc.createPolicy("lit-html",{createHTML:t=>t}):void 0,Yv="$lit$",ks=`lit$${Math.random().toFixed(9).slice(2)}$`,Qv="?"+ks,Q8=`<${Qv}>`,Er=document,ta=()=>Er.createComment(""),ia=t=>t===null||typeof t!="object"&&typeof t!="function",Qu=Array.isArray,Z8=t=>Qu(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",oh=`[ 	
\f\r]`,Ao=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,tm=/-->/g,im=/>/g,er=RegExp(`>|${oh}(?:([^\\s"'>=/]+)(${oh}*=${oh}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),sm=/'/g,rm=/"/g,Zv=/^(?:script|style|textarea|title)$/i,Jv=t=>(e,...i)=>({_$litType$:t,strings:e,values:i}),Xq=Jv(1),e6=Jv(2),qn=Symbol.for("lit-noChange"),Et=Symbol.for("lit-nothing"),nm=new WeakMap,ur=Er.createTreeWalker(Er,129);function Xv(t,e){if(!Qu(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return em!==void 0?em.createHTML(e):e}const J8=(t,e)=>{const i=t.length-1,s=[];let r,n=e===2?"<svg>":e===3?"<math>":"",o=Ao;for(let a=0;a<i;a++){const l=t[a];let c,h,u=-1,d=0;for(;d<l.length&&(o.lastIndex=d,h=o.exec(l),h!==null);)d=o.lastIndex,o===Ao?h[1]==="!--"?o=tm:h[1]!==void 0?o=im:h[2]!==void 0?(Zv.test(h[2])&&(r=RegExp("</"+h[2],"g")),o=er):h[3]!==void 0&&(o=er):o===er?h[0]===">"?(o=r??Ao,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?er:h[3]==='"'?rm:sm):o===rm||o===sm?o=er:o===tm||o===im?o=Ao:(o=er,r=void 0);const p=o===er&&t[a+1].startsWith("/>")?" ":"";n+=o===Ao?l+Q8:u>=0?(s.push(c),l.slice(0,u)+Yv+l.slice(u)+ks+p):l+ks+(u===-2?a:p)}return[Xv(t,n+(t[i]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),s]};class sa{constructor({strings:e,_$litType$:i},s){let r;this.parts=[];let n=0,o=0;const a=e.length-1,l=this.parts,[c,h]=J8(e,i);if(this.el=sa.createElement(c,s),ur.currentNode=this.el.content,i===2||i===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=ur.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(Yv)){const d=h[o++],p=r.getAttribute(u).split(ks),g=/([.?@])?(.*)/.exec(d);l.push({type:1,index:n,name:g[2],strings:p,ctor:g[1]==="."?eq:g[1]==="?"?tq:g[1]==="@"?iq:cl}),r.removeAttribute(u)}else u.startsWith(ks)&&(l.push({type:6,index:n}),r.removeAttribute(u));if(Zv.test(r.tagName)){const u=r.textContent.split(ks),d=u.length-1;if(d>0){r.textContent=Uc?Uc.emptyScript:"";for(let p=0;p<d;p++)r.append(u[p],ta()),ur.nextNode(),l.push({type:2,index:++n});r.append(u[d],ta())}}}else if(r.nodeType===8)if(r.data===Qv)l.push({type:2,index:n});else{let u=-1;for(;(u=r.data.indexOf(ks,u+1))!==-1;)l.push({type:7,index:n}),u+=ks.length-1}n++}}static createElement(e,i){const s=Er.createElement("template");return s.innerHTML=e,s}}function Bn(t,e,i=t,s){var r,n;if(e===qn)return e;let o=s!==void 0?(r=i._$Co)==null?void 0:r[s]:i._$Cl;const a=ia(e)?void 0:e._$litDirective$;return(o==null?void 0:o.constructor)!==a&&((n=o==null?void 0:o._$AO)==null||n.call(o,!1),a===void 0?o=void 0:(o=new a(t),o._$AT(t,i,s)),s!==void 0?(i._$Co??(i._$Co=[]))[s]=o:i._$Cl=o),o!==void 0&&(e=Bn(t,o._$AS(t,e.values),o,s)),e}class X8{constructor(e,i){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=i}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:i},parts:s}=this._$AD,r=((e==null?void 0:e.creationScope)??Er).importNode(i,!0);ur.currentNode=r;let n=ur.nextNode(),o=0,a=0,l=s[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Aa(n,n.nextSibling,this,e):l.type===1?c=new l.ctor(n,l.name,l.strings,this,e):l.type===6&&(c=new sq(n,this,e)),this._$AV.push(c),l=s[++a]}o!==(l==null?void 0:l.index)&&(n=ur.nextNode(),o++)}return ur.currentNode=Er,r}p(e){let i=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(e,s,i),i+=s.strings.length-2):s._$AI(e[i])),i++}}class Aa{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,i,s,r){this.type=2,this._$AH=Et,this._$AN=void 0,this._$AA=e,this._$AB=i,this._$AM=s,this.options=r,this._$Cv=(r==null?void 0:r.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const i=this._$AM;return i!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=i.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,i=this){e=Bn(this,e,i),ia(e)?e===Et||e==null||e===""?(this._$AH!==Et&&this._$AR(),this._$AH=Et):e!==this._$AH&&e!==qn&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):Z8(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Et&&ia(this._$AH)?this._$AA.nextSibling.data=e:this.T(Er.createTextNode(e)),this._$AH=e}$(e){var i;const{values:s,_$litType$:r}=e,n=typeof r=="number"?this._$AC(e):(r.el===void 0&&(r.el=sa.createElement(Xv(r.h,r.h[0]),this.options)),r);if(((i=this._$AH)==null?void 0:i._$AD)===n)this._$AH.p(s);else{const o=new X8(n,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(e){let i=nm.get(e.strings);return i===void 0&&nm.set(e.strings,i=new sa(e)),i}k(e){Qu(this._$AH)||(this._$AH=[],this._$AR());const i=this._$AH;let s,r=0;for(const n of e)r===i.length?i.push(s=new Aa(this.O(ta()),this.O(ta()),this,this.options)):s=i[r],s._$AI(n),r++;r<i.length&&(this._$AR(s&&s._$AB.nextSibling,r),i.length=r)}_$AR(e=this._$AA.nextSibling,i){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,i);e&&e!==this._$AB;){const r=e.nextSibling;e.remove(),e=r}}setConnected(e){var i;this._$AM===void 0&&(this._$Cv=e,(i=this._$AP)==null||i.call(this,e))}}class cl{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,i,s,r,n){this.type=1,this._$AH=Et,this._$AN=void 0,this.element=e,this.name=i,this._$AM=r,this.options=n,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Et}_$AI(e,i=this,s,r){const n=this.strings;let o=!1;if(n===void 0)e=Bn(this,e,i,0),o=!ia(e)||e!==this._$AH&&e!==qn,o&&(this._$AH=e);else{const a=e;let l,c;for(e=n[0],l=0;l<n.length-1;l++)c=Bn(this,a[s+l],i,l),c===qn&&(c=this._$AH[l]),o||(o=!ia(c)||c!==this._$AH[l]),c===Et?e=Et:e!==Et&&(e+=(c??"")+n[l+1]),this._$AH[l]=c}o&&!r&&this.j(e)}j(e){e===Et?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class eq extends cl{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Et?void 0:e}}class tq extends cl{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Et)}}class iq extends cl{constructor(e,i,s,r,n){super(e,i,s,r,n),this.type=5}_$AI(e,i=this){if((e=Bn(this,e,i,0)??Et)===qn)return;const s=this._$AH,r=e===Et&&s!==Et||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,n=e!==Et&&(s===Et||r);r&&this.element.removeEventListener(this.name,this,s),n&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var i;typeof this._$AH=="function"?this._$AH.call(((i=this.options)==null?void 0:i.host)??this.element,e):this._$AH.handleEvent(e)}}class sq{constructor(e,i,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=i,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Bn(this,e)}}const om=Rc.litHtmlPolyfillSupport;om==null||om(sa,Aa),(Rc.litHtmlVersions??(Rc.litHtmlVersions=[])).push("3.3.0");const rq=(t,e,i)=>{const s=(i==null?void 0:i.renderBefore)??e;let r=s._$litPart$;if(r===void 0){const n=(i==null?void 0:i.renderBefore)??null;s._$litPart$=r=new Aa(e.insertBefore(ta(),n),n,void 0,i??{})}return r._$AI(t),r};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ra=globalThis;class wc extends En{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e;const i=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=i.firstChild),i}update(e){const i=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=rq(i,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return qn}}var am;wc._$litElement$=!0,wc.finalized=!0,(am=ra.litElementHydrateSupport)==null||am.call(ra,{LitElement:wc});const cm=ra.litElementPolyfillSupport;cm==null||cm({LitElement:wc});(ra.litElementVersions??(ra.litElementVersions=[])).push("4.2.0");let $o,Bs,Hs;function t6(t,e){$o=document.createElement("style"),Bs=document.createElement("style"),Hs=document.createElement("style"),$o.textContent=xn(t).core.cssText,Bs.textContent=xn(t).dark.cssText,Hs.textContent=xn(t).light.cssText,document.head.appendChild($o),document.head.appendChild(Bs),document.head.appendChild(Hs),eb(e)}function eb(t){Bs&&Hs&&(t==="light"?(Bs.removeAttribute("media"),Hs.media="enabled"):(Hs.removeAttribute("media"),Bs.media="enabled"))}function nq(t){$o&&Bs&&Hs&&($o.textContent=xn(t).core.cssText,Bs.textContent=xn(t).dark.cssText,Hs.textContent=xn(t).light.cssText)}function xn(t){return{core:On`
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --w3m-modal-width: 360px;
        --w3m-color-mix-strength: ${Ai(t!=null&&t["--w3m-color-mix-strength"]?`${t["--w3m-color-mix-strength"]}%`:"0%")};
        --w3m-font-family: ${Ai((t==null?void 0:t["--w3m-font-family"])||"Inter, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;")};
        --w3m-font-size-master: ${Ai((t==null?void 0:t["--w3m-font-size-master"])||"10px")};
        --w3m-border-radius-master: ${Ai((t==null?void 0:t["--w3m-border-radius-master"])||"4px")};
        --w3m-z-index: ${Ai((t==null?void 0:t["--w3m-z-index"])||999)};

        --wui-font-family: var(--w3m-font-family);

        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);
        --wui-font-size-micro: var(--w3m-font-size-master);
        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);
        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);
        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);
        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);
        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);
        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);
        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);
        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);

        --wui-border-radius-5xs: var(--w3m-border-radius-master);
        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);
        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);
        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);
        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);
        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);
        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);
        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);
        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);

        --wui-font-weight-light: 400;
        --wui-font-weight-regular: 500;
        --wui-font-weight-medium: 600;
        --wui-font-weight-bold: 700;

        --wui-letter-spacing-2xl: -1.6px;
        --wui-letter-spacing-medium-title: -0.96px;
        --wui-letter-spacing-title-6: -0.88px;
        --wui-letter-spacing-large: -0.8px;
        --wui-letter-spacing-medium: -0.72px;
        --wui-letter-spacing-paragraph: -0.64px;
        --wui-letter-spacing-small: -0.56px;
        --wui-letter-spacing-tiny: -0.48px;
        --wui-letter-spacing-micro: -0.2px;
        --wui-letter-spacing-mini: -0.16px;

        --wui-spacing-0: 0px;
        --wui-spacing-4xs: 2px;
        --wui-spacing-3xs: 4px;
        --wui-spacing-xxs: 6px;
        --wui-spacing-2xs: 7px;
        --wui-spacing-xs: 8px;
        --wui-spacing-1xs: 10px;
        --wui-spacing-s: 12px;
        --wui-spacing-m: 14px;
        --wui-spacing-l: 16px;
        --wui-spacing-2l: 18px;
        --wui-spacing-xl: 20px;
        --wui-spacing-xxl: 24px;
        --wui-spacing-2xl: 32px;
        --wui-spacing-3xl: 40px;
        --wui-spacing-4xl: 90px;
        --wui-spacing-5xl: 95px;

        --wui-icon-box-size-xxs: 14px;
        --wui-icon-box-size-xs: 20px;
        --wui-icon-box-size-sm: 24px;
        --wui-icon-box-size-md: 32px;
        --wui-icon-box-size-mdl: 36px;
        --wui-icon-box-size-lg: 40px;
        --wui-icon-box-size-2lg: 48px;
        --wui-icon-box-size-xl: 64px;

        --wui-icon-size-inherit: inherit;
        --wui-icon-size-xxs: 10px;
        --wui-icon-size-xs: 12px;
        --wui-icon-size-sm: 14px;
        --wui-icon-size-md: 16px;
        --wui-icon-size-mdl: 18px;
        --wui-icon-size-lg: 20px;
        --wui-icon-size-xl: 24px;
        --wui-icon-size-xxl: 28px;

        --wui-wallet-image-size-inherit: inherit;
        --wui-wallet-image-size-sm: 40px;
        --wui-wallet-image-size-md: 56px;
        --wui-wallet-image-size-lg: 80px;

        --wui-visual-size-size-inherit: inherit;
        --wui-visual-size-sm: 40px;
        --wui-visual-size-md: 55px;
        --wui-visual-size-lg: 80px;

        --wui-box-size-md: 100px;
        --wui-box-size-lg: 120px;

        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);
        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);

        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);
        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);
        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);

        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);

        --wui-duration-lg: 200ms;
        --wui-duration-md: 125ms;
        --wui-duration-sm: 75ms;

        --wui-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --wui-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --wui-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --wui-width-network-sm: 36px;
        --wui-width-network-md: 48px;
        --wui-width-network-lg: 86px;

        --wui-height-network-sm: 40px;
        --wui-height-network-md: 54px;
        --wui-height-network-lg: 96px;

        --wui-icon-size-network-xs: 12px;
        --wui-icon-size-network-sm: 16px;
        --wui-icon-size-network-md: 24px;
        --wui-icon-size-network-lg: 42px;

        --wui-color-inherit: inherit;

        --wui-color-inverse-100: #fff;
        --wui-color-inverse-000: #000;

        --wui-cover: rgba(20, 20, 20, 0.8);

        --wui-color-modal-bg: var(--wui-color-modal-bg-base);

        --wui-color-accent-100: var(--wui-color-accent-base-100);
        --wui-color-accent-090: var(--wui-color-accent-base-090);
        --wui-color-accent-080: var(--wui-color-accent-base-080);

        --wui-color-success-100: var(--wui-color-success-base-100);
        --wui-color-success-125: var(--wui-color-success-base-125);

        --wui-color-warning-100: var(--wui-color-warning-base-100);

        --wui-color-error-100: var(--wui-color-error-base-100);
        --wui-color-error-125: var(--wui-color-error-base-125);

        --wui-color-blue-100: var(--wui-color-blue-base-100);
        --wui-color-blue-90: var(--wui-color-blue-base-90);

        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);
        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);
        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);
        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);

        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);

        --wui-avatar-border: var(--wui-avatar-border-base);

        --wui-thumbnail-border: var(--wui-thumbnail-border-base);

        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);

        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);
      }

      @supports (background: color-mix(in srgb, white 50%, black)) {
        :root {
          --wui-color-modal-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-modal-bg-base)
          );

          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);

          --wui-color-accent-100: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 100%,
            transparent
          );
          --wui-color-accent-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-090: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 90%,
            transparent
          );
          --wui-color-accent-glass-080: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 80%,
            transparent
          );
          --wui-color-accent-glass-020: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 20%,
            transparent
          );
          --wui-color-accent-glass-015: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 15%,
            transparent
          );
          --wui-color-accent-glass-010: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 10%,
            transparent
          );
          --wui-color-accent-glass-005: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 5%,
            transparent
          );
          --wui-color-accent-002: color-mix(
            in srgb,
            var(--wui-color-accent-base-100) 2%,
            transparent
          );

          --wui-color-fg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-100)
          );
          --wui-color-fg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-125)
          );
          --wui-color-fg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-150)
          );
          --wui-color-fg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-175)
          );
          --wui-color-fg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-200)
          );
          --wui-color-fg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-225)
          );
          --wui-color-fg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-250)
          );
          --wui-color-fg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-275)
          );
          --wui-color-fg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-300)
          );
          --wui-color-fg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-325)
          );
          --wui-color-fg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-fg-350)
          );

          --wui-color-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-100)
          );
          --wui-color-bg-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-125)
          );
          --wui-color-bg-150: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-150)
          );
          --wui-color-bg-175: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-175)
          );
          --wui-color-bg-200: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-200)
          );
          --wui-color-bg-225: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-225)
          );
          --wui-color-bg-250: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-250)
          );
          --wui-color-bg-275: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-275)
          );
          --wui-color-bg-300: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-300)
          );
          --wui-color-bg-325: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-325)
          );
          --wui-color-bg-350: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-bg-350)
          );

          --wui-color-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-100)
          );
          --wui-color-success-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-success-base-125)
          );

          --wui-color-warning-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-warning-base-100)
          );

          --wui-color-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-100)
          );
          --wui-color-blue-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-100)
          );
          --wui-color-blue-90: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-blue-base-90)
          );
          --wui-color-error-125: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-color-error-base-125)
          );

          --wui-icon-box-bg-error-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-error-base-100)
          );
          --wui-icon-box-bg-accent-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-blue-base-100)
          );
          --wui-icon-box-bg-success-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-success-base-100)
          );
          --wui-icon-box-bg-inverse-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-icon-box-bg-inverse-base-100)
          );

          --wui-all-wallets-bg-100: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-all-wallets-bg-100)
          );

          --wui-avatar-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-avatar-border-base)
          );

          --wui-thumbnail-border: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-thumbnail-border-base)
          );

          --wui-wallet-button-bg: color-mix(
            in srgb,
            var(--w3m-color-mix) var(--w3m-color-mix-strength),
            var(--wui-wallet-button-bg-base)
          );
        }
      }
    `,light:On`
      :root {
        --w3m-color-mix: ${Ai((t==null?void 0:t["--w3m-color-mix"])||"#fff")};
        --w3m-accent: ${Ai(Us(t,"dark")["--w3m-accent"])};
        --w3m-default: #fff;

        --wui-color-modal-bg-base: ${Ai(Us(t,"dark")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);
        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);
        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);
        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);

        --wui-color-fg-100: #e4e7e7;
        --wui-color-fg-125: #d0d5d5;
        --wui-color-fg-150: #a8b1b1;
        --wui-color-fg-175: #a8b0b0;
        --wui-color-fg-200: #949e9e;
        --wui-color-fg-225: #868f8f;
        --wui-color-fg-250: #788080;
        --wui-color-fg-275: #788181;
        --wui-color-fg-300: #6e7777;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #363636;

        --wui-color-bg-100: #141414;
        --wui-color-bg-125: #191a1a;
        --wui-color-bg-150: #1e1f1f;
        --wui-color-bg-175: #222525;
        --wui-color-bg-200: #272a2a;
        --wui-color-bg-225: #2c3030;
        --wui-color-bg-250: #313535;
        --wui-color-bg-275: #363b3b;
        --wui-color-bg-300: #3b4040;
        --wui-color-bg-325: #252525;
        --wui-color-bg-350: #ffffff;

        --wui-color-success-base-100: #26d962;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f25a67;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);
        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);
        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);
        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);
        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);
        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);
        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);
        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);
        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);
        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);
        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);
        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);
        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);
        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);
        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);
        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);
        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);
        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);
        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);
        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);

        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);

        --wui-icon-box-bg-error-base-100: #3c2426;
        --wui-icon-box-bg-blue-base-100: #20303f;
        --wui-icon-box-bg-success-base-100: #1f3a28;
        --wui-icon-box-bg-inverse-base-100: #243240;

        --wui-all-wallets-bg-100: #222b35;

        --wui-avatar-border-base: #252525;

        --wui-thumbnail-border-base: #252525;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);
      }
    `,dark:On`
      :root {
        --w3m-color-mix: ${Ai((t==null?void 0:t["--w3m-color-mix"])||"#000")};
        --w3m-accent: ${Ai(Us(t,"light")["--w3m-accent"])};
        --w3m-default: #000;

        --wui-color-modal-bg-base: ${Ai(Us(t,"light")["--w3m-background"])};
        --wui-color-accent-base-100: var(--w3m-accent);

        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);
        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);
        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);

        --wui-color-fg-100: #141414;
        --wui-color-fg-125: #2d3131;
        --wui-color-fg-150: #474d4d;
        --wui-color-fg-175: #636d6d;
        --wui-color-fg-200: #798686;
        --wui-color-fg-225: #828f8f;
        --wui-color-fg-250: #8b9797;
        --wui-color-fg-275: #95a0a0;
        --wui-color-fg-300: #9ea9a9;
        --wui-color-fg-325: #9a9a9a;
        --wui-color-fg-350: #d0d0d0;

        --wui-color-bg-100: #ffffff;
        --wui-color-bg-125: #f5fafa;
        --wui-color-bg-150: #f3f8f8;
        --wui-color-bg-175: #eef4f4;
        --wui-color-bg-200: #eaf1f1;
        --wui-color-bg-225: #e5eded;
        --wui-color-bg-250: #e1e9e9;
        --wui-color-bg-275: #dce7e7;
        --wui-color-bg-300: #d8e3e3;
        --wui-color-bg-325: #f3f3f3;
        --wui-color-bg-350: #202020;

        --wui-color-success-base-100: #26b562;
        --wui-color-success-base-125: #30a46b;

        --wui-color-warning-base-100: #f3a13f;

        --wui-color-error-base-100: #f05142;
        --wui-color-error-base-125: #df4a34;

        --wui-color-blue-base-100: rgba(102, 125, 255, 1);
        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);

        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);
        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);
        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);
        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);
        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);
        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);
        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);
        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);
        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);
        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);

        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);

        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);

        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);
        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);
        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);
        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);
        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);
        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);
        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);
        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);
        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);
        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);

        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);

        --wui-icon-box-bg-error-base-100: #f4dfdd;
        --wui-icon-box-bg-blue-base-100: #d9ecfb;
        --wui-icon-box-bg-success-base-100: #daf0e4;
        --wui-icon-box-bg-inverse-base-100: #dcecfc;

        --wui-all-wallets-bg-100: #e8f1fa;

        --wui-avatar-border-base: #f3f4f4;

        --wui-thumbnail-border-base: #eaefef;

        --wui-wallet-button-bg-base: var(--wui-color-bg-125);

        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);
        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);
        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);
        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);
        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);
        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);
        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);
        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);
        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);
        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);
        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);

        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);

        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);
      }
    `}}const i6=On`
  *,
  *::after,
  *::before,
  :host {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    font-family: var(--wui-font-family);
    backface-visibility: hidden;
  }
`,s6=On`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transition:
      color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      background-color var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border var(--wui-duration-lg) var(--wui-ease-out-power-1),
      border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1),
      box-shadow var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: background-color, color, border, box-shadow, border-radius;
    outline: none;
    border: none;
    column-gap: var(--wui-spacing-3xs);
    background-color: transparent;
    text-decoration: none;
  }

  wui-flex {
    transition: border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1);
    will-change: border-radius;
  }

  button:disabled > wui-wallet-image,
  button:disabled > wui-all-wallets-image,
  button:disabled > wui-network-image,
  button:disabled > wui-image,
  button:disabled > wui-transaction-visual,
  button:disabled > wui-logo {
    filter: grayscale(1);
  }

  @media (hover: hover) and (pointer: fine) {
    button:hover:enabled {
      background-color: var(--wui-color-gray-glass-005);
    }

    button:active:enabled {
      background-color: var(--wui-color-gray-glass-010);
    }
  }

  button:disabled > wui-icon-box {
    opacity: 0.5;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,r6=On`
  .wui-color-inherit {
    color: var(--wui-color-inherit);
  }

  .wui-color-accent-100 {
    color: var(--wui-color-accent-100);
  }

  .wui-color-error-100 {
    color: var(--wui-color-error-100);
  }

  .wui-color-blue-100 {
    color: var(--wui-color-blue-100);
  }

  .wui-color-blue-90 {
    color: var(--wui-color-blue-90);
  }

  .wui-color-error-125 {
    color: var(--wui-color-error-125);
  }

  .wui-color-success-100 {
    color: var(--wui-color-success-100);
  }

  .wui-color-success-125 {
    color: var(--wui-color-success-125);
  }

  .wui-color-inverse-100 {
    color: var(--wui-color-inverse-100);
  }

  .wui-color-inverse-000 {
    color: var(--wui-color-inverse-000);
  }

  .wui-color-fg-100 {
    color: var(--wui-color-fg-100);
  }

  .wui-color-fg-200 {
    color: var(--wui-color-fg-200);
  }

  .wui-color-fg-300 {
    color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    color: var(--wui-color-fg-350);
  }

  .wui-bg-color-inherit {
    background-color: var(--wui-color-inherit);
  }

  .wui-bg-color-blue-100 {
    background-color: var(--wui-color-accent-100);
  }

  .wui-bg-color-error-100 {
    background-color: var(--wui-color-error-100);
  }

  .wui-bg-color-error-125 {
    background-color: var(--wui-color-error-125);
  }

  .wui-bg-color-success-100 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-success-125 {
    background-color: var(--wui-color-success-100);
  }

  .wui-bg-color-inverse-100 {
    background-color: var(--wui-color-inverse-100);
  }

  .wui-bg-color-inverse-000 {
    background-color: var(--wui-color-inverse-000);
  }

  .wui-bg-color-fg-100 {
    background-color: var(--wui-color-fg-100);
  }

  .wui-bg-color-fg-200 {
    background-color: var(--wui-color-fg-200);
  }

  .wui-bg-color-fg-300 {
    background-color: var(--wui-color-fg-300);
  }

  .wui-color-fg-325 {
    background-color: var(--wui-color-fg-325);
  }

  .wui-color-fg-350 {
    background-color: var(--wui-color-fg-350);
  }
`,ec={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603};function _a(t){return{formatters:void 0,fees:void 0,serializers:void 0,...t}}const pu=_a({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),gu=_a({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"}),oq=_a({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});_a({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}});_a({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const aq={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},tb={getMethodsByChainNamespace(t){return aq[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const i={...t},s=new Set;if(e.methods&&Object.keys(e.methods).forEach(r=>s.add(r)),e.chains&&Object.keys(e.chains).forEach(r=>s.add(r)),e.events&&Object.keys(e.events).forEach(r=>s.add(r)),e.rpcMap&&Object.keys(e.rpcMap).forEach(r=>{const[n]=r.split(":");n&&s.add(n)}),s.forEach(r=>{i[r]||(i[r]=this.createDefaultNamespace(r))}),e.methods&&Object.entries(e.methods).forEach(([r,n])=>{i[r]&&(i[r].methods=n)}),e.chains&&Object.entries(e.chains).forEach(([r,n])=>{i[r]&&(i[r].chains=n)}),e.events&&Object.entries(e.events).forEach(([r,n])=>{i[r]&&(i[r].events=n)}),e.rpcMap){const r=new Set;Object.entries(e.rpcMap).forEach(([n,o])=>{const[a,l]=n.split(":");!a||!l||!i[a]||(i[a].rpcMap||(i[a].rpcMap={}),r.has(a)||(i[a].rpcMap={},r.add(a)),i[a].rpcMap[l]=o)})}return i},createNamespaces(t,e){const i=t.reduce((s,r)=>{const{id:n,chainNamespace:o,rpcUrls:a}=r,l=a.default.http[0];s[o]||(s[o]=this.createDefaultNamespace(o));const c=`${o}:${n}`,h=s[o];switch(h.chains.push(c),c){case pu.caipNetworkId:h.chains.push(pu.deprecatedCaipNetworkId);break;case gu.caipNetworkId:h.chains.push(gu.deprecatedCaipNetworkId);break}return h!=null&&h.rpcMap&&l&&(h.rpcMap[n]=l),s},{});return this.applyNamespaceOverrides(i,e)},resolveReownName:async t=>{var e;const i=await _y.resolveName(t);return((e=(Object.values(i==null?void 0:i.addresses)||[])[0])==null?void 0:e.address)||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const i=e.chains||[],s=e.accounts.map(r=>{const[n,o]=r.split(":");return`${n}:${o}`});return Array.from(new Set([...i,...s]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null}};class ib{constructor({provider:e,caipNetworks:i,namespace:s}){this.id=Y.CONNECTOR_ID.WALLET_CONNECT,this.name=Dc.ConnectorNamesMap[Y.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=Dc.ConnectorImageIds[Y.CONNECTOR_ID.WALLET_CONNECT],this.caipNetworks=i,this.provider=e,this.chain=s}get chains(){return this.caipNetworks}async connectWalletConnect(){if(!await this.authenticate()){const e=D.state.universalProviderConfigOverride,i=tb.createNamespaces(this.caipNetworks,e);await this.provider.connect({optionalNamespaces:i})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(i=>i.caipNetworkId);return jo.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:cq})}}const cq=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class lq{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,e&&this.construct(e)}construct(e){this.caipNetworks=e.networks,this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.caipNetworks||[]}setAuthProvider(e){this.addConnector({id:Y.CONNECTOR_ID.AUTH,type:"AUTH",name:Y.CONNECTOR_NAMES.AUTH,provider:e,imageId:Dc.ConnectorImageIds[Y.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(...e){const i=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(s=>i.has(s.id)?!1:(i.add(s.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(e,i){Z.setStatus(e,i)}on(e,i){var s;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(s=this.eventListeners.get(e))==null||s.add(i)}off(e,i){const s=this.eventListeners.get(e);s&&s.delete(i)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,i){const s=this.eventListeners.get(e);s&&s.forEach(r=>r(i))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){const{caipNetwork:i,providerType:s}=e;if(!e.provider)return;const r="provider"in e.provider?e.provider.provider:e.provider;if(s==="WALLET_CONNECT"){r.setDefaultChain(i.caipNetworkId);return}if(r&&s==="AUTH"){const n=r;await n.switchNetwork(i.caipNetworkId);const o=await n.getUser({chainId:i.caipNetworkId,preferredAccountType:D.state.defaultAccountTypes[i.chainNamespace]});this.emit("switchNetwork",o)}}getWalletConnectConnector(){const e=this.connectors.find(i=>i instanceof ib);if(!e)throw new Error("WalletConnectConnector not found");return e}}class hq extends lq{setUniversalProvider(e){this.addConnector(new ib({provider:e,caipNetworks:this.caipNetworks||[],namespace:this.namespace}))}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect()}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}}async getAccounts({namespace:e}){var i,s,r,n;const o=this.provider,a=((n=(r=(s=(i=o==null?void 0:o.session)==null?void 0:i.namespaces)==null?void 0:s[e])==null?void 0:r.accounts)==null?void 0:n.map(l=>{const[,,c]=l.split(":");return c}).filter((l,c,h)=>h.indexOf(l)===c))||[];return Promise.resolve({accounts:a.map(l=>ie.createAccount(e,l,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var i,s,r,n,o;if(!(e.caipNetwork&&ni.BALANCE_SUPPORTED_CHAINS.includes((i=e.caipNetwork)==null?void 0:i.chainNamespace))||(s=e.caipNetwork)!=null&&s.testnet)return{balance:"0.00",symbol:((r=e.caipNetwork)==null?void 0:r.nativeCurrency.symbol)||""};if(Z.state.balanceLoading&&e.chainId===((n=b.state.activeCaipNetwork)==null?void 0:n.id))return{balance:Z.state.balance||"0.00",symbol:Z.state.balanceSymbol||""};const a=(await Z.fetchTokenBalance()).find(l=>{var c,h;return l.chainId===`${(c=e.caipNetwork)==null?void 0:c.chainNamespace}:${e.chainId}`&&l.symbol===((h=e.caipNetwork)==null?void 0:h.nativeCurrency.symbol)});return{balance:(a==null?void 0:a.quantity.numeric)||"0.00",symbol:(a==null?void 0:a.symbol)||((o=e.caipNetwork)==null?void 0:o.nativeCurrency.symbol)||""}}async signMessage(e){var i,s,r;const{provider:n,message:o,address:a}=e;if(!n)throw new Error("UniversalAdapter:signMessage - provider is undefined");let l="";return((i=b.state.activeCaipNetwork)==null?void 0:i.chainNamespace)===Y.CHAIN.SOLANA?l=(await n.request({method:"solana_signMessage",params:{message:Ly.encode(new TextEncoder().encode(o)),pubkey:a}},(s=b.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)).signature:l=await n.request({method:"personal_sign",params:[o,a]},(r=b.state.activeCaipNetwork)==null?void 0:r.caipNetworkId),{signature:l}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async getProfile(){return Promise.resolve({profileImage:"",profileName:""})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}async getEnsAddress(){return Promise.resolve({address:!1})}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var i,s,r,n,o,a;const{caipNetwork:l}=e,c=this.getWalletConnectConnector();if(l.chainNamespace===Y.CHAIN.EVM)try{await((i=c.provider)==null?void 0:i.request({method:"wallet_switchEthereumChain",params:[{chainId:sd(l.id)}]}))}catch(h){if(h.code===ec.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||h.code===ec.ERROR_INVALID_CHAIN_ID||h.code===ec.ERROR_CODE_DEFAULT||((r=(s=h==null?void 0:h.data)==null?void 0:s.originalError)==null?void 0:r.code)===ec.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((a=c.provider)==null?void 0:a.request({method:"wallet_addEthereumChain",params:[{chainId:sd(l.id),rpcUrls:[(n=l==null?void 0:l.rpcUrls.chainDefault)==null?void 0:n.http],chainName:l.name,nativeCurrency:l.nativeCurrency,blockExplorerUrls:[(o=l.blockExplorers)==null?void 0:o.default.url]}]}))}catch{throw new Error("Chain is not supported")}}c.provider.setDefaultChain(l.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(i=>i.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}class uq{constructor(e){var i;this.hasSwitchedToPreferredAccountTypeOnConnect=!1,this.chainNamespaces=[],this.reportedAlertErrors={},this.getCaipNetwork=s=>{var r,n;return s?((r=b.getNetworkData(s))==null?void 0:r.caipNetwork)||((n=b.getRequestedCaipNetworks(s).filter(a=>a.chainNamespace===s))==null?void 0:n[0]):b.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const s=this.getCaipNetwork();if(s)return s.id},this.getCaipNetworks=s=>b.getRequestedCaipNetworks(s),this.getActiveChainNamespace=()=>b.state.activeChain,this.setRequestedCaipNetworks=(s,r)=>{b.setRequestedCaipNetworks(s,r)},this.getApprovedCaipNetworkIds=()=>b.getAllApprovedCaipNetworkIds(),this.getCaipAddress=s=>b.state.activeChain===s||!s?b.state.activeCaipAddress:b.getAccountProp("caipAddress",s),this.setClientId=s=>{X.setClientId(s)},this.getProvider=s=>Ze.getProvider(s),this.getProviderType=s=>Ze.getProviderId(s),this.getPreferredAccountType=()=>Z.state.preferredAccountType,this.setCaipAddress=(s,r)=>{Z.setCaipAddress(s,r)},this.setBalance=(s,r,n)=>{Z.setBalance(s,r,n)},this.setProfileName=(s,r)=>{Z.setProfileName(s,r)},this.setProfileImage=(s,r)=>{Z.setProfileImage(s,r)},this.setUser=(s,r)=>{Z.setUser(s,r),D.state.enableEmbedded&&ct.close()},this.resetAccount=s=>{Z.resetAccount(s)},this.setCaipNetwork=s=>{b.setActiveCaipNetwork(s)},this.setCaipNetworkOfNamespace=(s,r)=>{b.setChainNetworkData(r,{caipNetwork:s})},this.setAllAccounts=(s,r)=>{Z.setAllAccounts(s,r),D.setHasMultipleAddresses((s==null?void 0:s.length)>1)},this.setStatus=(s,r)=>{Z.setStatus(s,r),te.isConnected()?G.setConnectionStatus("connected"):G.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=s=>b.getAccountProp("address",s),this.setConnectors=s=>{const r=[...te.getConnectors(),...s];te.setConnectors(r)},this.fetchIdentity=s=>X.fetchIdentity(s),this.getReownName=s=>_y.getNamesForAddress(s),this.getConnectors=()=>te.getConnectors(),this.getConnectorImage=s=>Ey.getConnectorImage(s),this.setConnectedWalletInfo=(s,r)=>{const n=Ze.getProviderId(r),o=s?{...s,type:n}:void 0;Z.setConnectedWalletInfo(o,r)},this.getIsConnectedState=()=>!!b.state.activeCaipAddress,this.addAddressLabel=(s,r,n)=>{Z.addAddressLabel(s,r,n)},this.removeAddressLabel=(s,r)=>{Z.removeAddressLabel(s,r)},this.getAddress=s=>b.state.activeChain===s||!s?Z.state.address:b.getAccountProp("address",s),this.setApprovedCaipNetworksData=s=>b.setApprovedCaipNetworksData(s),this.resetNetwork=s=>{b.resetNetwork(s)},this.addConnector=s=>{te.addConnector(s)},this.resetWcConnection=()=>{Le.resetWcConnection()},this.setAddressExplorerUrl=(s,r)=>{Z.setAddressExplorerUrl(s,r)},this.setSmartAccountDeployed=(s,r)=>{Z.setSmartAccountDeployed(s,r)},this.setSmartAccountEnabledNetworks=(s,r)=>{b.setSmartAccountEnabledNetworks(s,r)},this.setPreferredAccountType=(s,r)=>{Z.setPreferredAccountType(s,r)},this.setEIP6963Enabled=s=>{D.setEIP6963Enabled(s)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=[...new Set((i=this.caipNetworks)==null?void 0:i.map(s=>s.chainNamespace))],this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.initialize(e),this.sendInitializeEvent(e)}async initialize(e){this.initControllers(e),await this.initChainAdapters(),await this.injectModalUi(),await this.syncExistingConnection(),fs.set({initialized:!0})}sendInitializeEvent(e){var i;const{...s}=e;delete s.adapters,ze.sendEvent({type:"track",event:"INITIALIZE",properties:{...s,networks:e.networks.map(r=>r.id),siweConfig:{options:((i=e.siweConfig)==null?void 0:i.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&Wt.setThemeMode(e.themeMode),e.themeVariables&&Wt.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");b.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});const i=this.getDefaultNetwork();i&&b.setActiveCaipNetwork(i)}initializeConnectionController(e){Le.setWcBasic(e.basic??!1)}initializeConnectorController(){te.initialize(this.chainNamespaces)}initializeOptionsController(e){var i;D.setDebug(e.debug!==!1),D.setEnableWalletConnect(e.enableWalletConnect!==!1),D.setEnableWalletGuide(e.enableWalletGuide!==!1),D.setEnableWallets(e.enableWallets!==!1),D.setEIP6963Enabled(e.enableEIP6963!==!1),D.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),D.setEnableAuthLogger(e.enableAuthLogger!==!1),D.setCustomRpcUrls(e.customRpcUrls),D.setSdkVersion(e.sdkVersion),D.setProjectId(e.projectId),D.setEnableEmbedded(e.enableEmbedded),D.setAllWallets(e.allWallets),D.setIncludeWalletIds(e.includeWalletIds),D.setExcludeWalletIds(e.excludeWalletIds),D.setFeaturedWalletIds(e.featuredWalletIds),D.setTokens(e.tokens),D.setTermsConditionsUrl(e.termsConditionsUrl),D.setPrivacyPolicyUrl(e.privacyPolicyUrl),D.setCustomWallets(e.customWallets),D.setFeatures(e.features),D.setAllowUnsupportedChain(e.allowUnsupportedChain),D.setDefaultAccountTypes(e.defaultAccountTypes),D.setUniversalProviderConfigOverride(e.universalProviderConfigOverride);const s=this.getDefaultMetaData();if(!e.metadata&&s&&(e.metadata=s),D.setMetadata(e.metadata),D.setDisableAppend(e.disableAppend),D.setEnableEmbedded(e.enableEmbedded),D.setSIWX(e.siwx),!e.projectId){ac.open(Xa.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if((i=e.adapters)!=null&&i.find(r=>r.namespace===Y.CHAIN.EVM)&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");D.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,i,s,r;return typeof window<"u"&&typeof document<"u"?{name:((i=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:i.textContent)||"",description:((s=document.querySelector('meta[property="og:description"]'))==null?void 0:s.content)||"",url:window.location.origin,icons:[((r=document.querySelector('link[rel~="icon"]'))==null?void 0:r.href)||""]}:null}setUnsupportedNetwork(e){const i=this.getActiveChainNamespace();if(i){const s=In.getUnsupportedNetwork(`${i}:${e}`);b.setActiveCaipNetwork(s)}}getDefaultNetwork(){return In.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,i){return In.extendCaipNetwork(e,{customNetworkImageUrls:i.chainImages,projectId:i.projectId})}extendCaipNetworks(e){return In.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const i=e.networks.find(s=>{var r;return s.id===((r=e.defaultNetwork)==null?void 0:r.id)});return i?In.extendCaipNetwork(i,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var e;const i=b.state.activeChain,s=this.getAdapter(i),r=(e=this.getCaipNetwork(i))==null?void 0:e.id;if(!s)throw new Error("Adapter not found");const n=await s.connectWalletConnect(r);this.close(),this.setClientId((n==null?void 0:n.clientId)||null),G.setConnectedNamespaces([...b.state.chains.keys()]),this.chainNamespaces.forEach(o=>{te.setConnectorId(_s.CONNECTOR_TYPE_WALLET_CONNECT,o)}),await this.syncWalletConnectAccount()},connectExternal:async({id:e,info:i,type:s,provider:r,chain:n,caipNetwork:o})=>{var a,l,c,h,u,d,p;const g=b.state.activeChain,f=n||g,w=this.getAdapter(f);if(n&&n!==g&&!o){const I=(a=this.caipNetworks)==null?void 0:a.find(S=>S.chainNamespace===n);I&&this.setCaipNetwork(I)}if(!w)throw new Error("Adapter not found");const m=this.getCaipNetwork(f),y=await w.connect({id:e,info:i,type:s,provider:r,chainId:(o==null?void 0:o.id)||(m==null?void 0:m.id),rpcUrl:((h=(c=(l=o==null?void 0:o.rpcUrls)==null?void 0:l.default)==null?void 0:c.http)==null?void 0:h[0])||((p=(d=(u=m==null?void 0:m.rpcUrls)==null?void 0:u.default)==null?void 0:d.http)==null?void 0:p[0])});if(!y)return;G.addConnectedNamespace(f),this.syncProvider({...y,chainNamespace:f}),await this.syncAccount({...y,chainNamespace:f});const{accounts:v}=await w.getAccounts({namespace:f,id:e});this.setAllAccounts(v,f)},reconnectExternal:async({id:e,info:i,type:s,provider:r})=>{var n;const o=b.state.activeChain,a=this.getAdapter(o);a!=null&&a.reconnect&&(await(a==null?void 0:a.reconnect({id:e,info:i,type:s,provider:r,chainId:(n=this.getCaipNetwork())==null?void 0:n.id})),G.addConnectedNamespace(o))},disconnect:async e=>{const i=e||b.state.activeChain,s=this.getAdapter(i),r=Ze.getProvider(i),n=Ze.getProviderId(i);await(s==null?void 0:s.disconnect({provider:r,providerType:n})),G.removeConnectedNamespace(i),Ze.resetChain(i),this.setUser(void 0,i),this.setStatus("disconnected",i),this.hasSwitchedToPreferredAccountTypeOnConnect=!1},checkInstalled:e=>e?e.some(i=>{var s;return!!((s=window.ethereum)!=null&&s[String(i)])}):!!window.ethereum,signMessage:async e=>{const i=this.getAdapter(b.state.activeChain),s=await(i==null?void 0:i.signMessage({message:e,address:Z.state.address,provider:Ze.getProvider(b.state.activeChain)}));return(s==null?void 0:s.signature)||""},sendTransaction:async e=>{if(e.chainNamespace===Y.CHAIN.EVM){const i=this.getAdapter(b.state.activeChain),s=Ze.getProvider(b.state.activeChain),r=await(i==null?void 0:i.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:s}));return(r==null?void 0:r.hash)||""}return""},estimateGas:async e=>{if(e.chainNamespace===Y.CHAIN.EVM){const i=this.getAdapter(b.state.activeChain),s=Ze.getProvider(b.state.activeChain),r=this.getCaipNetwork();if(!r)throw new Error("CaipNetwork is undefined");const n=await(i==null?void 0:i.estimateGas({...e,provider:s,caipNetwork:r}));return(n==null?void 0:n.gas)||0n}return 0n},getEnsAvatar:async()=>{var e;const i=this.getAdapter(b.state.activeChain),s=await(i==null?void 0:i.getProfile({address:Z.state.address,chainId:Number((e=this.getCaipNetwork())==null?void 0:e.id)}));return(s==null?void 0:s.profileImage)||!1},getEnsAddress:async e=>{const i=this.getAdapter(b.state.activeChain),s=this.getCaipNetwork();if(!s)return!1;const r=await(i==null?void 0:i.getEnsAddress({name:e,caipNetwork:s}));return(r==null?void 0:r.address)||!1},writeContract:async e=>{const i=this.getAdapter(b.state.activeChain),s=this.getCaipNetwork(),r=this.getCaipAddress(),n=Ze.getProvider(b.state.activeChain);if(!s||!r)throw new Error("CaipNetwork or CaipAddress is undefined");const o=await(i==null?void 0:i.writeContract({...e,caipNetwork:s,provider:n,caipAddress:r}));return o==null?void 0:o.hash},parseUnits:(e,i)=>{const s=this.getAdapter(b.state.activeChain);return(s==null?void 0:s.parseUnits({value:e,decimals:i}))??0n},formatUnits:(e,i)=>{const s=this.getAdapter(b.state.activeChain);return(s==null?void 0:s.formatUnits({value:e,decimals:i}))??"0"},getCapabilities:async e=>{const i=this.getAdapter(b.state.activeChain);return await(i==null?void 0:i.getCapabilities(e))},grantPermissions:async e=>{const i=this.getAdapter(b.state.activeChain);return await(i==null?void 0:i.grantPermissions(e))},revokePermissions:async e=>{const i=this.getAdapter(b.state.activeChain);return i!=null&&i.revokePermissions?await i.revokePermissions(e):"0x"},walletGetAssets:async e=>{const i=this.getAdapter(b.state.activeChain);return await(i==null?void 0:i.walletGetAssets(e))??{}}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},Le.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){var e,i,s,r,n;if(Ze.getProviderId(b.state.activeChain)===_s.CONNECTOR_TYPE_WALLET_CONNECT){const o=(i=(e=this.universalProvider)==null?void 0:e.session)==null?void 0:i.namespaces;return{supportsAllNetworks:((n=(r=(s=this.universalProvider)==null?void 0:s.session)==null?void 0:r.peer)==null?void 0:n.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(o)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;const i=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const s=Ze.getProvider(i),r=Ze.getProviderId(i);if(e.chainNamespace===b.state.activeChain){const n=this.getAdapter(i);await(n==null?void 0:n.switchNetwork({caipNetwork:e,provider:s,providerType:r}))}else if(this.setCaipNetwork(e),r===_s.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const n=this.getAddressByChainNamespace(i);n&&this.syncAccount({address:n,chainId:e.id,chainNamespace:i})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(i=>{const s=i.chains||[],r=i.accounts.map(n=>{const{chainId:o,chainNamespace:a}=Is.parseCaipAddress(n);return`${a}:${o}`});return Array.from(new Set([...s,...r]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((i,s)=>{var r;const n=e==null?void 0:e.find(o=>o.namespace===s);return n?(i[s]=n,i[s].namespace=s,i[s].construct({namespace:s,projectId:(r=this.options)==null?void 0:r.projectId,networks:this.caipNetworks})):i[s]=new hq({namespace:s,networks:this.caipNetworks}),i},{})}async initChainAdapter(e){var i;this.onConnectors(e),this.listenAdapter(e),(i=this.chainAdapters)==null||i[e].syncConnectors(this.options,this),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){const i=this.getAdapter(e);i==null||i.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const i=this.getAdapter(e);if(!i)return;const s=G.getConnectionStatus();s==="connected"?this.setStatus("connecting",e):s==="disconnected"?(G.clearAddressCache(),this.setStatus(s,e)):this.setStatus(s,e),i.on("switchNetwork",({address:r,chainId:n})=>{var o;const a=(o=this.caipNetworks)==null?void 0:o.find(h=>h.id===n||h.caipNetworkId===n),l=b.state.activeChain===e,c=b.getAccountProp("address",e);if(a){const h=l&&r?r:c;h&&this.syncAccount({address:h,chainId:n,chainNamespace:e})}else this.setUnsupportedNetwork(n)}),i.on("disconnect",this.disconnect.bind(this,e)),i.on("pendingTransactions",()=>{const r=Z.state.address,n=b.state.activeCaipNetwork;!r||!(n!=null&&n.id)||this.updateNativeBalance(r,n.id,n.chainNamespace)}),i.on("accountChanged",({address:r,chainId:n})=>{var o,a;const l=b.state.activeChain===e;l&&n?this.syncAccount({address:r,chainId:n,chainNamespace:e}):l&&(o=b.state.activeCaipNetwork)!=null&&o.id?this.syncAccount({address:r,chainId:(a=b.state.activeCaipNetwork)==null?void 0:a.id,chainNamespace:e}):this.syncAccountInfo(r,n,e)})}async createUniversalProviderForAdapter(e){var i,s,r;await this.getUniversalProvider(),this.universalProvider&&((r=(s=(i=this.chainAdapters)==null?void 0:i[e])==null?void 0:s.setUniversalProvider)==null||r.call(s,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async syncNamespaceConnection(e){try{const i=te.getConnectorId(e);switch(this.setStatus("connecting",e),i){case Y.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case Y.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(i){console.warn("AppKit couldn't sync existing connection",i),this.setStatus("disconnected",e)}}async syncAdapterConnection(e){var i,s,r;const n=this.getAdapter(e),o=te.getConnectorId(e),a=this.getCaipNetwork(e),l=te.getConnectors(e).find(c=>c.id===o);try{if(!n||!l)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(a!=null&&a.id))throw new Error("CaipNetwork not found");const c=await(n==null?void 0:n.syncConnection({namespace:e,id:l.id,chainId:a.id,rpcUrl:(r=(s=(i=a==null?void 0:a.rpcUrls)==null?void 0:i.default)==null?void 0:s.http)==null?void 0:r[0]}));if(c){const h=await(n==null?void 0:n.getAccounts({namespace:e,id:l.id}));h&&h.accounts.length>0?this.setAllAccounts(h.accounts,e):this.setAllAccounts([ie.createAccount(e,c.address,"eoa")],e),this.syncProvider({...c,chainNamespace:e}),await this.syncAccount({...c,chainNamespace:e}),this.setStatus("connected",e)}else this.setStatus("disconnected",e)}catch{this.setStatus("disconnected",e)}}async syncWalletConnectAccount(){const e=this.chainNamespaces.map(async i=>{var s,r,n,o,a;const l=this.getAdapter(i),c=((o=(n=(r=(s=this.universalProvider)==null?void 0:s.session)==null?void 0:r.namespaces)==null?void 0:n[i])==null?void 0:o.accounts)||[],h=(a=b.state.activeCaipNetwork)==null?void 0:a.id,u=c.find(d=>{const{chainId:p}=Is.parseCaipAddress(d);return p===(h==null?void 0:h.toString())})||c[0];if(u){const d=Is.validateCaipAddress(u),{chainId:p,address:g}=Is.parseCaipAddress(d);if(Ze.setProviderId(i,_s.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&b.state.activeCaipNetwork&&(l==null?void 0:l.namespace)!==Y.CHAIN.EVM){const f=l==null?void 0:l.getWalletConnectProvider({caipNetworks:this.caipNetworks,provider:this.universalProvider,activeCaipNetwork:b.state.activeCaipNetwork});Ze.setProvider(i,f)}else Ze.setProvider(i,this.universalProvider);te.setConnectorId(Y.CONNECTOR_ID.WALLET_CONNECT,i),G.addConnectedNamespace(i),this.syncWalletConnectAccounts(i),await this.syncAccount({address:g,chainId:p,chainNamespace:i})}else this.setStatus("disconnected",i);await b.setApprovedCaipNetworksData(i)});await Promise.all(e)}syncWalletConnectAccounts(e){var i,s,r,n,o;const a=(o=(n=(r=(s=(i=this.universalProvider)==null?void 0:i.session)==null?void 0:s.namespaces)==null?void 0:r[e])==null?void 0:n.accounts)==null?void 0:o.map(l=>{const{address:c}=Is.parseCaipAddress(l);return c}).filter((l,c,h)=>h.indexOf(l)===c);a&&this.setAllAccounts(a.map(l=>ie.createAccount(e,l,e==="bip122"?"payment":"eoa")),e)}syncProvider({type:e,provider:i,id:s,chainNamespace:r}){Ze.setProviderId(r,e),Ze.setProvider(r,i),te.setConnectorId(s,r)}async syncAccount(e){var i,s,r,n,o,a;const l=e.chainNamespace===b.state.activeChain,c=b.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:h,chainId:u,chainNamespace:d}=e,{chainId:p}=G.getActiveNetworkProps(),g=u||p,f=((i=b.state.activeCaipNetwork)==null?void 0:i.name)===Y.UNSUPPORTED_NETWORK_NAME,w=b.getNetworkProp("supportsAllNetworks",d);if(this.setStatus("connected",d),!(f&&!w)&&g){let m=(s=this.caipNetworks)==null?void 0:s.find(I=>I.id.toString()===g.toString()),y=(r=this.caipNetworks)==null?void 0:r.find(I=>I.chainNamespace===d);if(!w&&!m&&!y){const I=this.getApprovedCaipNetworkIds()||[],S=I.find(P=>{var _;return((_=Is.parseCaipNetworkId(P))==null?void 0:_.chainId)===g.toString()}),T=I.find(P=>{var _;return((_=Is.parseCaipNetworkId(P))==null?void 0:_.chainNamespace)===d});m=(n=this.caipNetworks)==null?void 0:n.find(P=>P.caipNetworkId===S),y=(o=this.caipNetworks)==null?void 0:o.find(P=>P.caipNetworkId===T||"deprecatedCaipNetworkId"in P&&P.deprecatedCaipNetworkId===T)}const v=m||y;(v==null?void 0:v.chainNamespace)===b.state.activeChain?D.state.enableNetworkSwitch&&!D.state.allowUnsupportedChain&&((a=b.state.activeCaipNetwork)==null?void 0:a.name)===Y.UNSUPPORTED_NETWORK_NAME?b.showUnsupportedChainUI():this.setCaipNetwork(v):l||c&&this.setCaipNetworkOfNamespace(c,d),this.syncConnectedWalletInfo(d),Kv.isLowerCaseMatch(h,Z.state.address)||this.syncAccountInfo(h,v==null?void 0:v.id,d),l?await this.syncBalance({address:h,chainId:v==null?void 0:v.id,chainNamespace:d}):await this.syncBalance({address:h,chainId:c==null?void 0:c.id,chainNamespace:d})}}async syncAccountInfo(e,i,s){const r=this.getCaipAddress(s),n=i||(r==null?void 0:r.split(":")[1]);if(!n)return;const o=`${s}:${n}:${e}`;this.setCaipAddress(o,s),await this.syncIdentity({address:e,chainId:n,chainNamespace:s})}async syncReownName(e,i){try{const s=await this.getReownName(e);if(s[0]){const r=s[0];this.setProfileName(r.name,i)}else this.setProfileName(null,i)}catch{this.setProfileName(null,i)}}syncConnectedWalletInfo(e){var i;const s=te.getConnectorId(e),r=Ze.getProviderId(e);if(r===_s.CONNECTOR_TYPE_ANNOUNCED||r===_s.CONNECTOR_TYPE_INJECTED){if(s){const n=this.getConnectors().find(o=>o.id===s);if(n){const{info:o,name:a,imageUrl:l}=n,c=l||this.getConnectorImage(n);this.setConnectedWalletInfo({name:a,icon:c,...o},e)}}}else if(r===_s.CONNECTOR_TYPE_WALLET_CONNECT){const n=Ze.getProvider(e);n!=null&&n.session&&this.setConnectedWalletInfo({...n.session.peer.metadata,name:n.session.peer.metadata.name,icon:(i=n.session.peer.metadata.icons)==null?void 0:i[0]},e)}else if(s)if(s===Y.CONNECTOR_ID.COINBASE){const n=this.getConnectors().find(o=>o.id===Y.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(n)},e)}else this.setConnectedWalletInfo({name:s},e)}async syncBalance(e){!vy.getNetworksByNamespace(this.caipNetworks,e.chainNamespace).find(i=>{var s;return i.id.toString()===((s=e.chainId)==null?void 0:s.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async updateNativeBalance(e,i,s){const r=this.getAdapter(s);if(r){const n=await r.getBalance({address:e,chainId:i,caipNetwork:this.getCaipNetwork(s),tokens:this.options.tokens});this.setBalance(n.balance,n.symbol,s)}}async initializeUniversalAdapter(){var e,i,s,r,n,o,a,l,c,h;const u=L8.createLogger((p,...g)=>{p&&this.handleAlertError(p),console.error(...g)}),d={projectId:(e=this.options)==null?void 0:e.projectId,metadata:{name:(i=this.options)!=null&&i.metadata?(s=this.options)==null?void 0:s.metadata.name:"",description:(r=this.options)!=null&&r.metadata?(n=this.options)==null?void 0:n.metadata.description:"",url:(o=this.options)!=null&&o.metadata?(a=this.options)==null?void 0:a.metadata.url:"",icons:(l=this.options)!=null&&l.metadata?(c=this.options)==null?void 0:c.metadata.icons:[""]},logger:u};D.setManualWCControl(!!((h=this.options)!=null&&h.manualWCControl)),this.universalProvider=this.options.universalProvider??await R8.init(d),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",e=>{Le.setUri(e)}),this.universalProvider.on("connect",Le.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),Le.resetWcConnection()}),this.universalProvider.on("chainChanged",e=>{var i;const s=(i=this.caipNetworks)==null?void 0:i.find(n=>n.id==e),r=this.getCaipNetwork();if(!s){this.setUnsupportedNetwork(e);return}(r==null?void 0:r.id)!==(s==null?void 0:s.id)&&this.setCaipNetwork(s)}),this.universalProvider.on("session_event",e=>{if(tb.isSessionEventData(e)){const{name:i,data:s}=e.params.event;i==="accountsChanged"&&Array.isArray(s)&&ie.isCaipAddress(s[0])&&this.syncAccount(Is.parseCaipAddress(s[0]))}}))}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&ie.isClient()&&(e=this.options)!=null&&e.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){ze.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}handleAlertError(e){const i=Object.entries(Xa.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[s,r]=i??[],{message:n,alertErrorKey:o}=r??{};if(s&&n&&!this.reportedAlertErrors[s]){const a=Xa.ALERT_ERRORS[o];a&&(ac.open(a,"error"),this.reportedAlertErrors[s]=!0)}}getAdapter(e){var i;if(e)return(i=this.chainAdapters)==null?void 0:i[e]}createAdapter(e){var i;if(!e)return;const s=e.namespace;if(!s)return;this.createClients();const r=e;r.namespace=s,r.construct({namespace:s,projectId:(i=this.options)==null?void 0:i.projectId,networks:this.caipNetworks}),this.chainNamespaces.includes(s)||this.chainNamespaces.push(s),this.chainAdapters&&(this.chainAdapters[s]=r)}async open(e){await this.injectModalUi(),e!=null&&e.uri&&Le.setUri(e.uri),await ct.open(e)}async close(){await this.injectModalUi(),ct.close()}setLoading(e,i){ct.setLoading(e,i)}async disconnect(e){await Le.disconnect(e)}getError(){return""}getChainId(){var e;return(e=b.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e){var i;const s=(i=this.caipNetworks)==null?void 0:i.find(r=>r.id===e.id);if(!s){ac.open(Xa.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await b.switchActiveNetwork(s)}getWalletProvider(){return b.state.activeChain?Ze.state.providers[b.state.activeChain]:null}getWalletProviderType(){return Ze.getProviderId(b.state.activeChain)}subscribeProviders(e){return Ze.subscribeProviders(e)}getThemeMode(){return Wt.state.themeMode}getThemeVariables(){return Wt.state.themeVariables}setThemeMode(e){Wt.setThemeMode(e),eb(Wt.state.themeMode)}setTermsConditionsUrl(e){D.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){D.setPrivacyPolicyUrl(e)}setThemeVariables(e){Wt.setThemeVariables(e),nq(Wt.state.themeVariables)}subscribeTheme(e){return Wt.subscribe(e)}getWalletInfo(){return Z.state.connectedWalletInfo}getAccount(e){const i=te.getAuthConnector(e),s=b.getAccountData(e);if(s)return{allAccounts:s.allAccounts,caipAddress:s.caipAddress,address:ie.getPlainAddress(s.caipAddress),isConnected:!!s.caipAddress,status:s.status,embeddedWalletInfo:i?{user:s.user,authProvider:s.socialProvider||"email",accountType:s.preferredAccountType,isSmartAccountDeployed:!!s.smartAccountDeployed}:void 0}}subscribeAccount(e,i){const s=()=>{const r=this.getAccount(i);r&&e(r)};i?b.subscribeChainProp("accountState",s,i):b.subscribe(s),te.subscribe(s)}subscribeNetwork(e){return b.subscribe(({activeCaipNetwork:i})=>{e({caipNetwork:i,chainId:i==null?void 0:i.id,caipNetworkId:i==null?void 0:i.caipNetworkId})})}subscribeWalletInfo(e){return Z.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){Z.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){b.subscribeKey("activeCaipNetwork",e)}getState(){return fs.state}subscribeState(e){return fs.subscribe(e)}showErrorMessage(e){Ot.showError(e)}showSuccessMessage(e){Ot.showSuccess(e)}getEvent(){return{...ze.state}}subscribeEvents(e){return ze.subscribe(e)}replace(e){Se.replace(e)}redirect(e){Se.push(e)}popTransactionStack(e){Se.popTransactionStack(e)}isOpen(){return ct.state.open}isTransactionStackEmpty(){return Se.state.transactionStack.length===0}isTransactionShouldReplaceView(){var e;return(e=Se.state.transactionStack[Se.state.transactionStack.length-1])==null?void 0:e.replace}static getInstance(){return this.instance}updateFeatures(e){D.setFeatures(e)}updateOptions(e){const i={...D.state||{},...e};D.setOptions(i)}setConnectMethodsOrder(e){D.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){D.setWalletFeaturesOrder(e)}setCollapseWallets(e){D.setCollapseWallets(e)}setSocialsOrder(e){D.setSocialsOrder(e)}getConnectMethodsOrder(){return uu.getConnectOrderMethod(D.state.features,te.getConnectors())}removeAdapter(e){var i;const s=this.getIsConnectedState(),r=this.getAdapter(e);if(!r||!this.chainAdapters||s)return;const n=(i=this.caipNetworks)==null?void 0:i.filter(o=>o.chainNamespace!==e);b.removeAdapter(e),te.removeAdapter(e),this.chainNamespaces=this.chainNamespaces.filter(o=>o!==e),this.caipNetworks=n,r.removeAllEventListeners(),Reflect.deleteProperty(this.chainAdapters,e)}addAdapter(e,i){const s=e.namespace;if(!this.connectionControllerClient||!this.networkControllerClient||!this.chainAdapters||!s)return;const r=this.extendCaipNetworks({...this.options,networks:i});this.caipNetworks=[...this.caipNetworks||[],...r],this.createAdapter(e),this.initChainAdapter(s),b.addAdapter(e,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient},r)}addNetwork(e,i){var s;if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const r=this.extendCaipNetwork(i,this.options);b.addNetwork(r),this.caipNetworks&&!((s=this.caipNetworks)!=null&&s.find(n=>n.id===r.id))&&this.caipNetworks.push(r)}removeNetwork(e,i){var s;if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);if(!((s=this.caipNetworks)!=null&&s.find(n=>n.id===i)))throw new Error(`Network with ID ${i} not found`);if(!this.caipNetworks)return;const r=this.caipNetworks.filter(n=>n.chainNamespace===e&&n.id!==i);if(!(r!=null&&r.length))throw new Error("Cannot remove last network for a namespace");b.removeNetwork(e,i),this.caipNetworks=[...r]}}let lm=!1;class dq extends uq{async open(e){te.isConnected()||await super.open(e)}async close(){await super.close(),this.options.manualWCControl&&Le.finalizeWcConnection()}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!lm&&ie.isClient()){if(await Bo(()=>import("./basic-zSaFlloC-C1fIY3Mr.js"),__vite__mapDeps([11,12,1,2,5,6,7,8,9])),await Bo(()=>import("./w3m-modal-DksS6aIT-Dd1VgM2E.js"),__vite__mapDeps([13,12,1,2,5,6,7,8,9])),!document.querySelector("w3m-modal")){const e=document.createElement("w3m-modal");!D.state.disableAppend&&!D.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",e)}lm=!0}}}const pq="1.7.2";function gq(t){return new dq({...t,basic:!0,sdkVersion:`html-core-${pq}`})}function fq(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let c=0;c<e.length;c++)e[c]=255;for(let c=0;c<t.length;c++){const h=t.charAt(c),u=h.charCodeAt(0);if(e[u]!==255)throw new TypeError(h+" is ambiguous");e[u]=c}const i=t.length,s=t.charAt(0),r=Math.log(i)/Math.log(256),n=Math.log(256)/Math.log(i);function o(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let h=0,u=0,d=0;const p=c.length;for(;d!==p&&c[d]===0;)d++,h++;const g=(p-d)*n+1>>>0,f=new Uint8Array(g);for(;d!==p;){let y=c[d],v=0;for(let I=g-1;(y!==0||v<u)&&I!==-1;I--,v++)y+=256*f[I]>>>0,f[I]=y%i>>>0,y=y/i>>>0;if(y!==0)throw new Error("Non-zero carry");u=v,d++}let w=g-u;for(;w!==g&&f[w]===0;)w++;let m=s.repeat(h);for(;w<g;++w)m+=t.charAt(f[w]);return m}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let h=0,u=0,d=0;for(;c[h]===s;)u++,h++;const p=(c.length-h)*r+1>>>0,g=new Uint8Array(p);for(;h<c.length;){const y=c.charCodeAt(h);if(y>255)return;let v=e[y];if(v===255)return;let I=0;for(let S=p-1;(v!==0||I<d)&&S!==-1;S--,I++)v+=i*g[S]>>>0,g[S]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=I,h++}let f=p-d;for(;f!==p&&g[f]===0;)f++;const w=new Uint8Array(u+(p-f));let m=u;for(;f!==p;)w[m++]=g[f++];return w}function l(c){const h=a(c);if(h)return h;throw new Error("Non-base"+i+" character")}return{encode:o,decodeUnsafe:a,decode:l}}var mq="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const ah=fq(mq);class Sn extends Error{constructor(){super(),Object.setPrototypeOf(this,Sn.prototype)}}class hm extends Error{constructor(e){super(`WalletConnect Adapter - Method ${e} is not supported by the wallet`),this.name="WalletConnectFeatureNotSupportedError"}}function wq(t){let e=[t];return t===dt.Mainnet||t===dt.Deprecated_Mainnet?(e=[dt.Mainnet,dt.Deprecated_Mainnet],t===dt.Deprecated_Mainnet&&console.warn(Lc.mainnet)):(t===dt.Deprecated_Devnet||t===dt.Devnet)&&(e=[dt.Devnet,dt.Deprecated_Devnet],console.warn(Lc.devnet)),e}const Lc={mainnet:`You are using a deprecated chain ID for Solana Mainnet, please use ${dt.Mainnet} instead.`,devnet:`You are using a deprecated chain ID for Solana Devnet, please use ${dt.Devnet} instead.`,wallet:"The connected wallet is using a deprecated chain ID for Solana. Please, contact them to upgrade. You can learn more at https://github.com/ChainAgnostic/namespaces/blob/main/solana/caip10.md#chain-ids"};function um(t,e){var i;const s=(i=t.namespaces.solana)==null?void 0:i.accounts.map(r=>`solana:${r.split(":")[1]}`);if(e===dt.Mainnet)return s!=null&&s.find(r=>r===dt.Mainnet)?dt.Mainnet:(console.warn(Lc.wallet),dt.Deprecated_Mainnet);if(e===dt.Devnet)return s!=null&&s.find(r=>r===dt.Devnet)?dt.Devnet:(console.warn(Lc.wallet),dt.Deprecated_Devnet);throw Error("WalletConnect Solana Adapter: Unable to get a default chain from the session.")}function yq(t){return{optionalNamespaces:{solana:{chains:wq(t),methods:[Si.signTransaction,Si.signMessage],events:[]}}}}class Zu extends Error{constructor(){super("QR Code Modal was closed by user"),Object.setPrototypeOf(this,Zu.prototype),this.name="QRCodeModalError"}}class vq{constructor(e){if(zt(this,"_UniversalProvider"),zt(this,"_session"),zt(this,"_modal"),zt(this,"_projectId"),zt(this,"_network"),zt(this,"_ConnectQueueResolver"),this.initClient(e.options),this._network=e.network,!e.options.projectId)throw Error("WalletConnect Adapter: Project ID is undefined");this._projectId=e.options.projectId}async connect(){var e,i,s,r,n,o;if(this._UniversalProvider||await new Promise(h=>{this._ConnectQueueResolver=h}),!this._UniversalProvider)throw new Error("WalletConnect Adapter - Universal Provider was undefined while calling 'connect()'");if(this._UniversalProvider.session){this._session=this._UniversalProvider.session;const h=um(this._session,this._network);return this._network=h,this._UniversalProvider.setDefaultChain(h),{publicKey:this.publicKey}}await this.initModal();const a=yq(this._network);(e=this._modal)==null||e.open();const l=new AbortController,c=l.signal;(i=this._modal)==null||i.subscribeState(h=>{h.open||l.abort(new Zu)});try{const h=await Promise.race([(s=this._UniversalProvider)==null?void 0:s.connect(a),new Promise((d,p)=>{c.addEventListener("abort",()=>{p(c.reason)})})]);if((r=this._modal)==null||r.close(),this._session=h,!h)throw new Bc;const u=um(h,this._network);return this._network=u,(n=this._UniversalProvider)==null||n.setDefaultChain(u),{publicKey:this.publicKey}}catch(h){throw(o=this._modal)==null||o.close(),h}}async disconnect(){var e;if((e=this._UniversalProvider)!=null&&e.session){if(await this.initModal(),!this._modal)throw Error("WalletConnect Adapter -Modal is undefined: unable to disconnect");await this.client.disconnect(),this._session=void 0}else throw new Sn}get client(){if(this._UniversalProvider)return this._UniversalProvider;throw new Sn}get session(){if(!this._session)throw new Sn;return this._session}get publicKey(){var e,i,s;if((e=this._UniversalProvider)!=null&&e.session&&this._session){const{address:r}=bI(((s=(i=this._session)==null?void 0:i.namespaces.solana)==null?void 0:s.accounts[0])??"");return new Xi(r)}throw new Sn}async signTransaction(e){this.checkIfWalletSupportsMethod(Si.signTransaction);const i=ps(e),s=i?{}:e,{signature:r,transaction:n}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:Si.signTransaction,params:{...s,transaction:this.serialize(e)}}});return n?this.deserialize(n,i):(e.addSignature(this.publicKey,N.Buffer.from(ah.decode(r))),e)}async signMessage(e){this.checkIfWalletSupportsMethod(Si.signMessage);const{signature:i}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:Si.signMessage,params:{pubkey:this.publicKey.toString(),message:ah.encode(e)}}});return ah.decode(i)}async signAndSendTransaction(e){this.checkIfWalletSupportsMethod(Si.signAndSendTransaction);const{signature:i}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:Si.signAndSendTransaction,params:{transaction:this.serialize(e)}}});return i}async signAllTransactions(e){try{this.checkIfWalletSupportsMethod(Si.signAllTransactions);const i=e.map(r=>this.serialize(r)),{transactions:s}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:Si.signAllTransactions,params:{transactions:i}}});return e.map((r,n)=>ps(r)?this.deserialize(s[n]??"",!0):this.deserialize(s[n]??""))}catch(i){if(i instanceof hm){const s=e.map(r=>this.signTransaction(r));return await Promise.all(s)}throw i}}async initClient(e){const i=await qD.init(e);this._UniversalProvider=i,this._ConnectQueueResolver&&this._ConnectQueueResolver(!0)}async initModal(){if(!this._modal){if(!this._UniversalProvider)throw new Error("WalletConnect Adapter - cannot init modal when Universal Provider is undefined");this._modal=gq({projectId:this._projectId,universalProvider:this._UniversalProvider,networks:[pu,gu,oq],manualWCControl:!0})}}serialize(e){return N.Buffer.from(e.serialize({verifySignatures:!1})).toString("base64")}deserialize(e,i=!1){return i?lh.deserialize(N.Buffer.from(e,"base64")):hh.from(N.Buffer.from(e,"base64"))}checkIfWalletSupportsMethod(e){var i;if(!((i=this.session.namespaces.solana)!=null&&i.methods.includes(e)))throw new hm(e)}}const bq="WalletConnect";class Iq extends vu{constructor(e){super(),zt(this,"name",bq),zt(this,"url","https://walletconnect.org"),zt(this,"icon","data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE4NSIgdmlld0JveD0iMCAwIDMwMCAxODUiIHdpZHRoPSIzMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTYxLjQzODU0MjkgMzYuMjU2MjYxMmM0OC45MTEyMjQxLTQ3Ljg4ODE2NjMgMTI4LjIxMTk4NzEtNDcuODg4MTY2MyAxNzcuMTIzMjA5MSAwbDUuODg2NTQ1IDUuNzYzNDE3NGMyLjQ0NTU2MSAyLjM5NDQwODEgMi40NDU1NjEgNi4yNzY1MTEyIDAgOC42NzA5MjA0bC0yMC4xMzY2OTUgMTkuNzE1NTAzYy0xLjIyMjc4MSAxLjE5NzIwNTEtMy4yMDUzIDEuMTk3MjA1MS00LjQyODA4MSAwbC04LjEwMDU4NC03LjkzMTE0NzljLTM0LjEyMTY5Mi0zMy40MDc5ODE3LTg5LjQ0Mzg4Ni0zMy40MDc5ODE3LTEyMy41NjU1Nzg4IDBsLTguNjc1MDU2MiA4LjQ5MzYwNTFjLTEuMjIyNzgxNiAxLjE5NzIwNDEtMy4yMDUzMDEgMS4xOTcyMDQxLTQuNDI4MDgwNiAwbC0yMC4xMzY2OTQ5LTE5LjcxNTUwMzFjLTIuNDQ1NTYxMi0yLjM5NDQwOTItMi40NDU1NjEyLTYuMjc2NTEyMiAwLTguNjcwOTIwNHptMjE4Ljc2Nzc5NjEgNDAuNzczNzQ0OSAxNy45MjE2OTcgMTcuNTQ2ODk3YzIuNDQ1NTQ5IDIuMzk0Mzk2OSAyLjQ0NTU2MyA2LjI3NjQ3NjkuMDAwMDMxIDguNjcwODg5OWwtODAuODEwMTcxIDc5LjEyMTEzNGMtMi40NDU1NDQgMi4zOTQ0MjYtNi40MTA1ODIgMi4zOTQ0NTMtOC44NTYxNi4wMDAwNjItLjAwMDAxLS4wMDAwMS0uMDAwMDIyLS4wMDAwMjItLjAwMDAzMi0uMDAwMDMybC01Ny4zNTQxNDMtNTYuMTU0NTcyYy0uNjExMzktLjU5ODYwMi0xLjYwMjY1LS41OTg2MDItMi4yMTQwNCAwLS4wMDAwMDQuMDAwMDA0LS4wMDAwMDcuMDAwMDA4LS4wMDAwMTEuMDAwMDExbC01Ny4zNTI5MjEyIDU2LjE1NDUzMWMtMi40NDU1MzY4IDIuMzk0NDMyLTYuNDEwNTc1NSAyLjM5NDQ3Mi04Ljg1NjE2MTIuMDAwMDg3LS4wMDAwMTQzLS4wMDAwMTQtLjAwMDAyOTYtLjAwMDAyOC0uMDAwMDQ0OS0uMDAwMDQ0bC04MC44MTI0MTk0My03OS4xMjIxODVjLTIuNDQ1NTYwMjEtMi4zOTQ0MDgtMi40NDU1NjAyMS02LjI3NjUxMTUgMC04LjY3MDkxOTdsMTcuOTIxNzI5NjMtMTcuNTQ2ODY3M2MyLjQ0NTU2MDItMi4zOTQ0MDgyIDYuNDEwNTk4OS0yLjM5NDQwODIgOC44NTYxNjAyIDBsNTcuMzU0OTc3NSA1Ni4xNTUzNTdjLjYxMTM5MDguNTk4NjAyIDEuNjAyNjQ5LjU5ODYwMiAyLjIxNDAzOTggMCAuMDAwMDA5Mi0uMDAwMDA5LjAwMDAxNzQtLjAwMDAxNy4wMDAwMjY1LS4wMDAwMjRsNTcuMzUyMTAzMS01Ni4xNTUzMzNjMi40NDU1MDUtMi4zOTQ0NjMzIDYuNDEwNTQ0LTIuMzk0NTUzMSA4Ljg1NjE2MS0uMDAwMi4wMDAwMzQuMDAwMDMzNi4wMDAwNjguMDAwMDY3My4wMDAxMDEuMDAwMTAxbDU3LjM1NDkwMiA1Ni4xNTU0MzJjLjYxMTM5LjU5ODYwMSAxLjYwMjY1LjU5ODYwMSAyLjIxNDA0IDBsNTcuMzUzOTc1LTU2LjE1NDMyNDljMi40NDU1NjEtMi4zOTQ0MDkyIDYuNDEwNTk5LTIuMzk0NDA5MiA4Ljg1NjE2IDB6IiBmaWxsPSIjM2I5OWZjIi8+PC9zdmc+"),zt(this,"supportedTransactionVersions",new Set(["legacy",0])),zt(this,"_publicKey"),zt(this,"_connecting"),zt(this,"_wallet"),zt(this,"_config"),zt(this,"_readyState"),zt(this,"_onDisconnect"),this._publicKey=null,this._connecting=!1,this._config=e,this._wallet=null,this._readyState=typeof window>"u"?oe.Unsupported:oe.Loadable,this._onDisconnect=this.disconnect.bind(this)}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==oe.Loadable)throw new Ks;this._connecting=!0,this._wallet=new vq({network:this._config.network===Ho.Mainnet?Ic.Mainnet:Ic.Devnet,options:this._config.options});const{publicKey:e}=await this._wallet.connect();this._publicKey=e,this.emit("connect",e),this._wallet.client.on("session_delete",this._onDisconnect)}catch(e){throw e.constructor.name==="QRCodeModalError"||e instanceof Error&&e.name==="QRCodeModalError"?new Ab:(this._connecting=!1,e)}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){e.client.off("session_delete",this._onDisconnect),this._publicKey=null;try{e.client.session&&await e.disconnect()}catch(i){console.error("WalletConnectWalletAdapter: disconnect error",i),this.emit("error",new oa(i==null?void 0:i.message,i))}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signTransaction(e)}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signMessage(e)}catch(s){throw new aa(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAndSendTransaction(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signAndSendTransaction(e)}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new $e;try{return await i.signAllTransactions(e)}catch(s){throw new et(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}}const Eq={icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgdmlld0JveD0iMCAwIDI1NiAyNTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF8yMDM1XzExMDYpIj4KPHJlY3Qgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiIGZpbGw9IiM1NEZGRjUiLz4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZl8yMDM1XzExMDYpIj4KPHBhdGggZD0iTTEzLjQ4MDYgMTk4LjYwNUMtMjkuMzI3NiAzMTkuMDQzIDE5OS42NjEgMjg1LjAyNyAzMTkuNTA3IDI1Mi45NjRDNDQyLjE2NSAyMTIuMjU5IDM1Ny4zODYgMzIuODI2OSAyNjkuNDE1IDI4Ljg1NThDMTgxLjQ0MyAyNC44ODQ3IDI4MC4zMjIgMTExLjgyNCAyMDUuNTk1IDEzNi42NTZDMTMwLjg2OCAxNjEuNDg3IDY2Ljk5MDcgNDguMDU4MyAxMy40ODA2IDE5OC42MDVaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxnIGZpbHRlcj0idXJsKCNmaWx0ZXIxX2ZfMjAzNV8xMTA2KSI+CjxwYXRoIGQ9Ik04NS41MTE4IC00NS44MjI1QzYzLjA1NjIgLTEwNy4xNzYgLTE2LjkxODkgLTIzLjk5NTMgLTU0LjA5OTUgMjUuMjY0M0MtODkuNTY1MiA3OC44NDc5IDMuMDA5MzcgMTI1LjE1MiAzOS4zMjA4IDEwMC4wMzdDNzUuNjMyMyA3NC45MjI3IDcuNzc0NDggNzAuMDM2MyAyOS4zNzA4IDM3LjM3ODVDNTAuOTY3MSA0LjcyMDc2IDExMy41ODEgMzAuODY5NSA4NS41MTE4IC00NS44MjI1WiIgZmlsbD0iIzAwRkZGMCIgZmlsbC1vcGFjaXR5PSIwLjY3Ii8+CjwvZz4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjJfZl8yMDM1XzExMDYpIj4KPHBhdGggZD0iTTk2LjQ3OTYgMjI1LjQyNEM2NS44NTAyIDEyMi4zNjMgLTY2LjA4MTggMTc2LjYzNyAtMTI4LjIxOSAyMTYuNjU3Qy0xODcuOTkgMjY0LjA0MiAtNDYuMDcxMSA0MDAuMzQ4IDEyLjg3MjUgMzkzLjM3NkM3MS44MTYxIDM4Ni40MDMgLTM0LjQxMTggMzI3LjA2NSAxLjk4NzAyIDI5OC4xN0MzOC4zODU4IDI2OS4yNzYgMTM0Ljc2NiAzNTQuMjQ5IDk2LjQ3OTYgMjI1LjQyNFoiIGZpbGw9IiM5RDgxRkYiLz4KPC9nPgo8ZyBmaWx0ZXI9InVybCgjZmlsdGVyM19mXzIwMzVfMTEwNikiPgo8cGF0aCBkPSJNMjgyLjEyIC0xMDcuMzUzQzIxNi4wNDcgLTE4Ni4wMzEgMTIxLjQ2MyAtMTIwLjk3IDgyLjQyOTYgLTc4LjYwNDdDNDguMjczOSAtMzAuNjQ0NiAyMjQuMjc1IDU3LjIzMTIgMjczLjEyMSA0Mi4xNzE0QzMyMS45NjggMjcuMTExNSAyMDYuNTEyIC00LjA1MDM4IDIyNy4yOTcgLTMzLjI4NzlDMjQ4LjA4MiAtNjIuNTI1NSAzNjQuNzEyIC05LjAwNTY2IDI4Mi4xMiAtMTA3LjM1M1oiIGZpbGw9IiM0RDk0RkYiLz4KPC9nPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTkzLjE4OSAxNTIuODM2SDEzNi42NzRMODcuMjA4NiAxMDMuMDUxTDEzNy4zMSA1My4yNjYzTDE1MC45NTUgNDBIMTA1LjgxOUw0OC4zMzU5IDk3Ljc3NzNDNDUuNDM0OSAxMDAuNjg5IDQ1LjQ0OTggMTA1LjQwMiA0OC4zNjU2IDEwOC4yOTlMOTMuMTg5IDE1Mi44MzZaTTExOS4zMyAxMDMuMTY4SDExOC45OTVMMTE5LjMyNiAxMDMuMTY0TDExOS4zMyAxMDMuMTY4Wk0xMTkuMzMgMTAzLjE2OEwxNjguNzkxIDE1Mi45NDlMMTE4LjY5IDIwMi43MzRMMTA1LjA0NSAyMTZIMTUwLjE4TDIwNy42NjQgMTU4LjIyNkMyMTAuNTY1IDE1NS4zMTQgMjEwLjU1IDE1MC42MDIgMjA3LjYzNCAxNDcuNzA1TDE2Mi44MTEgMTAzLjE2OEgxMTkuMzNaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2ZfMjAzNV8xMTA2IiB4PSItOTAuMjQxMSIgeT0iLTY5LjczNjkiIHdpZHRoPSI1NjkuNTU4IiBoZWlnaHQ9IjQ1MS40MzEiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNDkuMjMwOCIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzIwMzVfMTEwNiIvPgo8L2ZpbHRlcj4KPGZpbHRlciBpZD0iZmlsdGVyMV9mXzIwMzVfMTEwNiIgeD0iLTE2MC41MTEiIHk9Ii0xNjUuOTg3IiB3aWR0aD0iMzUxLjU5NiIgaGVpZ2h0PSIzNzEuNTA3IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9InNoYXBlIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQ5LjIzMDgiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl8yMDM1XzExMDYiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjJfZl8yMDM1XzExMDYiIHg9Ii0yNDEuMDc4IiB5PSI2Ny42NDIiIHdpZHRoPSI0NDQuODUxIiBoZWlnaHQ9IjQyNC40NTIiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNDkuMjMwOCIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzIwMzVfMTEwNiIvPgo8L2ZpbHRlcj4KPGZpbHRlciBpZD0iZmlsdGVyM19mXzIwMzVfMTEwNiIgeD0iLTIwLjM5NjgiIHk9Ii0yNDIuNzU4IiB3aWR0aD0iNDMwLjE5MSIgaGVpZ2h0PSIzODUuMTA1IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9InNoYXBlIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQ5LjIzMDgiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl8yMDM1XzExMDYiLz4KPC9maWx0ZXI+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMjAzNV8xMTA2Ij4KPHJlY3Qgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==",name:"Bitget Wallet"},Nq=[Eq],Aq=t=>Nq.find(e=>e.name.toLocaleLowerCase().includes(t.name.toLocaleLowerCase()))||t,_q=(t,e,i)=>e[t]||i[t],dm=(t,e)=>_q(t,Aq(e),e);class Cs extends ob{constructor(e,i){super(),this.adapter=e,this.connection=i}getAdapter(){return this.adapter}getName(){return dm("name",this.adapter)}getUrl(){return this.adapter.url}async connect(){if(this.isConnected())return this.getAddresses();const e=await new Promise((i,s)=>{this.adapter.on("connect",()=>{this.adapter.off("connect"),this.adapter.off("error"),i(this.getAddresses())}),this.adapter.on("error",r=>{this.adapter.off("connect"),this.adapter.off("error"),s(r)}),this.adapter.connect().catch(s)});return this.emit("connect"),this.adapter.on("disconnect",()=>this.emit("disconnect")),e}getNetworkInfo(){return{}}isConnected(){return this.adapter.connected}async disconnect(){this.isConnected()&&(await new Promise((e,i)=>{this.adapter.on("disconnect",()=>{this.adapter.off("disconnect"),this.adapter.off("error"),e(void 0)}),this.adapter.on("error",s=>{this.adapter.off("disconnect"),this.adapter.off("error"),i(s)}),this.adapter.disconnect().catch(i)}),this.adapter.removeAllListeners(),this.emit("disconnect"))}getChainId(){return Ju}getAddress(){var e;return(e=this.adapter.publicKey)==null?void 0:e.toString()}getAddresses(){const e=this.getAddress();return e?[e]:[]}setMainAddress(){throw new Error("Not supported")}getBalance(){throw new Error("Not supported")}async signTransaction(e){if(!this.adapter.signTransaction||!this.adapter.signAllTransactions)throw new Error("Not supported");return Array.isArray(e)?this.adapter.signAllTransactions(e):this.adapter.signTransaction(e)}async sendTransaction(e){var i;const{transaction:s}=e,r=Array.isArray(s)?s:[s];if(r.length===0)throw new Error("Empty transactions array");const n=[];for(const o of r){const a=await this.adapter.sendTransaction(o,this.connection,{...e.options});n.push(a)}return await this.connection.confirmTransaction(n[0],(i=e.options)==null?void 0:i.commitment),{id:n[0],data:n.length===1?n[0]:n}}async signAndSendTransaction(e){return this.sendTransaction(e)}signMessage(e){if(!this.adapter.signMessage)throw new Error("Not supported");return this.adapter.signMessage(e)}getIcon(){return dm("icon",this.adapter)}getWalletState(){const e=this.adapter.readyState;if(!(e in Xu))throw new Error(`Unknown wallet state ${e}`);return Xu[e]}getFeatures(){const e=[Sa.SendTransaction,Sa.SignAndSendTransaction];return this.adapter.signTransaction&&this.adapter.signAllTransactions&&e.push(Sa.SignTransaction),this.adapter.signMessage&&e.push(Sa.SignMessage),e}supportsChain(e){return e===Ju}}function Cq(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let c=0;c<e.length;c++)e[c]=255;for(let c=0;c<t.length;c++){const h=t.charAt(c),u=h.charCodeAt(0);if(e[u]!==255)throw new TypeError(h+" is ambiguous");e[u]=c}const i=t.length,s=t.charAt(0),r=Math.log(i)/Math.log(256),n=Math.log(256)/Math.log(i);function o(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";let h=0,u=0,d=0;const p=c.length;for(;d!==p&&c[d]===0;)d++,h++;const g=(p-d)*n+1>>>0,f=new Uint8Array(g);for(;d!==p;){let y=c[d],v=0;for(let I=g-1;(y!==0||v<u)&&I!==-1;I--,v++)y+=256*f[I]>>>0,f[I]=y%i>>>0,y=y/i>>>0;if(y!==0)throw new Error("Non-zero carry");u=v,d++}let w=g-u;for(;w!==g&&f[w]===0;)w++;let m=s.repeat(h);for(;w<g;++w)m+=t.charAt(f[w]);return m}function a(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;let h=0,u=0,d=0;for(;c[h]===s;)u++,h++;const p=(c.length-h)*r+1>>>0,g=new Uint8Array(p);for(;h<c.length;){const y=c.charCodeAt(h);if(y>255)return;let v=e[y];if(v===255)return;let I=0;for(let S=p-1;(v!==0||I<d)&&S!==-1;S--,I++)v+=i*g[S]>>>0,g[S]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");d=I,h++}let f=p-d;for(;f!==p&&g[f]===0;)f++;const w=new Uint8Array(u+(p-f));let m=u;for(;f!==p;)w[m++]=g[f++];return w}function l(c){const h=a(c);if(h)return h;throw new Error("Non-base"+i+" character")}return{encode:o,decodeUnsafe:a,decode:l}}var Sq="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Pq=Cq(Sq);var K=function(t,e,i,s){if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?s:i==="a"?s.call(t):s?s.value:e.get(t)},ot=function(t,e,i,s,r){if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i},Mt,si,dr,pr,rr,xo,zc,me,$c,fu,yc,mu,qo,wu,pm,gm,fm,mm;class Tq extends Om{get name(){return K(this,me,"f").name}get url(){return"https://github.com/solana-labs/wallet-standard"}get icon(){return K(this,me,"f").icon}get readyState(){return K(this,$c,"f")}get publicKey(){return K(this,dr,"f")}get connecting(){return K(this,pr,"f")}get supportedTransactionVersions(){return K(this,zc,"f")}get wallet(){return K(this,me,"f")}get standard(){return!0}constructor({wallet:e}){super(),Mt.add(this),si.set(this,void 0),dr.set(this,void 0),pr.set(this,void 0),rr.set(this,void 0),xo.set(this,void 0),zc.set(this,void 0),me.set(this,void 0),$c.set(this,typeof window>"u"||typeof document>"u"?oe.Unsupported:oe.Installed),wu.set(this,i=>{if("accounts"in i){const s=K(this,me,"f").accounts[0];K(this,si,"f")&&!K(this,rr,"f")&&s!==K(this,si,"f")&&(s?K(this,Mt,"m",yc).call(this,s):(this.emit("error",new Mm),K(this,Mt,"m",mu).call(this)))}"features"in i&&K(this,Mt,"m",qo).call(this)}),ot(this,me,e),ot(this,si,null),ot(this,dr,null),ot(this,pr,!1),ot(this,rr,!1),ot(this,xo,K(this,me,"f").features[km].on("change",K(this,wu,"f"))),K(this,Mt,"m",qo).call(this)}destroy(){ot(this,si,null),ot(this,dr,null),ot(this,pr,!1),ot(this,rr,!1);const e=K(this,xo,"f");e&&(ot(this,xo,null),e())}async autoConnect(){return K(this,Mt,"m",fu).call(this,{silent:!0})}async connect(){return K(this,Mt,"m",fu).call(this)}async disconnect(){if(od in K(this,me,"f").features)try{ot(this,rr,!0,"f"),await K(this,me,"f").features[od].disconnect()}catch(e){this.emit("error",new oa(e==null?void 0:e.message,e))}finally{ot(this,rr,!1)}K(this,Mt,"m",mu).call(this)}async sendTransaction(e,i,s={}){try{const r=K(this,si,"f");if(!r)throw new $e;let n;if(xs in K(this,me,"f").features)if(r.features.includes(xs))n=xs;else if(Tt in K(this,me,"f").features&&r.features.includes(Tt))n=Tt;else throw new Pi;else if(Tt in K(this,me,"f").features){if(!r.features.includes(Tt))throw new Pi;n=Tt}else throw new Nn;const o=Vb(i.rpcEndpoint);if(!r.chains.includes(o))throw new cr;try{const{signers:a,...l}=s;let c;if(ps(e)?(a!=null&&a.length&&e.sign(a),c=e.serialize()):(e=await this.prepareTransaction(e,i,l),a!=null&&a.length&&e.partialSign(...a),c=new Uint8Array(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))),n===xs){const[h]=await K(this,me,"f").features[xs].signAndSendTransaction({account:r,chain:o,transaction:c,options:{preflightCommitment:dl(l.preflightCommitment||i.commitment),skipPreflight:l.skipPreflight,maxRetries:l.maxRetries,minContextSlot:l.minContextSlot}});return Pq.encode(h.signature)}else{const[h]=await K(this,me,"f").features[Tt].signTransaction({account:r,chain:o,transaction:c,options:{preflightCommitment:dl(l.preflightCommitment||i.commitment),minContextSlot:l.minContextSlot}});return await i.sendRawTransaction(h.signedTransaction,{...l,preflightCommitment:dl(l.preflightCommitment||i.commitment)})}}catch(a){throw a instanceof kt?a:new cr(a==null?void 0:a.message,a)}}catch(r){throw this.emit("error",r),r}}}si=new WeakMap,dr=new WeakMap,pr=new WeakMap,rr=new WeakMap,xo=new WeakMap,zc=new WeakMap,me=new WeakMap,$c=new WeakMap,wu=new WeakMap,Mt=new WeakSet,fu=async function(t){try{if(this.connected||this.connecting)return;if(K(this,$c,"f")!==oe.Installed)throw new Ks;if(ot(this,pr,!0,"f"),!K(this,me,"f").accounts.length)try{await K(this,me,"f").features[xm].connect(t)}catch(i){throw new Bc(i==null?void 0:i.message,i)}const e=K(this,me,"f").accounts[0];if(!e)throw new Pi;K(this,Mt,"m",yc).call(this,e)}catch(e){throw this.emit("error",e),e}finally{ot(this,pr,!1)}},yc=function(t){let e;try{e=new Xi(t.address)}catch(i){throw new _r(i==null?void 0:i.message,i)}ot(this,si,t),ot(this,dr,e),K(this,Mt,"m",qo).call(this),this.emit("connect",e)},mu=function(){ot(this,si,null),ot(this,dr,null),K(this,Mt,"m",qo).call(this),this.emit("disconnect")},qo=function(){var t,e;const i=xs in K(this,me,"f").features?K(this,me,"f").features[xs].supportedTransactionVersions:K(this,me,"f").features[Tt].supportedTransactionVersions;ot(this,zc,ub(i,["legacy"])?null:new Set(i)),Tt in K(this,me,"f").features&&(t=K(this,si,"f"))!=null&&t.features.includes(Tt)?(this.signTransaction=K(this,Mt,"m",pm),this.signAllTransactions=K(this,Mt,"m",gm)):(delete this.signTransaction,delete this.signAllTransactions),io in K(this,me,"f").features&&(e=K(this,si,"f"))!=null&&e.features.includes(io)?this.signMessage=K(this,Mt,"m",fm):delete this.signMessage,hl in K(this,me,"f").features?this.signIn=K(this,Mt,"m",mm):delete this.signIn},pm=async function(t){try{const e=K(this,si,"f");if(!e)throw new $e;if(!(Tt in K(this,me,"f").features))throw new Nn;if(!e.features.includes(Tt))throw new Pi;try{const i=(await K(this,me,"f").features[Tt].signTransaction({account:e,transaction:ps(t)?t.serialize():new Uint8Array(t.serialize({requireAllSignatures:!1,verifySignatures:!1}))}))[0].signedTransaction;return ps(t)?lh.deserialize(i):hh.from(i)}catch(i){throw i instanceof kt?i:new et(i==null?void 0:i.message,i)}}catch(e){throw this.emit("error",e),e}},gm=async function(t){try{const e=K(this,si,"f");if(!e)throw new $e;if(!(Tt in K(this,me,"f").features))throw new Nn;if(!e.features.includes(Tt))throw new Pi;try{const i=await K(this,me,"f").features[Tt].signTransaction(...t.map(s=>({account:e,transaction:ps(s)?s.serialize():new Uint8Array(s.serialize({requireAllSignatures:!1,verifySignatures:!1}))})));return t.map((s,r)=>{const n=i[r].signedTransaction;return ps(s)?lh.deserialize(n):hh.from(n)})}catch(i){throw new et(i==null?void 0:i.message,i)}}catch(e){throw this.emit("error",e),e}},fm=async function(t){try{const e=K(this,si,"f");if(!e)throw new $e;if(!(io in K(this,me,"f").features))throw new Nn;if(!e.features.includes(io))throw new Pi;try{return(await K(this,me,"f").features[io].signMessage({account:e,message:t}))[0].signature}catch(i){throw new aa(i==null?void 0:i.message,i)}}catch(e){throw this.emit("error",e),e}},mm=async function(t={}){try{if(!(hl in K(this,me,"f").features))throw new Nn;let e;try{[e]=await K(this,me,"f").features[hl].signIn(t)}catch(i){throw new nd(i==null?void 0:i.message,i)}if(!e)throw new nd;return K(this,Mt,"m",yc).call(this,e.account),e}catch(e){throw this.emit("error",e),e}};function Mq(t){return db().get().filter(_b).map(e=>new Cs(new Tq({wallet:e}),t))}function Oq(t){return t.includes("rpcpool.com")?"triton":t.includes("helius-rpc.com")?"helius":t.includes("rpc.ankr.com")?"ankr":"unknown"}async function xq(t,e,i,s){const r=s.transaction.transaction,n=o=>o.programId.toString()!=="ComputeBudget111111111111111111111111111111";if(ch(r)){const o=(await Promise.all(r.message.addressTableLookups.map(l=>t.getAddressLookupTable(l.accountKey)))).map(l=>l.value).filter(l=>l!==null),a=ab.decompile(r.message,{addressLookupTableAccounts:o});a.recentBlockhash=e,r.message.recentBlockhash=e,a.instructions=a.instructions.filter(n),a.instructions.push(...await wm(t,r)),r.message=a.compileToV0Message(o),r.sign(s.transaction.signers??[])}else r.recentBlockhash=e,r.lastValidBlockHeight=i,r.instructions=r.instructions.filter(n),r.add(...await wm(t,r)),s.transaction.signers&&r.partialSign(...s.transaction.signers);return r}async function wm(t,e,i){var s,r;let n=2e5,o=0;e:for(;;){if(ch(e)&&!e.message.recentBlockhash){const{blockhash:I}=await t.getLatestBlockhash(i);e.message.recentBlockhash=I}const v=await(ch(e)?t.simulateTransaction(e,{commitment:i,replaceRecentBlockhash:!0}):t.simulateTransaction(e));if(v.value.err){if(kq(v.value)){if(o<5){o++,await ed(1e3);continue e}}else if(o<3){o++,await ed(1e3);continue e}throw new Error(`Simulation failed: ${JSON.stringify(v.value.err)}
Logs:
${(v.value.logs||[]).join(`
  `)}`)}else{v.value.unitsConsumed&&(n=v.value.unitsConsumed);break}}const a=Math.floor(n*1.2),l=[];l.push(td.setComputeUnitLimit({units:a}));const c=((r=(s=Os.transactionSettings)==null?void 0:s.Solana)==null?void 0:r.priorityFee)||{},{percentile:h=.9,percentileMultiple:u=1,min:d=1e5,max:p=1e8}=c,g=async v=>{if(v==="triton")try{return{fee:await pb(t,e,h,u,d,p),methodUsed:"triton"}}catch(I){console.warn("Failed to determine priority fee using Triton RPC:",I)}try{return{fee:await gb(t,e,h,u,d,p),methodUsed:"default"}}catch(I){return console.warn("Failed to determine priority fee using Triton RPC:",I),{fee:d,methodUsed:"minimum"}}},f=Oq(t.rpcEndpoint),{fee:w,methodUsed:m}=await g(f),y=w/1e6/lb*a;return console.table({"RPC Provider":f,"Method used":m,"Percentile used":h,"Multiple used":u,"Compute budget":a,"Priority fee":w,"Max fee in SOL":y}),l.push(td.setComputeUnitPrice({microLamports:w})),l}function kq(t){const e={};if(t.err==="BlockhashNotFound"&&(e.BlockhashNotFound="Blockhash not found during simulation. Trying again."),t.logs)for(const i of t.logs)i.includes("SlippageToleranceExceeded")&&(e.SlippageToleranceExceeded="Slippage failure during simulation. Trying again."),i.includes("RequireGteViolated")&&(e.RequireGteViolated="Swap instruction failure during simulation. Trying again.");return cb(e)?!1:(console.table(e),!0)}const Dq=t=>t.getName().toLowerCase().replaceAll("wallet","").trim();function jq(){const t=Os.isMainnet?"mainnet-beta":"devnet",e=new ym(Os.rpcs.Solana||nb(t));return{...Mq(e).reduce((i,s)=>(i[Dq(s)]=s,i),{}),bitget:new Cs(new Sb,e),clover:new Cs(new Tb,e),coin98:new Cs(new kb,e),solong:new Cs(new $b,e),torus:new Cs(new Bb,e),nightly:new Cs(new jb,e),...Os.ui.walletConnectProjectId?{walletConnect:new Cs(new Iq({network:Os.isMainnet?Ho.Mainnet:Ho.Devnet,options:{projectId:Os.ui.walletConnectProjectId,customStoragePrefix:"wh-connect-solana-adapter"}}),e)}:{}}}async function Rq(t,e,i){if(!e)throw new Error("Wallet not found");if(!Os.rpcs.Solana)throw new Error("Solana RPC not found");const s=(i==null?void 0:i.commitment)??"finalized",r=new ym(Os.rpcs.Solana),{blockhash:n,lastValidBlockHeight:o}=await r.getLatestBlockhash(s),a=await xq(r,n,o,t);let l=null,c=null,h=1,u="";const d=(await e.signTransaction(a)).serialize(),p={skipPreflight:!0,maxRetries:0,preFlightCommitment:s};u=await r.sendRawTransaction(d,p),l=r.confirmTransaction({signature:u,blockhash:n,lastValidBlockHeight:o},s);const g=5e3;for(;!c&&(c=await Promise.race([l,new Promise(f=>setTimeout(()=>{f(null)},g))]),!c);){console.log(`Tx not confirmed after ${g*h++}ms, resending`);try{await r.sendRawTransaction(d,p)}catch(f){console.error("Failed to resend transaction:",f)}}if(c.value.err){let f=`Transaction failed: ${c.value.err}`;if(typeof c.value.err=="object")try{f=`Transaction failed: ${JSON.stringify(c.value.err,(w,m)=>typeof m=="bigint"?m.toString():m)}`}catch{f="Transaction failed: Unknown error"}throw new Error(`Transaction failed: ${f}`)}return u}const n6=Object.freeze(Object.defineProperty({__proto__:null,fetchOptions:jq,signAndSendTransaction:Rq},Symbol.toStringTag,{value:"Module"}));export{jj as $,se as A,Z as B,te as C,t6 as D,ze as E,Vq as F,fd as G,iI as H,Hm as I,K0 as J,sI as K,Wq as L,ct as M,Hq as N,D as O,Vc as P,Fq as Q,Se as R,G as S,Wt as T,Kq as U,Dj as V,uu as W,Yq as X,yg as Y,ky as Z,Aj as _,wc as a,Qq as a0,Gq as a1,sl as a2,Jq as a3,Zq as a4,n6 as a5,ie as b,fc as c,Ey as d,s6 as e,Le as f,Y as g,$i as h,On as i,Ot as j,ni as k,e6 as l,b as m,Et as n,r6 as o,Gv as p,qn as q,i6 as r,Je as s,vi as t,du as u,Ft as v,ac as w,Xq as x,q8 as y,jo as z};
